import{h as N}from"./http-DGyH82Tn.js";import{r as b,c as d}from"./vendor-vue-fFWwKrgY.js";function h(t){if(t==null)return[];if(Array.isArray(t))return t;if(typeof t=="object"){const e=t.items;return Array.isArray(e)?e:[]}return[]}function m(t,e){const n=Number(e);return Number.isFinite(n)?n:t}function S(t){const e=Number(t);return Number.isFinite(e)?e:null}function F(t){const e=t&&typeof t=="object"?t:{},n=e.extra&&typeof e.extra=="object"?e.extra:{},r=String(e.field_name??"").trim();if(!r)return null;const i=S(n.ui_default_list_order),f=n.finance_list_width,c=f==null?void 0:m(void 0,f);return{key:r,label:String(e.label??""),type:String(e.type??"text"),sort:m(0,e.sort),required:e.required===!0,editable:e.editable!==!1,visible:e.visible!==!1,options:h(e.options),show_in_list:n.show_in_list===!0,list_width:m(150,n.list_width),show_in_finance_list:n.show_in_finance_list===!0,finance_list_width:c,ui_default_list:n.ui_default_list===!0,ui_default_list_order:i}}function T(){const t=b(!1),e=b([]),n=d(()=>{const u=[],s=Array.isArray(e.value)?e.value:[];for(const o of s){const l=Array.isArray(o?.fields)?o.fields:[];for(const a of l){const g=F(a);g&&u.push(g)}}return u.sort((o,l)=>o.sort-l.sort),u});function r(u){return[...u].sort((s,o)=>{const l=s.ui_default_list_order??s.sort??0,a=o.ui_default_list_order??o.sort??0;return l-a})}const i=d(()=>{const u=n.value.filter(s=>s.show_in_list);return u.length?r(u):n.value.slice(0,5)}),f=d(()=>{const u=n.value.filter(o=>o.show_in_finance_list);if(u.length)return r(u);const s=n.value.filter(o=>o.show_in_list);return s.length?r(s).slice(0,3):n.value.slice(0,3)});async function c(u="order"){t.value=!0;try{const s=await N.get("/field-config/form-config",{params:{module:u}});e.value=Array.isArray(s?.data)?s.data:[]}catch(s){console.error(s),e.value=[]}finally{t.value=!1}}return{groups:e,allFields:n,listFields:i,financeFields:f,loadingConfig:t,loadConfig:c}}function w(t,e){if(!t||!t.length)return"";for(const n of t)if(n&&typeof n=="object"){if(String(n.value)===String(e))return n.label??String(n.value??"")}else if(String(n)===String(e))return String(n);return""}function p(t){return typeof t=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(t)}function _(t){return typeof t=="string"&&/^\d{8}$/.test(t)}function A(t){return _(t)?`${t.slice(0,4)}-${t.slice(4,6)}-${t.slice(6,8)}`:t}function y(t){return String(t).padStart(2,"0")}function x(t){if(t==null||t==="")return"";const e=String(t).trim();if(!e)return"";if(p(e))return e;if(_(e))return A(e);const n=D(t);if(n){const r=n.getFullYear(),i=y(n.getMonth()+1),f=y(n.getDate());return`${r}-${i}-${f}`}return e}function D(t){if(typeof t=="number"&&Number.isFinite(t)){const n=t,r=n<1e12?n*1e3:n,i=new Date(r);return Number.isNaN(i.getTime())?null:i}const e=String(t??"").trim();if(!e||p(e))return null;if(_(e)){const n=Number(e.slice(0,4)),r=Number(e.slice(4,6)),i=Number(e.slice(6,8));if(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)&&r>=1&&r<=12&&i>=1&&i<=31){const f=new Date(n,r-1,i);if(!Number.isNaN(f.getTime()))return f}return null}if(/^\d+$/.test(e)){const n=Number(e);if(Number.isFinite(n)){const r=e.length===10?n*1e3:n,i=new Date(r);if(!Number.isNaN(i.getTime()))return i}}try{const n=new Date(e);if(!Number.isNaN(n.getTime()))return n}catch{}return null}function L(t,e){if(t==null||t==="")return"";const n=e?.type??"text";return n==="select"?w(e.options,t)||String(t):n==="date"?x(t):n==="image"?"[图片]":String(t)}export{L as f,T as u};
