import{h}from"./http-CBIyYC5i.js";import{r as g,c as _}from"./vendor-vue-fFWwKrgY.js";function b(t){if(!t)return[];if(Array.isArray(t))return t;if(typeof t=="object"&&t!==null){const r=t.items;return Array.isArray(r)?r:[]}return[]}function T(){const t=g(!1),r=g([]),e=_(()=>{const o=[];return(r.value||[]).forEach(i=>{(i.fields||[]).forEach(n=>o.push(n))}),o.sort((i,n)=>(i.sort??0)-(n.sort??0)),o.map(i=>{const n=i.field_name,l=i.label??"",c=i.type??"text",f=i.extra??{},a=typeof f.ui_default_list_order=="number"?f.ui_default_list_order:null;return{key:n,label:l,type:c,sort:i.sort??0,required:!!i.required,editable:i.editable!==!1,options:b(i.options),show_in_list:f.show_in_list===!0,list_width:f.list_width??150,show_in_finance_list:f.show_in_finance_list===!0,finance_list_width:f.finance_list_width??void 0,ui_default_list:f.ui_default_list===!0,ui_default_list_order:a}}).filter(i=>!!i.key)}),u=_(()=>{const o=e.value.filter(i=>i.show_in_list);return o.length?[...o].sort((i,n)=>{const l=i.ui_default_list_order!=null?i.ui_default_list_order:i.sort??0,c=n.ui_default_list_order!=null?n.ui_default_list_order:n.sort??0;return l-c}):e.value.slice(0,5)}),s=_(()=>{const o=e.value.filter(n=>n.show_in_finance_list);if(o.length)return[...o].sort((n,l)=>{const c=n.ui_default_list_order!=null?n.ui_default_list_order:n.sort??0,f=l.ui_default_list_order!=null?l.ui_default_list_order:l.sort??0;return c-f});const i=e.value.filter(n=>n.show_in_list);return i.length?[...i].sort((l,c)=>{const f=l.ui_default_list_order!=null?l.ui_default_list_order:l.sort??0,a=c.ui_default_list_order!=null?c.ui_default_list_order:c.sort??0;return f-a}).slice(0,3):e.value.slice(0,3)});async function d(o="order"){t.value=!0;try{const i=await h.get("/field-config/form-config",{params:{module:o}});r.value=i.data||[]}catch(i){console.error(i),r.value=[]}finally{t.value=!1}}return{groups:r,allFields:e,listFields:u,financeFields:s,loadingConfig:t,loadConfig:d}}function N(t,r){if(!t||!t.length)return"";for(const e of t)if(e&&typeof e=="object"){if(String(e.value)===String(r))return e.label??String(e.value??"")}else if(String(e)===String(r))return String(e);return""}function y(t){return typeof t=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(t)}function m(t){return typeof t=="string"&&/^\d{8}$/.test(t)}function S(t){return m(t)?`${t.slice(0,4)}-${t.slice(4,6)}-${t.slice(6,8)}`:t}function p(t){return String(t).padStart(2,"0")}function w(t){if(t==null||t==="")return"";const r=String(t).trim();if(!r)return"";if(y(r))return r;if(m(r))return S(r);const e=F(t);if(e){const u=e.getFullYear(),s=p(e.getMonth()+1),d=p(e.getDate());return`${u}-${s}-${d}`}return r}function F(t){if(typeof t=="number"&&Number.isFinite(t)){const e=t,u=e<1e12?e*1e3:e,s=new Date(u);return Number.isNaN(s.getTime())?null:s}const r=String(t??"").trim();if(!r||y(r))return null;if(m(r)){const e=Number(r.slice(0,4)),u=Number(r.slice(4,6)),s=Number(r.slice(6,8));if(Number.isFinite(e)&&Number.isFinite(u)&&Number.isFinite(s)&&u>=1&&u<=12&&s>=1&&s<=31){const d=new Date(e,u-1,s);if(!Number.isNaN(d.getTime()))return d}return null}if(/^\d+$/.test(r)){const e=Number(r);if(Number.isFinite(e)){const u=r.length===10?e*1e3:e,s=new Date(u);if(!Number.isNaN(s.getTime()))return s}}try{const e=new Date(r);if(!Number.isNaN(e.getTime()))return e}catch{}return null}function x(t,r){if(t==null||t==="")return"";const e=r?.type??"text";return e==="select"?N(r.options,t)||String(t):e==="date"?w(t):e==="image"?"[图片]":String(t)}export{x as f,T as u};
