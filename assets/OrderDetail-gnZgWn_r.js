import{u as H,b as P}from"./vendor-vue-router-o2a2TmKO.js";import{g as U,a as E}from"./orders-f2TW8mPj.js";import{f as $}from"./fieldFormat-kkRAEXYp.js";import{_ as K}from"./index-ql1pe5O8.js";import{E as c,d as I}from"./vendor-element-plus-nv6hIq5t.js";import{r as v,c as Q,q as W,x as o,z as k,P as z,G as n,J as M,H as l,ay as d,O as A,ac as C,y as r,L as f,M as g}from"./vendor-vue-CZOMRj4y.js";import"./http-DGyH82Tn.js";import"./vendor-axios-C0Zqfgkc.js";import"./vendor-pinia--LqfdQ-h.js";import"./vendor-lodash-rvV0CIkQ.js";import"./vendor-DWCz07M-.js";import"./vendor-dates-DVKSwKij.js";const X={class:"order-detail"},Y={class:"detail-header"},Z={class:"header-actions"},ee={key:0,class:"loading-wrap"},ae={key:1,class:"detail-body"},te={class:"block-title"},re={key:2,class:"json-dump"},se={__name:"OrderDetail",setup(oe){const B=P(),S=H();function F(a){const e=Number(typeof a=="string"?a.trim():a);if(!Number.isFinite(e)||!Number.isInteger(e)||e<=0)throw new Error("invalid order id");return e}const _=(()=>{try{return F(S.params.id)}catch{return 0}})(),u=v(!1),i=v(!1),m=v({source:"orders",capabilities:{}}),y=v([]),O=Q(()=>{const a=m.value&&typeof m.value=="object"?m.value:{};return a.capabilities&&typeof a.capabilities=="object"?a.capabilities:{}});function J(){B.back()}function R(a){try{return JSON.stringify(a,null,2)}catch{return String(a??"")}}function L(a){const e=a&&typeof a=="object"?a:{},p=e.meta&&typeof e.meta=="object"?e.meta:{source:"orders",capabilities:{}},b=Array.isArray(e.blocks)?e.blocks:null,w=!b&&Array.isArray(e.items)?e.items:null;return{meta:p,blocks:b||w||[]}}async function h(){if(!_){c.error("订单ID无效"),B.replace("/orders/all");return}u.value=!0;try{const a=await U(_),e=L(a?.data??a??{});m.value=e.meta,y.value=e.blocks}catch(a){console.error(a),c.error("加载失败"),m.value={source:"orders",capabilities:{}},y.value=[]}finally{u.value=!1}}function V(a,e){return $(a,e)}async function T(){try{await I.confirm("确认将该订单标记为完成？","确认",{type:"warning"})}catch{return}i.value=!0;try{await E(_,{is_finished:!0}),c.success("已标记完成"),await h()}catch(a){console.error(a),c.error("操作失败")}finally{i.value=!1}}async function q(){try{await I.confirm("确认将该订单退回未完成？","确认",{type:"warning"})}catch{return}i.value=!0;try{await E(_,{is_finished:!1}),c.success("已退回未完成"),await h()}catch(a){console.error(a),c.error("操作失败")}finally{i.value=!1}}return W(h),(a,e)=>{const p=d("el-button"),b=d("el-divider"),w=d("el-skeleton"),x=d("el-descriptions-item"),D=d("el-descriptions"),G=d("el-empty");return r(),o("div",X,[k("div",Y,[e[3]||(e[3]=k("h2",null,"订单详情",-1)),k("div",Z,[z(p,{size:"small",onClick:J},{default:l(()=>[...e[0]||(e[0]=[f("返回",-1)])]),_:1}),O.value.can_reopen?(r(),n(p,{key:0,size:"small",type:"warning",plain:"",loading:i.value,disabled:u.value,onClick:q},{default:l(()=>[...e[1]||(e[1]=[f(" 退回未完成 ",-1)])]),_:1},8,["loading","disabled"])):M("",!0),O.value.can_mark_finished?(r(),n(p,{key:1,size:"small",type:"success",plain:"",loading:i.value,disabled:u.value,onClick:T},{default:l(()=>[...e[2]||(e[2]=[f(" 标记完成 ",-1)])]),_:1},8,["loading","disabled"])):M("",!0)])]),z(b),u.value?(r(),o("div",ee,[z(w,{rows:8,animated:""})])):(r(),o("div",ae,[y.value.length?(r(!0),o(A,{key:0},C(y.value,(s,j)=>(r(),o("div",{key:s.key||s.block_key||s.name||j,class:"detail-block"},[k("div",te,g(s.title||s.group_name||s.name||`区块 ${j+1}`),1),Array.isArray(s.items)&&s.items.length?(r(),n(D,{key:0,column:2,border:"",size:"small"},{default:l(()=>[(r(!0),o(A,null,C(s.items,(t,N)=>(r(),n(x,{key:t.key||t.field_name||t.label||N,label:t.label||t.field_label||t.key||t.field_name||"-"},{default:l(()=>[f(g(V(t.value,t)),1)]),_:2},1032,["label"]))),128))]),_:2},1024)):Array.isArray(s.fields)&&s.fields.length?(r(),n(D,{key:1,column:2,border:"",size:"small"},{default:l(()=>[(r(!0),o(A,null,C(s.fields,(t,N)=>(r(),n(x,{key:t.key||t.field_name||t.label||N,label:t.label||t.field_label||t.key||t.field_name||"-"},{default:l(()=>[f(g(V(t.value,t)),1)]),_:2},1032,["label"]))),128))]),_:2},1024)):(r(),o("pre",re,g(R(s)),1))]))),128)):(r(),n(G,{key:1,description:"暂无详情数据"}))]))])}}},ve=K(se,[["__scopeId","data-v-5cdba6b1"]]);export{ve as default};
