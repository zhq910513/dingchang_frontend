import{u as il,b as al}from"./vendor-vue-router-CVyACjsp.js";import{E as M,c as Ce,a as Ie,d as ke}from"./vendor-element-plus-CtVxZ4Oy.js";import{V as sl}from"./VehicleCertTable-DSrKGvfc.js";import{h as Ae}from"./http-DGyH82Tn.js";import{g as ol,f as rl,u as dl,a as ul,b as cl}from"./orders-DVGDUW2c.js";import{g as ml,f as vl,u as _l}from"./finance-D7CYzIUW.js";import{_ as pl,u as fl}from"./index-Ddpn8viq.js";import{u as gl,f as kl}from"./fieldFormat-B0eaWt9f.js";import{u as yl}from"./bosUpload-Bf8-Xtq-.js";import{c as E,r as O,o as ye,Z as be,q as bl,x as c,z as l,I as hl,P as s,H as g,ay as P,O as F,G as N,J as C,aI as Vl,y as r,L as T,M as B,ac as Y,u as _,l as Xe,ai as H,D as Ze}from"./vendor-vue-fFWwKrgY.js";import"./vendor-lodash-rvV0CIkQ.js";import"./vendor-DWCz07M-.js";import"./vendor-dates-DVKSwKij.js";import"./vendor-axios-C0Zqfgkc.js";import"./vendor-pinia-CMXa-Za0.js";const wl={class:"order-detail"},xl={class:"detail-header"},Sl={class:"header-actions"},Ul={class:"page-body"},Ol={class:"kv-grid kv-grid-2"},El={class:"kv-item"},Dl={class:"kv-value"},zl={class:"plain-value"},Cl={class:"kv-item"},Il={class:"kv-value"},Al={class:"plain-value"},Fl={class:"kv-item"},Nl={class:"kv-value"},Tl=["title"],Bl={class:"kv-item"},Ml={class:"kv-value"},Pl=["title"],Rl={class:"kv-item"},Yl={class:"kv-value"},$l=["title"],jl={class:"kv-item"},Ll={class:"kv-value"},ql={class:"plain-value"},Hl={class:"kv-item"},Kl={class:"kv-value"},Wl={class:"plain-value"},Gl={class:"kv-item"},Xl={class:"kv-value"},Zl={class:"plain-value"},Jl={class:"kv-grid kv-grid-2"},Ql={class:"kv-item"},en={class:"kv-value"},tn=["title"],ln={class:"kv-item"},nn={class:"kv-value"},an=["title"],sn={key:0,class:"image-actions image-actions-wide"},on={key:1,class:"image-wall image-wall-wide"},rn=["onClick"],dn={key:0,class:"thumb-empty"},un={class:"info-block"},cn={class:"kv-grid kv-grid-2 info-grid"},mn={class:"kv-item"},vn={class:"kv-value"},_n={class:"kv-item"},pn={class:"kv-grid kv-grid-2 info-grid"},fn={class:"kv-item kv-item-remark"},gn={class:"kv-value"},kn={class:"kv-grid kv-grid-4 info-grid info-grid-compact"},yn={class:"kv-item"},bn={class:"kv-value"},hn={class:"kv-item"},Vn={class:"kv-value"},wn={class:"kv-item"},xn={class:"kv-value"},Sn={class:"kv-item"},Un={class:"kv-value"},On={class:"kv-grid kv-grid-2 info-grid"},En={class:"kv-item"},Dn={class:"kv-value value-red"},zn={class:"kv-grid kv-grid-6 info-grid info-grid-compact"},Cn={class:"kv-item"},In={class:"kv-value"},An={class:"kv-item"},Fn={class:"kv-value"},Nn={class:"kv-item"},Tn={class:"kv-value"},Bn={class:"kv-item"},Mn={class:"kv-value"},Pn={class:"kv-item"},Rn={class:"kv-value"},Yn={class:"kv-item"},$n={class:"kv-value"},jn={class:"kv-grid kv-grid-2 info-grid"},Ln={class:"kv-item"},qn={class:"kv-value value-red"},Hn={class:"kv-grid kv-grid-6 info-grid info-grid-compact"},Kn={class:"kv-item"},Wn={class:"kv-value"},Gn={class:"kv-item"},Xn={class:"kv-value"},Zn={class:"kv-item"},Jn={class:"kv-value"},Qn={class:"kv-item"},ei={class:"kv-value"},ti={class:"kv-item"},li={class:"kv-value"},ni={class:"kv-item"},ii={class:"kv-value"},ai={class:"kv-grid kv-grid-2 info-grid"},si={class:"kv-item"},oi={class:"kv-value value-red"},ri={class:"kv-grid kv-grid-2 info-grid"},di={class:"kv-item"},ui={class:"kv-value value-red"},ci={class:"section-header"},mi={class:"two-col"},vi={class:"left"},_i={key:0,class:"kv-grid kv-grid-2"},pi={class:"kv-item"},fi={class:"kv-value"},gi={class:"kv-item"},ki={class:"kv-value"},yi={class:"kv-item"},bi={class:"kv-value"},hi={class:"kv-item"},Vi={class:"kv-value"},wi={key:1},xi={class:"right"},Si={key:0,class:"image-actions"},Ui={class:"image-wall"},Oi={key:0,class:"thumb-empty"},Ei={class:"section-header"},Di={class:"stack"},zi={class:"sub-block"},Ci={class:"two-col"},Ii={class:"left"},Ai={key:0,class:"kv-grid kv-grid-2"},Fi={class:"kv-item"},Ni={class:"kv-item"},Ti={class:"kv-value"},Bi={key:1,class:"kv-grid kv-grid-2"},Mi={class:"kv-label"},Pi={class:"right"},Ri={key:0,class:"image-actions"},Yi={class:"image-wall"},$i={key:0,class:"thumb-empty"},ji={class:"sub-block"},Li={class:"two-col"},qi={class:"left"},Hi={key:0,class:"kv-grid kv-grid-2"},Ki={class:"kv-label"},Wi={class:"kv-value"},Gi={class:"right"},Xi={key:0,class:"image-actions"},Zi={class:"image-wall"},Ji={key:0,class:"thumb-empty"},Qi={class:"section-header"},ea={class:"stack"},ta={class:"sub-block"},la={class:"two-col"},na={class:"left"},ia={key:0,class:"kv-grid kv-grid-2"},aa={class:"kv-item"},sa={class:"kv-value"},oa={class:"kv-item"},ra={class:"kv-item"},da={class:"kv-value"},ua={class:"kv-item"},ca={class:"kv-value"},ma={class:"kv-item"},va={class:"kv-value"},_a={class:"kv-item"},pa={class:"kv-value"},fa={class:"kv-item"},ga={class:"kv-value"},ka={class:"kv-item"},ya={class:"kv-value"},ba={key:1,class:"kv-grid kv-grid-2"},ha={class:"kv-label"},Va={class:"right"},wa={key:0,class:"image-actions"},xa={class:"image-wall"},Sa={key:0,class:"thumb-empty"},Ua={class:"sub-block"},Oa={class:"two-col"},Ea={class:"left"},Da={key:0,class:"kv-grid kv-grid-2"},za={class:"kv-item"},Ca={class:"kv-value"},Ia={key:1,class:"kv-grid kv-grid-2"},Aa={class:"kv-label"},Fa={class:"kv-value"},Na={class:"right"},Ta={key:0,class:"image-actions"},Ba={class:"image-wall"},Ma={key:0,class:"thumb-empty"},Pa=3500,Je="order_import_upload_mode",Ra={__name:"OrderDetail",setup(Ya){const re=al(),Q=il(),Qe=fl();function et(t){const e=Number(typeof t=="string"?t.trim():t);if(!Number.isFinite(e)||!Number.isInteger(e)||e<=0)throw new Error("invalid order id");return e}let j=0;try{j=et(Q.params.id)}catch{M.error("订单ID无效"),re.replace("/orders/all")}const he=E(()=>String(Q.query?.source||"")==="finance"||String(Q.name||"")==="finance-order-detail"?!0:String(Q.path||"").startsWith("/finance/")),de=E(()=>String(Qe.roleName||"").trim().toLowerCase()),Ve=E(()=>de.value==="super_admin"||de.value==="manager"),tt=E(()=>de.value==="sales"),lt=E(()=>{const t=de.value;return t==="finance"||t==="manager"||t==="super_admin"}),L=E(()=>he.value&&lt.value),y=O(null),K=O(!1),$=O(!1),ue=O(!1),ee=O(!1),te=O(!1),W=O(!1),G=O(!1);function nt(){L.value&&(G.value=!G.value)}function it(){L.value&&(x.related||(ae.value=[],Oe.value=!1,G.value=!1,M.success("已退出编辑")))}async function at(){L.value&&(x.related||(G.value=!1,M.success("已完成编辑"),await ie({preserveEditDraft:!0})))}ye(()=>L.value,t=>{t||(G.value=!1)},{immediate:!0});const le=O([]),ne=O([]),ce=O(!1),me=O(!1),q=be({channel_group_id:null,customer_group_id:null}),ve=O(null),_e=O(null),we=O(null);function st(t){return t?.key!=="id_name"?null:e=>{e&&(ve.value=e)}}function ot(t){t&&(_e.value=t)}function rt(t){return t?.key!=="dl_owner"?null:e=>{e&&(_e.value=e)}}function dt(t){return t?t.closest?.(".kv-item")||t:null}function ut(t){t&&(t.classList.remove("flash-value"),t.offsetWidth,t.classList.add("flash-value"),window.setTimeout(()=>{t.classList.remove("flash-value")},Pa))}async function ct({stableMs:t=260,eps:e=1.5,timeoutMs:a=2e3}={}){const o=Date.now();let v=window.scrollY,f=0;return await new Promise(V=>{function b(){const w=window.scrollY;if(Math.abs(w-v)<=e?f+=16:f=0,v=w,f>=t)return V(!0);if(Date.now()-o>=a)return V(!1);requestAnimationFrame(b)}requestAnimationFrame(b)})}async function Fe({targetEl:t,flashEls:e=[],title:a="提示",message:o="",confirmText:v="继续",cancelText:f="取消"}={}){const V=dt(t)||t;V?.scrollIntoView&&V.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),await ct({stableMs:260,eps:1.5,timeoutMs:2200});const b=Array.from(new Set([...(e||[]).filter(Boolean)]));for(const w of b)ut(w);await new Promise(w=>window.setTimeout(w,120));try{const w=typeof o=="string"?H("div",{style:"white-space: pre-line; line-height: 1.7;"},o):o;return await ke.confirm(w,a,{confirmButtonText:v,cancelButtonText:f,type:"warning",center:!0}),!0}catch{return!1}}function mt(t){const e={};for(const a of Array.isArray(t)?t:[]){const o=String(a?.key||"").trim();o&&(e[o]=a?.value??null)}return e}function vt(t){const e=t&&typeof t=="object"?t:{},a=e?.base&&typeof e.base=="object"?e.base:{},o=e?.sections&&typeof e.sections=="object"?e.sections:{},v={id:e?.id??a?.id??null,...a,dynamic_data:{},order_info:{},images:[],_sections_raw:o},f=o?.order_info&&typeof o.order_info=="object"?o.order_info:null;f&&(v.order_info=mt(f.fields));const V=o?.slots&&typeof o.slots=="object"?o.slots:{},b={},w=[];for(const[R,A]of Object.entries(V||{})){if(!A||typeof A!="object")continue;const n=Array.isArray(A.fields)?A.fields:[];for(const k of n){const I=String(k?.key||"").trim();I&&(b[I]=k?.value??null)}const u=Array.isArray(A.images)?A.images:[];for(const k of u){const I=String(k?.image_url||k?.image_file?.url||"").trim();I&&w.push({id:k?.id??null,order_id:v.id,slot_key:R,storage_key:k?.storage_key||k?.image_file?.storage_key||"",image_url:I,image_file_id:k?.image_file_id??k?.image_file?.id??null,image_file:k?.image_file??null,created_at:k?.created_at??null})}}return v.dynamic_data=b,v.images=w,v}const i=be({insurance_expire_date:"",owner_phone:"",remark:"",commercial_amount:null,compulsory_amount:null,vehicle_tax_amount:null,non_vehicle_amount:null,premium_total:null,channel_commercial_point:null,channel_commercial_supplement_point:null,channel_compulsory_point:null,channel_vehicle_tax_point:null,channel_non_vehicle_point:null,channel_reward:null,channel_total:null,customer_commercial_point:null,customer_commercial_supplement_point:null,customer_compulsory_point:null,customer_vehicle_tax_point:null,customer_non_vehicle_point:null,customer_reward:null,customer_total:null,profit:null});function d(t){if(t==null||t==="")return null;const e=Number(t);return Number.isFinite(e)?e:null}function h(t){const e=d(t);return e===null?0:e}function Ne(t){return t==null?"":String(t).trim()}function xe(t){if(!t)return"";const e=String(t).trim();return e?/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:/^\d{4}-\d{2}-\d{2}/.test(e)?e.slice(0,10):e:""}function Te(t){const e=t&&typeof t=="object"&&t.order_info&&typeof t.order_info=="object"?t.order_info:{};i.insurance_expire_date=xe(e.insurance_expire_date),i.owner_phone=Ne(e.owner_phone),i.remark=Ne(e.remark),i.commercial_amount=d(e.commercial_amount),i.compulsory_amount=d(e.compulsory_amount),i.vehicle_tax_amount=d(e.vehicle_tax_amount),i.non_vehicle_amount=d(e.non_vehicle_amount),i.premium_total=d(e.premium_total),i.channel_commercial_point=d(e.channel_commercial_point),i.channel_commercial_supplement_point=d(e.channel_commercial_supplement_point),i.channel_compulsory_point=d(e.channel_compulsory_point),i.channel_vehicle_tax_point=d(e.channel_vehicle_tax_point),i.channel_non_vehicle_point=d(e.channel_non_vehicle_point),i.channel_reward=d(e.channel_reward),i.channel_total=d(e.channel_total),i.customer_commercial_point=d(e.customer_commercial_point),i.customer_commercial_supplement_point=d(e.customer_commercial_supplement_point),i.customer_compulsory_point=d(e.customer_compulsory_point),i.customer_vehicle_tax_point=d(e.customer_vehicle_tax_point),i.customer_non_vehicle_point=d(e.customer_non_vehicle_point),i.customer_reward=d(e.customer_reward),i.customer_total=d(e.customer_total),i.profit=d(e.profit),Be()}function _t(){const t=String(i.owner_phone||"").trim(),e=String(i.remark||"").trim();return{insurance_expire_date:i.insurance_expire_date?String(i.insurance_expire_date):"",owner_phone:t,remark:e,commercial_amount:d(i.commercial_amount),compulsory_amount:d(i.compulsory_amount),vehicle_tax_amount:d(i.vehicle_tax_amount),non_vehicle_amount:d(i.non_vehicle_amount),channel_commercial_point:d(i.channel_commercial_point),channel_commercial_supplement_point:d(i.channel_commercial_supplement_point),channel_compulsory_point:d(i.channel_compulsory_point),channel_vehicle_tax_point:d(i.channel_vehicle_tax_point),channel_non_vehicle_point:d(i.channel_non_vehicle_point),channel_reward:d(i.channel_reward),customer_commercial_point:d(i.customer_commercial_point),customer_commercial_supplement_point:d(i.customer_commercial_supplement_point),customer_compulsory_point:d(i.customer_compulsory_point),customer_vehicle_tax_point:d(i.customer_vehicle_tax_point),customer_non_vehicle_point:d(i.customer_non_vehicle_point),customer_reward:d(i.customer_reward)}}function Be(){const t=d(i.commercial_amount),e=d(i.compulsory_amount),a=d(i.vehicle_tax_amount),o=d(i.non_vehicle_amount),v=[t,e,a,o].some(nl=>typeof nl=="number"),f=h(t)+h(e)+h(a)+h(o);i.premium_total=v?f:null;const V=d(i.channel_commercial_point),b=d(i.channel_commercial_supplement_point),w=d(i.channel_compulsory_point),R=d(i.channel_vehicle_tax_point),A=d(i.channel_non_vehicle_point),n=d(i.channel_reward),u=d(i.customer_commercial_point),k=d(i.customer_commercial_supplement_point),I=d(i.customer_compulsory_point),Jt=d(i.customer_vehicle_tax_point),Qt=d(i.customer_non_vehicle_point),el=d(i.customer_reward),tl=h(t)*(h(V)/100)+h(t)*(h(b)/100)+h(e)*(h(w)/100)+h(a)*(h(R)/100)+h(o)*(h(A)/100)+h(n),ll=h(t)*(h(u)/100)+h(t)*(h(k)/100)+h(e)*(h(I)/100)+h(a)*(h(Jt)/100)+h(o)*(h(Qt)/100)+h(el);i.channel_total=v?tl:null,i.customer_total=v?ll:null,i.channel_total===null||i.customer_total===null?i.profit=null:i.profit=h(i.channel_total)-h(i.customer_total)}ye(()=>[i.commercial_amount,i.compulsory_amount,i.vehicle_tax_amount,i.non_vehicle_amount,i.channel_commercial_point,i.channel_commercial_supplement_point,i.channel_compulsory_point,i.channel_vehicle_tax_point,i.channel_non_vehicle_point,i.channel_reward,i.customer_commercial_point,i.customer_commercial_supplement_point,i.customer_compulsory_point,i.customer_vehicle_tax_point,i.customer_non_vehicle_point,i.customer_reward],()=>Be());const pt=E(()=>{const t=Array.isArray(le.value)?le.value:[],e=q.channel_group_id;if(e==null||e==="")return t;const a=Number(e);if(t.some(f=>Number(f?.id)===a))return t;const v=y.value?.channel_group_name||`ID:${e}`;return[{id:e,group_name:`${v}（已删除）`,_ghost:!0},...t]}),ft=E(()=>{const t=Array.isArray(ne.value)?ne.value:[],e=q.customer_group_id;if(e==null||e==="")return t;const a=Number(e);if(t.some(f=>Number(f?.id)===a))return t;const v=y.value?.customer_group_name||`ID:${e}`;return[{id:e,group_name:`${v}（已删除）`,_ghost:!0},...t]}),{allFields:gt,loadConfig:kt}=gl(),Me=E(()=>{const t=new Map;for(const e of gt.value||[])t.set(e.key,e);return t});function D(t){const e=String(t||"").trim();return Me.value.get(e)||{key:e,label:e,type:"text",options:[]}}function pe(t){return t?.key==="id_number"?"身份证号":t?.label||t?.key||""}function Pe(t){if(t==null||t==="")return t;const e=String(t);return/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:t}function yt(t,e){if(t==null||t==="")return"-";const a=e||{type:"text",options:[]},o=a.type==="date"?Pe(t):t,v=kl(o,a);return v===""?"-":v}const p=be({}),Z=E(()=>!y.value||he.value?!1:y.value.is_finished===!0?Ve.value:Ve.value?!0:tt.value&&y.value.is_finished===!1),m=E(()=>Z.value&&W.value),X=E(()=>m.value?!0:L.value&&G.value),bt=E(()=>!y.value||y.value.is_finished!==!0?!1:Ve.value);function Re(t){const e=String(t||"").trim();return e||""}function Se(){return{vehicle_cert:[],idcard_front:[],idcard_back:[],driving_license_main:[],driving_license_sub:[],related:[]}}function ht(t){const e=Se();for(const[a,o]of Object.entries(t||{})){const v=new Set,f=[];for(const V of Array.isArray(o)?o:[]){const b=String(V||"").trim();!b||v.has(b)||(v.add(b),f.push(b))}e[a]=f}return e}const U=E(()=>{const t=Se();for(const e of y.value?.images||[]){const a=Re(e?.slot_key),o=String(e?.image_url||"").trim();!a||!o||(t[a]||(t[a]=[]),t[a].push(o))}return ht(t)}),Ye=E(()=>{const t=Se();for(const e of y.value?.images||[]){const a=Re(e?.slot_key);a&&(t[a]||(t[a]=[]),t[a].push(e))}return t}),Vt=Object.freeze(["id_name","id_number","id_address","id_nation","id_gender","id_birth"]),wt=Object.freeze(["id_issue_authority","id_valid_from","id_valid_to","id_valid_period"]),xt=E(()=>Vt.map(t=>D(t))),St=E(()=>wt.map(t=>D(t))),Ut=Object.freeze(["dl_owner","dl_plate_no","dl_vin","dl_engine_no","dl_vehicle_model","dl_register_date","dl_issue_date","dl_use_nature","dl_id_number"]),Ot=Object.freeze(["dl_approved_passenger_count"]);function $e(t){if(!t)return!1;if(Me.value.has(t))return!0;const e=p?.[t];return!(e==null||e==="")}function je(t){const e=[],a=new Set;for(const o of Array.isArray(t)?t:[]){const v=String(o?.key||"");!v||a.has(v)||(a.add(v),e.push(o))}return e}const Et=E(()=>{const t=Ut.filter(e=>$e(e)).map(e=>D(e));return je(t)}),Dt=E(()=>{const t=Ot.filter(e=>$e(e)).map(e=>D(e));return je(t)});function zt(){const t=Q.query?.from;if(typeof t=="string"&&t){let e=t;try{e=decodeURIComponent(t)}catch{e=t}if(e.startsWith("/")){re.push(e);return}}if(window.history.length>1){re.back();return}re.push({path:he.value?"/finance":"/orders/all"})}function Ct(t){const e=Array.isArray(t)?t:[],a=[...new Set(e.map(o=>String(o||"").trim()).filter(Boolean))];return a.length?a.join("、"):""}const Le=E(()=>{const t=Ct(y.value?.team_names);return t||String(y.value?.team_name??"").trim()||""});function qe(t){if(t==null||t==="")return"-";const e=String(t).trim();if(!e)return"-";const a=e.match(/^(\d{4}-\d{2}-\d{2})/);return a&&a[1]?a[1]:/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:"-"}function He(t){const e=t?.dynamic_data||{};for(const a of Object.keys(p))delete p[a];for(const[a,o]of Object.entries(e))p[a]=o??"";q.customer_group_id=t?.customer_group_id??null,q.channel_group_id=t?.channel_group_id??null,Te(t)}function Ke(){if(Z.value){if(W.value){W.value=!1,y.value&&He(y.value);return}W.value=!0,(!le.value.length||!ne.value.length)&&Ue()}}async function Ue(){ce.value=!0,me.value=!0;try{const[t,e]=await Promise.all([Ae.get("/orders/channel-groups"),Ae.get("/orders/customer-groups")]);le.value=Array.isArray(t?.data?.items)?t.data.items:[],ne.value=Array.isArray(e?.data?.items)?e.data.items:[]}catch(t){console.error(t),M.error("加载渠道/客户选项失败")}finally{ce.value=!1,me.value=!1}}function It(){return L.value}async function ie({preserveEditDraft:t=!1}={}){if(j){K.value=!0;try{const e=It()?await ml(j):await ol(j),a=vt(e?.data??e??{});y.value=a,t?W.value||Te(y.value):(W.value=!1,He(y.value))}catch(e){console.error(e),M.error("加载订单详情失败")}finally{K.value=!1}}}function At(t){return String(t||"").replace(/\s+/g,"").replace(/-/g,"")}function Ft(t){const e=At(t);return e?/^(?:\+?86)?1[3-9]\d{9}$/.test(e):!0}function Nt(){return String(p?.id_name||"").trim()}function Tt(){return String(p?.dl_owner||"").trim()}async function Bt(){if(m.value){const a=String(i.owner_phone||"").trim();if(a&&!Ft(a))return await Ze(),await Fe({targetEl:we.value,flashEls:[we.value],title:"电话格式不正确",message:"车主电话默认按手机号校验，请检查后再保存。",confirmText:"我知道了",cancelText:"取消"}),!1}const t=Nt(),e=Tt();return!(t&&e&&t!==e&&(await Ze(),!await Fe({targetEl:ve.value||_e.value,flashEls:[ve.value,_e.value].filter(Boolean),title:"姓名不一致",message:`检测到证件姓名不一致：
身份证姓名【${t}】
行驶证车主【${e}】
是否仍要继续保存？`,confirmText:"继续保存",cancelText:"取消保存"})))}async function Mt(){if(!(!y.value||!m.value||!await Bt())){$.value=!0;try{const e={...y.value.dynamic_data||{},...p};await ul(j,{dynamic_data:e,customer_group_id:q.customer_group_id,channel_group_id:q.channel_group_id,order_info:_t()}),M.success("保存成功"),await ie()}catch(e){console.error(e),M.error("保存失败")}finally{$.value=!1}}}async function Pt(){try{await ke.confirm("确认将该订单【退回未完成】？","确认操作",{confirmButtonText:"确认退回",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}await Rt()}async function Rt(){if(y.value){$.value=!0;try{await cl(j,{is_finished:!1}),M.success("已退回未完成"),await ie()}catch(t){console.error(t),M.error("操作失败")}finally{$.value=!1}}}const fe=O("smart");function Yt(){const t=localStorage.getItem(Je);(t==="smart"||t==="direct"||t==="stable")&&(fe.value=t)}Yt();const x=be({vehicle_cert:!1,idcard_front:!1,idcard_back:!1,driving_license_main:!1,driving_license_sub:!1,related:!1}),ae=O([]),Oe=O(!1),Ee=O("");let ge=null,De=0;function $t(t){try{return Date.parse(t)}catch{return 0}}async function jt(){const t=Date.now();if(ge&&De&&t+12e4<De)return ge;const a=(await Ae.get("/orders/bos-sts"))?.data;if(!a?.accessKeyId||!a?.secretAccessKey||!a?.sessionToken)throw new Error("bos-sts response invalid");return ge=a,Ee.value=a.bosHost||"",De=$t(a.expiration)||t+600*1e3,ge}function se(t){const e=t?.message||t?.response?.data?.detail||t?.response?.data?.message||"";return String(e||"")}function Lt(t){const e=se(t).toLowerCase();return e.includes("failed to fetch")||e.includes("network error")||e.includes("cors")||e.includes("代理")||e.includes("vpn")}async function qt(t){try{await ke.confirm(`上传看起来被当前网络环境拦截（常见于 VPN/代理/公司网关）。

是否切换到【稳定模式上传】继续？`,"上传失败（网络拦截）",{confirmButtonText:"切换为稳定模式",cancelButtonText:"继续直传重试",type:"warning",center:!0,distinguishCancelAndClose:!0}),fe.value="stable";try{localStorage.setItem(Je,"stable")}catch{}return!0}catch{return!1}}function Ht(t){try{return(new URL(String(t)).pathname||"").replace(/^\/+/,"")}catch{return""}}function Kt(t){const e=(t?.storage_key||t?.image_file?.storage_key||"").trim().replace(/^\/+/,"");if(e)return e;const a=(t?.image_url||t?.url||"").trim();return a?Ht(a):""}function Wt(t){const a=String(t||"").match(/([a-f0-9]{32})\.[a-z0-9]+$/i);return a?String(a[1]).toLowerCase():""}function We(t,e){const a=Kt(t);if(!a)return null;const o=Wt(a)||"";return{slot_key:e,storage_key:a,md5:o,size:0}}async function ze(t,e){if(L.value){const f=(await _l({order_id:j,slot_key:t,file:e}))?.data;return{slot_key:t,storage_key:f?.storage_key,md5:f?.md5||"",size:f?.size||e?.size||0,content_type:f?.content_type||e?.type||"application/octet-stream",etag:f?.etag||"",original_name:f?.original_name||e?.name||"file",url:f?.url||""}}if(fe.value==="stable"){const f=(await dl({slot_key:t,file:e}))?.data;return{slot_key:t,storage_key:f?.storage_key,md5:f?.md5||"",size:f?.size||e?.size||0,content_type:f?.content_type||e?.type||"application/octet-stream",etag:f?.etag||"",original_name:f?.original_name||e?.name||"file",url:f?.url||""}}const a=await jt();if(!Ee.value)throw new Error("bosHost missing");const o=await yl({bosHost:Ee.value,slotKey:t,file:e,sts:a});return{slot_key:t,storage_key:o?.storage_key,md5:o?.md5||"",size:o?.size||e?.size||0,content_type:o?.content_type||e?.type||"application/octet-stream",etag:o?.etag||"",original_name:o?.original_name||e?.name||"file",url:o?.url||""}}async function J(t,e,{clear:a=!1}={}){const o=a?[t]:[];L.value?await vl({order_id:j,images:e,clear_slots:o}):await rl({order_id:j,images:e,clear_slots:o}),await ie({preserveEditDraft:!0}),M.success("图片已更新（如涉及证件将触发 OCR 任务）")}async function oe(t,e){if(!m.value)return;const a=e?.raw;if(a){x[t]=!0;try{const o=await ze(t,a);if(!o?.storage_key)throw new Error("upload meta invalid");await J(t,[o])}catch(o){if(!L.value&&fe.value==="smart"&&Lt(o)&&await qt()){const f=await ze(t,a);if(!f?.storage_key)throw new Error("upload meta invalid");await J(t,[f]);return}console.error(o),M.error(se(o)||"上传失败")}finally{x[t]=!1}}}async function Gt(t){if(!X.value)return;const e=t?.raw;e&&(ae.value.push(e),!x.related&&await Ge())}async function Ge(){if(x.related)return;const t=ae.value.splice(0);if(t.length){x.related=!0;try{const e=(Ye.value.related||[]).map(o=>We(o,"related")).filter(Boolean),a=[];for(const o of t){const v=await ze("related",o);if(!v?.storage_key)throw new Error("upload meta invalid");a.push(v)}await J("related",[...e,...a]),Oe.value=!1}catch(e){console.error(e),M.error(se(e)||"上传失败")}finally{x.related=!1,ae.value.length&&Ge()}}}async function Xt(t){if(!X.value)return;const e=(Ye.value.related||[]).slice();if(!(t<0||t>=e.length)){x.related=!0;try{const a=e.filter((o,v)=>v!==t).map(o=>We(o,"related")).filter(Boolean);if(!a.length){await J("related",[],{clear:!0});return}await J("related",a)}catch(a){console.error(a),M.error(se(a)||"删除失败")}finally{x.related=!1}}}async function Zt(){if(X.value&&U.value.related.length){try{await ke.confirm("确认清空【备用图】所有图片？","确认清空",{confirmButtonText:"确认清空",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}ae.value=[],Oe.value=!1,x.related=!0;try{await J("related",[],{clear:!0})}catch(t){console.error(t),M.error(se(t)||"清空失败")}finally{x.related=!1}}}bl(async()=>{j&&(await kt("order"),await ie(),Z.value&&await Ue())});const z=Xe({name:"FieldValue",props:{modelValue:{type:[String,Number,Date],default:""},field:{type:Object,required:!0},editable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:e}){const a=P("el-input"),o=P("el-select"),v=P("el-option"),f=P("el-date-picker"),V=b=>e("update:modelValue",b);return()=>{const b=t.field||{type:"text",options:[]},w=t.modelValue??"",R=yt(w,b);if(!t.editable)return H("span",{class:"plain-value",title:R},R);if(b.type==="date"){const A=Pe(w)??"";return H(f,{modelValue:A,"onUpdate:modelValue":V,type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}if(b.type==="select"){const A=Array.isArray(b.options)?b.options:[];return H(o,{modelValue:w,"onUpdate:modelValue":V,filterable:!0,clearable:!0,class:"fv fv-select"},()=>A.map(n=>{const u=n&&typeof n=="object"?n.label:String(n),k=n&&typeof n=="object"?n.value:n;return H(v,{key:String(k),label:u,value:k})}))}return H(a,{modelValue:w,"onUpdate:modelValue":V,clearable:!0,class:"fv fv-input"})}}}),S=Xe({name:"InfoValue",props:{modelValue:{type:[String,Number,null],default:""},type:{type:String,default:"text"},editable:{type:Boolean,default:!1},min:{type:Number,default:void 0},max:{type:Number,default:void 0}},emits:["update:modelValue"],setup(t,{emit:e}){const a=P("el-input"),o=P("el-date-picker"),v=O(""),f=O(!1);function V(u){return u==null||u===""?"":String(u)}function b(){f.value||(v.value=V(t.modelValue))}ye(()=>t.modelValue,()=>b(),{immediate:!0});function w(u){let k=u;return typeof t.min=="number"&&(k=Math.max(t.min,k)),typeof t.max=="number"&&(k=Math.min(t.max,k)),k}function R(){v.value="",e("update:modelValue",null)}function A(){f.value=!1;const u=String(v.value||"").trim();if(!u){R();return}const k=Number(u);if(!Number.isFinite(k)){R();return}let I=w(k);if(t.type==="money"){I=Math.round(I*100)/100,e("update:modelValue",I),v.value=I.toFixed(2);return}e("update:modelValue",I),v.value=String(I)}function n(u){if(u==null||u==="")return"-";const k=Number(u);return t.type==="money"?Number.isFinite(k)?k.toFixed(2):"-":t.type==="point"?Number.isFinite(k)?String(k):"-":t.type==="date"?xe(u)||"-":String(u)}return()=>{const u=t.modelValue??"";if(!t.editable){const k=n(u);return H("span",{class:"plain-value",title:k},k)}if(t.type==="date"){const k=xe(u);return H(o,{modelValue:k,"onUpdate:modelValue":I=>e("update:modelValue",I),type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}return t.type==="money"||t.type==="point"?H(a,{modelValue:v.value,"onUpdate:modelValue":k=>{v.value=String(k??"")},clearable:!0,class:"fv fv-input",inputmode:"decimal",onFocus:()=>{f.value=!0},onBlur:()=>A(),onClear:()=>R()}):H(a,{modelValue:u,"onUpdate:modelValue":k=>e("update:modelValue",k),clearable:!0,class:"fv fv-input"})}}});return ye(()=>Z.value,t=>{t&&(!le.value.length||!ne.value.length)&&Ue()}),(t,e)=>{const a=P("el-button"),o=P("el-card"),v=P("el-option"),f=P("el-select"),V=P("el-upload"),b=P("el-image"),w=P("el-icon"),R=P("el-tooltip"),A=Vl("loading");return r(),c("div",wl,[l("div",xl,[e[51]||(e[51]=l("h2",null,"订单详情",-1)),l("div",Sl,[s(a,{size:"small",onClick:zt},{default:g(()=>[...e[43]||(e[43]=[T("返回",-1)])]),_:1}),L.value&&y.value?(r(),c(F,{key:0},[G.value?(r(),c(F,{key:1},[s(a,{size:"small",plain:"",disabled:K.value||$.value||x.related,onClick:it},{default:g(()=>[...e[45]||(e[45]=[T(" 退出编辑 ",-1)])]),_:1},8,["disabled"]),s(a,{size:"small",type:"primary",disabled:K.value||$.value||x.related,onClick:at},{default:g(()=>[...e[46]||(e[46]=[T(" 完成编辑 ",-1)])]),_:1},8,["disabled"])],64)):(r(),N(a,{key:0,size:"small",type:"primary",plain:"",disabled:K.value||$.value||x.related,onClick:nt},{default:g(()=>[...e[44]||(e[44]=[T(" 编辑 ",-1)])]),_:1},8,["disabled"]))],64)):(r(),c(F,{key:1},[bt.value?(r(),N(a,{key:0,size:"small",type:"warning",plain:"",loading:$.value,onClick:Pt},{default:g(()=>[...e[47]||(e[47]=[T(" 退回未完成 ",-1)])]),_:1},8,["loading"])):C("",!0),Z.value&&!W.value?(r(),N(a,{key:1,size:"small",type:"primary",plain:"",disabled:K.value||$.value,onClick:Ke},{default:g(()=>[...e[48]||(e[48]=[T(" 编辑 ",-1)])]),_:1},8,["disabled"])):C("",!0),Z.value&&W.value?(r(),N(a,{key:2,size:"small",plain:"",disabled:K.value||$.value,onClick:Ke},{default:g(()=>[...e[49]||(e[49]=[T(" 取消编辑 ",-1)])]),_:1},8,["disabled"])):C("",!0),m.value?(r(),N(a,{key:3,size:"small",type:"primary",loading:$.value,onClick:Mt},{default:g(()=>[...e[50]||(e[50]=[T("保存",-1)])]),_:1},8,["loading"])):C("",!0)],64))])]),hl((r(),c("div",Ul,[s(o,{shadow:"never",class:"section-card meta-card"},{header:g(()=>[...e[52]||(e[52]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"基础信息")],-1)])]),default:g(()=>[l("div",Ol,[l("div",El,[e[53]||(e[53]=l("div",{class:"kv-label"},"订单ID",-1)),l("div",Dl,[l("span",zl,B(y.value?.id??"-"),1)])]),l("div",Cl,[e[54]||(e[54]=l("div",{class:"kv-label"},"完成状态",-1)),l("div",Il,[l("span",Al,B(y.value?.is_finished===!0?"已完成":"未完成"),1)])]),l("div",Fl,[e[55]||(e[55]=l("div",{class:"kv-label"},"业务员",-1)),l("div",Nl,[l("span",{class:"plain-value",title:y.value?.salesperson_name||"-"},B(y.value?.salesperson_name||"-"),9,Tl)])]),l("div",Bl,[e[56]||(e[56]=l("div",{class:"kv-label"},"所属经理",-1)),l("div",Ml,[l("span",{class:"plain-value",title:y.value?.manager_name||"-"},B(y.value?.manager_name||"-"),9,Pl)])]),l("div",Rl,[e[57]||(e[57]=l("div",{class:"kv-label"},"所属团队",-1)),l("div",Yl,[l("span",{class:"plain-value",title:Le.value||"-"},B(Le.value||"-"),9,$l)])]),l("div",jl,[e[58]||(e[58]=l("div",{class:"kv-label"},"回款/返点",-1)),l("div",Ll,[l("span",ql," 回款："+B(y.value?.is_paid===!0?"是":"否")+"，返点："+B(y.value?.is_rebate===!0?"是":"否"),1)])]),l("div",Hl,[e[59]||(e[59]=l("div",{class:"kv-label"},"创建时间",-1)),l("div",Kl,[l("span",Wl,B(qe(y.value?.created_at)),1)])]),l("div",Gl,[e[60]||(e[60]=l("div",{class:"kv-label"},"更新时间",-1)),l("div",Xl,[l("span",Zl,B(qe(y.value?.updated_at)),1)])])])]),_:1}),s(o,{shadow:"never",class:"section-card meta-card"},{header:g(()=>[...e[61]||(e[61]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"渠道、客户")],-1)])]),default:g(()=>[l("div",Jl,[l("div",Ql,[e[62]||(e[62]=l("div",{class:"kv-label"},"渠道",-1)),l("div",en,[m.value?(r(),N(f,{key:0,modelValue:q.channel_group_id,"onUpdate:modelValue":e[0]||(e[0]=n=>q.channel_group_id=n),filterable:"",clearable:"",placeholder:"请选择渠道",class:"fv fv-select",loading:ce.value,disabled:ce.value},{default:g(()=>[(r(!0),c(F,null,Y(pt.value,n=>(r(),N(v,{key:String(n.id),label:n.group_name||String(n.id),value:n.id,disabled:!!n._ghost},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading","disabled"])):(r(),c("span",{key:1,class:"plain-value",title:y.value?.channel_group_name||"-"},B(y.value?.channel_group_name||"-"),9,tn))])]),l("div",ln,[e[63]||(e[63]=l("div",{class:"kv-label"},"客户",-1)),l("div",nn,[m.value?(r(),N(f,{key:0,modelValue:q.customer_group_id,"onUpdate:modelValue":e[1]||(e[1]=n=>q.customer_group_id=n),filterable:"",clearable:"",placeholder:"请选择客户",class:"fv fv-select",loading:me.value,disabled:me.value},{default:g(()=>[(r(!0),c(F,null,Y(ft.value,n=>(r(),N(v,{key:String(n.id),label:n.group_name||String(n.id),value:n.id,disabled:!!n._ghost},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading","disabled"])):(r(),c("span",{key:1,class:"plain-value",title:y.value?.customer_group_name||"-"},B(y.value?.customer_group_name||"-"),9,an))])])])]),_:1}),s(o,{shadow:"never",class:"section-card"},{header:g(()=>[...e[64]||(e[64]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"备用图")],-1)])]),default:g(()=>[X.value?(r(),c("div",sn,[s(V,{drag:"","auto-upload":!1,multiple:!0,"show-file-list":!1,accept:"image/*",disabled:x.related,"on-change":n=>Gt(n),class:"related-dragger"},{default:g(()=>[...e[65]||(e[65]=[l("div",{class:"drag-inner"},[l("div",{class:"drag-title"},"拖拽图片到这里"),l("div",{class:"drag-sub"},"或点击选择（支持多张）")],-1)])]),_:1},8,["disabled","on-change"]),s(a,{size:"small",type:"danger",plain:"",disabled:x.related||!U.value.related.length,loading:x.related,onClick:Zt},{default:g(()=>[...e[66]||(e[66]=[T(" 清空 ",-1)])]),_:1},8,["disabled","loading"])])):C("",!0),X.value||U.value.related.length?(r(),c("div",on,[(r(!0),c(F,null,Y(U.value.related,(n,u)=>(r(),c("div",{key:n+":"+u,class:"thumb-wrap"},[s(b,{src:n,"preview-src-list":U.value.related,"initial-index":u,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"]),X.value?(r(),c("button",{key:0,type:"button",class:"thumb-remove",title:"删除这张",onClick:k=>Xt(u)}," × ",8,rn)):C("",!0)]))),128)),X.value&&!U.value.related.length?(r(),c("div",dn)):C("",!0)])):C("",!0)]),_:1}),s(o,{shadow:"never",class:"section-card"},{header:g(()=>[...e[67]||(e[67]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"订单信息")],-1)])]),default:g(()=>[l("div",un,[l("div",cn,[l("div",mn,[e[68]||(e[68]=l("div",{class:"kv-label"},"保险到期日",-1)),l("div",vn,[s(_(S),{modelValue:i.insurance_expire_date,"onUpdate:modelValue":e[2]||(e[2]=n=>i.insurance_expire_date=n),type:"date",editable:m.value},null,8,["modelValue","editable"])])]),l("div",_n,[e[69]||(e[69]=l("div",{class:"kv-label"},"车主电话",-1)),l("div",{class:"kv-value",ref_key:"ownerPhoneValueRef",ref:we},[s(_(S),{modelValue:i.owner_phone,"onUpdate:modelValue":e[3]||(e[3]=n=>i.owner_phone=n),type:"text",editable:m.value},null,8,["modelValue","editable"])],512)])]),l("div",pn,[l("div",fn,[e[70]||(e[70]=l("div",{class:"kv-label"},"订单备注",-1)),l("div",gn,[s(_(S),{modelValue:i.remark,"onUpdate:modelValue":e[4]||(e[4]=n=>i.remark=n),type:"text",editable:m.value},null,8,["modelValue","editable"])])])]),l("div",kn,[l("div",yn,[e[71]||(e[71]=l("div",{class:"kv-label"},"商业金额",-1)),l("div",bn,[s(_(S),{modelValue:i.commercial_amount,"onUpdate:modelValue":e[5]||(e[5]=n=>i.commercial_amount=n),type:"money",editable:m.value,min:0},null,8,["modelValue","editable"])])]),l("div",hn,[e[72]||(e[72]=l("div",{class:"kv-label"},"交强金额",-1)),l("div",Vn,[s(_(S),{modelValue:i.compulsory_amount,"onUpdate:modelValue":e[6]||(e[6]=n=>i.compulsory_amount=n),type:"money",editable:m.value,min:0},null,8,["modelValue","editable"])])]),l("div",wn,[e[73]||(e[73]=l("div",{class:"kv-label"},"车船税金额",-1)),l("div",xn,[s(_(S),{modelValue:i.vehicle_tax_amount,"onUpdate:modelValue":e[7]||(e[7]=n=>i.vehicle_tax_amount=n),type:"money",editable:m.value,min:0},null,8,["modelValue","editable"])])]),l("div",Sn,[e[74]||(e[74]=l("div",{class:"kv-label"},"非车金额",-1)),l("div",Un,[s(_(S),{modelValue:i.non_vehicle_amount,"onUpdate:modelValue":e[8]||(e[8]=n=>i.non_vehicle_amount=n),type:"money",editable:m.value,min:0},null,8,["modelValue","editable"])])])]),l("div",On,[l("div",En,[e[75]||(e[75]=l("div",{class:"kv-label"},"保费金额",-1)),l("div",Dn,[s(_(S),{modelValue:i.premium_total,"onUpdate:modelValue":e[9]||(e[9]=n=>i.premium_total=n),type:"money",editable:!1},null,8,["modelValue"])])])])]),e[91]||(e[91]=l("div",{class:"split-title"},"渠道",-1)),l("div",zn,[l("div",Cn,[e[76]||(e[76]=l("div",{class:"kv-label"},"商业点位%",-1)),l("div",In,[s(_(S),{modelValue:i.channel_commercial_point,"onUpdate:modelValue":e[10]||(e[10]=n=>i.channel_commercial_point=n),type:"point",editable:m.value},null,8,["modelValue","editable"])])]),l("div",An,[e[77]||(e[77]=l("div",{class:"kv-label"},"商业后补%",-1)),l("div",Fn,[s(_(S),{modelValue:i.channel_commercial_supplement_point,"onUpdate:modelValue":e[11]||(e[11]=n=>i.channel_commercial_supplement_point=n),type:"point",editable:m.value},null,8,["modelValue","editable"])])]),l("div",Nn,[e[78]||(e[78]=l("div",{class:"kv-label"},"交强点位%",-1)),l("div",Tn,[s(_(S),{modelValue:i.channel_compulsory_point,"onUpdate:modelValue":e[12]||(e[12]=n=>i.channel_compulsory_point=n),type:"point",editable:m.value},null,8,["modelValue","editable"])])]),l("div",Bn,[e[79]||(e[79]=l("div",{class:"kv-label"},"车船税点位%",-1)),l("div",Mn,[s(_(S),{modelValue:i.channel_vehicle_tax_point,"onUpdate:modelValue":e[13]||(e[13]=n=>i.channel_vehicle_tax_point=n),type:"point",editable:m.value},null,8,["modelValue","editable"])])]),l("div",Pn,[e[80]||(e[80]=l("div",{class:"kv-label"},"非车点位%",-1)),l("div",Rn,[s(_(S),{modelValue:i.channel_non_vehicle_point,"onUpdate:modelValue":e[14]||(e[14]=n=>i.channel_non_vehicle_point=n),type:"point",editable:m.value},null,8,["modelValue","editable"])])]),l("div",Yn,[e[81]||(e[81]=l("div",{class:"kv-label"},"渠道奖励",-1)),l("div",$n,[s(_(S),{modelValue:i.channel_reward,"onUpdate:modelValue":e[15]||(e[15]=n=>i.channel_reward=n),type:"money",editable:m.value},null,8,["modelValue","editable"])])])]),l("div",jn,[l("div",Ln,[e[82]||(e[82]=l("div",{class:"kv-label"},"渠道应收",-1)),l("div",qn,[s(_(S),{modelValue:i.channel_total,"onUpdate:modelValue":e[16]||(e[16]=n=>i.channel_total=n),type:"money",editable:!1},null,8,["modelValue"])])])]),e[92]||(e[92]=l("div",{class:"split-title"},"客户",-1)),l("div",Hn,[l("div",Kn,[e[83]||(e[83]=l("div",{class:"kv-label"},"商业点位%",-1)),l("div",Wn,[s(_(S),{modelValue:i.customer_commercial_point,"onUpdate:modelValue":e[17]||(e[17]=n=>i.customer_commercial_point=n),type:"point",editable:m.value},null,8,["modelValue","editable"])])]),l("div",Gn,[e[84]||(e[84]=l("div",{class:"kv-label"},"商业后补%",-1)),l("div",Xn,[s(_(S),{modelValue:i.customer_commercial_supplement_point,"onUpdate:modelValue":e[18]||(e[18]=n=>i.customer_commercial_supplement_point=n),type:"point",editable:m.value},null,8,["modelValue","editable"])])]),l("div",Zn,[e[85]||(e[85]=l("div",{class:"kv-label"},"交强点位%",-1)),l("div",Jn,[s(_(S),{modelValue:i.customer_compulsory_point,"onUpdate:modelValue":e[19]||(e[19]=n=>i.customer_compulsory_point=n),type:"point",editable:m.value},null,8,["modelValue","editable"])])]),l("div",Qn,[e[86]||(e[86]=l("div",{class:"kv-label"},"车船税点位%",-1)),l("div",ei,[s(_(S),{modelValue:i.customer_vehicle_tax_point,"onUpdate:modelValue":e[20]||(e[20]=n=>i.customer_vehicle_tax_point=n),type:"point",editable:m.value},null,8,["modelValue","editable"])])]),l("div",ti,[e[87]||(e[87]=l("div",{class:"kv-label"},"非车点位%",-1)),l("div",li,[s(_(S),{modelValue:i.customer_non_vehicle_point,"onUpdate:modelValue":e[21]||(e[21]=n=>i.customer_non_vehicle_point=n),type:"point",editable:m.value},null,8,["modelValue","editable"])])]),l("div",ni,[e[88]||(e[88]=l("div",{class:"kv-label"},"客户奖励",-1)),l("div",ii,[s(_(S),{modelValue:i.customer_reward,"onUpdate:modelValue":e[22]||(e[22]=n=>i.customer_reward=n),type:"money",editable:m.value},null,8,["modelValue","editable"])])])]),l("div",ai,[l("div",si,[e[89]||(e[89]=l("div",{class:"kv-label"},"客户应付",-1)),l("div",oi,[s(_(S),{modelValue:i.customer_total,"onUpdate:modelValue":e[23]||(e[23]=n=>i.customer_total=n),type:"money",editable:!1},null,8,["modelValue"])])])]),l("div",ri,[l("div",di,[e[90]||(e[90]=l("div",{class:"kv-label"},"利润",-1)),l("div",ui,[s(_(S),{modelValue:i.profit,"onUpdate:modelValue":e[24]||(e[24]=n=>i.profit=n),type:"money",editable:!1},null,8,["modelValue"])])])])]),_:1}),s(o,{shadow:"never",class:"section-card"},{header:g(()=>[l("div",ci,[e[93]||(e[93]=l("div",{class:"section-title"},"车辆合格证",-1)),s(a,{class:"icon-btn",circle:"",size:"small",onClick:e[25]||(e[25]=n=>ue.value=!ue.value)},{default:g(()=>[s(w,null,{default:g(()=>[ue.value?(r(),N(_(Ce),{key:0})):(r(),N(_(Ie),{key:1}))]),_:1})]),_:1})])]),default:g(()=>[l("div",mi,[l("div",vi,[ue.value?(r(),c("div",wi,[s(sl,{data:p,readonly:!m.value},null,8,["data","readonly"])])):(r(),c("div",_i,[l("div",pi,[e[94]||(e[94]=l("div",{class:"kv-label"},"车辆型号",-1)),l("div",fi,[s(_(z),{modelValue:p.vehicle_model,"onUpdate:modelValue":e[26]||(e[26]=n=>p.vehicle_model=n),field:D("vehicle_model"),editable:m.value},null,8,["modelValue","field","editable"])])]),l("div",gi,[e[95]||(e[95]=l("div",{class:"kv-label"},"车架号",-1)),l("div",ki,[s(_(z),{modelValue:p.vin,"onUpdate:modelValue":e[27]||(e[27]=n=>p.vin=n),field:D("vin"),editable:m.value},null,8,["modelValue","field","editable"])])]),l("div",yi,[e[96]||(e[96]=l("div",{class:"kv-label"},"发动机号",-1)),l("div",bi,[s(_(z),{modelValue:p.engine_no,"onUpdate:modelValue":e[28]||(e[28]=n=>p.engine_no=n),field:D("engine_no"),editable:m.value},null,8,["modelValue","field","editable"])])]),l("div",hi,[e[97]||(e[97]=l("div",{class:"kv-label"},"初登日期",-1)),l("div",Vi,[s(_(z),{modelValue:p.first_register_date,"onUpdate:modelValue":e[29]||(e[29]=n=>p.first_register_date=n),field:D("first_register_date"),editable:m.value},null,8,["modelValue","field","editable"])])])]))]),l("div",xi,[m.value?(r(),c("div",Si,[s(V,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>oe("vehicle_cert",n)},{default:g(()=>[s(a,{size:"small",type:"primary",plain:"",loading:x.vehicle_cert},{default:g(()=>[...e[98]||(e[98]=[T("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),s(R,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:g(()=>[l("span",null,[s(a,{size:"small",disabled:""},{default:g(()=>[...e[99]||(e[99]=[T("清空",-1)])]),_:1})])]),_:1})])):C("",!0),l("div",Ui,[(r(!0),c(F,null,Y(U.value.vehicle_cert,(n,u)=>(r(),c("div",{key:n+":"+u,class:"thumb-wrap"},[s(b,{src:n,"preview-src-list":U.value.vehicle_cert,"initial-index":u,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),U.value.vehicle_cert.length?C("",!0):(r(),c("div",Oi))])])])]),_:1}),s(o,{shadow:"never",class:"section-card"},{header:g(()=>[l("div",Ei,[e[100]||(e[100]=l("div",{class:"section-title"},"身份证正面/身份证背面",-1)),s(a,{class:"icon-btn",circle:"",size:"small",onClick:e[30]||(e[30]=n=>ee.value=!ee.value)},{default:g(()=>[s(w,null,{default:g(()=>[ee.value?(r(),N(_(Ce),{key:0})):(r(),N(_(Ie),{key:1}))]),_:1})]),_:1})])]),default:g(()=>[l("div",Di,[l("div",zi,[e[104]||(e[104]=l("div",{class:"sub-title"},"身份证正面",-1)),l("div",Ci,[l("div",Ii,[ee.value?(r(),c("div",Bi,[(r(!0),c(F,null,Y(xt.value,n=>(r(),c("div",{key:n.key,class:"kv-item"},[l("div",Mi,B(pe(n)),1),l("div",{class:"kv-value",ref_for:!0,ref:st(n)},[s(_(z),{modelValue:p[n.key],"onUpdate:modelValue":u=>p[n.key]=u,field:n,editable:m.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])],512)]))),128))])):(r(),c("div",Ai,[l("div",Fi,[e[101]||(e[101]=l("div",{class:"kv-label"},"姓名",-1)),l("div",{class:"kv-value",ref_key:"idNameValueRef",ref:ve},[s(_(z),{modelValue:p.id_name,"onUpdate:modelValue":e[31]||(e[31]=n=>p.id_name=n),field:D("id_name"),editable:m.value},null,8,["modelValue","field","editable"])],512)]),l("div",Ni,[e[102]||(e[102]=l("div",{class:"kv-label"},"身份证号",-1)),l("div",Ti,[s(_(z),{modelValue:p.id_number,"onUpdate:modelValue":e[32]||(e[32]=n=>p.id_number=n),field:D("id_number"),editable:m.value},null,8,["modelValue","field","editable"])])])]))]),l("div",Pi,[m.value?(r(),c("div",Ri,[s(V,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>oe("idcard_front",n)},{default:g(()=>[s(a,{size:"small",type:"primary",plain:"",loading:x.idcard_front},{default:g(()=>[...e[103]||(e[103]=[T("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"])])):C("",!0),l("div",Yi,[(r(!0),c(F,null,Y(U.value.idcard_front,(n,u)=>(r(),c("div",{key:n+":"+u,class:"thumb-wrap"},[s(b,{src:n,"preview-src-list":U.value.idcard_front,"initial-index":u,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),U.value.idcard_front.length?C("",!0):(r(),c("div",$i))])])])]),l("div",ji,[e[106]||(e[106]=l("div",{class:"sub-title"},"身份证背面",-1)),l("div",Li,[l("div",qi,[ee.value?(r(),c("div",Hi,[(r(!0),c(F,null,Y(St.value,n=>(r(),c("div",{key:n.key,class:"kv-item"},[l("div",Ki,B(pe(n)),1),l("div",Wi,[s(_(z),{modelValue:p[n.key],"onUpdate:modelValue":u=>p[n.key]=u,field:n,editable:m.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])])]))),128))])):C("",!0)]),l("div",Gi,[m.value?(r(),c("div",Xi,[s(V,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>oe("idcard_back",n)},{default:g(()=>[s(a,{size:"small",type:"primary",plain:"",loading:x.idcard_back},{default:g(()=>[...e[105]||(e[105]=[T("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"])])):C("",!0),l("div",Zi,[(r(!0),c(F,null,Y(U.value.idcard_back,(n,u)=>(r(),c("div",{key:n+":"+u,class:"thumb-wrap"},[s(b,{src:n,"preview-src-list":U.value.idcard_back,"initial-index":u,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),U.value.idcard_back.length?C("",!0):(r(),c("div",Ji))])])])])])]),_:1}),s(o,{shadow:"never",class:"section-card"},{header:g(()=>[l("div",Qi,[e[107]||(e[107]=l("div",{class:"section-title"},"行驶证/行驶证副件",-1)),s(a,{class:"icon-btn",circle:"",size:"small",onClick:e[33]||(e[33]=n=>te.value=!te.value)},{default:g(()=>[s(w,null,{default:g(()=>[te.value?(r(),N(_(Ce),{key:0})):(r(),N(_(Ie),{key:1}))]),_:1})]),_:1})])]),default:g(()=>[l("div",ea,[l("div",ta,[e[117]||(e[117]=l("div",{class:"sub-title"},"行驶证主页",-1)),l("div",la,[l("div",na,[te.value?(r(),c("div",ba,[(r(!0),c(F,null,Y(Et.value,n=>(r(),c("div",{key:n.key,class:"kv-item"},[l("div",ha,B(pe(n)),1),l("div",{class:"kv-value",ref_for:!0,ref:rt(n)},[s(_(z),{modelValue:p[n.key],"onUpdate:modelValue":u=>p[n.key]=u,field:n,editable:m.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])],512)]))),128))])):(r(),c("div",ia,[l("div",aa,[e[108]||(e[108]=l("div",{class:"kv-label"},"车牌号",-1)),l("div",sa,[s(_(z),{modelValue:p.dl_plate_no,"onUpdate:modelValue":e[34]||(e[34]=n=>p.dl_plate_no=n),field:D("dl_plate_no"),editable:m.value},null,8,["modelValue","field","editable"])])]),l("div",oa,[e[109]||(e[109]=l("div",{class:"kv-label"},"车主",-1)),l("div",{class:"kv-value",ref:ot},[s(_(z),{modelValue:p.dl_owner,"onUpdate:modelValue":e[35]||(e[35]=n=>p.dl_owner=n),field:D("dl_owner"),editable:m.value},null,8,["modelValue","field","editable"])])]),l("div",ra,[e[110]||(e[110]=l("div",{class:"kv-label"},"使用性质",-1)),l("div",da,[s(_(z),{modelValue:p.dl_use_nature,"onUpdate:modelValue":e[36]||(e[36]=n=>p.dl_use_nature=n),field:D("dl_use_nature"),editable:m.value},null,8,["modelValue","field","editable"])])]),l("div",ua,[e[111]||(e[111]=l("div",{class:"kv-label"},"车型",-1)),l("div",ca,[s(_(z),{modelValue:p.dl_vehicle_model,"onUpdate:modelValue":e[37]||(e[37]=n=>p.dl_vehicle_model=n),field:D("dl_vehicle_model"),editable:m.value},null,8,["modelValue","field","editable"])])]),l("div",ma,[e[112]||(e[112]=l("div",{class:"kv-label"},"车架号",-1)),l("div",va,[s(_(z),{modelValue:p.dl_vin,"onUpdate:modelValue":e[38]||(e[38]=n=>p.dl_vin=n),field:D("dl_vin"),editable:m.value},null,8,["modelValue","field","editable"])])]),l("div",_a,[e[113]||(e[113]=l("div",{class:"kv-label"},"发动机号",-1)),l("div",pa,[s(_(z),{modelValue:p.dl_engine_no,"onUpdate:modelValue":e[39]||(e[39]=n=>p.dl_engine_no=n),field:D("dl_engine_no"),editable:m.value},null,8,["modelValue","field","editable"])])]),l("div",fa,[e[114]||(e[114]=l("div",{class:"kv-label"},"注册日期",-1)),l("div",ga,[s(_(z),{modelValue:p.dl_register_date,"onUpdate:modelValue":e[40]||(e[40]=n=>p.dl_register_date=n),field:D("dl_register_date"),editable:m.value},null,8,["modelValue","field","editable"])])]),l("div",ka,[e[115]||(e[115]=l("div",{class:"kv-label"},"发证日期",-1)),l("div",ya,[s(_(z),{modelValue:p.dl_issue_date,"onUpdate:modelValue":e[41]||(e[41]=n=>p.dl_issue_date=n),field:D("dl_issue_date"),editable:m.value},null,8,["modelValue","field","editable"])])])]))]),l("div",Va,[m.value?(r(),c("div",wa,[s(V,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>oe("driving_license_main",n)},{default:g(()=>[s(a,{size:"small",type:"primary",plain:"",loading:x.driving_license_main},{default:g(()=>[...e[116]||(e[116]=[T("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"])])):C("",!0),l("div",xa,[(r(!0),c(F,null,Y(U.value.driving_license_main,(n,u)=>(r(),c("div",{key:n+":"+u,class:"thumb-wrap"},[s(b,{src:n,"preview-src-list":U.value.driving_license_main,"initial-index":u,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),U.value.driving_license_main.length?C("",!0):(r(),c("div",Sa))])])])]),l("div",Ua,[e[120]||(e[120]=l("div",{class:"sub-title"},"行驶证副页",-1)),l("div",Oa,[l("div",Ea,[te.value?(r(),c("div",Ia,[(r(!0),c(F,null,Y(Dt.value,n=>(r(),c("div",{key:n.key,class:"kv-item"},[l("div",Aa,B(pe(n)),1),l("div",Fa,[s(_(z),{modelValue:p[n.key],"onUpdate:modelValue":u=>p[n.key]=u,field:n,editable:m.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])])]))),128))])):(r(),c("div",Da,[l("div",za,[e[118]||(e[118]=l("div",{class:"kv-label"},"核定载人数",-1)),l("div",Ca,[s(_(z),{modelValue:p.dl_approved_passenger_count,"onUpdate:modelValue":e[42]||(e[42]=n=>p.dl_approved_passenger_count=n),field:D("dl_approved_passenger_count"),editable:m.value},null,8,["modelValue","field","editable"])])])]))]),l("div",Na,[m.value?(r(),c("div",Ta,[s(V,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>oe("driving_license_sub",n)},{default:g(()=>[s(a,{size:"small",type:"primary",plain:"",loading:x.driving_license_sub},{default:g(()=>[...e[119]||(e[119]=[T("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"])])):C("",!0),l("div",Ba,[(r(!0),c(F,null,Y(U.value.driving_license_sub,(n,u)=>(r(),c("div",{key:n+":"+u,class:"thumb-wrap"},[s(b,{src:n,"preview-src-list":U.value.driving_license_sub,"initial-index":u,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),U.value.driving_license_sub.length?C("",!0):(r(),c("div",Ma))])])])])])]),_:1})])),[[A,K.value]])])}}},ns=pl(Ra,[["__scopeId","data-v-e011e997"]]);export{ns as default};
