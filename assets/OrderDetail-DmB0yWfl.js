import{u as fl,b as pl}from"./vendor-vue-router-CVyACjsp.js";import{E as M,c as Re,a as Pe,d as Se}from"./vendor-element-plus-CtVxZ4Oy.js";import{V as yl,u as gl}from"./bosUpload-BTJmt5Ry.js";import{h as Ye}from"./http-CBIyYC5i.js";import{g as kl,f as bl,u as dt,a as hl,b as wl}from"./orders-C0J9gWfa.js";import{g as Vl}from"./finance-DEkAaesZ.js";import{_ as xl,u as Sl}from"./index-1e9zDAa1.js";import{u as Ul,f as Ol}from"./fieldFormat-dj427FSC.js";import{c as I,r as C,o as Ue,Z as Oe,q as Il,x as c,z as l,I as zl,P as o,H as _,ay as R,O as B,G as T,J as V,aI as Cl,y as r,L as E,ac as Y,M as le,u as f,l as ct,ai as j,D as mt}from"./vendor-vue-fFWwKrgY.js";import"./vendor-lodash-rvV0CIkQ.js";import"./vendor-DWCz07M-.js";import"./vendor-dates-DVKSwKij.js";import"./vendor-axios-C0Zqfgkc.js";import"./vendor-pinia-CMXa-Za0.js";const Al={class:"order-detail"},El={class:"detail-header"},Dl={class:"header-actions"},Fl={class:"page-body"},Nl={class:"kv-grid kv-grid-2"},Ml={class:"kv-item"},Bl={class:"kv-value"},Tl=["title"],Rl={class:"kv-item"},Pl={class:"kv-value"},Yl=["title"],Kl={key:0,class:"image-actions image-actions-wide"},Ll={key:1,class:"image-wall image-wall-wide"},$l=["onClick"],jl={key:0,class:"thumb-empty"},ql={class:"info-block"},Hl={class:"kv-grid kv-grid-2 info-grid"},Gl={class:"kv-item"},Wl={class:"kv-value"},Zl={class:"kv-item"},Jl={class:"kv-grid kv-grid-2 info-grid"},Ql={class:"kv-item kv-item-remark"},Xl={class:"kv-value"},en={class:"kv-grid kv-grid-4 info-grid info-grid-compact"},tn={class:"kv-item"},ln={class:"kv-value"},nn={class:"kv-item"},an={class:"kv-value"},on={class:"kv-item"},sn={class:"kv-value"},rn={class:"kv-item"},un={class:"kv-value"},dn={class:"kv-grid kv-grid-2 info-grid"},cn={class:"kv-item"},mn={class:"kv-value value-red"},vn={class:"kv-grid kv-grid-6 info-grid info-grid-compact"},_n={class:"kv-item"},fn={class:"kv-value"},pn={class:"kv-item"},yn={class:"kv-value"},gn={class:"kv-item"},kn={class:"kv-value"},bn={class:"kv-item"},hn={class:"kv-value"},wn={class:"kv-item"},Vn={class:"kv-value"},xn={class:"kv-item"},Sn={class:"kv-value"},Un={class:"kv-grid kv-grid-2 info-grid"},On={class:"kv-item"},In={class:"kv-value value-red"},zn={class:"kv-grid kv-grid-6 info-grid info-grid-compact"},Cn={class:"kv-item"},An={class:"kv-value"},En={class:"kv-item"},Dn={class:"kv-value"},Fn={class:"kv-item"},Nn={class:"kv-value"},Mn={class:"kv-item"},Bn={class:"kv-value"},Tn={class:"kv-item"},Rn={class:"kv-value"},Pn={class:"kv-item"},Yn={class:"kv-value"},Kn={class:"kv-grid kv-grid-2 info-grid"},Ln={class:"kv-item"},$n={class:"kv-value value-red"},jn={class:"kv-grid kv-grid-2 info-grid"},qn={class:"kv-item"},Hn={class:"kv-value value-red"},Gn={class:"section-header"},Wn={class:"two-col"},Zn={class:"left"},Jn={key:0,class:"kv-grid kv-grid-2"},Qn={class:"kv-item"},Xn={class:"kv-value"},ea={class:"kv-item"},ta={class:"kv-value"},la={class:"kv-item"},na={class:"kv-value"},aa={class:"kv-item"},ia={class:"kv-value"},oa={key:1},sa={class:"right"},ra={key:0,class:"image-actions"},ua={class:"image-wall"},da={key:0,class:"thumb-empty"},ca={class:"section-header"},ma={class:"stack"},va={class:"sub-block"},_a={class:"two-col"},fa={class:"left"},pa={key:0,class:"kv-grid kv-grid-2"},ya={class:"kv-item"},ga={class:"kv-item"},ka={class:"kv-value"},ba={key:1,class:"kv-grid kv-grid-2"},ha={class:"kv-label"},wa={class:"right"},Va={key:0,class:"image-actions"},xa={class:"image-wall"},Sa={key:0,class:"thumb-empty"},Ua={class:"sub-block"},Oa={class:"two-col"},Ia={class:"left"},za={key:0,class:"kv-grid kv-grid-2"},Ca={class:"kv-label"},Aa={class:"kv-value"},Ea={class:"right"},Da={key:0,class:"image-actions"},Fa={class:"image-wall"},Na={key:0,class:"thumb-empty"},Ma={class:"section-header"},Ba={class:"stack"},Ta={class:"sub-block"},Ra={class:"two-col"},Pa={class:"left"},Ya={key:0,class:"kv-grid kv-grid-2"},Ka={key:0,class:"kv-item"},La={class:"kv-value"},$a={key:1,class:"kv-item"},ja={key:2,class:"kv-item"},qa={class:"kv-value"},Ha={key:3,class:"kv-item"},Ga={class:"kv-value"},Wa={key:4,class:"kv-item"},Za={class:"kv-value"},Ja={key:5,class:"kv-item"},Qa={class:"kv-value"},Xa={key:6,class:"kv-item"},ei={class:"kv-value"},ti={key:1,class:"kv-grid kv-grid-2"},li={class:"kv-label"},ni={class:"right"},ai={key:0,class:"image-actions"},ii={class:"image-wall"},oi={key:0,class:"thumb-empty"},si={class:"sub-block"},ri={class:"two-col"},ui={class:"left"},di={key:0,class:"kv-grid kv-grid-2"},ci={key:0,class:"kv-item"},mi={class:"kv-value"},vi={key:1,class:"kv-grid kv-grid-2"},_i={class:"kv-label"},fi={class:"kv-value"},pi={class:"right"},yi={key:0,class:"image-actions"},gi={class:"image-wall"},ki={key:0,class:"thumb-empty"},bi=3500,vt="order_import_upload_mode",hi={__name:"OrderDetail",setup(wi){const Ie=pl(),ne=fl(),_t=Sl(),ae=Number(ne.params.id),ze=I(()=>String(ne.query?.source||"")==="finance"||String(ne.name||"")==="finance-order-detail"?!0:String(ne.path||"").startsWith("/finance/")),_e=I(()=>String(_t.roleName||"").trim().toLowerCase()),Ce=I(()=>_e.value==="super_admin"||_e.value==="manager"),ft=I(()=>_e.value==="sales"),pt=I(()=>{const t=_e.value;return t==="finance"||t==="manager"||t==="super_admin"}),q=I(()=>ze.value&&pt.value),x=C(null),H=C(!1),K=C(!1),fe=C(!1),ie=C(!1),oe=C(!1),G=C(!1),Z=C(!1);function yt(){q.value&&(Z.value=!Z.value)}function gt(){q.value&&(S.related||(ce.value=[],te.value=!1,Z.value=!1,M.success("已退出编辑")))}async function kt(){q.value&&(S.related||(Z.value=!1,M.success("已保存"),await ue({preserveEditDraft:!0})))}Ue(()=>q.value,t=>{t||(Z.value=!1)},{immediate:!0});const se=C([]),re=C([]),pe=C(!1),ye=C(!1),L=Oe({channel_group_id:null,customer_group_id:null}),ge=C(null),ke=C(null),Ae=C(null);function bt(t){return t?.key!=="id_name"?null:e=>{e&&(ge.value=e)}}function ht(t){t&&(ke.value=t)}function wt(t){const e=b("owner");return!e||t?.key!==e?null:i=>{i&&(ke.value=i)}}function Vt(t){return t?t.closest?.(".kv-item")||t:null}function xt(t){t&&(t.classList.remove("flash-value"),t.offsetWidth,t.classList.add("flash-value"),window.setTimeout(()=>{t.classList.remove("flash-value")},bi))}async function St({stableMs:t=260,eps:e=1.5,timeoutMs:i=2e3}={}){const s=Date.now();let d=window.scrollY,u=0;return await new Promise(g=>{function k(){const O=window.scrollY;if(Math.abs(O-d)<=e?u+=16:u=0,d=O,u>=t)return g(!0);if(Date.now()-s>=i)return g(!1);requestAnimationFrame(k)}requestAnimationFrame(k)})}async function Ke({targetEl:t,flashEls:e=[],title:i="提示",message:s="",confirmText:d="继续",cancelText:u="取消"}={}){const g=Vt(t)||t;g?.scrollIntoView&&g.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),await St({stableMs:260,eps:1.5,timeoutMs:2200});const k=Array.from(new Set([...(e||[]).filter(Boolean)]));for(const O of k)xt(O);await new Promise(O=>window.setTimeout(O,120));try{const O=typeof s=="string"?j("div",{style:"white-space: pre-line; line-height: 1.7;"},s):s;return await Se.confirm(O,i,{confirmButtonText:d,cancelButtonText:u,type:"warning",center:!0}),!0}catch{return!1}}const a=Oe({insurance_expire_date:"",owner_phone:"",remark:"",commercial_amount:null,compulsory_amount:null,vehicle_tax_amount:null,non_vehicle_amount:null,premium_total:null,channel_commercial_point:null,channel_commercial_supplement_point:null,channel_compulsory_point:null,channel_vehicle_tax_point:null,channel_non_vehicle_point:null,channel_reward:null,channel_total:null,customer_commercial_point:null,customer_commercial_supplement_point:null,customer_compulsory_point:null,customer_vehicle_tax_point:null,customer_non_vehicle_point:null,customer_reward:null,customer_total:null,profit:null});function y(t){if(t==null||t==="")return null;const e=Number(t);return Number.isFinite(e)?e:null}function A(t){const e=y(t);return e===0?null:e}function w(t){const e=y(t);return e===null?0:e}function Le(t){return t==null?"":String(t).trim()}function Ee(t){if(!t)return"";const e=String(t).trim();return e?/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:/^\d{4}-\d{2}-\d{2}/.test(e)?e.slice(0,10):e:""}function $e(t){const e=t&&typeof t=="object"&&t.order_info&&typeof t.order_info=="object"?t.order_info:{};a.insurance_expire_date=Ee(e.insurance_expire_date),a.owner_phone=Le(e.owner_phone),a.remark=Le(e.remark),a.commercial_amount=A(e.commercial_amount),a.compulsory_amount=A(e.compulsory_amount),a.vehicle_tax_amount=A(e.vehicle_tax_amount),a.non_vehicle_amount=A(e.non_vehicle_amount),a.premium_total=A(e.premium_total),a.channel_commercial_point=A(e.channel_commercial_point),a.channel_commercial_supplement_point=A(e.channel_commercial_supplement_point),a.channel_compulsory_point=A(e.channel_compulsory_point),a.channel_vehicle_tax_point=A(e.channel_vehicle_tax_point),a.channel_non_vehicle_point=A(e.channel_non_vehicle_point),a.channel_reward=A(e.channel_reward),a.channel_total=A(e.channel_total),a.customer_commercial_point=A(e.customer_commercial_point),a.customer_commercial_supplement_point=A(e.customer_commercial_supplement_point),a.customer_compulsory_point=A(e.customer_compulsory_point),a.customer_vehicle_tax_point=A(e.customer_vehicle_tax_point),a.customer_non_vehicle_point=A(e.customer_non_vehicle_point),a.customer_reward=A(e.customer_reward),a.customer_total=A(e.customer_total),a.profit=A(e.profit),je()}function Ut(){const t=String(a.owner_phone||"").trim(),e=String(a.remark||"").trim();return{insurance_expire_date:a.insurance_expire_date?String(a.insurance_expire_date):"",owner_phone:t,remark:e,commercial_amount:y(a.commercial_amount),compulsory_amount:y(a.compulsory_amount),vehicle_tax_amount:y(a.vehicle_tax_amount),non_vehicle_amount:y(a.non_vehicle_amount),premium_total:y(a.premium_total),channel_commercial_point:y(a.channel_commercial_point),channel_commercial_supplement_point:y(a.channel_commercial_supplement_point),channel_compulsory_point:y(a.channel_compulsory_point),channel_vehicle_tax_point:y(a.channel_vehicle_tax_point),channel_non_vehicle_point:y(a.channel_non_vehicle_point),channel_reward:y(a.channel_reward),channel_total:y(a.channel_total),customer_commercial_point:y(a.customer_commercial_point),customer_commercial_supplement_point:y(a.customer_commercial_supplement_point),customer_compulsory_point:y(a.customer_compulsory_point),customer_vehicle_tax_point:y(a.customer_vehicle_tax_point),customer_non_vehicle_point:y(a.customer_non_vehicle_point),customer_reward:y(a.customer_reward),customer_total:y(a.customer_total),profit:y(a.profit)}}function je(){const t=y(a.commercial_amount),e=y(a.compulsory_amount),i=y(a.vehicle_tax_amount),s=y(a.non_vehicle_amount),d=t===null?null:Math.max(0,t),u=e===null?null:Math.max(0,e),g=i===null?null:Math.max(0,i),k=s===null?null:Math.max(0,s);a.commercial_amount=d,a.compulsory_amount=u,a.vehicle_tax_amount=g,a.non_vehicle_amount=k;const O=[d,u,g,k].some(ve=>typeof ve=="number"),N=w(d)+w(u)+w(g)+w(k);a.premium_total=O?N:null;const $=y(a.channel_commercial_point),n=y(a.channel_commercial_supplement_point),m=y(a.channel_compulsory_point),h=y(a.channel_vehicle_tax_point),P=y(a.channel_non_vehicle_point),nt=y(a.channel_reward),at=y(a.customer_commercial_point),it=y(a.customer_commercial_supplement_point),ot=y(a.customer_compulsory_point),st=y(a.customer_vehicle_tax_point),rt=y(a.customer_non_vehicle_point),ut=y(a.customer_reward),cl=[$,n,m,h,P,nt].some(ve=>typeof ve=="number"),ml=[at,it,ot,st,rt,ut].some(ve=>typeof ve=="number"),vl=w(d)*(w($)/100)+w(d)*(w(n)/100)+w(u)*(w(m)/100)+w(g)*(w(h)/100)+w(k)*(w(P)/100)+w(nt),_l=w(d)*(w(at)/100)+w(d)*(w(it)/100)+w(u)*(w(ot)/100)+w(g)*(w(st)/100)+w(k)*(w(rt)/100)+w(ut);a.channel_total=O||cl?vl:null,a.customer_total=O||ml?_l:null,a.channel_total===null||a.customer_total===null?a.profit=null:a.profit=w(a.channel_total)-w(a.customer_total)}Ue(()=>[a.commercial_amount,a.compulsory_amount,a.vehicle_tax_amount,a.non_vehicle_amount,a.channel_commercial_point,a.channel_commercial_supplement_point,a.channel_compulsory_point,a.channel_vehicle_tax_point,a.channel_non_vehicle_point,a.channel_reward,a.customer_commercial_point,a.customer_commercial_supplement_point,a.customer_compulsory_point,a.customer_vehicle_tax_point,a.customer_non_vehicle_point,a.customer_reward],()=>je());const Ot=I(()=>{const t=Array.isArray(se.value)?se.value:[],e=L.channel_group_id;if(e==null||e==="")return t;const i=Number(e);if(t.some(u=>Number(u?.id)===i))return t;const d=x.value?.channel_group_name||`ID:${e}`;return[{id:e,group_name:`${d}（已删除）`,_ghost:!0},...t]}),It=I(()=>{const t=Array.isArray(re.value)?re.value:[],e=L.customer_group_id;if(e==null||e==="")return t;const i=Number(e);if(t.some(u=>Number(u?.id)===i))return t;const d=x.value?.customer_group_name||`ID:${e}`;return[{id:e,group_name:`${d}（已删除）`,_ghost:!0},...t]}),{groups:qe,allFields:zt,loadConfig:Ct}=Ul(),At=I(()=>{const t=new Map;for(const e of zt.value||[])t.set(e.key,e);return t});function D(t){return At.value.get(t)||{key:t,label:t,type:"text",options:[]}}function be(t){return t?.key==="id_number"?"公民身份号码":t?.label||t?.key||""}function He(t){if(t==null||t==="")return t;const e=String(t);return/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:t}function Et(t,e){if(t==null||t==="")return"-";const i=e||{type:"text",options:[]},s=i.type==="date"?He(t):t,d=Ol(s,i);return d===""?"-":d}const p=Oe({}),ee=I(()=>!x.value||ze.value?!1:x.value.is_finished===!0?Ce.value:Ce.value?!0:ft.value&&x.value.is_finished===!1),v=I(()=>ee.value&&G.value),J=I(()=>v.value?!0:q.value&&Z.value),Dt=I(()=>!x.value||x.value.is_finished!==!0?!1:Ce.value);function he(t){const e=String(t||"").trim().toLowerCase();return e?["vehicle_cert","vehicle_certificate","cert","car_cert"].includes(e)?"vehicle_cert":["idcard_front","id_card_front","identity_front","id_front"].includes(e)?"idcard_front":["idcard_back","id_card_back","identity_back","id_back"].includes(e)?"idcard_back":["driving_license_main","driving_license","driving_main","license_main","dl_main"].includes(e)?"driving_license_main":["driving_license_sub","driving_license_attach","driving_attach","driving_sub","license_sub","dl_sub","dl_attach"].includes(e)?"driving_license_sub":["related","other","others","extra","backup"].includes(e)?"related":e:""}function De(){return{vehicle_cert:[],idcard_front:[],idcard_back:[],driving_license_main:[],driving_license_sub:[],related:[]}}function Ge(t,e,i){const s=he(e),d=String(i||"").trim();!s||!d||(t[s]||(t[s]=[]),t[s].push(d))}function Ft(t,e){if(!(!e||typeof e!="object"||Array.isArray(e)))for(const[i,s]of Object.entries(e)){const d=he(i);if(d!=="_all"){if(typeof s=="string"){Ge(t,d,s);continue}if(Array.isArray(s))for(const u of s)Ge(t,d,u)}}}function Nt(t){const e=De();for(const[i,s]of Object.entries(t||{})){const d=new Set,u=[];for(const g of Array.isArray(s)?s:[]){const k=String(g||"").trim();!k||d.has(k)||(d.add(k),u.push(k))}e[i]=u}return e}const z=I(()=>{const t=De();for(const e of x.value?.images||[]){const i=he(e?.slot_key),s=String(e?.image_url||e?.url||e?.image_file?.url||"").trim();!i||!s||(t[i]||(t[i]=[]),t[i].push(s))}return Ft(t,x.value?.image_urls),Nt(t)}),Fe=I(()=>{const t=De();for(const e of x.value?.images||[]){const i=he(e?.slot_key);i&&(t[i]||(t[i]=[]),t[i].push(e))}return t}),Mt=Object.freeze(["id_name","id_gender","id_ethnicity","id_birth_date","id_address","id_number"]),Bt=Object.freeze(["id_issuer","id_validity"]),Tt=I(()=>Mt.map(t=>D(t))),Rt=I(()=>Bt.map(t=>D(t))),Pt=I(()=>(qe.value||[]).find(t=>t.group_key==="driving_license")),Yt=I(()=>(qe.value||[]).find(t=>t.group_key==="driving_attach"));function We(t){return t?(t.fields||[]).map(i=>i.field_name).filter(Boolean).map(i=>D(i)):[]}const Kt=Object.freeze(["dl_plate_no","dl_owner","dl_use_nature","dl_brand_model","dl_vin","dl_engine_no","dl_register_date"]);function Lt(t){const e=[],i=new Set;for(const s of Array.isArray(t)?t:[]){const d=String(s?.key||"");d&&(i.has(d)||(i.add(d),e.push(s)))}return e}function $t(t,e){const i=Array.isArray(t)?t:[],s=new Set(i.map(u=>String(u?.key||"")).filter(Boolean)),d=(Array.isArray(e)?e:[]).filter(u=>u&&!s.has(String(u))).map(u=>D(u));return Lt([...i,...d])}const Ze=I(()=>$t(We(Pt.value),Kt)),Je=I(()=>We(Yt.value));function W(t,{preferKeys:e=[],labelIncludes:i=[],keyIncludes:s=[]}={}){const d=Array.isArray(t)?t:[];for(const u of e){const g=d.find(k=>k?.key===u);if(g?.key)return g.key}for(const u of s){const g=d.find(k=>String(k?.key||"").toLowerCase().includes(String(u).toLowerCase()));if(g?.key)return g.key}for(const u of i){const g=d.find(k=>String(k?.label||"").includes(String(u)));if(g?.key)return g.key}return null}const jt=I(()=>{const t=Ze.value||[];return{plate:W(t,{preferKeys:["dl_plate_no"],keyIncludes:["plate"],labelIncludes:["号牌"]}),owner:W(t,{preferKeys:["dl_owner"],keyIncludes:["owner"],labelIncludes:["所有人"]}),use_nature:W(t,{preferKeys:["dl_use_nature"],keyIncludes:["use_nature","use"],labelIncludes:["使用性质"]}),brand_model:W(t,{preferKeys:["dl_brand_model"],keyIncludes:["brand","model"],labelIncludes:["品牌型号","品牌","型号"]}),vin:W(t,{preferKeys:["dl_vin","vin"],keyIncludes:["vin"],labelIncludes:["识别","车架"]}),engine:W(t,{preferKeys:["dl_engine_no","engine_no","dl_engine","engine"],keyIncludes:["engine"],labelIncludes:["发动机"]}),register_date:W(t,{preferKeys:["dl_register_date","register_date","dl_reg_date","dl_register_dt"],keyIncludes:["register","reg_date","reg"],labelIncludes:["注册日期"]})}});function b(t){return jt.value?.[t]||null}const we=I(()=>{const t=Je.value||[];return W(t,{preferKeys:["dl_approved_passenger_count","approved_passenger_count","dl_passenger_count"],keyIncludes:["passenger","approved"],labelIncludes:["核定载","载人数","载客"]})});function qt(){const t=ne.query?.from;if(typeof t=="string"&&t){let e=t;try{e=decodeURIComponent(t)}catch{e=t}if(e.startsWith("/")){Ie.push(e);return}}if(window.history.length>1){Ie.back();return}Ie.push({path:ze.value?"/finance":"/orders/all"})}function Qe(t){const e=t?.dynamic_data||{};for(const i of Object.keys(p))delete p[i];for(const[i,s]of Object.entries(e))p[i]=s??"";L.customer_group_id=t?.customer_group_id??null,L.channel_group_id=t?.channel_group_id??null,$e(t)}function Xe(){if(ee.value){if(G.value){G.value=!1,x.value&&Qe(x.value);return}G.value=!0,(!se.value.length||!re.value.length)&&Ne()}}async function Ne(){pe.value=!0,ye.value=!0;try{const[t,e]=await Promise.all([Ye.get("/orders/channel-groups"),Ye.get("/orders/customer-groups")]);se.value=Array.isArray(t?.data?.items)?t.data.items:[],re.value=Array.isArray(e?.data?.items)?e.data.items:[]}catch(t){console.error(t),M.error("加载渠道/客户选项失败")}finally{pe.value=!1,ye.value=!1}}function Ht(){return q.value}async function ue({preserveEditDraft:t=!1}={}){H.value=!0;try{const e=Ht()?await Vl(ae):await kl(ae);x.value=e.data,t?G.value||$e(x.value):(G.value=!1,Qe(x.value))}catch(e){console.error(e),M.error("加载订单详情失败")}finally{H.value=!1}}function Gt(t){return String(t||"").replace(/\s+/g,"").replace(/-/g,"")}function Wt(t){const e=Gt(t);return e?/^(?:\+?86)?1[3-9]\d{9}$/.test(e):!0}function Zt(){return String(p?.id_name||"").trim()}function Jt(){const t=b("owner");return t?String(p?.[t]||"").trim():""}async function Qt(){if(v.value){const i=String(a.owner_phone||"").trim();if(i&&!Wt(i))return await mt(),await Ke({targetEl:Ae.value,flashEls:[Ae.value],title:"电话格式不正确",message:"车主电话默认按手机号校验，请检查后再保存。",confirmText:"我知道了",cancelText:"取消"}),!1}const t=Zt(),e=Jt();return!(t&&e&&t!==e&&(await mt(),!await Ke({targetEl:ge.value||ke.value,flashEls:[ge.value,ke.value].filter(Boolean),title:"姓名不一致",message:`检测到证件姓名不一致：
身份证姓名【${t}】
行驶证所有人【${e}】
是否仍要继续保存？`,confirmText:"继续保存",cancelText:"取消保存"})))}async function Xt(){if(!(!x.value||!v.value||!await Qt())){K.value=!0;try{const e={...x.value.dynamic_data||{},...p};await hl(ae,{dynamic_data:e,customer_group_id:L.customer_group_id,channel_group_id:L.channel_group_id,order_info:Ut()}),M.success("保存成功"),await ue()}catch(e){console.error(e),M.error("保存失败")}finally{K.value=!1}}}async function el(){try{await Se.confirm("确认将该订单【退回未完成】？","确认操作",{confirmButtonText:"确认退回",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}await tl()}async function tl(){if(x.value){K.value=!0;try{await wl(ae,{is_finished:!1}),M.success("已退回未完成"),await ue()}catch(t){console.error(t),M.error("操作失败")}finally{K.value=!1}}}const de=C("smart");function ll(){const t=localStorage.getItem(vt);(t==="smart"||t==="direct"||t==="stable")&&(de.value=t)}ll();const S=Oe({vehicle_cert:!1,idcard_front:!1,idcard_back:!1,driving_license_main:!1,driving_license_sub:!1,related:!1}),ce=C([]),te=C(!1),Me=C("");let Ve=null,Be=0;function nl(t){try{return Date.parse(t)}catch{return 0}}async function al(){const t=Date.now();if(Ve&&Be&&t+12e4<Be)return Ve;const i=(await Ye.get("/orders/bos-sts"))?.data;if(!i?.accessKeyId||!i?.secretAccessKey||!i?.sessionToken)throw new Error("bos-sts response invalid");return Ve=i,Me.value=i.bosHost||"",Be=nl(i.expiration)||t+600*1e3,Ve}function Q(t){const e=t?.message||t?.response?.data?.detail||t?.response?.data?.message||"";return String(e||"")}function et(t){const e=Q(t).toLowerCase();return e.includes("failed to fetch")||e.includes("network error")||e.includes("err_")||e.includes("cors")||e.includes("代理")||e.includes("vpn")||e.includes("127.0.0.1:7890")}async function tt(t){try{await Se.confirm(`上传看起来被当前网络环境拦截（常见于 VPN/代理/公司网关）。

是否切换到【稳定模式上传】继续？`,"上传失败（网络拦截）",{confirmButtonText:"切换为稳定模式",cancelButtonText:"继续直传重试",type:"warning",center:!0,distinguishCancelAndClose:!0}),de.value="stable";try{localStorage.setItem(vt,"stable")}catch{}return!0}catch{return!1}}function il(t){try{return(new URL(String(t)).pathname||"").replace(/^\/+/,"")}catch{const e=String(t||""),i=e.indexOf("://");if(i>=0){const s=e.slice(i+3),d=s.indexOf("/");if(d>=0)return s.slice(d+1).replace(/^\/+/,"")}return""}}function ol(t){const e=(t?.storage_key||t?.image_file?.storage_key||"").trim().replace(/^\/+/,"");if(e)return e;const i=(t?.image_url||t?.url||"").trim();return i?il(i):""}function sl(t){const i=String(t||"").match(/([a-f0-9]{32})\.[a-z0-9]+$/i);return i?String(i[1]).toLowerCase():""}function Te(t,e){const i=ol(t);if(!i)return null;const s=sl(i)||"";return{slot_key:e,storage_key:i,md5:s,size:0}}async function xe(t,e){if(q.value){const u=(await dt({slot_key:t,file:e}))?.data;return{slot_key:t,storage_key:u?.storage_key,md5:u?.md5||"",size:u?.size||e?.size||0,content_type:u?.content_type||e?.type||"application/octet-stream",etag:u?.etag||"",original_name:u?.original_name||e?.name||"file",url:u?.url||""}}if(de.value==="stable"){const u=(await dt({slot_key:t,file:e}))?.data;return{slot_key:t,storage_key:u?.storage_key,md5:u?.md5||"",size:u?.size||e?.size||0,content_type:u?.content_type||e?.type||"application/octet-stream",etag:u?.etag||"",original_name:u?.original_name||e?.name||"file",url:u?.url||""}}const i=await al();if(!Me.value)throw new Error("bosHost missing");const s=await gl({bosHost:Me.value,slotKey:t,file:e,sts:i});return{slot_key:t,storage_key:s?.storage_key,md5:s?.md5||"",size:s?.size||e?.size||0,content_type:s?.content_type||e?.type||"application/octet-stream",etag:s?.etag||"",original_name:s?.original_name||e?.name||"file",url:s?.url||""}}async function X(t,e,{clear:i=!1}={}){await bl({order_id:ae,images:e,clear_slots:i?[t]:[]}),await ue({preserveEditDraft:!0}),M.success("图片已更新（如涉及证件将触发 OCR 任务）")}async function me(t,e){if(!v.value)return;const i=e?.raw;if(i){S[t]=!0;try{const s=await xe(t,i);if(!s?.storage_key)throw new Error("upload meta invalid");await X(t,[s])}catch(s){if(de.value==="smart"&&et(s)&&await tt())try{const u=await xe(t,i);if(!u?.storage_key)throw new Error("upload meta invalid");await X(t,[u]);return}catch(u){console.error(u),M.error(Q(u)||"上传失败");return}console.error(s),M.error(Q(s)||"上传失败")}finally{S[t]=!1}}}async function rl(t){if(!J.value)return;const e=t?.raw;e&&(ce.value.push(e),!S.related&&await lt())}async function lt(){if(S.related)return;const t=ce.value.splice(0);if(t.length){S.related=!0;try{const e=(Fe.value.related||[]).map(s=>Te(s,"related")).filter(Boolean),i=[];for(const s of t){const d=await xe("related",s);if(!d?.storage_key)throw new Error("upload meta invalid");i.push(d)}i.length&&await X("related",[...e,...i]),te.value=!1}catch(e){if(!q.value&&de.value==="smart"&&et(e)&&!te.value&&await tt()){te.value=!0;try{const s=(Fe.value.related||[]).map(u=>Te(u,"related")).filter(Boolean),d=[];for(const u of t){const g=await xe("related",u);if(!g?.storage_key)throw new Error("upload meta invalid");d.push(g)}d.length&&await X("related",[...s,...d]),te.value=!1}catch(s){console.error(s),M.error(Q(s)||"上传失败")}return}console.error(e),M.error(Q(e)||"上传失败")}finally{S.related=!1,ce.value.length&&lt()}}}async function ul(t){if(!J.value)return;const e=(Fe.value.related||[]).slice();if(!(t<0||t>=e.length)){S.related=!0;try{const i=e.filter((s,d)=>d!==t).map(s=>Te(s,"related")).filter(Boolean);if(!i.length){await X("related",[],{clear:!0});return}await X("related",i)}catch(i){console.error(i),M.error(Q(i)||"删除失败")}finally{S.related=!1}}}async function dl(){if(J.value&&z.value.related.length){try{await Se.confirm("确认清空【备用图】所有图片？","确认清空",{confirmButtonText:"确认清空",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}ce.value=[],te.value=!1,S.related=!0;try{await X("related",[],{clear:!0})}catch(t){console.error(t),M.error(Q(t)||"清空失败")}finally{S.related=!1}}}Il(async()=>{await Ct("order"),ee.value&&await Ne(),await ue()});const F=ct({name:"FieldValue",props:{modelValue:{type:[String,Number,Date],default:""},field:{type:Object,required:!0},editable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:e}){const i=R("el-input"),s=R("el-select"),d=R("el-option"),u=R("el-date-picker"),g=k=>e("update:modelValue",k);return()=>{const k=t.field||{type:"text",options:[]},O=t.modelValue??"",N=Et(O,k);if(!t.editable)return j("span",{class:"plain-value",title:N},N);if(k.type==="date"){const $=He(O)??"";return j(u,{modelValue:$,"onUpdate:modelValue":g,type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}if(k.type==="select"){const $=Array.isArray(k.options)?k.options:[];return j(s,{modelValue:O,"onUpdate:modelValue":g,filterable:!0,clearable:!0,class:"fv fv-select"},()=>$.map(n=>{const m=n&&typeof n=="object"?n.label:String(n),h=n&&typeof n=="object"?n.value:n;return j(d,{key:String(h),label:m,value:h})}))}return j(i,{modelValue:O,"onUpdate:modelValue":g,clearable:!0,class:"fv fv-input"})}}}),U=ct({name:"InfoValue",props:{modelValue:{type:[String,Number,null],default:""},type:{type:String,default:"text"},editable:{type:Boolean,default:!1},min:{type:Number,default:void 0},max:{type:Number,default:void 0}},emits:["update:modelValue"],setup(t,{emit:e}){const i=R("el-input"),s=R("el-date-picker"),d=C(""),u=C(!1);function g(m){return m==null||m===""||(t.type==="money"||t.type==="point")&&Number(m)===0?"":String(m)}function k(){u.value||(d.value=g(t.modelValue))}Ue(()=>t.modelValue,()=>k(),{immediate:!0});function O(m){let h=m;return typeof t.min=="number"&&(h=Math.max(t.min,h)),typeof t.max=="number"&&(h=Math.min(t.max,h)),h}function N(){d.value="",e("update:modelValue",null)}function $(){u.value=!1;const m=String(d.value||"").trim();if(!m){N();return}const h=Number(m);if(!Number.isFinite(h)){N();return}let P=O(h);if(t.type==="money"){P=Math.round(P*100)/100,e("update:modelValue",P),d.value=P.toFixed(2);return}e("update:modelValue",P),d.value=String(P)}function n(m){if(m==null||m==="")return"-";const h=Number(m);return t.type==="money"?Number.isFinite(h)?h.toFixed(2):"-":t.type==="point"?Number.isFinite(h)?String(h):"-":t.type==="date"?Ee(m)||"-":String(m)}return()=>{const m=t.modelValue??"";if(!t.editable){const h=n(m);return j("span",{class:"plain-value",title:h},h)}if(t.type==="date"){const h=Ee(m);return j(s,{modelValue:h,"onUpdate:modelValue":P=>e("update:modelValue",P),type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}return t.type==="money"||t.type==="point"?j(i,{modelValue:d.value,"onUpdate:modelValue":h=>{d.value=String(h??"")},clearable:!0,class:"fv fv-input",inputmode:"decimal",onFocus:()=>{u.value=!0},onBlur:()=>$(),onClear:()=>N()}):j(i,{modelValue:m,"onUpdate:modelValue":h=>e("update:modelValue",h),clearable:!0,class:"fv fv-input"})}}});return Ue(()=>ee.value,t=>{t&&(!se.value.length||!re.value.length)&&Ne()}),(t,e)=>{const i=R("el-button"),s=R("el-option"),d=R("el-select"),u=R("el-card"),g=R("el-upload"),k=R("el-image"),O=R("el-icon"),N=R("el-tooltip"),$=Cl("loading");return r(),c("div",Al,[l("div",El,[e[50]||(e[50]=l("h2",null,"订单详情",-1)),l("div",Dl,[o(i,{size:"small",onClick:qt},{default:_(()=>[...e[42]||(e[42]=[E("返回",-1)])]),_:1}),q.value&&x.value?(r(),c(B,{key:0},[Z.value?(r(),c(B,{key:1},[o(i,{size:"small",plain:"",disabled:H.value||K.value||S.related,onClick:gt},{default:_(()=>[...e[44]||(e[44]=[E(" 取消编辑 ",-1)])]),_:1},8,["disabled"]),o(i,{size:"small",type:"primary",disabled:H.value||K.value||S.related,onClick:kt},{default:_(()=>[...e[45]||(e[45]=[E(" 保存 ",-1)])]),_:1},8,["disabled"])],64)):(r(),T(i,{key:0,size:"small",type:"primary",plain:"",disabled:H.value||K.value||S.related,onClick:yt},{default:_(()=>[...e[43]||(e[43]=[E(" 编辑 ",-1)])]),_:1},8,["disabled"]))],64)):(r(),c(B,{key:1},[Dt.value?(r(),T(i,{key:0,size:"small",type:"warning",plain:"",loading:K.value,onClick:el},{default:_(()=>[...e[46]||(e[46]=[E(" 退回未完成 ",-1)])]),_:1},8,["loading"])):V("",!0),ee.value&&!G.value?(r(),T(i,{key:1,size:"small",type:"primary",plain:"",disabled:H.value||K.value,onClick:Xe},{default:_(()=>[...e[47]||(e[47]=[E(" 编辑 ",-1)])]),_:1},8,["disabled"])):V("",!0),ee.value&&G.value?(r(),T(i,{key:2,size:"small",plain:"",disabled:H.value||K.value,onClick:Xe},{default:_(()=>[...e[48]||(e[48]=[E(" 取消编辑 ",-1)])]),_:1},8,["disabled"])):V("",!0),v.value?(r(),T(i,{key:3,size:"small",type:"primary",loading:K.value,onClick:Xt},{default:_(()=>[...e[49]||(e[49]=[E("保存",-1)])]),_:1},8,["loading"])):V("",!0)],64))])]),zl((r(),c("div",Fl,[o(u,{shadow:"never",class:"section-card meta-card"},{header:_(()=>[...e[51]||(e[51]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"渠道、客户")],-1)])]),default:_(()=>[l("div",Nl,[l("div",Ml,[e[52]||(e[52]=l("div",{class:"kv-label"},"渠道",-1)),l("div",Bl,[v.value?(r(),T(d,{key:0,modelValue:L.channel_group_id,"onUpdate:modelValue":e[0]||(e[0]=n=>L.channel_group_id=n),filterable:"",clearable:"",placeholder:"请选择渠道",class:"fv fv-select",loading:pe.value,disabled:pe.value},{default:_(()=>[(r(!0),c(B,null,Y(Ot.value,n=>(r(),T(s,{key:String(n.id),label:n.group_name||String(n.id),value:n.id,disabled:!!n._ghost},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading","disabled"])):(r(),c("span",{key:1,class:"plain-value",title:x.value?.channel_group_name||"-"},le(x.value?.channel_group_name||"-"),9,Tl))])]),l("div",Rl,[e[53]||(e[53]=l("div",{class:"kv-label"},"客户",-1)),l("div",Pl,[v.value?(r(),T(d,{key:0,modelValue:L.customer_group_id,"onUpdate:modelValue":e[1]||(e[1]=n=>L.customer_group_id=n),filterable:"",clearable:"",placeholder:"请选择客户",class:"fv fv-select",loading:ye.value,disabled:ye.value},{default:_(()=>[(r(!0),c(B,null,Y(It.value,n=>(r(),T(s,{key:String(n.id),label:n.group_name||String(n.id),value:n.id,disabled:!!n._ghost},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading","disabled"])):(r(),c("span",{key:1,class:"plain-value",title:x.value?.customer_group_name||"-"},le(x.value?.customer_group_name||"-"),9,Yl))])])])]),_:1}),o(u,{shadow:"never",class:"section-card"},{header:_(()=>[...e[54]||(e[54]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"备用图")],-1)])]),default:_(()=>[J.value?(r(),c("div",Kl,[o(g,{drag:"","auto-upload":!1,multiple:!0,"show-file-list":!1,accept:"image/*",disabled:S.related,"on-change":n=>rl(n),class:"related-dragger"},{default:_(()=>[...e[55]||(e[55]=[l("div",{class:"drag-inner"},[l("div",{class:"drag-title"},"拖拽图片到这里"),l("div",{class:"drag-sub"},"或点击选择（支持多张）")],-1)])]),_:1},8,["disabled","on-change"]),o(i,{size:"small",type:"danger",plain:"",disabled:S.related||!z.value.related.length,loading:S.related,onClick:dl},{default:_(()=>[...e[56]||(e[56]=[E(" 清空 ",-1)])]),_:1},8,["disabled","loading"])])):V("",!0),J.value||z.value.related.length?(r(),c("div",Ll,[(r(!0),c(B,null,Y(z.value.related,(n,m)=>(r(),c("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.related,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"]),J.value?(r(),c("button",{key:0,type:"button",class:"thumb-remove",title:"删除这张",onClick:h=>ul(m)}," × ",8,$l)):V("",!0)]))),128)),J.value&&!z.value.related.length?(r(),c("div",jl)):V("",!0)])):V("",!0)]),_:1}),o(u,{shadow:"never",class:"section-card"},{header:_(()=>[...e[57]||(e[57]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"订单信息")],-1)])]),default:_(()=>[l("div",ql,[l("div",Hl,[l("div",Gl,[e[58]||(e[58]=l("div",{class:"kv-label"},"保险到期日",-1)),l("div",Wl,[o(f(U),{modelValue:a.insurance_expire_date,"onUpdate:modelValue":e[2]||(e[2]=n=>a.insurance_expire_date=n),type:"date",editable:v.value},null,8,["modelValue","editable"])])]),l("div",Zl,[e[59]||(e[59]=l("div",{class:"kv-label"},"车主电话",-1)),l("div",{class:"kv-value",ref_key:"ownerPhoneValueRef",ref:Ae},[o(f(U),{modelValue:a.owner_phone,"onUpdate:modelValue":e[3]||(e[3]=n=>a.owner_phone=n),type:"text",editable:v.value},null,8,["modelValue","editable"])],512)])]),l("div",Jl,[l("div",Ql,[e[60]||(e[60]=l("div",{class:"kv-label"},"订单备注",-1)),l("div",Xl,[o(f(U),{modelValue:a.remark,"onUpdate:modelValue":e[4]||(e[4]=n=>a.remark=n),type:"text",editable:v.value},null,8,["modelValue","editable"])])])]),l("div",en,[l("div",tn,[e[61]||(e[61]=l("div",{class:"kv-label"},"商业金额",-1)),l("div",ln,[o(f(U),{modelValue:a.commercial_amount,"onUpdate:modelValue":e[5]||(e[5]=n=>a.commercial_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])]),l("div",nn,[e[62]||(e[62]=l("div",{class:"kv-label"},"交强金额",-1)),l("div",an,[o(f(U),{modelValue:a.compulsory_amount,"onUpdate:modelValue":e[6]||(e[6]=n=>a.compulsory_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])]),l("div",on,[e[63]||(e[63]=l("div",{class:"kv-label"},"车船税金额",-1)),l("div",sn,[o(f(U),{modelValue:a.vehicle_tax_amount,"onUpdate:modelValue":e[7]||(e[7]=n=>a.vehicle_tax_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])]),l("div",rn,[e[64]||(e[64]=l("div",{class:"kv-label"},"非车金额",-1)),l("div",un,[o(f(U),{modelValue:a.non_vehicle_amount,"onUpdate:modelValue":e[8]||(e[8]=n=>a.non_vehicle_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])])]),l("div",dn,[l("div",cn,[e[65]||(e[65]=l("div",{class:"kv-label"},"保费金额",-1)),l("div",mn,[o(f(U),{modelValue:a.premium_total,"onUpdate:modelValue":e[9]||(e[9]=n=>a.premium_total=n),type:"money",editable:!1},null,8,["modelValue"])])])])]),e[81]||(e[81]=l("div",{class:"split-title"},"渠道",-1)),l("div",vn,[l("div",_n,[e[66]||(e[66]=l("div",{class:"kv-label"},"商业点位%",-1)),l("div",fn,[o(f(U),{modelValue:a.channel_commercial_point,"onUpdate:modelValue":e[10]||(e[10]=n=>a.channel_commercial_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",pn,[e[67]||(e[67]=l("div",{class:"kv-label"},"商业后补%",-1)),l("div",yn,[o(f(U),{modelValue:a.channel_commercial_supplement_point,"onUpdate:modelValue":e[11]||(e[11]=n=>a.channel_commercial_supplement_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",gn,[e[68]||(e[68]=l("div",{class:"kv-label"},"交强点位%",-1)),l("div",kn,[o(f(U),{modelValue:a.channel_compulsory_point,"onUpdate:modelValue":e[12]||(e[12]=n=>a.channel_compulsory_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",bn,[e[69]||(e[69]=l("div",{class:"kv-label"},"车船税点位%",-1)),l("div",hn,[o(f(U),{modelValue:a.channel_vehicle_tax_point,"onUpdate:modelValue":e[13]||(e[13]=n=>a.channel_vehicle_tax_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",wn,[e[70]||(e[70]=l("div",{class:"kv-label"},"非车点位%",-1)),l("div",Vn,[o(f(U),{modelValue:a.channel_non_vehicle_point,"onUpdate:modelValue":e[14]||(e[14]=n=>a.channel_non_vehicle_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",xn,[e[71]||(e[71]=l("div",{class:"kv-label"},"出单奖励",-1)),l("div",Sn,[o(f(U),{modelValue:a.channel_reward,"onUpdate:modelValue":e[15]||(e[15]=n=>a.channel_reward=n),type:"money",editable:v.value},null,8,["modelValue","editable"])])])]),l("div",Un,[l("div",On,[e[72]||(e[72]=l("div",{class:"kv-label"},"渠道合计",-1)),l("div",In,[o(f(U),{modelValue:a.channel_total,"onUpdate:modelValue":e[16]||(e[16]=n=>a.channel_total=n),type:"money",editable:!1},null,8,["modelValue"])])])]),e[82]||(e[82]=l("div",{class:"split-title"},"客户",-1)),l("div",zn,[l("div",Cn,[e[73]||(e[73]=l("div",{class:"kv-label"},"商业点位%",-1)),l("div",An,[o(f(U),{modelValue:a.customer_commercial_point,"onUpdate:modelValue":e[17]||(e[17]=n=>a.customer_commercial_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",En,[e[74]||(e[74]=l("div",{class:"kv-label"},"商业后补%",-1)),l("div",Dn,[o(f(U),{modelValue:a.customer_commercial_supplement_point,"onUpdate:modelValue":e[18]||(e[18]=n=>a.customer_commercial_supplement_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",Fn,[e[75]||(e[75]=l("div",{class:"kv-label"},"交强点位%",-1)),l("div",Nn,[o(f(U),{modelValue:a.customer_compulsory_point,"onUpdate:modelValue":e[19]||(e[19]=n=>a.customer_compulsory_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",Mn,[e[76]||(e[76]=l("div",{class:"kv-label"},"车船税点位%",-1)),l("div",Bn,[o(f(U),{modelValue:a.customer_vehicle_tax_point,"onUpdate:modelValue":e[20]||(e[20]=n=>a.customer_vehicle_tax_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",Tn,[e[77]||(e[77]=l("div",{class:"kv-label"},"非车点位%",-1)),l("div",Rn,[o(f(U),{modelValue:a.customer_non_vehicle_point,"onUpdate:modelValue":e[21]||(e[21]=n=>a.customer_non_vehicle_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",Pn,[e[78]||(e[78]=l("div",{class:"kv-label"},"出单奖励",-1)),l("div",Yn,[o(f(U),{modelValue:a.customer_reward,"onUpdate:modelValue":e[22]||(e[22]=n=>a.customer_reward=n),type:"money",editable:v.value},null,8,["modelValue","editable"])])])]),l("div",Kn,[l("div",Ln,[e[79]||(e[79]=l("div",{class:"kv-label"},"客户合计",-1)),l("div",$n,[o(f(U),{modelValue:a.customer_total,"onUpdate:modelValue":e[23]||(e[23]=n=>a.customer_total=n),type:"money",editable:!1},null,8,["modelValue"])])])]),l("div",jn,[l("div",qn,[e[80]||(e[80]=l("div",{class:"kv-label"},"利润",-1)),l("div",Hn,[o(f(U),{modelValue:a.profit,"onUpdate:modelValue":e[24]||(e[24]=n=>a.profit=n),type:"money",editable:!1},null,8,["modelValue"])])])])]),_:1}),o(u,{shadow:"never",class:"section-card"},{header:_(()=>[l("div",Gn,[e[83]||(e[83]=l("div",{class:"section-title"},"车辆合格证",-1)),o(i,{class:"icon-btn",circle:"",size:"small",onClick:e[25]||(e[25]=n=>fe.value=!fe.value)},{default:_(()=>[o(O,null,{default:_(()=>[fe.value?(r(),T(f(Re),{key:0})):(r(),T(f(Pe),{key:1}))]),_:1})]),_:1})])]),default:_(()=>[l("div",Wn,[l("div",Zn,[fe.value?(r(),c("div",oa,[o(yl,{data:p,readonly:!v.value},null,8,["data","readonly"])])):(r(),c("div",Jn,[l("div",Qn,[e[84]||(e[84]=l("div",{class:"kv-label"},"车辆型号",-1)),l("div",Xn,[o(f(F),{modelValue:p.vehicle_model,"onUpdate:modelValue":e[26]||(e[26]=n=>p.vehicle_model=n),field:D("vehicle_model"),editable:v.value},null,8,["modelValue","field","editable"])])]),l("div",ea,[e[85]||(e[85]=l("div",{class:"kv-label"},"车辆识别代号/车架号",-1)),l("div",ta,[o(f(F),{modelValue:p.vin,"onUpdate:modelValue":e[27]||(e[27]=n=>p.vin=n),field:D("vin"),editable:v.value},null,8,["modelValue","field","editable"])])]),l("div",la,[e[86]||(e[86]=l("div",{class:"kv-label"},"发动机号",-1)),l("div",na,[o(f(F),{modelValue:p.engine_no,"onUpdate:modelValue":e[28]||(e[28]=n=>p.engine_no=n),field:D("engine_no"),editable:v.value},null,8,["modelValue","field","editable"])])]),l("div",aa,[e[87]||(e[87]=l("div",{class:"kv-label"},"额定载客(人 )",-1)),l("div",ia,[o(f(F),{modelValue:p.approved_passenger_count,"onUpdate:modelValue":e[29]||(e[29]=n=>p.approved_passenger_count=n),field:D("approved_passenger_count"),editable:v.value},null,8,["modelValue","field","editable"])])])]))]),l("div",sa,[v.value?(r(),c("div",ra,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("vehicle_cert",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:S.vehicle_cert},{default:_(()=>[...e[88]||(e[88]=[E("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[89]||(e[89]=[E("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",ua,[(r(!0),c(B,null,Y(z.value.vehicle_cert,(n,m)=>(r(),c("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.vehicle_cert,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.vehicle_cert.length?V("",!0):(r(),c("div",da))])])])]),_:1}),o(u,{shadow:"never",class:"section-card"},{header:_(()=>[l("div",ca,[e[90]||(e[90]=l("div",{class:"section-title"},"身份证正面/身份证背面",-1)),o(i,{class:"icon-btn",circle:"",size:"small",onClick:e[30]||(e[30]=n=>ie.value=!ie.value)},{default:_(()=>[o(O,null,{default:_(()=>[ie.value?(r(),T(f(Re),{key:0})):(r(),T(f(Pe),{key:1}))]),_:1})]),_:1})])]),default:_(()=>[l("div",ma,[l("div",va,[e[95]||(e[95]=l("div",{class:"sub-title"},"身份证正面",-1)),l("div",_a,[l("div",fa,[ie.value?(r(),c("div",ba,[(r(!0),c(B,null,Y(Tt.value,n=>(r(),c("div",{key:n.key,class:"kv-item"},[l("div",ha,le(be(n)),1),l("div",{class:"kv-value",ref_for:!0,ref:bt(n)},[o(f(F),{modelValue:p[n.key],"onUpdate:modelValue":m=>p[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])],512)]))),128))])):(r(),c("div",pa,[l("div",ya,[e[91]||(e[91]=l("div",{class:"kv-label"},"姓名",-1)),l("div",{class:"kv-value",ref_key:"idNameValueRef",ref:ge},[o(f(F),{modelValue:p.id_name,"onUpdate:modelValue":e[31]||(e[31]=n=>p.id_name=n),field:D("id_name"),editable:v.value},null,8,["modelValue","field","editable"])],512)]),l("div",ga,[e[92]||(e[92]=l("div",{class:"kv-label"},"公民身份号码",-1)),l("div",ka,[o(f(F),{modelValue:p.id_number,"onUpdate:modelValue":e[32]||(e[32]=n=>p.id_number=n),field:D("id_number"),editable:v.value},null,8,["modelValue","field","editable"])])])]))]),l("div",wa,[v.value?(r(),c("div",Va,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("idcard_front",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:S.idcard_front},{default:_(()=>[...e[93]||(e[93]=[E("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[94]||(e[94]=[E("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",xa,[(r(!0),c(B,null,Y(z.value.idcard_front,(n,m)=>(r(),c("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.idcard_front,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.idcard_front.length?V("",!0):(r(),c("div",Sa))])])])]),l("div",Ua,[e[98]||(e[98]=l("div",{class:"sub-title"},"身份证背面",-1)),l("div",Oa,[l("div",Ia,[ie.value?(r(),c("div",za,[(r(!0),c(B,null,Y(Rt.value,n=>(r(),c("div",{key:n.key,class:"kv-item"},[l("div",Ca,le(be(n)),1),l("div",Aa,[o(f(F),{modelValue:p[n.key],"onUpdate:modelValue":m=>p[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])])]))),128))])):V("",!0)]),l("div",Ea,[v.value?(r(),c("div",Da,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("idcard_back",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:S.idcard_back},{default:_(()=>[...e[96]||(e[96]=[E("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[97]||(e[97]=[E("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",Fa,[(r(!0),c(B,null,Y(z.value.idcard_back,(n,m)=>(r(),c("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.idcard_back,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.idcard_back.length?V("",!0):(r(),c("div",Na))])])])])])]),_:1}),o(u,{shadow:"never",class:"section-card"},{header:_(()=>[l("div",Ma,[e[99]||(e[99]=l("div",{class:"section-title"},"行驶证/行驶证副件",-1)),o(i,{class:"icon-btn",circle:"",size:"small",onClick:e[33]||(e[33]=n=>oe.value=!oe.value)},{default:_(()=>[o(O,null,{default:_(()=>[oe.value?(r(),T(f(Re),{key:0})):(r(),T(f(Pe),{key:1}))]),_:1})]),_:1})])]),default:_(()=>[l("div",Ba,[l("div",Ta,[e[109]||(e[109]=l("div",{class:"sub-title"},"行驶证",-1)),l("div",Ra,[l("div",Pa,[oe.value?(r(),c("div",ti,[(r(!0),c(B,null,Y(Ze.value,n=>(r(),c("div",{key:n.key,class:"kv-item"},[l("div",li,le(be(n)),1),l("div",{class:"kv-value",ref_for:!0,ref:wt(n)},[o(f(F),{modelValue:p[n.key],"onUpdate:modelValue":m=>p[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])],512)]))),128))])):(r(),c("div",Ya,[b("plate")?(r(),c("div",Ka,[e[100]||(e[100]=l("div",{class:"kv-label"},"号牌号码",-1)),l("div",La,[o(f(F),{modelValue:p[b("plate")],"onUpdate:modelValue":e[34]||(e[34]=n=>p[b("plate")]=n),field:D(b("plate")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("owner")?(r(),c("div",$a,[e[101]||(e[101]=l("div",{class:"kv-label"},"所有人",-1)),l("div",{class:"kv-value",ref:ht},[o(f(F),{modelValue:p[b("owner")],"onUpdate:modelValue":e[35]||(e[35]=n=>p[b("owner")]=n),field:D(b("owner")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("use_nature")?(r(),c("div",ja,[e[102]||(e[102]=l("div",{class:"kv-label"},"使用性质",-1)),l("div",qa,[o(f(F),{modelValue:p[b("use_nature")],"onUpdate:modelValue":e[36]||(e[36]=n=>p[b("use_nature")]=n),field:D(b("use_nature")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("brand_model")?(r(),c("div",Ha,[e[103]||(e[103]=l("div",{class:"kv-label"},"品牌型号",-1)),l("div",Ga,[o(f(F),{modelValue:p[b("brand_model")],"onUpdate:modelValue":e[37]||(e[37]=n=>p[b("brand_model")]=n),field:D(b("brand_model")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("vin")?(r(),c("div",Wa,[e[104]||(e[104]=l("div",{class:"kv-label"},"车辆识别代码",-1)),l("div",Za,[o(f(F),{modelValue:p[b("vin")],"onUpdate:modelValue":e[38]||(e[38]=n=>p[b("vin")]=n),field:D(b("vin")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("engine")?(r(),c("div",Ja,[e[105]||(e[105]=l("div",{class:"kv-label"},"发动机号码",-1)),l("div",Qa,[o(f(F),{modelValue:p[b("engine")],"onUpdate:modelValue":e[39]||(e[39]=n=>p[b("engine")]=n),field:D(b("engine")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("register_date")?(r(),c("div",Xa,[e[106]||(e[106]=l("div",{class:"kv-label"},"注册日期",-1)),l("div",ei,[o(f(F),{modelValue:p[b("register_date")],"onUpdate:modelValue":e[40]||(e[40]=n=>p[b("register_date")]=n),field:D(b("register_date")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0)]))]),l("div",ni,[v.value?(r(),c("div",ai,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("driving_license_main",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:S.driving_license_main},{default:_(()=>[...e[107]||(e[107]=[E("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[108]||(e[108]=[E("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",ii,[(r(!0),c(B,null,Y(z.value.driving_license_main,(n,m)=>(r(),c("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.driving_license_main,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.driving_license_main.length?V("",!0):(r(),c("div",oi))])])])]),l("div",si,[e[113]||(e[113]=l("div",{class:"sub-title"},"行驶证副件",-1)),l("div",ri,[l("div",ui,[oe.value?(r(),c("div",vi,[(r(!0),c(B,null,Y(Je.value,n=>(r(),c("div",{key:n.key,class:"kv-item"},[l("div",_i,le(be(n)),1),l("div",fi,[o(f(F),{modelValue:p[n.key],"onUpdate:modelValue":m=>p[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])])]))),128))])):(r(),c("div",di,[we.value?(r(),c("div",ci,[e[110]||(e[110]=l("div",{class:"kv-label"},"核定载人数",-1)),l("div",mi,[o(f(F),{modelValue:p[we.value],"onUpdate:modelValue":e[41]||(e[41]=n=>p[we.value]=n),field:D(we.value),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0)]))]),l("div",pi,[v.value?(r(),c("div",yi,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("driving_license_sub",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:S.driving_license_sub},{default:_(()=>[...e[111]||(e[111]=[E("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[112]||(e[112]=[E("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",gi,[(r(!0),c(B,null,Y(z.value.driving_license_sub,(n,m)=>(r(),c("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.driving_license_sub,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.driving_license_sub.length?V("",!0):(r(),c("div",ki))])])])])])]),_:1})])),[[$,H.value]])])}}},Bi=xl(hi,[["__scopeId","data-v-8687a82b"]]);export{Bi as default};
