import{h as d}from"./http-DGyH82Tn.js";const c="Asia/Shanghai",O=new Set(["vehicle_cert","idcard_front","idcard_back","driving_license_main","driving_license_sub","related"]);function l(t){const e=Number(typeof t=="string"?t.trim():t);if(!Number.isFinite(e))throw new Error("orders api: invalid id");if(!Number.isInteger(e))throw new Error("orders api: id must be an integer");if(e<=0)throw new Error("orders api: invalid id");return e}function u(t){const e={};for(const[n,r]of Object.entries(t||{}))r!==void 0&&(e[n]=r);return e}function g(t){return Object.prototype.toString.call(t)==="[object Object]"}function a(t){return t instanceof Date&&Number.isFinite(t.getTime())}function m(t,e=c){const n=a(t)?t:new Date(t);return a(n)?new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit"}).format(n):""}function h(t){if(t==null)return"";if(a(t))return m(t,c);if(typeof t=="string"){const e=t.trim();if(!e)return"";if(/^\d{8}$/.test(e))return`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`;const n=e.match(/^(\d{4}-\d{2}-\d{2})/);if(n)return n[1];const r=e.match(/^(\d{4})\/(\d{2})\/(\d{2})/);return r?`${r[1]}-${r[2]}-${r[3]}`:""}if(typeof t=="number"&&Number.isFinite(t)){const e=new Date(t);return a(e)?m(e,c):""}return""}function b(t){if(!Array.isArray(t)||t.length!==2)return null;const e=h(t[0]),n=h(t[1]);return!e||!n?null:[e,n]}function j(t){const e={},n=t&&typeof t=="object"?t:{};for(const[r,i]of Object.entries(n))if(i!=null){if(typeof i=="string"){const s=i.trim();if(!s)continue;e[r]=s;continue}if(typeof i=="number"){if(!Number.isFinite(i))continue;e[r]=i;continue}if(a(i)){e[r]=m(i,c);continue}if(Array.isArray(i)){const s=i.map(o=>o==null?o:typeof o=="string"?o.trim():typeof o=="number"?Number.isFinite(o)?o:null:a(o)?m(o,c):o).filter(o=>o!=null&&!(typeof o=="string"&&o===""));if(!s.length)continue;e[r]=s;continue}e[r]=i}return e}function N(t){const e=j(t);if(Object.prototype.hasOwnProperty.call(e,"created_date")){const r=Object.prototype.hasOwnProperty.call(e,"created_date_start"),i=Object.prototype.hasOwnProperty.call(e,"created_date_end"),s=!r&&!i?b(e.created_date):null;delete e.created_date,s&&(e.created_date_start=s[0],e.created_date_end=s[1])}if(Object.prototype.hasOwnProperty.call(e,"first_register_date")){const r=Object.prototype.hasOwnProperty.call(e,"first_register_date_start"),i=Object.prototype.hasOwnProperty.call(e,"first_register_date_end"),s=!r&&!i?b(e.first_register_date):null;delete e.first_register_date,s&&(e.first_register_date_start=s[0],e.first_register_date_end=s[1])}const n=[["created_date_start","created_date_end"],["first_register_date_start","first_register_date_end"]];for(const[r,i]of n){const s=Object.prototype.hasOwnProperty.call(e,r)&&String(e[r]??"").trim()!=="",o=Object.prototype.hasOwnProperty.call(e,i)&&String(e[i]??"").trim()!=="";s!==o&&(delete e[r],delete e[i])}return e}function p(t){return g(t)?t:{}}function f(t){if(t!==void 0)return g(t)?t:void 0}function P(t={}){const e=N(t);return d.get("/orders",{params:e})}function k(t){const e=l(t);return d.get(`/orders/${e}`)}function z(t={}){const e=p(t),n=u({module:e.module||"order",dynamic_data:g(e.dynamic_data)?e.dynamic_data:{},customer_group_id:e.customer_group_id??void 0,channel_group_id:e.channel_group_id??void 0,salesperson_id:e.salesperson_id??void 0,order_info:f(e.order_info)});return d.post("/orders/draft",n)}function w(t){if(!Array.isArray(t))return[];const e=[];for(const n of t){if(!n||typeof n!="object")continue;const r=n.slot_key!=null?String(n.slot_key).trim():"",i=n.storage_key!=null?String(n.storage_key).trim().replace(/^\/+/,""):"",s=n.md5!=null?String(n.md5).trim():"";if(!r||!O.has(r)||!i)continue;const o={slot_key:r,storage_key:i};if(s&&(o.md5=s),n.etag!=null&&String(n.etag).trim()&&(o.etag=String(n.etag).trim()),n.size!=null&&!Number.isNaN(Number(n.size))){const y=Number(n.size);Number.isFinite(y)&&(o.size=Math.max(0,y))}n.content_type!=null&&String(n.content_type).trim()&&(o.content_type=String(n.content_type).trim()),n.original_name!=null&&String(n.original_name).trim()&&(o.original_name=String(n.original_name).trim());const _=n.url!=null&&String(n.url).trim()?String(n.url).trim():n.preview_url!=null&&String(n.preview_url).trim()?String(n.preview_url).trim():"";_&&(o.url=_),e.push(o)}return e}function S(t){if(!Array.isArray(t))return[];const e=new Set(["related"]),n=new Set,r=[];for(const i of t){const s=String(i??"").trim();s&&e.has(s)&&(n.has(s)||(n.add(s),r.push(s)))}return r}function E(t={}){const e=p(t),n=S(e.clear_slots),r=w(e.images),i=u({order_id:e.order_id!=null?l(e.order_id):void 0,images:r,clear_slots:n.length?n:void 0,dynamic_data:f(e.dynamic_data),customer_group_id:e.customer_group_id??void 0,channel_group_id:e.channel_group_id??void 0,salesperson_id:e.salesperson_id??void 0,order_info:f(e.order_info)});return d.post("/orders/finalize",i)}function $({slot_key:t,file:e}={}){const n=String(t??"").trim();if(!n)throw new Error("orders api: slot_key is required");if(!O.has(n))throw new Error("orders api: invalid slot_key");if(!e)throw new Error("orders api: file is required");const r=new FormData;return r.append("slot_key",n),r.append("file",e),d.post("/orders/bos-upload",r)}function F({order_id:t,images:e=[],clear_slots:n=[],trigger_ocr:r=!0}={}){const i=l(t),s=w(e),o=S(n),_=u({images:s,clear_slots:o.length?o:void 0,trigger_ocr:!!r});return d.post(`/orders/${i}/images/bind`,_)}function D(t,e={}){const n=l(t),r=p(e),i=u({module:r.module??void 0,dynamic_data:r.dynamic_data!==void 0?f(r.dynamic_data):void 0,status:r.status!==void 0?r.status:void 0,audit_status:r.audit_status!==void 0?r.audit_status:void 0,is_finished:r.is_finished!==void 0?r.is_finished:void 0,customer_group_id:r.customer_group_id!==void 0?r.customer_group_id:void 0,channel_group_id:r.channel_group_id!==void 0?r.channel_group_id:void 0,salesperson_id:r.salesperson_id!==void 0?r.salesperson_id:void 0,order_info:r.order_info!==void 0?f(r.order_info):void 0});return d.put(`/orders/${n}`,i)}function I(t,e={}){const n=l(t),r=p(e),i=u({is_finished:r.is_finished!==void 0?r.is_finished:void 0});return d.patch(`/orders/${n}/status`,i)}function T(){return d.get("/orders/customer-groups")}function C(){return d.get("/orders/channel-groups")}function L(){return d.get("/orders/teams")}function R(t={}){const e=t&&typeof t=="object"?t:{},n=typeof e.team_name=="string"?e.team_name.trim():"",r=e.status!==void 0&&e.status!==null?Number(e.status):1,i=Number.isFinite(r)?r:1,s=u({status:i,team_name:n||void 0});return d.get("/orders/salespersons",{params:s})}export{D as a,I as b,z as c,T as d,C as e,E as f,k as g,L as h,R as i,F as j,P as l,$ as u};
