import{a as w}from"./vendor-axios-C0Zqfgkc.js";const h="Asia/Shanghai";function u(t){return t instanceof Date&&Number.isFinite(t.getTime())}function p(t,n=h){const i=u(t)?t:new Date(t);return u(i)?new Intl.DateTimeFormat("en-CA",{timeZone:n,year:"numeric",month:"2-digit",day:"2-digit"}).format(i):""}function y(t){const n=new URLSearchParams,i=(e,o)=>{if(o==null)return;if(u(o)){const r=p(o);r&&n.append(e,r);return}if(Array.isArray(o)){for(const r of o){if(r==null)continue;if(u(r)){const c=p(r);c&&n.append(e,c);continue}if(typeof r=="object")continue;const s=String(r).trim();s&&n.append(e,s)}return}if(typeof o=="object")return;const d=String(o).trim();d&&n.append(e,d)};if(t&&typeof t=="object")for(const[e,o]of Object.entries(t))i(e,o);return n.toString()}const l=w.create({baseURL:"/api",timeout:3e4,paramsSerializer:{serialize:t=>y(t)}});function g(){try{return sessionStorage.getItem("sessionToken")||""}catch{return""}}function S(t,n){if(!t)return!1;if(typeof t.get=="function"){const e=t.get(n);return e!=null&&String(e).trim()!==""}const i=String(n).toLowerCase();for(const e of Object.keys(t))if(String(e).toLowerCase()===i){const o=t[e];return o!=null&&String(o).trim()!==""}return!1}function b(t,n,i){return t||(t={}),typeof t.set=="function"?(t.set(n,i),t):(t[n]=i,t)}l.interceptors.request.use(t=>{const n=g();return t.headers=t.headers??{},n&&!S(t.headers,"X-Session-Token")&&(t.headers=b(t.headers,"X-Session-Token",n)),t},t=>Promise.reject(t));let a=!1;function f(){return typeof window<"u"&&!!window.location}function m(){if(!f())return"/";const t=window.location.pathname||"/",n=window.location.search||"",i=window.location.hash||"";return`${t}${n}${i}`}function T(){if(!f())return;const t=m();if(t.startsWith("/login"))return;const n=`/login?redirect=${encodeURIComponent(t)}`;window.location.replace(n)}async function j(){if(!a){a=!0;try{const t=m();if(f()&&!t.startsWith("/login"))try{window.alert("登录已过期，请重新登录。")}catch{}try{sessionStorage.removeItem("sessionToken")}catch{}T()}catch(t){console.error(t)}finally{f()?window.setTimeout(()=>{a=!1},800):a=!1}}}async function B(t){const n=t?.response;if(!n)return t;const i=n.data,e=n.headers||{},o=String(e["content-type"]||e["Content-Type"]||"").toLowerCase();if(!(typeof Blob<"u"&&i instanceof Blob)||!(o.includes("application/json")||o.includes("text/json")))return t;try{const s=await i.text();if(!s)return t;const c=JSON.parse(s);return t.response.data=c,t}catch{return t}}l.interceptors.response.use(t=>t,async t=>{await B(t);const n=t?.response?.status;return(n===401||n===419)&&j(),Promise.reject(t)});export{l as h};
