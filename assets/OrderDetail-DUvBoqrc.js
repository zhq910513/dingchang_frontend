import{u as dl,b as cl}from"./vendor-vue-router-CVyACjsp.js";import{E as M,c as Be,a as Re,d as xe}from"./vendor-element-plus-CtVxZ4Oy.js";import{V as ml,u as vl}from"./bosUpload-8h4uOmX8.js";import{h as Te}from"./http-CBIyYC5i.js";import{g as _l,f as pl,u as st,a as fl,b as yl}from"./orders-C0J9gWfa.js";import{g as gl}from"./finance-DEkAaesZ.js";import{_ as kl,u as bl}from"./index-pdWIuU72.js";import{u as hl,f as wl}from"./fieldFormat-dj427FSC.js";import{c as I,r as C,o as Se,Z as Ue,q as Vl,x as d,z as l,I as xl,P as o,H as _,ay as T,O as B,G as R,J as V,aI as Sl,y as s,L as A,ac as Y,M as le,u as p,l as rt,ai as j,D as ut}from"./vendor-vue-fFWwKrgY.js";import"./vendor-lodash-rvV0CIkQ.js";import"./vendor-DWCz07M-.js";import"./vendor-dates-DVKSwKij.js";import"./vendor-axios-C0Zqfgkc.js";import"./vendor-pinia-CMXa-Za0.js";const Ul={class:"order-detail"},Il={class:"detail-header"},Ol={class:"header-actions"},zl={class:"page-body"},Cl={class:"kv-grid kv-grid-2"},El={class:"kv-item"},Al={class:"kv-value"},Dl=["title"],Fl={class:"kv-item"},Nl={class:"kv-value"},Ml=["title"],Bl={key:0,class:"image-actions image-actions-wide"},Rl={key:1,class:"image-wall image-wall-wide"},Tl=["onClick"],Pl={key:0,class:"thumb-empty"},Yl={class:"info-block"},$l={class:"kv-grid kv-grid-2 info-grid"},Ll={class:"kv-item"},Kl={class:"kv-value"},jl={class:"kv-item"},ql={class:"kv-grid kv-grid-2 info-grid"},Hl={class:"kv-item kv-item-remark"},Gl={class:"kv-value"},Wl={class:"kv-grid kv-grid-4 info-grid info-grid-compact"},Zl={class:"kv-item"},Jl={class:"kv-value"},Ql={class:"kv-item"},Xl={class:"kv-value"},en={class:"kv-item"},tn={class:"kv-value"},ln={class:"kv-item"},nn={class:"kv-value"},an={class:"kv-grid kv-grid-2 info-grid"},on={class:"kv-item"},sn={class:"kv-value value-red"},rn={class:"kv-grid kv-grid-6 info-grid info-grid-compact"},un={class:"kv-item"},dn={class:"kv-value"},cn={class:"kv-item"},mn={class:"kv-value"},vn={class:"kv-item"},_n={class:"kv-value"},pn={class:"kv-item"},fn={class:"kv-value"},yn={class:"kv-item"},gn={class:"kv-value"},kn={class:"kv-item"},bn={class:"kv-value"},hn={class:"kv-grid kv-grid-2 info-grid"},wn={class:"kv-item"},Vn={class:"kv-value value-red"},xn={class:"kv-grid kv-grid-6 info-grid info-grid-compact"},Sn={class:"kv-item"},Un={class:"kv-value"},In={class:"kv-item"},On={class:"kv-value"},zn={class:"kv-item"},Cn={class:"kv-value"},En={class:"kv-item"},An={class:"kv-value"},Dn={class:"kv-item"},Fn={class:"kv-value"},Nn={class:"kv-item"},Mn={class:"kv-value"},Bn={class:"kv-grid kv-grid-2 info-grid"},Rn={class:"kv-item"},Tn={class:"kv-value value-red"},Pn={class:"kv-grid kv-grid-2 info-grid"},Yn={class:"kv-item"},$n={class:"kv-value value-red"},Ln={class:"section-header"},Kn={class:"two-col"},jn={class:"left"},qn={key:0,class:"kv-grid kv-grid-2"},Hn={class:"kv-item"},Gn={class:"kv-value"},Wn={class:"kv-item"},Zn={class:"kv-value"},Jn={class:"kv-item"},Qn={class:"kv-value"},Xn={class:"kv-item"},ea={class:"kv-value"},ta={key:1},la={class:"right"},na={key:0,class:"image-actions"},aa={class:"image-wall"},ia={key:0,class:"thumb-empty"},oa={class:"section-header"},sa={class:"stack"},ra={class:"sub-block"},ua={class:"two-col"},da={class:"left"},ca={key:0,class:"kv-grid kv-grid-2"},ma={class:"kv-item"},va={class:"kv-item"},_a={class:"kv-value"},pa={key:1,class:"kv-grid kv-grid-2"},fa={class:"kv-label"},ya={class:"right"},ga={key:0,class:"image-actions"},ka={class:"image-wall"},ba={key:0,class:"thumb-empty"},ha={class:"sub-block"},wa={class:"two-col"},Va={class:"left"},xa={key:0,class:"kv-grid kv-grid-2"},Sa={class:"kv-label"},Ua={class:"kv-value"},Ia={class:"right"},Oa={key:0,class:"image-actions"},za={class:"image-wall"},Ca={key:0,class:"thumb-empty"},Ea={class:"section-header"},Aa={class:"stack"},Da={class:"sub-block"},Fa={class:"two-col"},Na={class:"left"},Ma={key:0,class:"kv-grid kv-grid-2"},Ba={key:0,class:"kv-item"},Ra={class:"kv-value"},Ta={key:1,class:"kv-item"},Pa={key:2,class:"kv-item"},Ya={class:"kv-value"},$a={key:3,class:"kv-item"},La={class:"kv-value"},Ka={key:4,class:"kv-item"},ja={class:"kv-value"},qa={key:5,class:"kv-item"},Ha={class:"kv-value"},Ga={key:6,class:"kv-item"},Wa={class:"kv-value"},Za={key:1,class:"kv-grid kv-grid-2"},Ja={class:"kv-label"},Qa={class:"right"},Xa={key:0,class:"image-actions"},ei={class:"image-wall"},ti={key:0,class:"thumb-empty"},li={class:"sub-block"},ni={class:"two-col"},ai={class:"left"},ii={key:0,class:"kv-grid kv-grid-2"},oi={key:0,class:"kv-item"},si={class:"kv-value"},ri={key:1,class:"kv-grid kv-grid-2"},ui={class:"kv-label"},di={class:"kv-value"},ci={class:"right"},mi={key:0,class:"image-actions"},vi={class:"image-wall"},_i={key:0,class:"thumb-empty"},pi=3500,dt="order_import_upload_mode",fi={__name:"OrderDetail",setup(yi){const Ie=cl(),ne=dl(),ct=bl(),ae=Number(ne.params.id),Oe=I(()=>String(ne.query?.source||"")==="finance"||String(ne.name||"")==="finance-order-detail"?!0:String(ne.path||"").startsWith("/finance/")),_e=I(()=>String(ct.roleName||"").trim().toLowerCase()),ze=I(()=>_e.value==="super_admin"||_e.value==="manager"),mt=I(()=>_e.value==="sales"),vt=I(()=>{const t=_e.value;return t==="finance"||t==="manager"||t==="super_admin"}),q=I(()=>Oe.value&&vt.value),O=C(null),H=C(!1),$=C(!1),pe=C(!1),ie=C(!1),oe=C(!1),G=C(!1),Z=C(!1);function _t(){q.value&&(Z.value=!Z.value)}function pt(){q.value&&(x.related||(ce.value=[],te.value=!1,Z.value=!1,M.success("已退出编辑")))}async function ft(){q.value&&(x.related||(Z.value=!1,M.success("已保存"),await ue({preserveEditDraft:!0})))}Se(()=>q.value,t=>{t||(Z.value=!1)},{immediate:!0});const se=C([]),re=C([]),fe=C(!1),ye=C(!1),L=Ue({channel_group_id:null,customer_group_id:null}),ge=C(null),ke=C(null),Ce=C(null);function yt(t){return t?.key!=="id_name"?null:e=>{e&&(ge.value=e)}}function gt(t){t&&(ke.value=t)}function kt(t){const e=b("owner");return!e||t?.key!==e?null:i=>{i&&(ke.value=i)}}function bt(t){return t?t.closest?.(".kv-item")||t:null}function ht(t){t&&(t.classList.remove("flash-value"),t.offsetWidth,t.classList.add("flash-value"),window.setTimeout(()=>{t.classList.remove("flash-value")},pi))}async function wt({stableMs:t=260,eps:e=1.5,timeoutMs:i=2e3}={}){const u=Date.now();let c=window.scrollY,r=0;return await new Promise(g=>{function k(){const U=window.scrollY;if(Math.abs(U-c)<=e?r+=16:r=0,c=U,r>=t)return g(!0);if(Date.now()-u>=i)return g(!1);requestAnimationFrame(k)}requestAnimationFrame(k)})}async function Pe({targetEl:t,flashEls:e=[],title:i="提示",message:u="",confirmText:c="继续",cancelText:r="取消"}={}){const g=bt(t)||t;g?.scrollIntoView&&g.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),await wt({stableMs:260,eps:1.5,timeoutMs:2200});const k=Array.from(new Set([...(e||[]).filter(Boolean)]));for(const U of k)ht(U);await new Promise(U=>window.setTimeout(U,120));try{const U=typeof u=="string"?j("div",{style:"white-space: pre-line; line-height: 1.7;"},u):u;return await xe.confirm(U,i,{confirmButtonText:c,cancelButtonText:r,type:"warning",center:!0}),!0}catch{return!1}}const a=Ue({insurance_expire_date:"",owner_phone:"",remark:"",commercial_amount:null,compulsory_amount:null,vehicle_tax_amount:null,non_vehicle_amount:null,premium_total:null,channel_commercial_point:null,channel_commercial_supplement_point:null,channel_compulsory_point:null,channel_vehicle_tax_point:null,channel_non_vehicle_point:null,channel_reward:null,channel_total:null,customer_commercial_point:null,customer_commercial_supplement_point:null,customer_compulsory_point:null,customer_vehicle_tax_point:null,customer_non_vehicle_point:null,customer_reward:null,customer_total:null,profit:null});function y(t){if(t==null||t==="")return null;const e=Number(t);return Number.isFinite(e)?e:null}function E(t){const e=y(t);return e===0?null:e}function w(t){const e=y(t);return e===null?0:e}function Ye(t){return t==null?"":String(t).trim()}function Ee(t){if(!t)return"";const e=String(t).trim();return e?/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:/^\d{4}-\d{2}-\d{2}/.test(e)?e.slice(0,10):e:""}function $e(t){const e=t&&typeof t=="object"&&t.order_info&&typeof t.order_info=="object"?t.order_info:{};a.insurance_expire_date=Ee(e.insurance_expire_date),a.owner_phone=Ye(e.owner_phone),a.remark=Ye(e.remark),a.commercial_amount=E(e.commercial_amount),a.compulsory_amount=E(e.compulsory_amount),a.vehicle_tax_amount=E(e.vehicle_tax_amount),a.non_vehicle_amount=E(e.non_vehicle_amount),a.premium_total=E(e.premium_total),a.channel_commercial_point=E(e.channel_commercial_point),a.channel_commercial_supplement_point=E(e.channel_commercial_supplement_point),a.channel_compulsory_point=E(e.channel_compulsory_point),a.channel_vehicle_tax_point=E(e.channel_vehicle_tax_point),a.channel_non_vehicle_point=E(e.channel_non_vehicle_point),a.channel_reward=E(e.channel_reward),a.channel_total=E(e.channel_total),a.customer_commercial_point=E(e.customer_commercial_point),a.customer_commercial_supplement_point=E(e.customer_commercial_supplement_point),a.customer_compulsory_point=E(e.customer_compulsory_point),a.customer_vehicle_tax_point=E(e.customer_vehicle_tax_point),a.customer_non_vehicle_point=E(e.customer_non_vehicle_point),a.customer_reward=E(e.customer_reward),a.customer_total=E(e.customer_total),a.profit=E(e.profit),Le()}function Vt(){const t=String(a.owner_phone||"").trim(),e=String(a.remark||"").trim();return{insurance_expire_date:a.insurance_expire_date?String(a.insurance_expire_date):"",owner_phone:t,remark:e,commercial_amount:y(a.commercial_amount),compulsory_amount:y(a.compulsory_amount),vehicle_tax_amount:y(a.vehicle_tax_amount),non_vehicle_amount:y(a.non_vehicle_amount),premium_total:y(a.premium_total),channel_commercial_point:y(a.channel_commercial_point),channel_commercial_supplement_point:y(a.channel_commercial_supplement_point),channel_compulsory_point:y(a.channel_compulsory_point),channel_vehicle_tax_point:y(a.channel_vehicle_tax_point),channel_non_vehicle_point:y(a.channel_non_vehicle_point),channel_reward:y(a.channel_reward),channel_total:y(a.channel_total),customer_commercial_point:y(a.customer_commercial_point),customer_commercial_supplement_point:y(a.customer_commercial_supplement_point),customer_compulsory_point:y(a.customer_compulsory_point),customer_vehicle_tax_point:y(a.customer_vehicle_tax_point),customer_non_vehicle_point:y(a.customer_non_vehicle_point),customer_reward:y(a.customer_reward),customer_total:y(a.customer_total),profit:y(a.profit)}}function Le(){const t=y(a.commercial_amount),e=y(a.compulsory_amount),i=y(a.vehicle_tax_amount),u=y(a.non_vehicle_amount),c=t===null?null:Math.max(0,t),r=e===null?null:Math.max(0,e),g=i===null?null:Math.max(0,i),k=u===null?null:Math.max(0,u);a.commercial_amount=c,a.compulsory_amount=r,a.vehicle_tax_amount=g,a.non_vehicle_amount=k;const U=[c,r,g,k].some(ve=>typeof ve=="number"),N=w(c)+w(r)+w(g)+w(k);a.premium_total=U?N:null;const K=y(a.channel_commercial_point),n=y(a.channel_commercial_supplement_point),m=y(a.channel_compulsory_point),h=y(a.channel_vehicle_tax_point),P=y(a.channel_non_vehicle_point),et=y(a.channel_reward),tt=y(a.customer_commercial_point),lt=y(a.customer_commercial_supplement_point),nt=y(a.customer_compulsory_point),at=y(a.customer_vehicle_tax_point),it=y(a.customer_non_vehicle_point),ot=y(a.customer_reward),ol=[K,n,m,h,P,et].some(ve=>typeof ve=="number"),sl=[tt,lt,nt,at,it,ot].some(ve=>typeof ve=="number"),rl=w(c)*(w(K)/100)+w(c)*(w(n)/100)+w(r)*(w(m)/100)+w(g)*(w(h)/100)+w(k)*(w(P)/100)+w(et),ul=w(c)*(w(tt)/100)+w(c)*(w(lt)/100)+w(r)*(w(nt)/100)+w(g)*(w(at)/100)+w(k)*(w(it)/100)+w(ot);a.channel_total=U||ol?rl:null,a.customer_total=U||sl?ul:null,a.channel_total===null||a.customer_total===null?a.profit=null:a.profit=w(a.channel_total)-w(a.customer_total)}Se(()=>[a.commercial_amount,a.compulsory_amount,a.vehicle_tax_amount,a.non_vehicle_amount,a.channel_commercial_point,a.channel_commercial_supplement_point,a.channel_compulsory_point,a.channel_vehicle_tax_point,a.channel_non_vehicle_point,a.channel_reward,a.customer_commercial_point,a.customer_commercial_supplement_point,a.customer_compulsory_point,a.customer_vehicle_tax_point,a.customer_non_vehicle_point,a.customer_reward],()=>Le());const xt=I(()=>{const t=Array.isArray(se.value)?se.value:[],e=L.channel_group_id;if(e==null||e==="")return t;const i=Number(e);if(t.some(r=>Number(r?.id)===i))return t;const c=O.value?.channel_group_name||`ID:${e}`;return[{id:e,group_name:`${c}（已删除）`,_ghost:!0},...t]}),St=I(()=>{const t=Array.isArray(re.value)?re.value:[],e=L.customer_group_id;if(e==null||e==="")return t;const i=Number(e);if(t.some(r=>Number(r?.id)===i))return t;const c=O.value?.customer_group_name||`ID:${e}`;return[{id:e,group_name:`${c}（已删除）`,_ghost:!0},...t]}),{groups:Ke,allFields:Ut,loadConfig:It}=hl(),Ot=I(()=>{const t=new Map;for(const e of Ut.value||[])t.set(e.key,e);return t});function D(t){return Ot.value.get(t)||{key:t,label:t,type:"text",options:[]}}function be(t){return t?.key==="id_number"?"公民身份号码":t?.label||t?.key||""}function je(t){if(t==null||t==="")return t;const e=String(t);return/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:t}function zt(t,e){if(t==null||t==="")return"-";const i=e||{type:"text",options:[]},u=i.type==="date"?je(t):t,c=wl(u,i);return c===""?"-":c}const f=Ue({}),ee=I(()=>!O.value||Oe.value?!1:O.value.is_finished===!0?ze.value:ze.value?!0:mt.value&&O.value.is_finished===!1),v=I(()=>ee.value&&G.value),J=I(()=>v.value?!0:q.value&&Z.value),Ct=I(()=>!O.value||O.value.is_finished!==!0?!1:ze.value),z=I(()=>{const t={vehicle_cert:[],idcard_front:[],idcard_back:[],driving_license_main:[],driving_license_sub:[],related:[]};for(const e of O.value?.images||[]){if(!e?.slot_key)continue;const i=(e?.image_url||e?.url||"").trim();i&&(t[e.slot_key]||(t[e.slot_key]=[]),t[e.slot_key].push(i))}return t}),Ae=I(()=>{const t={vehicle_cert:[],idcard_front:[],idcard_back:[],driving_license_main:[],driving_license_sub:[],related:[]};for(const e of O.value?.images||[])e?.slot_key&&(t[e.slot_key]||(t[e.slot_key]=[]),t[e.slot_key].push(e));return t}),Et=Object.freeze(["id_name","id_gender","id_ethnicity","id_birth_date","id_address","id_number"]),At=Object.freeze(["id_issuer","id_validity"]),Dt=I(()=>Et.map(t=>D(t))),Ft=I(()=>At.map(t=>D(t))),Nt=I(()=>(Ke.value||[]).find(t=>t.group_key==="driving_license")),Mt=I(()=>(Ke.value||[]).find(t=>t.group_key==="driving_attach"));function qe(t){return t?(t.fields||[]).map(i=>i.field_name).filter(Boolean).map(i=>D(i)):[]}const Bt=Object.freeze(["dl_plate_no","dl_owner","dl_use_nature","dl_brand_model","dl_vin","dl_engine_no","dl_register_date"]);function Rt(t){const e=[],i=new Set;for(const u of Array.isArray(t)?t:[]){const c=String(u?.key||"");c&&(i.has(c)||(i.add(c),e.push(u)))}return e}function Tt(t,e){const i=Array.isArray(t)?t:[],u=new Set(i.map(r=>String(r?.key||"")).filter(Boolean)),c=(Array.isArray(e)?e:[]).filter(r=>r&&!u.has(String(r))).map(r=>D(r));return Rt([...i,...c])}const He=I(()=>Tt(qe(Nt.value),Bt)),Ge=I(()=>qe(Mt.value));function W(t,{preferKeys:e=[],labelIncludes:i=[],keyIncludes:u=[]}={}){const c=Array.isArray(t)?t:[];for(const r of e){const g=c.find(k=>k?.key===r);if(g?.key)return g.key}for(const r of u){const g=c.find(k=>String(k?.key||"").toLowerCase().includes(String(r).toLowerCase()));if(g?.key)return g.key}for(const r of i){const g=c.find(k=>String(k?.label||"").includes(String(r)));if(g?.key)return g.key}return null}const Pt=I(()=>{const t=He.value||[];return{plate:W(t,{preferKeys:["dl_plate_no"],keyIncludes:["plate"],labelIncludes:["号牌"]}),owner:W(t,{preferKeys:["dl_owner"],keyIncludes:["owner"],labelIncludes:["所有人"]}),use_nature:W(t,{preferKeys:["dl_use_nature"],keyIncludes:["use_nature","use"],labelIncludes:["使用性质"]}),brand_model:W(t,{preferKeys:["dl_brand_model"],keyIncludes:["brand","model"],labelIncludes:["品牌型号","品牌","型号"]}),vin:W(t,{preferKeys:["dl_vin","vin"],keyIncludes:["vin"],labelIncludes:["识别","车架"]}),engine:W(t,{preferKeys:["dl_engine_no","engine_no","dl_engine","engine"],keyIncludes:["engine"],labelIncludes:["发动机"]}),register_date:W(t,{preferKeys:["dl_register_date","register_date","dl_reg_date","dl_register_dt"],keyIncludes:["register","reg_date","reg"],labelIncludes:["注册日期"]})}});function b(t){return Pt.value?.[t]||null}const he=I(()=>{const t=Ge.value||[];return W(t,{preferKeys:["dl_approved_passenger_count","approved_passenger_count","dl_passenger_count"],keyIncludes:["passenger","approved"],labelIncludes:["核定载","载人数","载客"]})});function Yt(){const t=ne.query?.from;if(typeof t=="string"&&t){let e=t;try{e=decodeURIComponent(t)}catch{e=t}if(e.startsWith("/")){Ie.push(e);return}}if(window.history.length>1){Ie.back();return}Ie.push({path:Oe.value?"/finance":"/orders/all"})}function We(t){const e=t?.dynamic_data||{};for(const i of Object.keys(f))delete f[i];for(const[i,u]of Object.entries(e))f[i]=u??"";L.customer_group_id=t?.customer_group_id??null,L.channel_group_id=t?.channel_group_id??null,$e(t)}function Ze(){if(ee.value){if(G.value){G.value=!1,O.value&&We(O.value);return}G.value=!0,(!se.value.length||!re.value.length)&&De()}}async function De(){fe.value=!0,ye.value=!0;try{const[t,e]=await Promise.all([Te.get("/orders/channel-groups"),Te.get("/orders/customer-groups")]);se.value=Array.isArray(t?.data?.items)?t.data.items:[],re.value=Array.isArray(e?.data?.items)?e.data.items:[]}catch(t){console.error(t),M.error("加载渠道/客户选项失败")}finally{fe.value=!1,ye.value=!1}}function $t(){return q.value}async function ue({preserveEditDraft:t=!1}={}){H.value=!0;try{const e=$t()?await gl(ae):await _l(ae);O.value=e.data,t?G.value||$e(O.value):(G.value=!1,We(O.value))}catch(e){console.error(e),M.error("加载订单详情失败")}finally{H.value=!1}}function Lt(t){return String(t||"").replace(/\s+/g,"").replace(/-/g,"")}function Kt(t){const e=Lt(t);return e?/^(?:\+?86)?1[3-9]\d{9}$/.test(e):!0}function jt(){return String(f?.id_name||"").trim()}function qt(){const t=b("owner");return t?String(f?.[t]||"").trim():""}async function Ht(){if(v.value){const i=String(a.owner_phone||"").trim();if(i&&!Kt(i))return await ut(),await Pe({targetEl:Ce.value,flashEls:[Ce.value],title:"电话格式不正确",message:"车主电话默认按手机号校验，请检查后再保存。",confirmText:"我知道了",cancelText:"取消"}),!1}const t=jt(),e=qt();return!(t&&e&&t!==e&&(await ut(),!await Pe({targetEl:ge.value||ke.value,flashEls:[ge.value,ke.value].filter(Boolean),title:"姓名不一致",message:`检测到证件姓名不一致：
身份证姓名【${t}】
行驶证所有人【${e}】
是否仍要继续保存？`,confirmText:"继续保存",cancelText:"取消保存"})))}async function Gt(){if(!(!O.value||!v.value||!await Ht())){$.value=!0;try{const e={...O.value.dynamic_data||{},...f};await fl(ae,{dynamic_data:e,customer_group_id:L.customer_group_id,channel_group_id:L.channel_group_id,order_info:Vt()}),M.success("保存成功"),await ue()}catch(e){console.error(e),M.error("保存失败")}finally{$.value=!1}}}async function Wt(){try{await xe.confirm("确认将该订单【退回未完成】？","确认操作",{confirmButtonText:"确认退回",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}await Zt()}async function Zt(){if(O.value){$.value=!0;try{await yl(ae,{is_finished:!1}),M.success("已退回未完成"),await ue()}catch(t){console.error(t),M.error("操作失败")}finally{$.value=!1}}}const de=C("smart");function Jt(){const t=localStorage.getItem(dt);(t==="smart"||t==="direct"||t==="stable")&&(de.value=t)}Jt();const x=Ue({vehicle_cert:!1,idcard_front:!1,idcard_back:!1,driving_license_main:!1,driving_license_sub:!1,related:!1}),ce=C([]),te=C(!1),Fe=C("");let we=null,Ne=0;function Qt(t){try{return Date.parse(t)}catch{return 0}}async function Xt(){const t=Date.now();if(we&&Ne&&t+12e4<Ne)return we;const i=(await Te.get("/orders/bos-sts"))?.data;if(!i?.accessKeyId||!i?.secretAccessKey||!i?.sessionToken)throw new Error("bos-sts response invalid");return we=i,Fe.value=i.bosHost||"",Ne=Qt(i.expiration)||t+600*1e3,we}function Q(t){const e=t?.message||t?.response?.data?.detail||t?.response?.data?.message||"";return String(e||"")}function Je(t){const e=Q(t).toLowerCase();return e.includes("failed to fetch")||e.includes("network error")||e.includes("err_")||e.includes("cors")||e.includes("代理")||e.includes("vpn")||e.includes("127.0.0.1:7890")}async function Qe(t){try{await xe.confirm(`上传看起来被当前网络环境拦截（常见于 VPN/代理/公司网关）。

是否切换到【稳定模式上传】继续？`,"上传失败（网络拦截）",{confirmButtonText:"切换为稳定模式",cancelButtonText:"继续直传重试",type:"warning",center:!0,distinguishCancelAndClose:!0}),de.value="stable";try{localStorage.setItem(dt,"stable")}catch{}return!0}catch{return!1}}function el(t){try{return(new URL(String(t)).pathname||"").replace(/^\/+/,"")}catch{const e=String(t||""),i=e.indexOf("://");if(i>=0){const u=e.slice(i+3),c=u.indexOf("/");if(c>=0)return u.slice(c+1).replace(/^\/+/,"")}return""}}function tl(t){const e=(t?.storage_key||t?.image_file?.storage_key||"").trim().replace(/^\/+/,"");if(e)return e;const i=(t?.image_url||t?.url||"").trim();return i?el(i):""}function ll(t){const i=String(t||"").match(/([a-f0-9]{32})\.[a-z0-9]+$/i);return i?String(i[1]).toLowerCase():""}function Me(t,e){const i=tl(t);if(!i)return null;const u=ll(i)||"";return{slot_key:e,storage_key:i,md5:u,size:0}}async function Ve(t,e){if(q.value){const r=(await st({slot_key:t,file:e}))?.data;return{slot_key:t,storage_key:r?.storage_key,md5:r?.md5||"",size:r?.size||e?.size||0,content_type:r?.content_type||e?.type||"application/octet-stream",etag:r?.etag||"",original_name:r?.original_name||e?.name||"file",url:r?.url||""}}if(de.value==="stable"){const r=(await st({slot_key:t,file:e}))?.data;return{slot_key:t,storage_key:r?.storage_key,md5:r?.md5||"",size:r?.size||e?.size||0,content_type:r?.content_type||e?.type||"application/octet-stream",etag:r?.etag||"",original_name:r?.original_name||e?.name||"file",url:r?.url||""}}const i=await Xt();if(!Fe.value)throw new Error("bosHost missing");const u=await vl({bosHost:Fe.value,slotKey:t,file:e,sts:i});return{slot_key:t,storage_key:u?.storage_key,md5:u?.md5||"",size:u?.size||e?.size||0,content_type:u?.content_type||e?.type||"application/octet-stream",etag:u?.etag||"",original_name:u?.original_name||e?.name||"file",url:u?.url||""}}async function X(t,e,{clear:i=!1}={}){await pl({order_id:ae,images:e,clear_slots:i?[t]:[]}),await ue({preserveEditDraft:!0}),M.success("图片已更新（如涉及证件将触发 OCR 任务）")}async function me(t,e){if(!v.value)return;const i=e?.raw;if(i){x[t]=!0;try{const u=await Ve(t,i);if(!u?.storage_key)throw new Error("upload meta invalid");await X(t,[u])}catch(u){if(de.value==="smart"&&Je(u)&&await Qe())try{const r=await Ve(t,i);if(!r?.storage_key)throw new Error("upload meta invalid");await X(t,[r]);return}catch(r){console.error(r),M.error(Q(r)||"上传失败");return}console.error(u),M.error(Q(u)||"上传失败")}finally{x[t]=!1}}}async function nl(t){if(!J.value)return;const e=t?.raw;e&&(ce.value.push(e),!x.related&&await Xe())}async function Xe(){if(x.related)return;const t=ce.value.splice(0);if(t.length){x.related=!0;try{const e=(Ae.value.related||[]).map(u=>Me(u,"related")).filter(Boolean),i=[];for(const u of t){const c=await Ve("related",u);if(!c?.storage_key)throw new Error("upload meta invalid");i.push(c)}i.length&&await X("related",[...e,...i]),te.value=!1}catch(e){if(!q.value&&de.value==="smart"&&Je(e)&&!te.value&&await Qe()){te.value=!0;try{const u=(Ae.value.related||[]).map(r=>Me(r,"related")).filter(Boolean),c=[];for(const r of t){const g=await Ve("related",r);if(!g?.storage_key)throw new Error("upload meta invalid");c.push(g)}c.length&&await X("related",[...u,...c]),te.value=!1}catch(u){console.error(u),M.error(Q(u)||"上传失败")}return}console.error(e),M.error(Q(e)||"上传失败")}finally{x.related=!1,ce.value.length&&Xe()}}}async function al(t){if(!J.value)return;const e=(Ae.value.related||[]).slice();if(!(t<0||t>=e.length)){x.related=!0;try{const i=e.filter((u,c)=>c!==t).map(u=>Me(u,"related")).filter(Boolean);if(!i.length){await X("related",[],{clear:!0});return}await X("related",i)}catch(i){console.error(i),M.error(Q(i)||"删除失败")}finally{x.related=!1}}}async function il(){if(J.value&&z.value.related.length){try{await xe.confirm("确认清空【备用图】所有图片？","确认清空",{confirmButtonText:"确认清空",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}ce.value=[],te.value=!1,x.related=!0;try{await X("related",[],{clear:!0})}catch(t){console.error(t),M.error(Q(t)||"清空失败")}finally{x.related=!1}}}Vl(async()=>{await It("order"),ee.value&&await De(),await ue()});const F=rt({name:"FieldValue",props:{modelValue:{type:[String,Number,Date],default:""},field:{type:Object,required:!0},editable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:e}){const i=T("el-input"),u=T("el-select"),c=T("el-option"),r=T("el-date-picker"),g=k=>e("update:modelValue",k);return()=>{const k=t.field||{type:"text",options:[]},U=t.modelValue??"",N=zt(U,k);if(!t.editable)return j("span",{class:"plain-value",title:N},N);if(k.type==="date"){const K=je(U)??"";return j(r,{modelValue:K,"onUpdate:modelValue":g,type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}if(k.type==="select"){const K=Array.isArray(k.options)?k.options:[];return j(u,{modelValue:U,"onUpdate:modelValue":g,filterable:!0,clearable:!0,class:"fv fv-select"},()=>K.map(n=>{const m=n&&typeof n=="object"?n.label:String(n),h=n&&typeof n=="object"?n.value:n;return j(c,{key:String(h),label:m,value:h})}))}return j(i,{modelValue:U,"onUpdate:modelValue":g,clearable:!0,class:"fv fv-input"})}}}),S=rt({name:"InfoValue",props:{modelValue:{type:[String,Number,null],default:""},type:{type:String,default:"text"},editable:{type:Boolean,default:!1},min:{type:Number,default:void 0},max:{type:Number,default:void 0}},emits:["update:modelValue"],setup(t,{emit:e}){const i=T("el-input"),u=T("el-date-picker"),c=C(""),r=C(!1);function g(m){return m==null||m===""||(t.type==="money"||t.type==="point")&&Number(m)===0?"":String(m)}function k(){r.value||(c.value=g(t.modelValue))}Se(()=>t.modelValue,()=>k(),{immediate:!0});function U(m){let h=m;return typeof t.min=="number"&&(h=Math.max(t.min,h)),typeof t.max=="number"&&(h=Math.min(t.max,h)),h}function N(){c.value="",e("update:modelValue",null)}function K(){r.value=!1;const m=String(c.value||"").trim();if(!m){N();return}const h=Number(m);if(!Number.isFinite(h)){N();return}let P=U(h);if(t.type==="money"){P=Math.round(P*100)/100,e("update:modelValue",P),c.value=P.toFixed(2);return}e("update:modelValue",P),c.value=String(P)}function n(m){if(m==null||m==="")return"-";const h=Number(m);return t.type==="money"?Number.isFinite(h)?h.toFixed(2):"-":t.type==="point"?Number.isFinite(h)?String(h):"-":t.type==="date"?Ee(m)||"-":String(m)}return()=>{const m=t.modelValue??"";if(!t.editable){const h=n(m);return j("span",{class:"plain-value",title:h},h)}if(t.type==="date"){const h=Ee(m);return j(u,{modelValue:h,"onUpdate:modelValue":P=>e("update:modelValue",P),type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}return t.type==="money"||t.type==="point"?j(i,{modelValue:c.value,"onUpdate:modelValue":h=>{c.value=String(h??"")},clearable:!0,class:"fv fv-input",inputmode:"decimal",onFocus:()=>{r.value=!0},onBlur:()=>K(),onClear:()=>N()}):j(i,{modelValue:m,"onUpdate:modelValue":h=>e("update:modelValue",h),clearable:!0,class:"fv fv-input"})}}});return Se(()=>ee.value,t=>{t&&(!se.value.length||!re.value.length)&&De()}),(t,e)=>{const i=T("el-button"),u=T("el-option"),c=T("el-select"),r=T("el-card"),g=T("el-upload"),k=T("el-image"),U=T("el-icon"),N=T("el-tooltip"),K=Sl("loading");return s(),d("div",Ul,[l("div",Il,[e[50]||(e[50]=l("h2",null,"订单详情",-1)),l("div",Ol,[o(i,{size:"small",onClick:Yt},{default:_(()=>[...e[42]||(e[42]=[A("返回",-1)])]),_:1}),q.value&&O.value?(s(),d(B,{key:0},[Z.value?(s(),d(B,{key:1},[o(i,{size:"small",plain:"",disabled:H.value||$.value||x.related,onClick:pt},{default:_(()=>[...e[44]||(e[44]=[A(" 取消编辑 ",-1)])]),_:1},8,["disabled"]),o(i,{size:"small",type:"primary",disabled:H.value||$.value||x.related,onClick:ft},{default:_(()=>[...e[45]||(e[45]=[A(" 保存 ",-1)])]),_:1},8,["disabled"])],64)):(s(),R(i,{key:0,size:"small",type:"primary",plain:"",disabled:H.value||$.value||x.related,onClick:_t},{default:_(()=>[...e[43]||(e[43]=[A(" 编辑 ",-1)])]),_:1},8,["disabled"]))],64)):(s(),d(B,{key:1},[Ct.value?(s(),R(i,{key:0,size:"small",type:"warning",plain:"",loading:$.value,onClick:Wt},{default:_(()=>[...e[46]||(e[46]=[A(" 退回未完成 ",-1)])]),_:1},8,["loading"])):V("",!0),ee.value&&!G.value?(s(),R(i,{key:1,size:"small",type:"primary",plain:"",disabled:H.value||$.value,onClick:Ze},{default:_(()=>[...e[47]||(e[47]=[A(" 编辑 ",-1)])]),_:1},8,["disabled"])):V("",!0),ee.value&&G.value?(s(),R(i,{key:2,size:"small",plain:"",disabled:H.value||$.value,onClick:Ze},{default:_(()=>[...e[48]||(e[48]=[A(" 取消编辑 ",-1)])]),_:1},8,["disabled"])):V("",!0),v.value?(s(),R(i,{key:3,size:"small",type:"primary",loading:$.value,onClick:Gt},{default:_(()=>[...e[49]||(e[49]=[A("保存",-1)])]),_:1},8,["loading"])):V("",!0)],64))])]),xl((s(),d("div",zl,[o(r,{shadow:"never",class:"section-card meta-card"},{header:_(()=>[...e[51]||(e[51]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"渠道、客户")],-1)])]),default:_(()=>[l("div",Cl,[l("div",El,[e[52]||(e[52]=l("div",{class:"kv-label"},"渠道",-1)),l("div",Al,[v.value?(s(),R(c,{key:0,modelValue:L.channel_group_id,"onUpdate:modelValue":e[0]||(e[0]=n=>L.channel_group_id=n),filterable:"",clearable:"",placeholder:"请选择渠道",class:"fv fv-select",loading:fe.value,disabled:fe.value},{default:_(()=>[(s(!0),d(B,null,Y(xt.value,n=>(s(),R(u,{key:String(n.id),label:n.group_name||String(n.id),value:n.id,disabled:!!n._ghost},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading","disabled"])):(s(),d("span",{key:1,class:"plain-value",title:O.value?.channel_group_name||"-"},le(O.value?.channel_group_name||"-"),9,Dl))])]),l("div",Fl,[e[53]||(e[53]=l("div",{class:"kv-label"},"客户",-1)),l("div",Nl,[v.value?(s(),R(c,{key:0,modelValue:L.customer_group_id,"onUpdate:modelValue":e[1]||(e[1]=n=>L.customer_group_id=n),filterable:"",clearable:"",placeholder:"请选择客户",class:"fv fv-select",loading:ye.value,disabled:ye.value},{default:_(()=>[(s(!0),d(B,null,Y(St.value,n=>(s(),R(u,{key:String(n.id),label:n.group_name||String(n.id),value:n.id,disabled:!!n._ghost},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading","disabled"])):(s(),d("span",{key:1,class:"plain-value",title:O.value?.customer_group_name||"-"},le(O.value?.customer_group_name||"-"),9,Ml))])])])]),_:1}),o(r,{shadow:"never",class:"section-card"},{header:_(()=>[...e[54]||(e[54]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"备用图")],-1)])]),default:_(()=>[J.value?(s(),d("div",Bl,[o(g,{drag:"","auto-upload":!1,multiple:!0,"show-file-list":!1,accept:"image/*",disabled:x.related,"on-change":n=>nl(n),class:"related-dragger"},{default:_(()=>[...e[55]||(e[55]=[l("div",{class:"drag-inner"},[l("div",{class:"drag-title"},"拖拽图片到这里"),l("div",{class:"drag-sub"},"或点击选择（支持多张）")],-1)])]),_:1},8,["disabled","on-change"]),o(i,{size:"small",type:"danger",plain:"",disabled:x.related||!z.value.related.length,loading:x.related,onClick:il},{default:_(()=>[...e[56]||(e[56]=[A(" 清空 ",-1)])]),_:1},8,["disabled","loading"])])):V("",!0),J.value||z.value.related.length?(s(),d("div",Rl,[(s(!0),d(B,null,Y(z.value.related,(n,m)=>(s(),d("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.related,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"]),J.value?(s(),d("button",{key:0,type:"button",class:"thumb-remove",title:"删除这张",onClick:h=>al(m)}," × ",8,Tl)):V("",!0)]))),128)),J.value&&!z.value.related.length?(s(),d("div",Pl)):V("",!0)])):V("",!0)]),_:1}),o(r,{shadow:"never",class:"section-card"},{header:_(()=>[...e[57]||(e[57]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"订单信息")],-1)])]),default:_(()=>[l("div",Yl,[l("div",$l,[l("div",Ll,[e[58]||(e[58]=l("div",{class:"kv-label"},"保险到期日",-1)),l("div",Kl,[o(p(S),{modelValue:a.insurance_expire_date,"onUpdate:modelValue":e[2]||(e[2]=n=>a.insurance_expire_date=n),type:"date",editable:v.value},null,8,["modelValue","editable"])])]),l("div",jl,[e[59]||(e[59]=l("div",{class:"kv-label"},"车主电话",-1)),l("div",{class:"kv-value",ref_key:"ownerPhoneValueRef",ref:Ce},[o(p(S),{modelValue:a.owner_phone,"onUpdate:modelValue":e[3]||(e[3]=n=>a.owner_phone=n),type:"text",editable:v.value},null,8,["modelValue","editable"])],512)])]),l("div",ql,[l("div",Hl,[e[60]||(e[60]=l("div",{class:"kv-label"},"订单备注",-1)),l("div",Gl,[o(p(S),{modelValue:a.remark,"onUpdate:modelValue":e[4]||(e[4]=n=>a.remark=n),type:"text",editable:v.value},null,8,["modelValue","editable"])])])]),l("div",Wl,[l("div",Zl,[e[61]||(e[61]=l("div",{class:"kv-label"},"商业金额",-1)),l("div",Jl,[o(p(S),{modelValue:a.commercial_amount,"onUpdate:modelValue":e[5]||(e[5]=n=>a.commercial_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])]),l("div",Ql,[e[62]||(e[62]=l("div",{class:"kv-label"},"交强金额",-1)),l("div",Xl,[o(p(S),{modelValue:a.compulsory_amount,"onUpdate:modelValue":e[6]||(e[6]=n=>a.compulsory_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])]),l("div",en,[e[63]||(e[63]=l("div",{class:"kv-label"},"车船税金额",-1)),l("div",tn,[o(p(S),{modelValue:a.vehicle_tax_amount,"onUpdate:modelValue":e[7]||(e[7]=n=>a.vehicle_tax_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])]),l("div",ln,[e[64]||(e[64]=l("div",{class:"kv-label"},"非车金额",-1)),l("div",nn,[o(p(S),{modelValue:a.non_vehicle_amount,"onUpdate:modelValue":e[8]||(e[8]=n=>a.non_vehicle_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])])]),l("div",an,[l("div",on,[e[65]||(e[65]=l("div",{class:"kv-label"},"保费金额",-1)),l("div",sn,[o(p(S),{modelValue:a.premium_total,"onUpdate:modelValue":e[9]||(e[9]=n=>a.premium_total=n),type:"money",editable:!1},null,8,["modelValue"])])])])]),e[81]||(e[81]=l("div",{class:"split-title"},"渠道",-1)),l("div",rn,[l("div",un,[e[66]||(e[66]=l("div",{class:"kv-label"},"商业点位%",-1)),l("div",dn,[o(p(S),{modelValue:a.channel_commercial_point,"onUpdate:modelValue":e[10]||(e[10]=n=>a.channel_commercial_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",cn,[e[67]||(e[67]=l("div",{class:"kv-label"},"商业后补%",-1)),l("div",mn,[o(p(S),{modelValue:a.channel_commercial_supplement_point,"onUpdate:modelValue":e[11]||(e[11]=n=>a.channel_commercial_supplement_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",vn,[e[68]||(e[68]=l("div",{class:"kv-label"},"交强点位%",-1)),l("div",_n,[o(p(S),{modelValue:a.channel_compulsory_point,"onUpdate:modelValue":e[12]||(e[12]=n=>a.channel_compulsory_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",pn,[e[69]||(e[69]=l("div",{class:"kv-label"},"车船税点位%",-1)),l("div",fn,[o(p(S),{modelValue:a.channel_vehicle_tax_point,"onUpdate:modelValue":e[13]||(e[13]=n=>a.channel_vehicle_tax_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",yn,[e[70]||(e[70]=l("div",{class:"kv-label"},"非车点位%",-1)),l("div",gn,[o(p(S),{modelValue:a.channel_non_vehicle_point,"onUpdate:modelValue":e[14]||(e[14]=n=>a.channel_non_vehicle_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",kn,[e[71]||(e[71]=l("div",{class:"kv-label"},"出单奖励",-1)),l("div",bn,[o(p(S),{modelValue:a.channel_reward,"onUpdate:modelValue":e[15]||(e[15]=n=>a.channel_reward=n),type:"money",editable:v.value},null,8,["modelValue","editable"])])])]),l("div",hn,[l("div",wn,[e[72]||(e[72]=l("div",{class:"kv-label"},"渠道合计",-1)),l("div",Vn,[o(p(S),{modelValue:a.channel_total,"onUpdate:modelValue":e[16]||(e[16]=n=>a.channel_total=n),type:"money",editable:!1},null,8,["modelValue"])])])]),e[82]||(e[82]=l("div",{class:"split-title"},"客户",-1)),l("div",xn,[l("div",Sn,[e[73]||(e[73]=l("div",{class:"kv-label"},"商业点位%",-1)),l("div",Un,[o(p(S),{modelValue:a.customer_commercial_point,"onUpdate:modelValue":e[17]||(e[17]=n=>a.customer_commercial_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",In,[e[74]||(e[74]=l("div",{class:"kv-label"},"商业后补%",-1)),l("div",On,[o(p(S),{modelValue:a.customer_commercial_supplement_point,"onUpdate:modelValue":e[18]||(e[18]=n=>a.customer_commercial_supplement_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",zn,[e[75]||(e[75]=l("div",{class:"kv-label"},"交强点位%",-1)),l("div",Cn,[o(p(S),{modelValue:a.customer_compulsory_point,"onUpdate:modelValue":e[19]||(e[19]=n=>a.customer_compulsory_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",En,[e[76]||(e[76]=l("div",{class:"kv-label"},"车船税点位%",-1)),l("div",An,[o(p(S),{modelValue:a.customer_vehicle_tax_point,"onUpdate:modelValue":e[20]||(e[20]=n=>a.customer_vehicle_tax_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",Dn,[e[77]||(e[77]=l("div",{class:"kv-label"},"非车点位%",-1)),l("div",Fn,[o(p(S),{modelValue:a.customer_non_vehicle_point,"onUpdate:modelValue":e[21]||(e[21]=n=>a.customer_non_vehicle_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",Nn,[e[78]||(e[78]=l("div",{class:"kv-label"},"出单奖励",-1)),l("div",Mn,[o(p(S),{modelValue:a.customer_reward,"onUpdate:modelValue":e[22]||(e[22]=n=>a.customer_reward=n),type:"money",editable:v.value},null,8,["modelValue","editable"])])])]),l("div",Bn,[l("div",Rn,[e[79]||(e[79]=l("div",{class:"kv-label"},"客户合计",-1)),l("div",Tn,[o(p(S),{modelValue:a.customer_total,"onUpdate:modelValue":e[23]||(e[23]=n=>a.customer_total=n),type:"money",editable:!1},null,8,["modelValue"])])])]),l("div",Pn,[l("div",Yn,[e[80]||(e[80]=l("div",{class:"kv-label"},"利润",-1)),l("div",$n,[o(p(S),{modelValue:a.profit,"onUpdate:modelValue":e[24]||(e[24]=n=>a.profit=n),type:"money",editable:!1},null,8,["modelValue"])])])])]),_:1}),o(r,{shadow:"never",class:"section-card"},{header:_(()=>[l("div",Ln,[e[83]||(e[83]=l("div",{class:"section-title"},"车辆合格证",-1)),o(i,{class:"icon-btn",circle:"",size:"small",onClick:e[25]||(e[25]=n=>pe.value=!pe.value)},{default:_(()=>[o(U,null,{default:_(()=>[pe.value?(s(),R(p(Be),{key:0})):(s(),R(p(Re),{key:1}))]),_:1})]),_:1})])]),default:_(()=>[l("div",Kn,[l("div",jn,[pe.value?(s(),d("div",ta,[o(ml,{data:f,readonly:!v.value},null,8,["data","readonly"])])):(s(),d("div",qn,[l("div",Hn,[e[84]||(e[84]=l("div",{class:"kv-label"},"车辆型号",-1)),l("div",Gn,[o(p(F),{modelValue:f.vehicle_model,"onUpdate:modelValue":e[26]||(e[26]=n=>f.vehicle_model=n),field:D("vehicle_model"),editable:v.value},null,8,["modelValue","field","editable"])])]),l("div",Wn,[e[85]||(e[85]=l("div",{class:"kv-label"},"车辆识别代号/车架号",-1)),l("div",Zn,[o(p(F),{modelValue:f.vin,"onUpdate:modelValue":e[27]||(e[27]=n=>f.vin=n),field:D("vin"),editable:v.value},null,8,["modelValue","field","editable"])])]),l("div",Jn,[e[86]||(e[86]=l("div",{class:"kv-label"},"发动机号",-1)),l("div",Qn,[o(p(F),{modelValue:f.engine_no,"onUpdate:modelValue":e[28]||(e[28]=n=>f.engine_no=n),field:D("engine_no"),editable:v.value},null,8,["modelValue","field","editable"])])]),l("div",Xn,[e[87]||(e[87]=l("div",{class:"kv-label"},"额定载客(人 )",-1)),l("div",ea,[o(p(F),{modelValue:f.approved_passenger_count,"onUpdate:modelValue":e[29]||(e[29]=n=>f.approved_passenger_count=n),field:D("approved_passenger_count"),editable:v.value},null,8,["modelValue","field","editable"])])])]))]),l("div",la,[v.value?(s(),d("div",na,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("vehicle_cert",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.vehicle_cert},{default:_(()=>[...e[88]||(e[88]=[A("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[89]||(e[89]=[A("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",aa,[(s(!0),d(B,null,Y(z.value.vehicle_cert,(n,m)=>(s(),d("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.vehicle_cert,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.vehicle_cert.length?V("",!0):(s(),d("div",ia))])])])]),_:1}),o(r,{shadow:"never",class:"section-card"},{header:_(()=>[l("div",oa,[e[90]||(e[90]=l("div",{class:"section-title"},"身份证正面/身份证背面",-1)),o(i,{class:"icon-btn",circle:"",size:"small",onClick:e[30]||(e[30]=n=>ie.value=!ie.value)},{default:_(()=>[o(U,null,{default:_(()=>[ie.value?(s(),R(p(Be),{key:0})):(s(),R(p(Re),{key:1}))]),_:1})]),_:1})])]),default:_(()=>[l("div",sa,[l("div",ra,[e[95]||(e[95]=l("div",{class:"sub-title"},"身份证正面",-1)),l("div",ua,[l("div",da,[ie.value?(s(),d("div",pa,[(s(!0),d(B,null,Y(Dt.value,n=>(s(),d("div",{key:n.key,class:"kv-item"},[l("div",fa,le(be(n)),1),l("div",{class:"kv-value",ref_for:!0,ref:yt(n)},[o(p(F),{modelValue:f[n.key],"onUpdate:modelValue":m=>f[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])],512)]))),128))])):(s(),d("div",ca,[l("div",ma,[e[91]||(e[91]=l("div",{class:"kv-label"},"姓名",-1)),l("div",{class:"kv-value",ref_key:"idNameValueRef",ref:ge},[o(p(F),{modelValue:f.id_name,"onUpdate:modelValue":e[31]||(e[31]=n=>f.id_name=n),field:D("id_name"),editable:v.value},null,8,["modelValue","field","editable"])],512)]),l("div",va,[e[92]||(e[92]=l("div",{class:"kv-label"},"公民身份号码",-1)),l("div",_a,[o(p(F),{modelValue:f.id_number,"onUpdate:modelValue":e[32]||(e[32]=n=>f.id_number=n),field:D("id_number"),editable:v.value},null,8,["modelValue","field","editable"])])])]))]),l("div",ya,[v.value?(s(),d("div",ga,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("idcard_front",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.idcard_front},{default:_(()=>[...e[93]||(e[93]=[A("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[94]||(e[94]=[A("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",ka,[(s(!0),d(B,null,Y(z.value.idcard_front,(n,m)=>(s(),d("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.idcard_front,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.idcard_front.length?V("",!0):(s(),d("div",ba))])])])]),l("div",ha,[e[98]||(e[98]=l("div",{class:"sub-title"},"身份证背面",-1)),l("div",wa,[l("div",Va,[ie.value?(s(),d("div",xa,[(s(!0),d(B,null,Y(Ft.value,n=>(s(),d("div",{key:n.key,class:"kv-item"},[l("div",Sa,le(be(n)),1),l("div",Ua,[o(p(F),{modelValue:f[n.key],"onUpdate:modelValue":m=>f[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])])]))),128))])):V("",!0)]),l("div",Ia,[v.value?(s(),d("div",Oa,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("idcard_back",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.idcard_back},{default:_(()=>[...e[96]||(e[96]=[A("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[97]||(e[97]=[A("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",za,[(s(!0),d(B,null,Y(z.value.idcard_back,(n,m)=>(s(),d("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.idcard_back,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.idcard_back.length?V("",!0):(s(),d("div",Ca))])])])])])]),_:1}),o(r,{shadow:"never",class:"section-card"},{header:_(()=>[l("div",Ea,[e[99]||(e[99]=l("div",{class:"section-title"},"行驶证/行驶证副件",-1)),o(i,{class:"icon-btn",circle:"",size:"small",onClick:e[33]||(e[33]=n=>oe.value=!oe.value)},{default:_(()=>[o(U,null,{default:_(()=>[oe.value?(s(),R(p(Be),{key:0})):(s(),R(p(Re),{key:1}))]),_:1})]),_:1})])]),default:_(()=>[l("div",Aa,[l("div",Da,[e[109]||(e[109]=l("div",{class:"sub-title"},"行驶证",-1)),l("div",Fa,[l("div",Na,[oe.value?(s(),d("div",Za,[(s(!0),d(B,null,Y(He.value,n=>(s(),d("div",{key:n.key,class:"kv-item"},[l("div",Ja,le(be(n)),1),l("div",{class:"kv-value",ref_for:!0,ref:kt(n)},[o(p(F),{modelValue:f[n.key],"onUpdate:modelValue":m=>f[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])],512)]))),128))])):(s(),d("div",Ma,[b("plate")?(s(),d("div",Ba,[e[100]||(e[100]=l("div",{class:"kv-label"},"号牌号码",-1)),l("div",Ra,[o(p(F),{modelValue:f[b("plate")],"onUpdate:modelValue":e[34]||(e[34]=n=>f[b("plate")]=n),field:D(b("plate")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("owner")?(s(),d("div",Ta,[e[101]||(e[101]=l("div",{class:"kv-label"},"所有人",-1)),l("div",{class:"kv-value",ref:gt},[o(p(F),{modelValue:f[b("owner")],"onUpdate:modelValue":e[35]||(e[35]=n=>f[b("owner")]=n),field:D(b("owner")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("use_nature")?(s(),d("div",Pa,[e[102]||(e[102]=l("div",{class:"kv-label"},"使用性质",-1)),l("div",Ya,[o(p(F),{modelValue:f[b("use_nature")],"onUpdate:modelValue":e[36]||(e[36]=n=>f[b("use_nature")]=n),field:D(b("use_nature")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("brand_model")?(s(),d("div",$a,[e[103]||(e[103]=l("div",{class:"kv-label"},"品牌型号",-1)),l("div",La,[o(p(F),{modelValue:f[b("brand_model")],"onUpdate:modelValue":e[37]||(e[37]=n=>f[b("brand_model")]=n),field:D(b("brand_model")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("vin")?(s(),d("div",Ka,[e[104]||(e[104]=l("div",{class:"kv-label"},"车辆识别代码",-1)),l("div",ja,[o(p(F),{modelValue:f[b("vin")],"onUpdate:modelValue":e[38]||(e[38]=n=>f[b("vin")]=n),field:D(b("vin")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("engine")?(s(),d("div",qa,[e[105]||(e[105]=l("div",{class:"kv-label"},"发动机号码",-1)),l("div",Ha,[o(p(F),{modelValue:f[b("engine")],"onUpdate:modelValue":e[39]||(e[39]=n=>f[b("engine")]=n),field:D(b("engine")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("register_date")?(s(),d("div",Ga,[e[106]||(e[106]=l("div",{class:"kv-label"},"注册日期",-1)),l("div",Wa,[o(p(F),{modelValue:f[b("register_date")],"onUpdate:modelValue":e[40]||(e[40]=n=>f[b("register_date")]=n),field:D(b("register_date")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0)]))]),l("div",Qa,[v.value?(s(),d("div",Xa,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("driving_license_main",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.driving_license_main},{default:_(()=>[...e[107]||(e[107]=[A("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[108]||(e[108]=[A("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",ei,[(s(!0),d(B,null,Y(z.value.driving_license_main,(n,m)=>(s(),d("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.driving_license_main,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.driving_license_main.length?V("",!0):(s(),d("div",ti))])])])]),l("div",li,[e[113]||(e[113]=l("div",{class:"sub-title"},"行驶证副件",-1)),l("div",ni,[l("div",ai,[oe.value?(s(),d("div",ri,[(s(!0),d(B,null,Y(Ge.value,n=>(s(),d("div",{key:n.key,class:"kv-item"},[l("div",ui,le(be(n)),1),l("div",di,[o(p(F),{modelValue:f[n.key],"onUpdate:modelValue":m=>f[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])])]))),128))])):(s(),d("div",ii,[he.value?(s(),d("div",oi,[e[110]||(e[110]=l("div",{class:"kv-label"},"核定载人数",-1)),l("div",si,[o(p(F),{modelValue:f[he.value],"onUpdate:modelValue":e[41]||(e[41]=n=>f[he.value]=n),field:D(he.value),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0)]))]),l("div",ci,[v.value?(s(),d("div",mi,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("driving_license_sub",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.driving_license_sub},{default:_(()=>[...e[111]||(e[111]=[A("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[112]||(e[112]=[A("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",vi,[(s(!0),d(B,null,Y(z.value.driving_license_sub,(n,m)=>(s(),d("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.driving_license_sub,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.driving_license_sub.length?V("",!0):(s(),d("div",_i))])])])])])]),_:1})])),[[K,H.value]])])}}},Ai=kl(fi,[["__scopeId","data-v-71ae193d"]]);export{Ai as default};
