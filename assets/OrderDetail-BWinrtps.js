import{u as ul,b as dl}from"./vendor-vue-router-CVyACjsp.js";import{E as A,c as Te,a as Re,d as Se}from"./vendor-element-plus-CtVxZ4Oy.js";import{V as cl}from"./VehicleCertTable-CH8ovAHD.js";import{h as Pe}from"./http-DGyH82Tn.js";import{g as ml,f as vl,u as _l,a as pl,b as fl}from"./orders-DVGDUW2c.js";import{g as gl,f as yl,u as kl}from"./finance-D7CYzIUW.js";import{_ as bl,u as hl}from"./index-B6ZByGp_.js";import{u as wl,f as Vl}from"./fieldFormat-B0eaWt9f.js";import{u as xl}from"./bosUpload-Bf8-Xtq-.js";import{c as E,r as C,o as Ue,Z as Oe,q as Sl,x as u,z as l,I as Ul,P as o,H as _,ay as R,O as B,G as T,J as V,aI as Ol,y as s,L as I,ac as Y,M as ne,u as p,l as st,ai as W,D as rt}from"./vendor-vue-fFWwKrgY.js";import"./vendor-lodash-rvV0CIkQ.js";import"./vendor-DWCz07M-.js";import"./vendor-dates-DVKSwKij.js";import"./vendor-axios-C0Zqfgkc.js";import"./vendor-pinia-CMXa-Za0.js";const zl={class:"order-detail"},El={class:"detail-header"},Cl={class:"header-actions"},Dl={class:"page-body"},Il={class:"kv-grid kv-grid-2"},Nl={class:"kv-item"},Fl={class:"kv-value"},Al=["title"],Ml={class:"kv-item"},Bl={class:"kv-value"},Tl=["title"],Rl={key:0,class:"image-actions image-actions-wide"},Pl={key:1,class:"image-wall image-wall-wide"},Yl=["onClick"],$l={key:0,class:"thumb-empty"},Ll={class:"info-block"},jl={class:"kv-grid kv-grid-2 info-grid"},Kl={class:"kv-item"},ql={class:"kv-value"},Hl={class:"kv-item"},Wl={class:"kv-grid kv-grid-2 info-grid"},Zl={class:"kv-item kv-item-remark"},Gl={class:"kv-value"},Xl={class:"kv-grid kv-grid-4 info-grid info-grid-compact"},Jl={class:"kv-item"},Ql={class:"kv-value"},en={class:"kv-item"},tn={class:"kv-value"},ln={class:"kv-item"},nn={class:"kv-value"},an={class:"kv-item"},on={class:"kv-value"},sn={class:"kv-grid kv-grid-2 info-grid"},rn={class:"kv-item"},un={class:"kv-value value-red"},dn={class:"kv-grid kv-grid-6 info-grid info-grid-compact"},cn={class:"kv-item"},mn={class:"kv-value"},vn={class:"kv-item"},_n={class:"kv-value"},pn={class:"kv-item"},fn={class:"kv-value"},gn={class:"kv-item"},yn={class:"kv-value"},kn={class:"kv-item"},bn={class:"kv-value"},hn={class:"kv-item"},wn={class:"kv-value"},Vn={class:"kv-grid kv-grid-2 info-grid"},xn={class:"kv-item"},Sn={class:"kv-value value-red"},Un={class:"kv-grid kv-grid-6 info-grid info-grid-compact"},On={class:"kv-item"},zn={class:"kv-value"},En={class:"kv-item"},Cn={class:"kv-value"},Dn={class:"kv-item"},In={class:"kv-value"},Nn={class:"kv-item"},Fn={class:"kv-value"},An={class:"kv-item"},Mn={class:"kv-value"},Bn={class:"kv-item"},Tn={class:"kv-value"},Rn={class:"kv-grid kv-grid-2 info-grid"},Pn={class:"kv-item"},Yn={class:"kv-value value-red"},$n={class:"kv-grid kv-grid-2 info-grid"},Ln={class:"kv-item"},jn={class:"kv-value value-red"},Kn={class:"section-header"},qn={class:"two-col"},Hn={class:"left"},Wn={key:0,class:"kv-grid kv-grid-2"},Zn={class:"kv-item"},Gn={class:"kv-value"},Xn={class:"kv-item"},Jn={class:"kv-value"},Qn={class:"kv-item"},ea={class:"kv-value"},ta={class:"kv-item"},la={class:"kv-value"},na={key:1},aa={class:"right"},ia={key:0,class:"image-actions"},oa={class:"image-wall"},sa={key:0,class:"thumb-empty"},ra={class:"section-header"},ua={class:"stack"},da={class:"sub-block"},ca={class:"two-col"},ma={class:"left"},va={key:0,class:"kv-grid kv-grid-2"},_a={class:"kv-item"},pa={class:"kv-item"},fa={class:"kv-value"},ga={key:1,class:"kv-grid kv-grid-2"},ya={class:"kv-label"},ka={class:"right"},ba={key:0,class:"image-actions"},ha={class:"image-wall"},wa={key:0,class:"thumb-empty"},Va={class:"sub-block"},xa={class:"two-col"},Sa={class:"left"},Ua={key:0,class:"kv-grid kv-grid-2"},Oa={class:"kv-label"},za={class:"kv-value"},Ea={class:"right"},Ca={key:0,class:"image-actions"},Da={class:"image-wall"},Ia={key:0,class:"thumb-empty"},Na={class:"section-header"},Fa={class:"stack"},Aa={class:"sub-block"},Ma={class:"two-col"},Ba={class:"left"},Ta={key:0,class:"kv-grid kv-grid-2"},Ra={key:0,class:"kv-item"},Pa={class:"kv-value"},Ya={key:1,class:"kv-item"},$a={key:2,class:"kv-item"},La={class:"kv-value"},ja={key:3,class:"kv-item"},Ka={class:"kv-value"},qa={key:4,class:"kv-item"},Ha={class:"kv-value"},Wa={key:5,class:"kv-item"},Za={class:"kv-value"},Ga={key:6,class:"kv-item"},Xa={class:"kv-value"},Ja={key:1,class:"kv-grid kv-grid-2"},Qa={class:"kv-label"},ei={class:"right"},ti={key:0,class:"image-actions"},li={class:"image-wall"},ni={key:0,class:"thumb-empty"},ai={class:"sub-block"},ii={class:"two-col"},oi={class:"left"},si={key:0,class:"kv-grid kv-grid-2"},ri={key:0,class:"kv-item"},ui={class:"kv-value"},di={key:1,class:"kv-grid kv-grid-2"},ci={class:"kv-label"},mi={class:"kv-value"},vi={class:"right"},_i={key:0,class:"image-actions"},pi={class:"image-wall"},fi={key:0,class:"thumb-empty"},gi=3500,ut="order_import_upload_mode",yi={__name:"OrderDetail",setup(ki){const _e=dl(),ae=ul(),dt=hl();function ct(t){const e=Number(typeof t=="string"?t.trim():t);if(!Number.isFinite(e)||!Number.isInteger(e)||e<=0)throw new Error("invalid order id");return e}let j=0;try{j=ct(ae.params.id)}catch{A.error("订单ID无效"),_e.replace("/orders/all")}const ze=E(()=>String(ae.query?.source||"")==="finance"||String(ae.name||"")==="finance-order-detail"?!0:String(ae.path||"").startsWith("/finance/")),pe=E(()=>String(dt.roleName||"").trim().toLowerCase()),Ee=E(()=>pe.value==="super_admin"||pe.value==="manager"),mt=E(()=>pe.value==="sales"),vt=E(()=>{const t=pe.value;return t==="finance"||t==="manager"||t==="super_admin"}),$=E(()=>ze.value&&vt.value),O=C(null),Z=C(!1),L=C(!1),fe=C(!1),ie=C(!1),oe=C(!1),G=C(!1),X=C(!1);function _t(){$.value&&(X.value=!X.value)}function pt(){$.value&&(x.related||(ce.value=[],le.value=!1,X.value=!1,A.success("已退出编辑")))}async function ft(){$.value&&(x.related||(X.value=!1,A.success("已完成编辑"),await ue({preserveEditDraft:!0})))}Ue(()=>$.value,t=>{t||(X.value=!1)},{immediate:!0});const se=C([]),re=C([]),ge=C(!1),ye=C(!1),K=Oe({channel_group_id:null,customer_group_id:null}),ke=C(null),be=C(null),Ce=C(null);function gt(t){return t?.key!=="id_name"?null:e=>{e&&(ke.value=e)}}function yt(t){t&&(be.value=t)}function kt(t){const e=k("owner");return!e||t?.key!==e?null:i=>{i&&(be.value=i)}}function bt(t){return t?t.closest?.(".kv-item")||t:null}function ht(t){t&&(t.classList.remove("flash-value"),t.offsetWidth,t.classList.add("flash-value"),window.setTimeout(()=>{t.classList.remove("flash-value")},gi))}async function wt({stableMs:t=260,eps:e=1.5,timeoutMs:i=2e3}={}){const r=Date.now();let c=window.scrollY,d=0;return await new Promise(b=>{function y(){const U=window.scrollY;if(Math.abs(U-c)<=e?d+=16:d=0,c=U,d>=t)return b(!0);if(Date.now()-r>=i)return b(!1);requestAnimationFrame(y)}requestAnimationFrame(y)})}async function Ye({targetEl:t,flashEls:e=[],title:i="提示",message:r="",confirmText:c="继续",cancelText:d="取消"}={}){const b=bt(t)||t;b?.scrollIntoView&&b.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),await wt({stableMs:260,eps:1.5,timeoutMs:2200});const y=Array.from(new Set([...(e||[]).filter(Boolean)]));for(const U of y)ht(U);await new Promise(U=>window.setTimeout(U,120));try{const U=typeof r=="string"?W("div",{style:"white-space: pre-line; line-height: 1.7;"},r):r;return await Se.confirm(U,i,{confirmButtonText:c,cancelButtonText:d,type:"warning",center:!0}),!0}catch{return!1}}const a=Oe({insurance_expire_date:"",owner_phone:"",remark:"",commercial_amount:null,compulsory_amount:null,vehicle_tax_amount:null,non_vehicle_amount:null,premium_total:null,channel_commercial_point:null,channel_commercial_supplement_point:null,channel_compulsory_point:null,channel_vehicle_tax_point:null,channel_non_vehicle_point:null,channel_reward:null,channel_total:null,customer_commercial_point:null,customer_commercial_supplement_point:null,customer_compulsory_point:null,customer_vehicle_tax_point:null,customer_non_vehicle_point:null,customer_reward:null,customer_total:null,profit:null});function g(t){if(t==null||t==="")return null;const e=Number(t);return Number.isFinite(e)?e:null}function D(t){const e=g(t);return e===0?null:e}function w(t){const e=g(t);return e===null?0:e}function $e(t){return t==null?"":String(t).trim()}function De(t){if(!t)return"";const e=String(t).trim();return e?/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:/^\d{4}-\d{2}-\d{2}/.test(e)?e.slice(0,10):e:""}function Le(t){const e=t&&typeof t=="object"&&t.order_info&&typeof t.order_info=="object"?t.order_info:{};a.insurance_expire_date=De(e.insurance_expire_date),a.owner_phone=$e(e.owner_phone),a.remark=$e(e.remark),a.commercial_amount=D(e.commercial_amount),a.compulsory_amount=D(e.compulsory_amount),a.vehicle_tax_amount=D(e.vehicle_tax_amount),a.non_vehicle_amount=D(e.non_vehicle_amount),a.premium_total=D(e.premium_total),a.channel_commercial_point=D(e.channel_commercial_point),a.channel_commercial_supplement_point=D(e.channel_commercial_supplement_point),a.channel_compulsory_point=D(e.channel_compulsory_point),a.channel_vehicle_tax_point=D(e.channel_vehicle_tax_point),a.channel_non_vehicle_point=D(e.channel_non_vehicle_point),a.channel_reward=D(e.channel_reward),a.channel_total=D(e.channel_total),a.customer_commercial_point=D(e.customer_commercial_point),a.customer_commercial_supplement_point=D(e.customer_commercial_supplement_point),a.customer_compulsory_point=D(e.customer_compulsory_point),a.customer_vehicle_tax_point=D(e.customer_vehicle_tax_point),a.customer_non_vehicle_point=D(e.customer_non_vehicle_point),a.customer_reward=D(e.customer_reward),a.customer_total=D(e.customer_total),a.profit=D(e.profit),je()}function Vt(){const t=String(a.owner_phone||"").trim(),e=String(a.remark||"").trim();return{insurance_expire_date:a.insurance_expire_date?String(a.insurance_expire_date):"",owner_phone:t,remark:e,commercial_amount:g(a.commercial_amount),compulsory_amount:g(a.compulsory_amount),vehicle_tax_amount:g(a.vehicle_tax_amount),non_vehicle_amount:g(a.non_vehicle_amount),channel_commercial_point:g(a.channel_commercial_point),channel_commercial_supplement_point:g(a.channel_commercial_supplement_point),channel_compulsory_point:g(a.channel_compulsory_point),channel_vehicle_tax_point:g(a.channel_vehicle_tax_point),channel_non_vehicle_point:g(a.channel_non_vehicle_point),channel_reward:g(a.channel_reward),customer_commercial_point:g(a.customer_commercial_point),customer_commercial_supplement_point:g(a.customer_commercial_supplement_point),customer_compulsory_point:g(a.customer_compulsory_point),customer_vehicle_tax_point:g(a.customer_vehicle_tax_point),customer_non_vehicle_point:g(a.customer_non_vehicle_point),customer_reward:g(a.customer_reward)}}function je(){const t=g(a.commercial_amount),e=g(a.compulsory_amount),i=g(a.vehicle_tax_amount),r=g(a.non_vehicle_amount),c=t===null?null:Math.max(0,t),d=e===null?null:Math.max(0,e),b=i===null?null:Math.max(0,i),y=r===null?null:Math.max(0,r);a.commercial_amount=c,a.compulsory_amount=d,a.vehicle_tax_amount=b,a.non_vehicle_amount=y;const U=[c,d,b,y].some(ve=>typeof ve=="number"),M=w(c)+w(d)+w(b)+w(y);a.premium_total=U?M:null;const H=g(a.channel_commercial_point),n=g(a.channel_commercial_supplement_point),m=g(a.channel_compulsory_point),h=g(a.channel_vehicle_tax_point),P=g(a.channel_non_vehicle_point),et=g(a.channel_reward),tt=g(a.customer_commercial_point),lt=g(a.customer_commercial_supplement_point),nt=g(a.customer_compulsory_point),at=g(a.customer_vehicle_tax_point),it=g(a.customer_non_vehicle_point),ot=g(a.customer_reward),il=[H,n,m,h,P,et].some(ve=>typeof ve=="number"),ol=[tt,lt,nt,at,it,ot].some(ve=>typeof ve=="number"),sl=w(c)*(w(H)/100)+w(c)*(w(n)/100)+w(d)*(w(m)/100)+w(b)*(w(h)/100)+w(y)*(w(P)/100)+w(et),rl=w(c)*(w(tt)/100)+w(c)*(w(lt)/100)+w(d)*(w(nt)/100)+w(b)*(w(at)/100)+w(y)*(w(it)/100)+w(ot);a.channel_total=U||il?sl:null,a.customer_total=U||ol?rl:null,a.channel_total===null||a.customer_total===null?a.profit=null:a.profit=w(a.channel_total)-w(a.customer_total)}Ue(()=>[a.commercial_amount,a.compulsory_amount,a.vehicle_tax_amount,a.non_vehicle_amount,a.channel_commercial_point,a.channel_commercial_supplement_point,a.channel_compulsory_point,a.channel_vehicle_tax_point,a.channel_non_vehicle_point,a.channel_reward,a.customer_commercial_point,a.customer_commercial_supplement_point,a.customer_compulsory_point,a.customer_vehicle_tax_point,a.customer_non_vehicle_point,a.customer_reward],()=>je());const xt=E(()=>{const t=Array.isArray(se.value)?se.value:[],e=K.channel_group_id;if(e==null||e==="")return t;const i=Number(e);if(t.some(d=>Number(d?.id)===i))return t;const c=O.value?.channel_group_name||`ID:${e}`;return[{id:e,group_name:`${c}（已删除）`,_ghost:!0},...t]}),St=E(()=>{const t=Array.isArray(re.value)?re.value:[],e=K.customer_group_id;if(e==null||e==="")return t;const i=Number(e);if(t.some(d=>Number(d?.id)===i))return t;const c=O.value?.customer_group_name||`ID:${e}`;return[{id:e,group_name:`${c}（已删除）`,_ghost:!0},...t]}),{allFields:Ut,loadConfig:Ot}=wl(),Ke=E(()=>{const t=new Map;for(const e of Ut.value||[])t.set(e.key,e);return t});function N(t){return Ke.value.get(t)||{key:t,label:t,type:"text",options:[]}}function he(t){return t?.key==="id_number"?"公民身份号码":t?.label||t?.key||""}function qe(t){if(t==null||t==="")return t;const e=String(t);return/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:t}function zt(t,e){if(t==null||t==="")return"-";const i=e||{type:"text",options:[]},r=i.type==="date"?qe(t):t,c=Vl(r,i);return c===""?"-":c}const f=Oe({}),te=E(()=>!O.value||ze.value?!1:O.value.is_finished===!0?Ee.value:Ee.value?!0:mt.value&&O.value.is_finished===!1),v=E(()=>te.value&&G.value),J=E(()=>v.value?!0:$.value&&X.value),Et=E(()=>!O.value||O.value.is_finished!==!0?!1:Ee.value);function He(t){const e=String(t||"").trim();return e&&(e==="vehicle_cert"||e==="idcard_front"||e==="idcard_back"||e==="driving_license_main"||e==="driving_license_sub"||e==="related")?e:""}function Ie(){return{vehicle_cert:[],idcard_front:[],idcard_back:[],driving_license_main:[],driving_license_sub:[],related:[]}}function Ct(t){const e=Ie();for(const[i,r]of Object.entries(t||{})){const c=new Set,d=[];for(const b of Array.isArray(r)?r:[]){const y=String(b||"").trim();!y||c.has(y)||(c.add(y),d.push(y))}e[i]=d}return e}const z=E(()=>{const t=Ie();for(const e of O.value?.images||[]){const i=He(e?.slot_key),r=String(e?.image_url||"").trim();!i||!r||t[i].push(r)}return Ct(t)}),Ne=E(()=>{const t=Ie();for(const e of O.value?.images||[]){const i=He(e?.slot_key);i&&(t[i]||(t[i]=[]),t[i].push(e))}return t}),Dt=Object.freeze(["id_name","id_gender","id_ethnicity","id_birth_date","id_address","id_number"]),It=Object.freeze(["id_issuer","id_validity"]),Nt=E(()=>Dt.map(t=>N(t))),Ft=E(()=>It.map(t=>N(t))),At=Object.freeze(["dl_plate_no","dl_owner","dl_use_nature","dl_brand_model","dl_vin","dl_engine_no","dl_register_date"]),Mt=Object.freeze(["dl_approved_passenger_count"]);function q(t){if(!t)return!1;if(Ke.value.has(t))return!0;const e=f?.[t];return!(e==null||e==="")}function We(t){const e=[],i=new Set;for(const r of Array.isArray(t)?t:[]){const c=String(r?.key||"");!c||i.has(c)||(i.add(c),e.push(r))}return e}const Bt=E(()=>{const t=At.filter(e=>q(e)).map(e=>N(e));return We(t)}),Tt=E(()=>{const t=Mt.filter(e=>q(e)).map(e=>N(e));return We(t)}),Rt=E(()=>({plate:q("dl_plate_no")?"dl_plate_no":null,owner:q("dl_owner")?"dl_owner":null,use_nature:q("dl_use_nature")?"dl_use_nature":null,brand_model:q("dl_brand_model")?"dl_brand_model":null,vin:q("dl_vin")?"dl_vin":null,engine:q("dl_engine_no")?"dl_engine_no":null,register_date:q("dl_register_date")?"dl_register_date":null}));function k(t){return Rt.value?.[t]||null}const we=E(()=>q("dl_approved_passenger_count")?"dl_approved_passenger_count":null);function Pt(){const t=ae.query?.from;if(typeof t=="string"&&t){let e=t;try{e=decodeURIComponent(t)}catch{e=t}if(e.startsWith("/")){_e.push(e);return}}if(window.history.length>1){_e.back();return}_e.push({path:ze.value?"/finance":"/orders/all"})}function Ze(t){const e=t?.dynamic_data||{};for(const i of Object.keys(f))delete f[i];for(const[i,r]of Object.entries(e))f[i]=r??"";K.customer_group_id=t?.customer_group_id??null,K.channel_group_id=t?.channel_group_id??null,Le(t)}function Ge(){if(te.value){if(G.value){G.value=!1,O.value&&Ze(O.value);return}G.value=!0,(!se.value.length||!re.value.length)&&Fe()}}async function Fe(){ge.value=!0,ye.value=!0;try{const[t,e]=await Promise.all([Pe.get("/orders/channel-groups"),Pe.get("/orders/customer-groups")]);se.value=Array.isArray(t?.data?.items)?t.data.items:[],re.value=Array.isArray(e?.data?.items)?e.data.items:[]}catch(t){console.error(t),A.error("加载渠道/客户选项失败")}finally{ge.value=!1,ye.value=!1}}function Yt(){return $.value}async function ue({preserveEditDraft:t=!1}={}){if(j){Z.value=!0;try{const e=Yt()?await gl(j):await ml(j);O.value=e.data,t?G.value||Le(O.value):(G.value=!1,Ze(O.value))}catch(e){console.error(e),A.error("加载订单详情失败")}finally{Z.value=!1}}}function $t(t){return String(t||"").replace(/\s+/g,"").replace(/-/g,"")}function Lt(t){const e=$t(t);return e?/^(?:\+?86)?1[3-9]\d{9}$/.test(e):!0}function jt(){return String(f?.id_name||"").trim()}function Kt(){const t=k("owner");return t?String(f?.[t]||"").trim():""}async function qt(){if(v.value){const i=String(a.owner_phone||"").trim();if(i&&!Lt(i))return await rt(),await Ye({targetEl:Ce.value,flashEls:[Ce.value],title:"电话格式不正确",message:"车主电话默认按手机号校验，请检查后再保存。",confirmText:"我知道了",cancelText:"取消"}),!1}const t=jt(),e=Kt();return!(t&&e&&t!==e&&(await rt(),!await Ye({targetEl:ke.value||be.value,flashEls:[ke.value,be.value].filter(Boolean),title:"姓名不一致",message:`检测到证件姓名不一致：
身份证姓名【${t}】
行驶证所有人【${e}】
是否仍要继续保存？`,confirmText:"继续保存",cancelText:"取消保存"})))}async function Ht(){if(!(!O.value||!v.value||!await qt())){L.value=!0;try{const e={...O.value.dynamic_data||{},...f};await pl(j,{dynamic_data:e,customer_group_id:K.customer_group_id,channel_group_id:K.channel_group_id,order_info:Vt()}),A.success("保存成功"),await ue()}catch(e){console.error(e),A.error("保存失败")}finally{L.value=!1}}}async function Wt(){try{await Se.confirm("确认将该订单【退回未完成】？","确认操作",{confirmButtonText:"确认退回",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}await Zt()}async function Zt(){if(O.value){L.value=!0;try{await fl(j,{is_finished:!1}),A.success("已退回未完成"),await ue()}catch(t){console.error(t),A.error("操作失败")}finally{L.value=!1}}}const de=C("smart");function Gt(){const t=localStorage.getItem(ut);(t==="smart"||t==="direct"||t==="stable")&&(de.value=t)}Gt();const x=Oe({vehicle_cert:!1,idcard_front:!1,idcard_back:!1,driving_license_main:!1,driving_license_sub:!1,related:!1}),ce=C([]),le=C(!1),Ae=C("");let Ve=null,Me=0;function Xt(t){try{return Date.parse(t)}catch{return 0}}async function Jt(){const t=Date.now();if(Ve&&Me&&t+12e4<Me)return Ve;const i=(await Pe.get("/orders/bos-sts"))?.data;if(!i?.accessKeyId||!i?.secretAccessKey||!i?.sessionToken)throw new Error("bos-sts response invalid");return Ve=i,Ae.value=i.bosHost||"",Me=Xt(i.expiration)||t+600*1e3,Ve}function Q(t){const e=t?.message||t?.response?.data?.detail||t?.response?.data?.message||"";return String(e||"")}function Xe(t){const e=Q(t).toLowerCase();return e.includes("failed to fetch")||e.includes("network error")||e.includes("err_")||e.includes("cors")||e.includes("代理")||e.includes("vpn")||e.includes("127.0.0.1:7890")}async function Je(t){try{await Se.confirm(`上传看起来被当前网络环境拦截（常见于 VPN/代理/公司网关）。

是否切换到【稳定模式上传】继续？`,"上传失败（网络拦截）",{confirmButtonText:"切换为稳定模式",cancelButtonText:"继续直传重试",type:"warning",center:!0,distinguishCancelAndClose:!0}),de.value="stable";try{localStorage.setItem(ut,"stable")}catch{}return!0}catch{return!1}}function Qt(t){try{return(new URL(String(t)).pathname||"").replace(/^\/+/,"")}catch{const e=String(t||""),i=e.indexOf("://");if(i>=0){const r=e.slice(i+3),c=r.indexOf("/");if(c>=0)return r.slice(c+1).replace(/^\/+/,"")}return""}}function el(t){const e=(t?.storage_key||t?.image_file?.storage_key||"").trim().replace(/^\/+/,"");if(e)return e;const i=(t?.image_url||t?.url||"").trim();return i?Qt(i):""}function tl(t){const i=String(t||"").match(/([a-f0-9]{32})\.[a-z0-9]+$/i);return i?String(i[1]).toLowerCase():""}function Be(t,e){const i=el(t);if(!i)return null;const r=tl(i)||"";return{slot_key:e,storage_key:i,md5:r,size:0}}async function xe(t,e){if($.value){const d=(await kl({order_id:j,slot_key:t,file:e}))?.data;return{slot_key:t,storage_key:d?.storage_key,md5:d?.md5||"",size:d?.size||e?.size||0,content_type:d?.content_type||e?.type||"application/octet-stream",etag:d?.etag||"",original_name:d?.original_name||e?.name||"file",url:d?.url||""}}if(de.value==="stable"){const d=(await _l({slot_key:t,file:e}))?.data;return{slot_key:t,storage_key:d?.storage_key,md5:d?.md5||"",size:d?.size||e?.size||0,content_type:d?.content_type||e?.type||"application/octet-stream",etag:d?.etag||"",original_name:d?.original_name||e?.name||"file",url:d?.url||""}}const i=await Jt();if(!Ae.value)throw new Error("bosHost missing");const r=await xl({bosHost:Ae.value,slotKey:t,file:e,sts:i});return{slot_key:t,storage_key:r?.storage_key,md5:r?.md5||"",size:r?.size||e?.size||0,content_type:r?.content_type||e?.type||"application/octet-stream",etag:r?.etag||"",original_name:r?.original_name||e?.name||"file",url:r?.url||""}}async function ee(t,e,{clear:i=!1}={}){const r=i?[t]:[];$.value?await yl({order_id:j,images:e,clear_slots:r}):await vl({order_id:j,images:e,clear_slots:r}),await ue({preserveEditDraft:!0}),A.success("图片已更新（如涉及证件将触发 OCR 任务）")}async function me(t,e){if(!v.value)return;const i=e?.raw;if(i){x[t]=!0;try{const r=await xe(t,i);if(!r?.storage_key)throw new Error("upload meta invalid");await ee(t,[r])}catch(r){if(!$.value&&de.value==="smart"&&Xe(r)&&await Je())try{const d=await xe(t,i);if(!d?.storage_key)throw new Error("upload meta invalid");await ee(t,[d]);return}catch(d){console.error(d),A.error(Q(d)||"上传失败");return}console.error(r),A.error(Q(r)||"上传失败")}finally{x[t]=!1}}}async function ll(t){if(!J.value)return;const e=t?.raw;e&&(ce.value.push(e),!x.related&&await Qe())}async function Qe(){if(x.related)return;const t=ce.value.splice(0);if(t.length){x.related=!0;try{const e=(Ne.value.related||[]).map(r=>Be(r,"related")).filter(Boolean),i=[];for(const r of t){const c=await xe("related",r);if(!c?.storage_key)throw new Error("upload meta invalid");i.push(c)}i.length&&await ee("related",[...e,...i]),le.value=!1}catch(e){if(!$.value&&de.value==="smart"&&Xe(e)&&!le.value&&await Je()){le.value=!0;try{const r=(Ne.value.related||[]).map(d=>Be(d,"related")).filter(Boolean),c=[];for(const d of t){const b=await xe("related",d);if(!b?.storage_key)throw new Error("upload meta invalid");c.push(b)}c.length&&await ee("related",[...r,...c]),le.value=!1}catch(r){console.error(r),A.error(Q(r)||"上传失败")}return}console.error(e),A.error(Q(e)||"上传失败")}finally{x.related=!1,ce.value.length&&Qe()}}}async function nl(t){if(!J.value)return;const e=(Ne.value.related||[]).slice();if(!(t<0||t>=e.length)){x.related=!0;try{const i=e.filter((r,c)=>c!==t).map(r=>Be(r,"related")).filter(Boolean);if(!i.length){await ee("related",[],{clear:!0});return}await ee("related",i)}catch(i){console.error(i),A.error(Q(i)||"删除失败")}finally{x.related=!1}}}async function al(){if(J.value&&z.value.related.length){try{await Se.confirm("确认清空【备用图】所有图片？","确认清空",{confirmButtonText:"确认清空",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}ce.value=[],le.value=!1,x.related=!0;try{await ee("related",[],{clear:!0})}catch(t){console.error(t),A.error(Q(t)||"清空失败")}finally{x.related=!1}}}Sl(async()=>{j&&(await Ot("order"),await ue(),te.value&&await Fe())});const F=st({name:"FieldValue",props:{modelValue:{type:[String,Number,Date],default:""},field:{type:Object,required:!0},editable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:e}){const i=R("el-input"),r=R("el-select"),c=R("el-option"),d=R("el-date-picker"),b=y=>e("update:modelValue",y);return()=>{const y=t.field||{type:"text",options:[]},U=t.modelValue??"",M=zt(U,y);if(!t.editable)return W("span",{class:"plain-value",title:M},M);if(y.type==="date"){const H=qe(U)??"";return W(d,{modelValue:H,"onUpdate:modelValue":b,type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}if(y.type==="select"){const H=Array.isArray(y.options)?y.options:[];return W(r,{modelValue:U,"onUpdate:modelValue":b,filterable:!0,clearable:!0,class:"fv fv-select"},()=>H.map(n=>{const m=n&&typeof n=="object"?n.label:String(n),h=n&&typeof n=="object"?n.value:n;return W(c,{key:String(h),label:m,value:h})}))}return W(i,{modelValue:U,"onUpdate:modelValue":b,clearable:!0,class:"fv fv-input"})}}}),S=st({name:"InfoValue",props:{modelValue:{type:[String,Number,null],default:""},type:{type:String,default:"text"},editable:{type:Boolean,default:!1},min:{type:Number,default:void 0},max:{type:Number,default:void 0}},emits:["update:modelValue"],setup(t,{emit:e}){const i=R("el-input"),r=R("el-date-picker"),c=C(""),d=C(!1);function b(m){return m==null||m===""||(t.type==="money"||t.type==="point")&&Number(m)===0?"":String(m)}function y(){d.value||(c.value=b(t.modelValue))}Ue(()=>t.modelValue,()=>y(),{immediate:!0});function U(m){let h=m;return typeof t.min=="number"&&(h=Math.max(t.min,h)),typeof t.max=="number"&&(h=Math.min(t.max,h)),h}function M(){c.value="",e("update:modelValue",null)}function H(){d.value=!1;const m=String(c.value||"").trim();if(!m){M();return}const h=Number(m);if(!Number.isFinite(h)){M();return}let P=U(h);if(t.type==="money"){P=Math.round(P*100)/100,e("update:modelValue",P),c.value=P.toFixed(2);return}e("update:modelValue",P),c.value=String(P)}function n(m){if(m==null||m==="")return"-";const h=Number(m);return t.type==="money"?Number.isFinite(h)?h.toFixed(2):"-":t.type==="point"?Number.isFinite(h)?String(h):"-":t.type==="date"?De(m)||"-":String(m)}return()=>{const m=t.modelValue??"";if(!t.editable){const h=n(m);return W("span",{class:"plain-value",title:h},h)}if(t.type==="date"){const h=De(m);return W(r,{modelValue:h,"onUpdate:modelValue":P=>e("update:modelValue",P),type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}return t.type==="money"||t.type==="point"?W(i,{modelValue:c.value,"onUpdate:modelValue":h=>{c.value=String(h??"")},clearable:!0,class:"fv fv-input",inputmode:"decimal",onFocus:()=>{d.value=!0},onBlur:()=>H(),onClear:()=>M()}):W(i,{modelValue:m,"onUpdate:modelValue":h=>e("update:modelValue",h),clearable:!0,class:"fv fv-input"})}}});return Ue(()=>te.value,t=>{t&&(!se.value.length||!re.value.length)&&Fe()}),(t,e)=>{const i=R("el-button"),r=R("el-option"),c=R("el-select"),d=R("el-card"),b=R("el-upload"),y=R("el-image"),U=R("el-icon"),M=R("el-tooltip"),H=Ol("loading");return s(),u("div",zl,[l("div",El,[e[50]||(e[50]=l("h2",null,"订单详情",-1)),l("div",Cl,[o(i,{size:"small",onClick:Pt},{default:_(()=>[...e[42]||(e[42]=[I("返回",-1)])]),_:1}),$.value&&O.value?(s(),u(B,{key:0},[X.value?(s(),u(B,{key:1},[o(i,{size:"small",plain:"",disabled:Z.value||L.value||x.related,onClick:pt},{default:_(()=>[...e[44]||(e[44]=[I(" 退出编辑 ",-1)])]),_:1},8,["disabled"]),o(i,{size:"small",type:"primary",disabled:Z.value||L.value||x.related,onClick:ft},{default:_(()=>[...e[45]||(e[45]=[I(" 完成编辑 ",-1)])]),_:1},8,["disabled"])],64)):(s(),T(i,{key:0,size:"small",type:"primary",plain:"",disabled:Z.value||L.value||x.related,onClick:_t},{default:_(()=>[...e[43]||(e[43]=[I(" 编辑 ",-1)])]),_:1},8,["disabled"]))],64)):(s(),u(B,{key:1},[Et.value?(s(),T(i,{key:0,size:"small",type:"warning",plain:"",loading:L.value,onClick:Wt},{default:_(()=>[...e[46]||(e[46]=[I(" 退回未完成 ",-1)])]),_:1},8,["loading"])):V("",!0),te.value&&!G.value?(s(),T(i,{key:1,size:"small",type:"primary",plain:"",disabled:Z.value||L.value,onClick:Ge},{default:_(()=>[...e[47]||(e[47]=[I(" 编辑 ",-1)])]),_:1},8,["disabled"])):V("",!0),te.value&&G.value?(s(),T(i,{key:2,size:"small",plain:"",disabled:Z.value||L.value,onClick:Ge},{default:_(()=>[...e[48]||(e[48]=[I(" 取消编辑 ",-1)])]),_:1},8,["disabled"])):V("",!0),v.value?(s(),T(i,{key:3,size:"small",type:"primary",loading:L.value,onClick:Ht},{default:_(()=>[...e[49]||(e[49]=[I("保存",-1)])]),_:1},8,["loading"])):V("",!0)],64))])]),Ul((s(),u("div",Dl,[o(d,{shadow:"never",class:"section-card meta-card"},{header:_(()=>[...e[51]||(e[51]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"渠道、客户")],-1)])]),default:_(()=>[l("div",Il,[l("div",Nl,[e[52]||(e[52]=l("div",{class:"kv-label"},"渠道",-1)),l("div",Fl,[v.value?(s(),T(c,{key:0,modelValue:K.channel_group_id,"onUpdate:modelValue":e[0]||(e[0]=n=>K.channel_group_id=n),filterable:"",clearable:"",placeholder:"请选择渠道",class:"fv fv-select",loading:ge.value,disabled:ge.value},{default:_(()=>[(s(!0),u(B,null,Y(xt.value,n=>(s(),T(r,{key:String(n.id),label:n.group_name||String(n.id),value:n.id,disabled:!!n._ghost},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading","disabled"])):(s(),u("span",{key:1,class:"plain-value",title:O.value?.channel_group_name||"-"},ne(O.value?.channel_group_name||"-"),9,Al))])]),l("div",Ml,[e[53]||(e[53]=l("div",{class:"kv-label"},"客户",-1)),l("div",Bl,[v.value?(s(),T(c,{key:0,modelValue:K.customer_group_id,"onUpdate:modelValue":e[1]||(e[1]=n=>K.customer_group_id=n),filterable:"",clearable:"",placeholder:"请选择客户",class:"fv fv-select",loading:ye.value,disabled:ye.value},{default:_(()=>[(s(!0),u(B,null,Y(St.value,n=>(s(),T(r,{key:String(n.id),label:n.group_name||String(n.id),value:n.id,disabled:!!n._ghost},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading","disabled"])):(s(),u("span",{key:1,class:"plain-value",title:O.value?.customer_group_name||"-"},ne(O.value?.customer_group_name||"-"),9,Tl))])])])]),_:1}),o(d,{shadow:"never",class:"section-card"},{header:_(()=>[...e[54]||(e[54]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"备用图")],-1)])]),default:_(()=>[J.value?(s(),u("div",Rl,[o(b,{drag:"","auto-upload":!1,multiple:!0,"show-file-list":!1,accept:"image/*",disabled:x.related,"on-change":n=>ll(n),class:"related-dragger"},{default:_(()=>[...e[55]||(e[55]=[l("div",{class:"drag-inner"},[l("div",{class:"drag-title"},"拖拽图片到这里"),l("div",{class:"drag-sub"},"或点击选择（支持多张）")],-1)])]),_:1},8,["disabled","on-change"]),o(i,{size:"small",type:"danger",plain:"",disabled:x.related||!z.value.related.length,loading:x.related,onClick:al},{default:_(()=>[...e[56]||(e[56]=[I(" 清空 ",-1)])]),_:1},8,["disabled","loading"])])):V("",!0),J.value||z.value.related.length?(s(),u("div",Pl,[(s(!0),u(B,null,Y(z.value.related,(n,m)=>(s(),u("div",{key:n+":"+m,class:"thumb-wrap"},[o(y,{src:n,"preview-src-list":z.value.related,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"]),J.value?(s(),u("button",{key:0,type:"button",class:"thumb-remove",title:"删除这张",onClick:h=>nl(m)}," × ",8,Yl)):V("",!0)]))),128)),J.value&&!z.value.related.length?(s(),u("div",$l)):V("",!0)])):V("",!0)]),_:1}),o(d,{shadow:"never",class:"section-card"},{header:_(()=>[...e[57]||(e[57]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"订单信息")],-1)])]),default:_(()=>[l("div",Ll,[l("div",jl,[l("div",Kl,[e[58]||(e[58]=l("div",{class:"kv-label"},"保险到期日",-1)),l("div",ql,[o(p(S),{modelValue:a.insurance_expire_date,"onUpdate:modelValue":e[2]||(e[2]=n=>a.insurance_expire_date=n),type:"date",editable:v.value},null,8,["modelValue","editable"])])]),l("div",Hl,[e[59]||(e[59]=l("div",{class:"kv-label"},"车主电话",-1)),l("div",{class:"kv-value",ref_key:"ownerPhoneValueRef",ref:Ce},[o(p(S),{modelValue:a.owner_phone,"onUpdate:modelValue":e[3]||(e[3]=n=>a.owner_phone=n),type:"text",editable:v.value},null,8,["modelValue","editable"])],512)])]),l("div",Wl,[l("div",Zl,[e[60]||(e[60]=l("div",{class:"kv-label"},"订单备注",-1)),l("div",Gl,[o(p(S),{modelValue:a.remark,"onUpdate:modelValue":e[4]||(e[4]=n=>a.remark=n),type:"text",editable:v.value},null,8,["modelValue","editable"])])])]),l("div",Xl,[l("div",Jl,[e[61]||(e[61]=l("div",{class:"kv-label"},"商业金额",-1)),l("div",Ql,[o(p(S),{modelValue:a.commercial_amount,"onUpdate:modelValue":e[5]||(e[5]=n=>a.commercial_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])]),l("div",en,[e[62]||(e[62]=l("div",{class:"kv-label"},"交强金额",-1)),l("div",tn,[o(p(S),{modelValue:a.compulsory_amount,"onUpdate:modelValue":e[6]||(e[6]=n=>a.compulsory_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])]),l("div",ln,[e[63]||(e[63]=l("div",{class:"kv-label"},"车船税金额",-1)),l("div",nn,[o(p(S),{modelValue:a.vehicle_tax_amount,"onUpdate:modelValue":e[7]||(e[7]=n=>a.vehicle_tax_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])]),l("div",an,[e[64]||(e[64]=l("div",{class:"kv-label"},"非车金额",-1)),l("div",on,[o(p(S),{modelValue:a.non_vehicle_amount,"onUpdate:modelValue":e[8]||(e[8]=n=>a.non_vehicle_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])])]),l("div",sn,[l("div",rn,[e[65]||(e[65]=l("div",{class:"kv-label"},"保费金额",-1)),l("div",un,[o(p(S),{modelValue:a.premium_total,"onUpdate:modelValue":e[9]||(e[9]=n=>a.premium_total=n),type:"money",editable:!1},null,8,["modelValue"])])])])]),e[81]||(e[81]=l("div",{class:"split-title"},"渠道",-1)),l("div",dn,[l("div",cn,[e[66]||(e[66]=l("div",{class:"kv-label"},"商业点位%",-1)),l("div",mn,[o(p(S),{modelValue:a.channel_commercial_point,"onUpdate:modelValue":e[10]||(e[10]=n=>a.channel_commercial_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",vn,[e[67]||(e[67]=l("div",{class:"kv-label"},"商业后补%",-1)),l("div",_n,[o(p(S),{modelValue:a.channel_commercial_supplement_point,"onUpdate:modelValue":e[11]||(e[11]=n=>a.channel_commercial_supplement_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",pn,[e[68]||(e[68]=l("div",{class:"kv-label"},"交强点位%",-1)),l("div",fn,[o(p(S),{modelValue:a.channel_compulsory_point,"onUpdate:modelValue":e[12]||(e[12]=n=>a.channel_compulsory_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",gn,[e[69]||(e[69]=l("div",{class:"kv-label"},"车船税点位%",-1)),l("div",yn,[o(p(S),{modelValue:a.channel_vehicle_tax_point,"onUpdate:modelValue":e[13]||(e[13]=n=>a.channel_vehicle_tax_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",kn,[e[70]||(e[70]=l("div",{class:"kv-label"},"非车点位%",-1)),l("div",bn,[o(p(S),{modelValue:a.channel_non_vehicle_point,"onUpdate:modelValue":e[14]||(e[14]=n=>a.channel_non_vehicle_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",hn,[e[71]||(e[71]=l("div",{class:"kv-label"},"出单奖励",-1)),l("div",wn,[o(p(S),{modelValue:a.channel_reward,"onUpdate:modelValue":e[15]||(e[15]=n=>a.channel_reward=n),type:"money",editable:v.value},null,8,["modelValue","editable"])])])]),l("div",Vn,[l("div",xn,[e[72]||(e[72]=l("div",{class:"kv-label"},"渠道合计",-1)),l("div",Sn,[o(p(S),{modelValue:a.channel_total,"onUpdate:modelValue":e[16]||(e[16]=n=>a.channel_total=n),type:"money",editable:!1},null,8,["modelValue"])])])]),e[82]||(e[82]=l("div",{class:"split-title"},"客户",-1)),l("div",Un,[l("div",On,[e[73]||(e[73]=l("div",{class:"kv-label"},"商业点位%",-1)),l("div",zn,[o(p(S),{modelValue:a.customer_commercial_point,"onUpdate:modelValue":e[17]||(e[17]=n=>a.customer_commercial_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",En,[e[74]||(e[74]=l("div",{class:"kv-label"},"商业后补%",-1)),l("div",Cn,[o(p(S),{modelValue:a.customer_commercial_supplement_point,"onUpdate:modelValue":e[18]||(e[18]=n=>a.customer_commercial_supplement_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",Dn,[e[75]||(e[75]=l("div",{class:"kv-label"},"交强点位%",-1)),l("div",In,[o(p(S),{modelValue:a.customer_compulsory_point,"onUpdate:modelValue":e[19]||(e[19]=n=>a.customer_compulsory_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",Nn,[e[76]||(e[76]=l("div",{class:"kv-label"},"车船税点位%",-1)),l("div",Fn,[o(p(S),{modelValue:a.customer_vehicle_tax_point,"onUpdate:modelValue":e[20]||(e[20]=n=>a.customer_vehicle_tax_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",An,[e[77]||(e[77]=l("div",{class:"kv-label"},"非车点位%",-1)),l("div",Mn,[o(p(S),{modelValue:a.customer_non_vehicle_point,"onUpdate:modelValue":e[21]||(e[21]=n=>a.customer_non_vehicle_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),l("div",Bn,[e[78]||(e[78]=l("div",{class:"kv-label"},"出单奖励",-1)),l("div",Tn,[o(p(S),{modelValue:a.customer_reward,"onUpdate:modelValue":e[22]||(e[22]=n=>a.customer_reward=n),type:"money",editable:v.value},null,8,["modelValue","editable"])])])]),l("div",Rn,[l("div",Pn,[e[79]||(e[79]=l("div",{class:"kv-label"},"客户合计",-1)),l("div",Yn,[o(p(S),{modelValue:a.customer_total,"onUpdate:modelValue":e[23]||(e[23]=n=>a.customer_total=n),type:"money",editable:!1},null,8,["modelValue"])])])]),l("div",$n,[l("div",Ln,[e[80]||(e[80]=l("div",{class:"kv-label"},"利润",-1)),l("div",jn,[o(p(S),{modelValue:a.profit,"onUpdate:modelValue":e[24]||(e[24]=n=>a.profit=n),type:"money",editable:!1},null,8,["modelValue"])])])])]),_:1}),o(d,{shadow:"never",class:"section-card"},{header:_(()=>[l("div",Kn,[e[83]||(e[83]=l("div",{class:"section-title"},"车辆合格证",-1)),o(i,{class:"icon-btn",circle:"",size:"small",onClick:e[25]||(e[25]=n=>fe.value=!fe.value)},{default:_(()=>[o(U,null,{default:_(()=>[fe.value?(s(),T(p(Te),{key:0})):(s(),T(p(Re),{key:1}))]),_:1})]),_:1})])]),default:_(()=>[l("div",qn,[l("div",Hn,[fe.value?(s(),u("div",na,[o(cl,{data:f,readonly:!v.value},null,8,["data","readonly"])])):(s(),u("div",Wn,[l("div",Zn,[e[84]||(e[84]=l("div",{class:"kv-label"},"车辆型号",-1)),l("div",Gn,[o(p(F),{modelValue:f.vehicle_model,"onUpdate:modelValue":e[26]||(e[26]=n=>f.vehicle_model=n),field:N("vehicle_model"),editable:v.value},null,8,["modelValue","field","editable"])])]),l("div",Xn,[e[85]||(e[85]=l("div",{class:"kv-label"},"车辆识别代号/车架号",-1)),l("div",Jn,[o(p(F),{modelValue:f.vin,"onUpdate:modelValue":e[27]||(e[27]=n=>f.vin=n),field:N("vin"),editable:v.value},null,8,["modelValue","field","editable"])])]),l("div",Qn,[e[86]||(e[86]=l("div",{class:"kv-label"},"发动机号",-1)),l("div",ea,[o(p(F),{modelValue:f.engine_no,"onUpdate:modelValue":e[28]||(e[28]=n=>f.engine_no=n),field:N("engine_no"),editable:v.value},null,8,["modelValue","field","editable"])])]),l("div",ta,[e[87]||(e[87]=l("div",{class:"kv-label"},"额定载客(人 )",-1)),l("div",la,[o(p(F),{modelValue:f.approved_passenger_count,"onUpdate:modelValue":e[29]||(e[29]=n=>f.approved_passenger_count=n),field:N("approved_passenger_count"),editable:v.value},null,8,["modelValue","field","editable"])])])]))]),l("div",aa,[v.value?(s(),u("div",ia,[o(b,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("vehicle_cert",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.vehicle_cert},{default:_(()=>[...e[88]||(e[88]=[I("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(M,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[89]||(e[89]=[I("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",oa,[(s(!0),u(B,null,Y(z.value.vehicle_cert,(n,m)=>(s(),u("div",{key:n+":"+m,class:"thumb-wrap"},[o(y,{src:n,"preview-src-list":z.value.vehicle_cert,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.vehicle_cert.length?V("",!0):(s(),u("div",sa))])])])]),_:1}),o(d,{shadow:"never",class:"section-card"},{header:_(()=>[l("div",ra,[e[90]||(e[90]=l("div",{class:"section-title"},"身份证正面/身份证背面",-1)),o(i,{class:"icon-btn",circle:"",size:"small",onClick:e[30]||(e[30]=n=>ie.value=!ie.value)},{default:_(()=>[o(U,null,{default:_(()=>[ie.value?(s(),T(p(Te),{key:0})):(s(),T(p(Re),{key:1}))]),_:1})]),_:1})])]),default:_(()=>[l("div",ua,[l("div",da,[e[95]||(e[95]=l("div",{class:"sub-title"},"身份证正面",-1)),l("div",ca,[l("div",ma,[ie.value?(s(),u("div",ga,[(s(!0),u(B,null,Y(Nt.value,n=>(s(),u("div",{key:n.key,class:"kv-item"},[l("div",ya,ne(he(n)),1),l("div",{class:"kv-value",ref_for:!0,ref:gt(n)},[o(p(F),{modelValue:f[n.key],"onUpdate:modelValue":m=>f[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])],512)]))),128))])):(s(),u("div",va,[l("div",_a,[e[91]||(e[91]=l("div",{class:"kv-label"},"姓名",-1)),l("div",{class:"kv-value",ref_key:"idNameValueRef",ref:ke},[o(p(F),{modelValue:f.id_name,"onUpdate:modelValue":e[31]||(e[31]=n=>f.id_name=n),field:N("id_name"),editable:v.value},null,8,["modelValue","field","editable"])],512)]),l("div",pa,[e[92]||(e[92]=l("div",{class:"kv-label"},"公民身份号码",-1)),l("div",fa,[o(p(F),{modelValue:f.id_number,"onUpdate:modelValue":e[32]||(e[32]=n=>f.id_number=n),field:N("id_number"),editable:v.value},null,8,["modelValue","field","editable"])])])]))]),l("div",ka,[v.value?(s(),u("div",ba,[o(b,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("idcard_front",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.idcard_front},{default:_(()=>[...e[93]||(e[93]=[I("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(M,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[94]||(e[94]=[I("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",ha,[(s(!0),u(B,null,Y(z.value.idcard_front,(n,m)=>(s(),u("div",{key:n+":"+m,class:"thumb-wrap"},[o(y,{src:n,"preview-src-list":z.value.idcard_front,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.idcard_front.length?V("",!0):(s(),u("div",wa))])])])]),l("div",Va,[e[98]||(e[98]=l("div",{class:"sub-title"},"身份证背面",-1)),l("div",xa,[l("div",Sa,[ie.value?(s(),u("div",Ua,[(s(!0),u(B,null,Y(Ft.value,n=>(s(),u("div",{key:n.key,class:"kv-item"},[l("div",Oa,ne(he(n)),1),l("div",za,[o(p(F),{modelValue:f[n.key],"onUpdate:modelValue":m=>f[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])])]))),128))])):V("",!0)]),l("div",Ea,[v.value?(s(),u("div",Ca,[o(b,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("idcard_back",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.idcard_back},{default:_(()=>[...e[96]||(e[96]=[I("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(M,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[97]||(e[97]=[I("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",Da,[(s(!0),u(B,null,Y(z.value.idcard_back,(n,m)=>(s(),u("div",{key:n+":"+m,class:"thumb-wrap"},[o(y,{src:n,"preview-src-list":z.value.idcard_back,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.idcard_back.length?V("",!0):(s(),u("div",Ia))])])])])])]),_:1}),o(d,{shadow:"never",class:"section-card"},{header:_(()=>[l("div",Na,[e[99]||(e[99]=l("div",{class:"section-title"},"行驶证/行驶证副件",-1)),o(i,{class:"icon-btn",circle:"",size:"small",onClick:e[33]||(e[33]=n=>oe.value=!oe.value)},{default:_(()=>[o(U,null,{default:_(()=>[oe.value?(s(),T(p(Te),{key:0})):(s(),T(p(Re),{key:1}))]),_:1})]),_:1})])]),default:_(()=>[l("div",Fa,[l("div",Aa,[e[109]||(e[109]=l("div",{class:"sub-title"},"行驶证",-1)),l("div",Ma,[l("div",Ba,[oe.value?(s(),u("div",Ja,[(s(!0),u(B,null,Y(Bt.value,n=>(s(),u("div",{key:n.key,class:"kv-item"},[l("div",Qa,ne(he(n)),1),l("div",{class:"kv-value",ref_for:!0,ref:kt(n)},[o(p(F),{modelValue:f[n.key],"onUpdate:modelValue":m=>f[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])],512)]))),128))])):(s(),u("div",Ta,[k("plate")?(s(),u("div",Ra,[e[100]||(e[100]=l("div",{class:"kv-label"},"号牌号码",-1)),l("div",Pa,[o(p(F),{modelValue:f[k("plate")],"onUpdate:modelValue":e[34]||(e[34]=n=>f[k("plate")]=n),field:N(k("plate")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),k("owner")?(s(),u("div",Ya,[e[101]||(e[101]=l("div",{class:"kv-label"},"所有人",-1)),l("div",{class:"kv-value",ref:yt},[o(p(F),{modelValue:f[k("owner")],"onUpdate:modelValue":e[35]||(e[35]=n=>f[k("owner")]=n),field:N(k("owner")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),k("use_nature")?(s(),u("div",$a,[e[102]||(e[102]=l("div",{class:"kv-label"},"使用性质",-1)),l("div",La,[o(p(F),{modelValue:f[k("use_nature")],"onUpdate:modelValue":e[36]||(e[36]=n=>f[k("use_nature")]=n),field:N(k("use_nature")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),k("brand_model")?(s(),u("div",ja,[e[103]||(e[103]=l("div",{class:"kv-label"},"品牌型号",-1)),l("div",Ka,[o(p(F),{modelValue:f[k("brand_model")],"onUpdate:modelValue":e[37]||(e[37]=n=>f[k("brand_model")]=n),field:N(k("brand_model")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),k("vin")?(s(),u("div",qa,[e[104]||(e[104]=l("div",{class:"kv-label"},"车辆识别代码",-1)),l("div",Ha,[o(p(F),{modelValue:f[k("vin")],"onUpdate:modelValue":e[38]||(e[38]=n=>f[k("vin")]=n),field:N(k("vin")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),k("engine")?(s(),u("div",Wa,[e[105]||(e[105]=l("div",{class:"kv-label"},"发动机号码",-1)),l("div",Za,[o(p(F),{modelValue:f[k("engine")],"onUpdate:modelValue":e[39]||(e[39]=n=>f[k("engine")]=n),field:N(k("engine")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),k("register_date")?(s(),u("div",Ga,[e[106]||(e[106]=l("div",{class:"kv-label"},"注册日期",-1)),l("div",Xa,[o(p(F),{modelValue:f[k("register_date")],"onUpdate:modelValue":e[40]||(e[40]=n=>f[k("register_date")]=n),field:N(k("register_date")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0)]))]),l("div",ei,[v.value?(s(),u("div",ti,[o(b,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("driving_license_main",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.driving_license_main},{default:_(()=>[...e[107]||(e[107]=[I("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(M,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[108]||(e[108]=[I("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",li,[(s(!0),u(B,null,Y(z.value.driving_license_main,(n,m)=>(s(),u("div",{key:n+":"+m,class:"thumb-wrap"},[o(y,{src:n,"preview-src-list":z.value.driving_license_main,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.driving_license_main.length?V("",!0):(s(),u("div",ni))])])])]),l("div",ai,[e[113]||(e[113]=l("div",{class:"sub-title"},"行驶证副件",-1)),l("div",ii,[l("div",oi,[oe.value?(s(),u("div",di,[(s(!0),u(B,null,Y(Tt.value,n=>(s(),u("div",{key:n.key,class:"kv-item"},[l("div",ci,ne(he(n)),1),l("div",mi,[o(p(F),{modelValue:f[n.key],"onUpdate:modelValue":m=>f[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])])]))),128))])):(s(),u("div",si,[we.value?(s(),u("div",ri,[e[110]||(e[110]=l("div",{class:"kv-label"},"核定载人数",-1)),l("div",ui,[o(p(F),{modelValue:f[we.value],"onUpdate:modelValue":e[41]||(e[41]=n=>f[we.value]=n),field:N(we.value),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0)]))]),l("div",vi,[v.value?(s(),u("div",_i,[o(b,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("driving_license_sub",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.driving_license_sub},{default:_(()=>[...e[111]||(e[111]=[I("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(M,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[l("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[112]||(e[112]=[I("清空",-1)])]),_:1})])]),_:1})])):V("",!0),l("div",pi,[(s(!0),u(B,null,Y(z.value.driving_license_sub,(n,m)=>(s(),u("div",{key:n+":"+m,class:"thumb-wrap"},[o(y,{src:n,"preview-src-list":z.value.driving_license_sub,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.driving_license_sub.length?V("",!0):(s(),u("div",fi))])])])])])]),_:1})])),[[H,Z.value]])])}}},Ai=bl(yi,[["__scopeId","data-v-e59156e0"]]);export{Ai as default};
