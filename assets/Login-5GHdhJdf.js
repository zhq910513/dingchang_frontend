import{Z as V,r as C,q as R,x as B,z as o,P as r,H as n,ay as u,y as I,L as v,ap as W,u as y}from"./vendor-vue-fFWwKrgY.js";import{u as M,b as T}from"./vendor-vue-router-CVyACjsp.js";import{l as F}from"./auth-BqM3s_5E.js";import{_ as K,u as O,R as c}from"./index-B6ZByGp_.js";import{u as P,l as U,E as m}from"./vendor-element-plus-CtVxZ4Oy.js";import"./http-DGyH82Tn.js";import"./vendor-axios-C0Zqfgkc.js";import"./vendor-pinia-CMXa-Za0.js";import"./vendor-lodash-rvV0CIkQ.js";import"./vendor-DWCz07M-.js";import"./vendor-dates-DVKSwKij.js";const q="/logo.png",z={class:"login-page"},H={class:"login-shell"},D={class:"card-inner"},Z={class:"brand"},j={__name:"Login",setup(G){const g=T(),E=M(),f=O(),l=V({username:"",password:""}),p=C(!1);function h(t){return t===c.MARKET?"/channels":t===c.FINANCE?"/finance":"/orders/all"}function L(t,e){const s=String(e||"");return!(!s.startsWith("/")||t===c.FINANCE&&s.startsWith("/orders")||t===c.SALES&&s.startsWith("/finance")||(t===c.SALES||t===c.FINANCE)&&s.startsWith("/users"))}function S(t){return/[\u4e00-\u9fa5]/.test(String(t||""))}function x(t){const e=t?.response?.status,s=t?.response?.data?.detail,i=t?.message;if(s&&typeof s=="string"&&S(s))return s;const a=String(i||"");return/timeout/i.test(a)||/ECONNABORTED/i.test(String(t?.code||""))?"请求超时，请检查网络后重试":/Network Error/i.test(a)?"网络异常，请检查网络连接":e===401?"登录失败：账号或密码不正确":e===403?"登录失败：当前账号无权限":e>=500?"服务器异常，请稍后重试":e?"登录失败，请稍后重试":"登录失败，请检查网络后重试"}async function b(t){const e=E.query.redirect,s=typeof e=="string"&&e.startsWith("/")?e:"";s&&L(t,s)?await g.replace(s):await g.replace(h(t))}R(async()=>{document.body.classList.remove("app-shell-lock"),f.isLoggedIn&&await b(f.roleName)});async function w(){if(p.value)return;const t=String(l.username||"").trim(),e=String(l.password||"");if(!t||!e){m.warning("请输入用户名和密码");return}p.value=!0;try{const s=await F({username:t,password:e}),i=s?.data?.session_token||"",a=s?.data?.user||null,d=a?.role_name||"";if(!i){m.error("登录失败：登录信息异常，请联系管理员");return}if(!d){m.error("登录失败：账号权限信息异常，请联系管理员");return}f.setToken(i),f.setRoleName(d),f.setUser(a),m.success("登录成功"),await b(d)}catch(s){console.error(s),m.error(x(s))}finally{p.value=!1}}return(t,e)=>{const s=u("el-tag"),i=u("el-icon"),a=u("el-input"),d=u("el-form-item"),N=u("el-button"),k=u("el-form"),A=u("el-card");return I(),B("div",z,[e[6]||(e[6]=o("div",{class:"bg-blobs","aria-hidden":"true"},[o("span",{class:"blob b1"})],-1)),o("div",H,[r(A,{class:"login-card",shadow:"never"},{default:n(()=>[o("div",D,[o("div",Z,[e[3]||(e[3]=o("div",{class:"brand-left"},[o("div",{class:"logo-wrap"},[o("img",{src:q,alt:"Logo",class:"logo"})]),o("div",{class:"brand-text"},[o("div",{class:"brand-title"},"订单管理系统"),o("div",{class:"brand-subtitle"},"欢迎回来，请登录继续")])],-1)),r(s,{size:"small",type:"info",class:"brand-tag"},{default:n(()=>[...e[2]||(e[2]=[v("v1",-1)])]),_:1})]),r(k,{class:"login-form",model:l,"label-width":"72px",onKeyup:W(w,["enter"])},{default:n(()=>[r(d,{label:"用户名",class:"form-item"},{default:n(()=>[r(a,{modelValue:l.username,"onUpdate:modelValue":e[0]||(e[0]=_=>l.username=_),autocomplete:"username",placeholder:"请输入用户名",clearable:""},{prefix:n(()=>[r(i,null,{default:n(()=>[r(y(P))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(d,{label:"密码",class:"form-item"},{default:n(()=>[r(a,{modelValue:l.password,"onUpdate:modelValue":e[1]||(e[1]=_=>l.password=_),type:"password","show-password":"",autocomplete:"current-password",placeholder:"请输入密码",clearable:""},{prefix:n(()=>[r(i,null,{default:n(()=>[r(y(U))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(N,{class:"login-btn",type:"primary",loading:p.value,onClick:w},{default:n(()=>[...e[4]||(e[4]=[v(" 登录 ",-1)])]),_:1},8,["loading"]),e[5]||(e[5]=o("div",{class:"footer-note"},"登录即表示你同意系统的使用规范与审计记录。",-1))]),_:1},8,["model"])])]),_:1})])])}}},ae=K(j,[["__scopeId","data-v-cd01feeb"]]);export{ae as default};
