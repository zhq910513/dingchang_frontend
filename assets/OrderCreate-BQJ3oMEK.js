import{b as mt,u as vt}from"./vendor-vue-router-CVyACjsp.js";import{E as J,c as me,a as ve,b as $,d as _t}from"./vendor-element-plus-CtVxZ4Oy.js";import{V as pt,u as ft,p as kt}from"./bosUpload-BV4DaZOI.js";import{h as _e}from"./http-CBIyYC5i.js";import{u as De,c as yt,f as gt}from"./orders-C0J9gWfa.js";import{u as bt,f as Vt}from"./fieldFormat-dj427FSC.js";import{_ as ht}from"./index-C11rPtdm.js";import{r as O,Z as A,c as N,o as wt,q as Ut,Y as xt,x as p,z as l,P as a,H as y,ay as h,G as S,J as z,y as u,L as B,O as T,ac as j,u as r,l as pe,M as G,ai as b}from"./vendor-vue-fFWwKrgY.js";import"./vendor-lodash-rvV0CIkQ.js";import"./vendor-DWCz07M-.js";import"./vendor-dates-DVKSwKij.js";import"./vendor-axios-C0Zqfgkc.js";import"./vendor-pinia-CMXa-Za0.js";const St={class:"order-detail"},Ct={class:"detail-header"},It={class:"header-actions"},Ft={class:"upload-mode"},Et={class:"page-body"},Mt={class:"meta-narrow"},Ot={class:"kv-grid kv-grid-2"},zt={class:"kv-item"},Lt={class:"kv-value"},Nt={class:"kv-item"},Dt={class:"kv-value"},Rt={class:"info-block"},Bt={class:"kv-grid kv-grid-2 info-grid"},Pt={class:"kv-item"},Yt={class:"kv-value"},$t={class:"kv-item"},At={class:"kv-value"},Tt={class:"kv-grid kv-grid-4 info-grid info-grid-compact"},jt={class:"kv-item"},Kt={class:"kv-value"},Gt={class:"kv-item"},Ht={class:"kv-value"},qt={class:"kv-item"},Zt={class:"kv-value"},Jt={class:"kv-item"},Wt={class:"kv-value"},Qt={class:"kv-grid kv-grid-2 info-grid"},Xt={class:"kv-item"},el={class:"kv-value"},tl={class:"kv-grid kv-grid-5 info-grid info-grid-compact"},ll={class:"kv-item"},ol={class:"kv-value"},sl={class:"kv-item"},nl={class:"kv-value"},il={class:"kv-item"},al={class:"kv-value"},dl={class:"kv-item"},rl={class:"kv-value"},ul={class:"kv-item"},cl={class:"kv-value"},ml={class:"kv-grid kv-grid-2 info-grid"},vl={class:"kv-item"},_l={class:"kv-value"},pl={class:"kv-grid kv-grid-5 info-grid info-grid-compact"},fl={class:"kv-item"},kl={class:"kv-value"},yl={class:"kv-item"},gl={class:"kv-value"},bl={class:"kv-item"},Vl={class:"kv-value"},hl={class:"kv-item"},wl={class:"kv-value"},Ul={class:"kv-item"},xl={class:"kv-value"},Sl={class:"kv-grid kv-grid-2 info-grid"},Cl={class:"kv-item"},Il={class:"kv-value"},Fl={class:"kv-grid kv-grid-2 info-grid"},El={class:"kv-item"},Ml={class:"kv-value"},Ol={class:"section-header"},zl={class:"two-col"},Ll={class:"left"},Nl={key:0,class:"kv-grid kv-grid-2"},Dl={class:"kv-item"},Rl={class:"kv-value"},Bl={class:"kv-item"},Pl={class:"kv-value"},Yl={class:"kv-item"},$l={class:"kv-value"},Al={class:"kv-item"},Tl={class:"kv-value"},jl={key:1},Kl={class:"right"},Gl={class:"section-header"},Hl={class:"stack"},ql={class:"sub-block"},Zl={class:"two-col"},Jl={class:"left"},Wl={key:0,class:"kv-grid kv-grid-2"},Ql={class:"kv-item"},Xl={class:"kv-value"},eo={class:"kv-item"},to={class:"kv-value"},lo={key:1,class:"kv-grid kv-grid-2"},oo={class:"kv-label"},so={class:"kv-value"},no={class:"right"},io={class:"sub-block"},ao={class:"two-col"},ro={class:"left"},uo={key:0,class:"kv-grid kv-grid-2"},co={class:"kv-label"},mo={class:"kv-value"},vo={class:"right"},_o={class:"section-header"},po={class:"stack"},fo={class:"sub-block"},ko={class:"two-col"},yo={class:"left"},go={key:0,class:"kv-grid kv-grid-2"},bo={key:0,class:"kv-item"},Vo={class:"kv-value"},ho={key:1,class:"kv-item"},wo={class:"kv-value"},Uo={key:2,class:"kv-item"},xo={class:"kv-value"},So={key:3,class:"kv-item"},Co={class:"kv-value"},Io={key:4,class:"kv-item"},Fo={class:"kv-value"},Eo={key:5,class:"kv-item"},Mo={class:"kv-value"},Oo={key:6,class:"kv-item"},zo={class:"kv-value"},Lo={key:1,class:"kv-grid kv-grid-2"},No={class:"kv-label"},Do={class:"kv-value"},Ro={class:"right"},Bo={class:"sub-block"},Po={class:"two-col"},Yo={class:"left"},$o={key:0,class:"kv-grid kv-grid-2"},Ao={key:0,class:"kv-item"},To={class:"kv-value"},jo={key:1,class:"kv-grid kv-grid-2"},Ko={class:"kv-label"},Go={class:"kv-value"},Ho={class:"right"},qo={class:"section-header"},Zo={class:"section-actions"},Jo={class:"slot-card"},Wo={class:"slot-head"},Qo={class:"slot-tip"},Xo={key:0,class:"preview-wall"},es={key:1,class:"preview-img preview-empty"},ts={class:"preview-meta"},ls=["title"],os={class:"preview-status"},ss={class:"slot-foot"},ns={key:0},is={key:1,class:"muted"},Re="order_import_upload_mode",as={__name:"OrderCreate",setup(ds){const W=mt(),Be=vt(),Q=O(!1),X=O(!1),H=O(!1),q=O(!1),P=O("smart");function Pe(){const t=localStorage.getItem(Re);(t==="smart"||t==="direct"||t==="stable")&&(P.value=t)}function fe(){try{localStorage.setItem(Re,P.value)}catch{}}Pe();function K(t){const e=t?.message||t?.response?.data?.detail||t?.response?.data?.message||"";return String(e||"")}function Ye(t){const e=K(t).toLowerCase();return e.includes("failed to fetch")||e.includes("network error")||e.includes("err_")||e.includes("cors")||e.includes("代理")||e.includes("vpn")||e.includes("hint=浏览器请求可能走了本机代理")||e.includes("127.0.0.1:7890")}let ke=!1;async function $e(){if(ke)return!1;ke=!0;try{return await _t.confirm(`上传被当前网络环境拦截（常见于 VPN/代理/公司网关）。

建议切换到【稳定模式上传】继续，无需任何设置。`,"上传失败（网络拦截）",{confirmButtonText:"切换为稳定模式",cancelButtonText:"继续直传重试",type:"warning",center:!0,distinguishCancelAndClose:!0}),P.value="stable",fe(),!0}catch{return!1}}function Ae(){const t=Be.query?.from;if(typeof t=="string"&&t){let e=t;try{e=decodeURIComponent(t)}catch{e=t}if(e.startsWith("/")){W.push(e);return}}if(window.history.length>1){W.back();return}W.push({path:"/orders/all"})}const ye=O([]),ge=O([]),ee=O(!1),te=O(!1),I=A({channel_group_id:null,customer_group_id:null}),Te=N(()=>!!I.customer_group_id&&!!I.channel_group_id&&R.value===0);function be(t,e){for(const n of e){const i=t?.[n];if(i!=null&&String(i).trim()!=="")return i}return""}function Ve(t){const e=be(t,["channel_code","customer_code","group_code","code","groupCode","group_code_str","groupCodeStr"]),n=be(t,["channel_name","customer_name","group_name","name","groupName"]),i=t?.id!==null&&t?.id!==void 0?String(t.id):"";return e&&n?`${e} - ${n}`:n?String(n):e?String(e):i||"-"}async function je(){ee.value=!0,te.value=!0;try{const[t,e]=await Promise.all([_e.get("/orders/channel-groups"),_e.get("/orders/customer-groups")]);ye.value=Array.isArray(t?.data?.items)?t.data.items:[],ge.value=Array.isArray(e?.data?.items)?e.data.items:[]}catch(t){console.error(t),J.error("加载渠道/客户选项失败")}finally{ee.value=!1,te.value=!1}}const{groups:he,allFields:Ke,loadConfig:Ge}=bt(),He=N(()=>{const t=new Map;for(const e of Ke.value||[])t.set(e.key,e);return t});function U(t){return He.value.get(t)||{key:t,label:t,type:"text",options:[]}}function le(t){return t?.key==="id_number"?"公民身份号码":t?.label||t?.key||""}function we(t){if(t==null||t==="")return t;const e=String(t);return/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:t}function qe(t,e){if(t==null||t==="")return"-";const n=e||{type:"text",options:[]},i=n.type==="date"?we(t):t,d=Vt(i,n);return d===""?"-":d}const v=A({}),Ze=N(()=>(he.value||[]).find(t=>t.group_key==="driving_license")),Je=N(()=>(he.value||[]).find(t=>t.group_key==="driving_attach"));function Ue(t){return t?(t.fields||[]).map(n=>n.field_name).filter(Boolean).map(n=>U(n)):[]}const We=Object.freeze(["id_name","id_gender","id_ethnicity","id_birth_date","id_address","id_number"]),Qe=Object.freeze(["id_issuer","id_validity"]),Xe=N(()=>We.map(t=>U(t))),et=N(()=>Qe.map(t=>U(t))),xe=N(()=>Ue(Ze.value)),Se=N(()=>Ue(Je.value));function D(t,{preferKeys:e=[],labelIncludes:n=[],keyIncludes:i=[]}={}){const d=Array.isArray(t)?t:[];for(const m of e){const k=d.find(c=>c?.key===m);if(k?.key)return k.key}for(const m of i){const k=d.find(c=>String(c?.key||"").toLowerCase().includes(String(m).toLowerCase()));if(k?.key)return k.key}for(const m of n){const k=d.find(c=>String(c?.label||"").includes(String(m)));if(k?.key)return k.key}return null}const tt=N(()=>{const t=xe.value||[];return{plate:D(t,{preferKeys:["dl_plate_no"],keyIncludes:["plate"],labelIncludes:["号牌"]}),owner:D(t,{preferKeys:["dl_owner"],keyIncludes:["owner"],labelIncludes:["所有人"]}),use_nature:D(t,{preferKeys:["dl_use_nature"],keyIncludes:["use_nature","use"],labelIncludes:["使用性质"]}),brand_model:D(t,{preferKeys:["dl_brand_model"],keyIncludes:["brand","model"],labelIncludes:["品牌型号","品牌","型号"]}),vin:D(t,{preferKeys:["dl_vin","vin"],keyIncludes:["vin"],labelIncludes:["识别","车架"]}),engine:D(t,{preferKeys:["dl_engine_no","engine_no"],keyIncludes:["engine"],labelIncludes:["发动机"]}),register_date:D(t,{preferKeys:["dl_register_date","register_date"],keyIncludes:["register","reg_date"],labelIncludes:["注册日期"]})}});function g(t){return tt.value?.[t]||null}const oe=N(()=>{const t=Se.value||[];return D(t,{preferKeys:["dl_approved_passenger_count","approved_passenger_count","dl_passenger_count"],keyIncludes:["passenger","approved"],labelIncludes:["核定载","载人数","载客"]})});function f(t){if(t==null||t==="")return 0;const e=Number(t);return Number.isFinite(e)?e:0}function lt(t){return t==null?"":String(t).trim()}function ae(t){if(!t)return"";const e=String(t).trim();return e?/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:/^\d{4}-\d{2}-\d{2}/.test(e)?e.slice(0,10):e:""}const s=A({insurance_expire_date:"",owner_phone:"",commercial_amount:0,compulsory_amount:0,vehicle_tax_amount:0,non_vehicle_amount:0,premium_total:0,channel_commercial_point:0,channel_compulsory_point:0,channel_vehicle_tax_point:0,channel_non_vehicle_point:0,channel_reward:0,channel_total:0,customer_commercial_point:0,customer_compulsory_point:0,customer_vehicle_tax_point:0,customer_non_vehicle_point:0,customer_reward:0,customer_total:0,profit:0});function Ce(){const t=Math.max(0,f(s.commercial_amount)),e=Math.max(0,f(s.compulsory_amount)),n=Math.max(0,f(s.vehicle_tax_amount)),i=Math.max(0,f(s.non_vehicle_amount));s.commercial_amount=t,s.compulsory_amount=e,s.vehicle_tax_amount=n,s.non_vehicle_amount=i;const d=t+e+n+i,m=f(s.channel_commercial_point),k=f(s.channel_compulsory_point),c=f(s.channel_vehicle_tax_point),_=f(s.channel_non_vehicle_point),F=f(s.channel_reward),Y=f(s.customer_commercial_point),o=f(s.customer_compulsory_point),M=f(s.customer_vehicle_tax_point),ie=f(s.customer_non_vehicle_point),ct=f(s.customer_reward),Le=t*(m/100)+e*(k/100)+n*(c/100)+i*(_/100)+F,Ne=t*(Y/100)+e*(o/100)+n*(M/100)+i*(ie/100)+ct;s.premium_total=d,s.channel_total=Le,s.customer_total=Ne,s.profit=Le-Ne}wt(()=>[s.commercial_amount,s.compulsory_amount,s.vehicle_tax_amount,s.non_vehicle_amount,s.channel_commercial_point,s.channel_compulsory_point,s.channel_vehicle_tax_point,s.channel_non_vehicle_point,s.channel_reward,s.customer_commercial_point,s.customer_compulsory_point,s.customer_vehicle_tax_point,s.customer_non_vehicle_point,s.customer_reward],()=>Ce());function ot(){return{insurance_expire_date:s.insurance_expire_date?ae(s.insurance_expire_date):null,owner_phone:s.owner_phone?lt(s.owner_phone):null,commercial_amount:f(s.commercial_amount),compulsory_amount:f(s.compulsory_amount),vehicle_tax_amount:f(s.vehicle_tax_amount),non_vehicle_amount:f(s.non_vehicle_amount),premium_total:f(s.premium_total),channel_commercial_point:f(s.channel_commercial_point),channel_compulsory_point:f(s.channel_compulsory_point),channel_vehicle_tax_point:f(s.channel_vehicle_tax_point),channel_non_vehicle_point:f(s.channel_non_vehicle_point),channel_reward:f(s.channel_reward),channel_total:f(s.channel_total),customer_commercial_point:f(s.customer_commercial_point),customer_compulsory_point:f(s.customer_compulsory_point),customer_vehicle_tax_point:f(s.customer_vehicle_tax_point),customer_non_vehicle_point:f(s.customer_non_vehicle_point),customer_reward:f(s.customer_reward),customer_total:f(s.customer_total),profit:f(s.profit)}}const de=[{key:"vehicle_cert",label:"合格证",multiple:!1},{key:"idcard_front",label:"身份证正面",multiple:!1},{key:"idcard_back",label:"身份证背面",multiple:!1},{key:"driving_license_main",label:"行驶证主页",multiple:!1},{key:"driving_license_sub",label:"行驶证副页",multiple:!1},{key:"related",label:"相关图片(多张)",multiple:!0}],x=A(de.reduce((t,e)=>(t[e.key]=[],t),{})),L=A({}),C=A({}),R=O(0),E=A({}),re=O("");let se=null,ue=0;function st(t){try{return Date.parse(t)}catch{return 0}}async function nt(){const t=Date.now();if(se&&ue&&t+12e4<ue)return se;const n=(await _e.get("/orders/bos-sts"))?.data;if(!n?.accessKeyId||!n?.secretAccessKey||!n?.sessionToken)throw new Error("bos-sts response invalid");return se=n,re.value=n.bosHost||"",ue=st(n.expiration)||t+600*1e3,se}function it(t){return!!de.find(n=>n.key===t)?.multiple}function at(t){const e=x[t]||[];return e.length?e[0]:null}function Ie(t){const e=t?.raw;if(e&&!t.url){const n=URL.createObjectURL(e);t.url=n,E[t.uid]=n}}function dt(t,e){if(!t||!e)return;const n=t.uid,i=n?E[n]:t.url;if(i){try{URL.revokeObjectURL(i)}catch{}n&&delete E[n]}const d=URL.createObjectURL(e);t.raw=e,t.url=d,n&&(E[n]=d)}function ce(t){const e=x[t]||[];for(const n of e){const i=n?.uid;if(!i)continue;L[i]&&delete L[i],C[i]&&delete C[i];const d=E[i];if(d){try{URL.revokeObjectURL(d)}catch{}delete E[i]}}x[t]=[]}function Fe(t,e){if(!it(t)){ce(t),Ie(e),x[t]=[e],Oe(t,e).catch(i=>{console.error(i),$.error({title:"上传失败",message:K(i)||"unknown error",duration:5e3})});return}const n=x[t]||[];n.find(i=>i.uid===e.uid)||n.push(e),x[t]=n,Ie(e),Oe(t,e).catch(i=>{console.error(i),$.error({title:"上传失败",message:K(i)||"unknown error",duration:5e3})})}function Ee(t,e){const n=x[t]||[];x[t]=n.filter(m=>m.uid!==e.uid);const i=e?.uid;i&&L[i]&&delete L[i],i&&C[i]&&delete C[i];const d=E[i];if(d){try{URL.revokeObjectURL(d)}catch{}delete E[i]}}async function Me(t,e,n){let i=n;try{const d=await kt({file:n,slotKey:t});d?.file&&(i=d.file,dt(e,i),d?.note&&$({title:"已预处理",message:d.note,type:"success",duration:1600}))}catch{i=n}return i}async function Oe(t,e){const n=e?.raw;if(n&&!L[e.uid]){R.value+=1,C[e.uid]={status:"uploading"};try{if(P.value==="stable"){const m=await Me(t,e,n),c=(await De({slot_key:t,file:m}))?.data;L[e.uid]={slot_key:t,md5:c?.md5,storage_key:c?.storage_key,etag:c?.etag||"",size:c?.size||m.size||0,content_type:c?.content_type||m.type||"application/octet-stream",original_name:c?.original_name||m.name||"file",preview_url:c?.preview_url||""},C[e.uid]={status:"done"},$.success({title:"上传完成",message:`${e.name} 已就绪`,duration:2e3});return}const i=await nt();if(!re.value)throw new Error("bosHost missing");const d=await ft({bosHost:re.value,slotKey:t,file:n,sts:i});d?.preprocess_note&&$({title:"已预处理",message:d.preprocess_note,type:"success",duration:1600}),L[e.uid]={slot_key:t,...d,size:d?.size||n.size||0,content_type:d?.content_type||n.type||"application/octet-stream",original_name:d?.original_name||n.name||"file"},C[e.uid]={status:"done"},$.success({title:"上传完成",message:`${e.name} 已就绪`,duration:2e3})}catch(i){if(P.value==="smart"&&Ye(i)&&await $e())try{const m=e?.raw||n,k=await Me(t,e,m),_=(await De({slot_key:t,file:k}))?.data;L[e.uid]={slot_key:t,md5:_?.md5,storage_key:_?.storage_key,etag:_?.etag||"",size:_?.size||k.size||0,content_type:_?.content_type||k.type||"application/octet-stream",original_name:_?.original_name||k.name||"file",preview_url:_?.preview_url||""},C[e.uid]={status:"done"},$.success({title:"上传完成（稳定模式）",message:`${e.name} 已就绪`,duration:2200});return}catch(m){throw C[e.uid]={status:"error",msg:K(m)||"upload failed"},m}throw C[e.uid]={status:"error",msg:K(i)||"upload failed"},i}finally{R.value-=1}}}function ne(t){const e=x[t]||[];let n=0;for(const i of e)L[i.uid]&&(n+=1);return n}function ze(t){return(x[t]||[]).map(n=>n.url).filter(Boolean)}function rt(){const t=[];for(const e of de){const n=x[e.key]||[];for(const i of n){const d=L[i.uid];d&&t.push(d)}}return t}async function ut(){if(!I.customer_group_id||!I.channel_group_id){J.warning("客户和渠道为必选项，请先选择后再保存");return}if(R.value>0){J.warning("还有文件在上传中，请稍后再保存");return}Q.value=!0;try{const t={...v},e=ot(),n=await yt({module:"order",dynamic_data:t,order_info:e,customer_group_id:I.customer_group_id??void 0,channel_group_id:I.channel_group_id??void 0}),d=(n?.data?.data??n?.data??n)?.order_id;if(!d)throw new Error("draft missing order_id");const m=rt();await gt({order_id:d,images:m,dynamic_data:t,order_info:e,customer_group_id:I.customer_group_id??void 0,channel_group_id:I.channel_group_id??void 0}),J.success("创建成功"),W.push({path:`/orders/${d}`})}catch(t){console.error(t),J.error(K(t)||"保存失败")}finally{Q.value=!1}}Ut(async()=>{await Ge("order"),await je(),Ce()}),xt(()=>{for(const t of Object.keys(E)){try{URL.revokeObjectURL(E[t])}catch{}delete E[t]}});const w=pe({name:"FieldValue",props:{modelValue:{type:[String,Number,Date],default:""},field:{type:Object,required:!0},editable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:e}){const n=h("el-input"),i=h("el-select"),d=h("el-option"),m=h("el-date-picker"),k=c=>e("update:modelValue",c);return()=>{const c=t.field||{type:"text",options:[]},_=t.modelValue??"",F=qe(_,c);if(!t.editable)return b("span",{class:"plain-value",title:F},F);if(c.type==="date"){const Y=we(_)??"";return b(m,{modelValue:Y,"onUpdate:modelValue":k,type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}if(c.type==="select"){const Y=Array.isArray(c.options)?c.options:[];return b(i,{modelValue:_,"onUpdate:modelValue":k,filterable:!0,clearable:!0,class:"fv fv-select"},()=>Y.map(o=>{const M=o&&typeof o=="object"?o.label:String(o),ie=o&&typeof o=="object"?o.value:o;return b(d,{key:String(ie),label:M,value:ie})}))}return b(n,{modelValue:_,"onUpdate:modelValue":k,clearable:!0,class:"fv fv-input"})}}}),V=pe({name:"InfoValue",props:{modelValue:{type:[String,Number],default:""},type:{type:String,default:"text"},editable:{type:Boolean,default:!1},min:{type:Number,default:void 0},max:{type:Number,default:void 0}},emits:["update:modelValue"],setup(t,{emit:e}){const n=h("el-input"),i=h("el-date-picker"),d=h("el-input-number"),m=c=>e("update:modelValue",c);function k(c){if(c==null||c==="")return"-";const _=Number(c);return t.type==="money"?Number.isFinite(_)?_.toFixed(2):"-":t.type==="point"?Number.isFinite(_)?String(_):"-":t.type==="date"?ae(c)||"-":String(c)}return()=>{const c=t.modelValue??"";if(!t.editable){const _=k(c);return b("span",{class:"plain-value",title:_},_)}if(t.type==="date"){const _=ae(c);return b(i,{modelValue:_,"onUpdate:modelValue":m,type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}if(t.type==="money"||t.type==="point"){const _=c===""||c===null||c===void 0?void 0:Number(c);return b(d,{modelValue:Number.isFinite(_)?_:void 0,"onUpdate:modelValue":m,controls:!1,precision:t.type==="money"?2:void 0,step:t.type==="money"?1:.1,min:typeof t.min=="number"?t.min:void 0,max:typeof t.max=="number"?t.max:void 0,class:"fv fv-number"})}return b(n,{modelValue:c,"onUpdate:modelValue":m,clearable:!0,class:"fv fv-input"})}}}),Z=pe({name:"SlotUploadCard",props:{slotKey:{type:String,required:!0},label:{type:String,default:""},multiple:{type:Boolean,default:!1}},setup(t){const e=h("el-upload"),n=h("el-image"),i=h("el-button"),d=h("el-tag");return()=>{const m=t.slotKey,k=t.label||m,c=x[m]||[],_=at(m);return b("div",{class:"slot-card"},[b("div",{class:"slot-head"},[b("div",{class:"slot-name"},k),b("div",{class:"slot-tip"},[b(d,{size:"small",type:"info",effect:"plain"},()=>"单张")])]),b(e,{drag:!0,autoUpload:!1,multiple:!1,showFileList:!1,fileList:c,accept:"image/*",class:"upload-box upload-one",onChange:F=>Fe(m,F),onRemove:F=>Ee(m,F)},{default:()=>_?b("div",{class:"one-wrap"},[b(n,{src:_?.url,previewSrcList:ze(m),fit:"contain",class:"one-img"}),b("div",{class:"one-mask"},[b("div",{class:"one-mask-text"},"拖拽或点击替换"),b(i,{size:"small",type:"danger",plain:!0,class:"one-remove",onClick:F=>{F?.stopPropagation?.(),ce(m)}},()=>"移除")])]):b("div",{class:"upload-empty"},[b("div",{class:"empty-center"},[b("div",{class:"empty-title"},"拖拽图片到此处"),b("div",{class:"empty-sub"},"或点击选择文件")])])}),b("div",{class:"slot-foot"},[ne(m)>0?b("span",null,`已就绪：${ne(m)} 张`):b("span",{class:"muted"},"未上传")])])}}});return(t,e)=>{const n=h("el-option"),i=h("el-select"),d=h("el-button"),m=h("el-alert"),k=h("el-card"),c=h("el-icon"),_=h("el-tag"),F=h("el-upload"),Y=h("el-image");return u(),p("div",St,[l("div",Ct,[e[44]||(e[44]=l("h2",null,"手动创建订单",-1)),l("div",It,[l("div",Ft,[e[41]||(e[41]=l("span",{class:"upload-mode-label"},"上传模式",-1)),a(i,{modelValue:P.value,"onUpdate:modelValue":e[0]||(e[0]=o=>P.value=o),size:"small",style:{width:"150px"},onChange:fe},{default:y(()=>[a(n,{label:"智能（推荐）",value:"smart"}),a(n,{label:"直传（更快）",value:"direct"}),a(n,{label:"稳定（兼容VPN）",value:"stable"})]),_:1},8,["modelValue"])]),a(d,{size:"small",onClick:Ae},{default:y(()=>[...e[42]||(e[42]=[B("返回",-1)])]),_:1}),a(d,{size:"small",type:"primary",loading:Q.value,disabled:R.value>0||!Te.value,onClick:ut},{default:y(()=>[...e[43]||(e[43]=[B(" 保存 ",-1)])]),_:1},8,["loading","disabled"])])]),l("div",Et,[R.value>0?(u(),S(m,{key:0,class:"upload-alert",type:"warning",closable:!1,"show-icon":"",title:"正在上传",description:`正在上传 ${R.value} 个文件…（全部上传完成后才能保存）`},null,8,["description"])):z("",!0),a(k,{shadow:"never",class:"section-card"},{header:y(()=>[...e[45]||(e[45]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"渠道、客户")],-1)])]),default:y(()=>[l("div",Mt,[l("div",Ot,[l("div",zt,[e[46]||(e[46]=l("div",{class:"kv-label"},"渠道",-1)),l("div",Lt,[a(i,{modelValue:I.channel_group_id,"onUpdate:modelValue":e[1]||(e[1]=o=>I.channel_group_id=o),filterable:"",clearable:"",placeholder:"请选择渠道（必选）",class:"fv fv-select",loading:ee.value,disabled:ee.value},{default:y(()=>[(u(!0),p(T,null,j(ye.value,o=>(u(),S(n,{key:String(o.id),label:Ve(o),value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])])]),l("div",Nt,[e[47]||(e[47]=l("div",{class:"kv-label"},"客户",-1)),l("div",Dt,[a(i,{modelValue:I.customer_group_id,"onUpdate:modelValue":e[2]||(e[2]=o=>I.customer_group_id=o),filterable:"",clearable:"",placeholder:"请选择客户（必选）",class:"fv fv-select",loading:te.value,disabled:te.value},{default:y(()=>[(u(!0),p(T,null,j(ge.value,o=>(u(),S(n,{key:String(o.id),label:Ve(o),value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])])])])])]),_:1}),a(k,{shadow:"never",class:"section-card"},{header:y(()=>[...e[48]||(e[48]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"订单信息")],-1)])]),default:y(()=>[l("div",Rt,[l("div",Bt,[l("div",Pt,[e[49]||(e[49]=l("div",{class:"kv-label"},"保险到期日",-1)),l("div",Yt,[a(r(V),{modelValue:s.insurance_expire_date,"onUpdate:modelValue":e[3]||(e[3]=o=>s.insurance_expire_date=o),type:"date",editable:!0},null,8,["modelValue"])])]),l("div",$t,[e[50]||(e[50]=l("div",{class:"kv-label"},"车主电话",-1)),l("div",At,[a(r(V),{modelValue:s.owner_phone,"onUpdate:modelValue":e[4]||(e[4]=o=>s.owner_phone=o),type:"text",editable:!0},null,8,["modelValue"])])])]),l("div",Tt,[l("div",jt,[e[51]||(e[51]=l("div",{class:"kv-label"},"商业金额",-1)),l("div",Kt,[a(r(V),{modelValue:s.commercial_amount,"onUpdate:modelValue":e[5]||(e[5]=o=>s.commercial_amount=o),type:"money",editable:!0,min:0},null,8,["modelValue"])])]),l("div",Gt,[e[52]||(e[52]=l("div",{class:"kv-label"},"交强金额",-1)),l("div",Ht,[a(r(V),{modelValue:s.compulsory_amount,"onUpdate:modelValue":e[6]||(e[6]=o=>s.compulsory_amount=o),type:"money",editable:!0,min:0},null,8,["modelValue"])])]),l("div",qt,[e[53]||(e[53]=l("div",{class:"kv-label"},"车船税金额",-1)),l("div",Zt,[a(r(V),{modelValue:s.vehicle_tax_amount,"onUpdate:modelValue":e[7]||(e[7]=o=>s.vehicle_tax_amount=o),type:"money",editable:!0,min:0},null,8,["modelValue"])])]),l("div",Jt,[e[54]||(e[54]=l("div",{class:"kv-label"},"非车金额",-1)),l("div",Wt,[a(r(V),{modelValue:s.non_vehicle_amount,"onUpdate:modelValue":e[8]||(e[8]=o=>s.non_vehicle_amount=o),type:"money",editable:!0,min:0},null,8,["modelValue"])])])]),l("div",Qt,[l("div",Xt,[e[55]||(e[55]=l("div",{class:"kv-label"},"保费金额",-1)),l("div",el,[a(r(V),{modelValue:s.premium_total,"onUpdate:modelValue":e[9]||(e[9]=o=>s.premium_total=o),type:"money",editable:!1},null,8,["modelValue"])])])])]),e[69]||(e[69]=l("div",{class:"split-title"},"渠道",-1)),l("div",tl,[l("div",ll,[e[56]||(e[56]=l("div",{class:"kv-label"},"商业点位%",-1)),l("div",ol,[a(r(V),{modelValue:s.channel_commercial_point,"onUpdate:modelValue":e[10]||(e[10]=o=>s.channel_commercial_point=o),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",sl,[e[57]||(e[57]=l("div",{class:"kv-label"},"交强点位%",-1)),l("div",nl,[a(r(V),{modelValue:s.channel_compulsory_point,"onUpdate:modelValue":e[11]||(e[11]=o=>s.channel_compulsory_point=o),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",il,[e[58]||(e[58]=l("div",{class:"kv-label"},"车船税点位%",-1)),l("div",al,[a(r(V),{modelValue:s.channel_vehicle_tax_point,"onUpdate:modelValue":e[12]||(e[12]=o=>s.channel_vehicle_tax_point=o),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",dl,[e[59]||(e[59]=l("div",{class:"kv-label"},"非车点位%",-1)),l("div",rl,[a(r(V),{modelValue:s.channel_non_vehicle_point,"onUpdate:modelValue":e[13]||(e[13]=o=>s.channel_non_vehicle_point=o),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",ul,[e[60]||(e[60]=l("div",{class:"kv-label"},"出单奖励",-1)),l("div",cl,[a(r(V),{modelValue:s.channel_reward,"onUpdate:modelValue":e[14]||(e[14]=o=>s.channel_reward=o),type:"money",editable:!0},null,8,["modelValue"])])])]),l("div",ml,[l("div",vl,[e[61]||(e[61]=l("div",{class:"kv-label"},"渠道合计",-1)),l("div",_l,[a(r(V),{modelValue:s.channel_total,"onUpdate:modelValue":e[15]||(e[15]=o=>s.channel_total=o),type:"money",editable:!1},null,8,["modelValue"])])])]),e[70]||(e[70]=l("div",{class:"split-title"},"客户",-1)),l("div",pl,[l("div",fl,[e[62]||(e[62]=l("div",{class:"kv-label"},"商业点位%",-1)),l("div",kl,[a(r(V),{modelValue:s.customer_commercial_point,"onUpdate:modelValue":e[16]||(e[16]=o=>s.customer_commercial_point=o),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",yl,[e[63]||(e[63]=l("div",{class:"kv-label"},"交强点位%",-1)),l("div",gl,[a(r(V),{modelValue:s.customer_compulsory_point,"onUpdate:modelValue":e[17]||(e[17]=o=>s.customer_compulsory_point=o),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",bl,[e[64]||(e[64]=l("div",{class:"kv-label"},"车船税点位%",-1)),l("div",Vl,[a(r(V),{modelValue:s.customer_vehicle_tax_point,"onUpdate:modelValue":e[18]||(e[18]=o=>s.customer_vehicle_tax_point=o),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",hl,[e[65]||(e[65]=l("div",{class:"kv-label"},"非车点位%",-1)),l("div",wl,[a(r(V),{modelValue:s.customer_non_vehicle_point,"onUpdate:modelValue":e[19]||(e[19]=o=>s.customer_non_vehicle_point=o),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",Ul,[e[66]||(e[66]=l("div",{class:"kv-label"},"出单奖励",-1)),l("div",xl,[a(r(V),{modelValue:s.customer_reward,"onUpdate:modelValue":e[20]||(e[20]=o=>s.customer_reward=o),type:"money",editable:!0},null,8,["modelValue"])])])]),l("div",Sl,[l("div",Cl,[e[67]||(e[67]=l("div",{class:"kv-label"},"客户合计",-1)),l("div",Il,[a(r(V),{modelValue:s.customer_total,"onUpdate:modelValue":e[21]||(e[21]=o=>s.customer_total=o),type:"money",editable:!1},null,8,["modelValue"])])])]),l("div",Fl,[l("div",El,[e[68]||(e[68]=l("div",{class:"kv-label"},"利润",-1)),l("div",Ml,[a(r(V),{modelValue:s.profit,"onUpdate:modelValue":e[22]||(e[22]=o=>s.profit=o),type:"money",editable:!1},null,8,["modelValue"])])])])]),_:1}),a(k,{shadow:"never",class:"section-card"},{header:y(()=>[l("div",Ol,[e[71]||(e[71]=l("div",{class:"section-title"},"车辆合格证",-1)),a(d,{class:"icon-btn",circle:"",size:"small",onClick:e[23]||(e[23]=o=>X.value=!X.value)},{default:y(()=>[a(c,null,{default:y(()=>[X.value?(u(),S(r(me),{key:0})):(u(),S(r(ve),{key:1}))]),_:1})]),_:1})])]),default:y(()=>[l("div",zl,[l("div",Ll,[X.value?(u(),p("div",jl,[a(pt,{data:v,readonly:!1},null,8,["data"])])):(u(),p("div",Nl,[l("div",Dl,[e[72]||(e[72]=l("div",{class:"kv-label"},"车辆型号",-1)),l("div",Rl,[a(r(w),{modelValue:v.vehicle_model,"onUpdate:modelValue":e[24]||(e[24]=o=>v.vehicle_model=o),field:U("vehicle_model"),editable:!0},null,8,["modelValue","field"])])]),l("div",Bl,[e[73]||(e[73]=l("div",{class:"kv-label"},"车辆识别代号/车架号",-1)),l("div",Pl,[a(r(w),{modelValue:v.vin,"onUpdate:modelValue":e[25]||(e[25]=o=>v.vin=o),field:U("vin"),editable:!0},null,8,["modelValue","field"])])]),l("div",Yl,[e[74]||(e[74]=l("div",{class:"kv-label"},"发动机号",-1)),l("div",$l,[a(r(w),{modelValue:v.engine_no,"onUpdate:modelValue":e[26]||(e[26]=o=>v.engine_no=o),field:U("engine_no"),editable:!0},null,8,["modelValue","field"])])]),l("div",Al,[e[75]||(e[75]=l("div",{class:"kv-label"},"额定载客(人 )",-1)),l("div",Tl,[a(r(w),{modelValue:v.approved_passenger_count,"onUpdate:modelValue":e[27]||(e[27]=o=>v.approved_passenger_count=o),field:U("approved_passenger_count"),editable:!0},null,8,["modelValue","field"])])])]))]),l("div",Kl,[a(r(Z),{"slot-key":"vehicle_cert",label:"合格证",multiple:!1})])])]),_:1}),a(k,{shadow:"never",class:"section-card"},{header:y(()=>[l("div",Gl,[e[76]||(e[76]=l("div",{class:"section-title"},"身份证正面/身份证背面",-1)),a(d,{class:"icon-btn",circle:"",size:"small",onClick:e[28]||(e[28]=o=>H.value=!H.value)},{default:y(()=>[a(c,null,{default:y(()=>[H.value?(u(),S(r(me),{key:0})):(u(),S(r(ve),{key:1}))]),_:1})]),_:1})])]),default:y(()=>[l("div",Hl,[l("div",ql,[e[79]||(e[79]=l("div",{class:"sub-title"},"身份证正面",-1)),l("div",Zl,[l("div",Jl,[H.value?(u(),p("div",lo,[(u(!0),p(T,null,j(Xe.value,o=>(u(),p("div",{key:o.key,class:"kv-item"},[l("div",oo,G(le(o)),1),l("div",so,[a(r(w),{modelValue:v[o.key],"onUpdate:modelValue":M=>v[o.key]=M,field:o,editable:!0},null,8,["modelValue","onUpdate:modelValue","field"])])]))),128))])):(u(),p("div",Wl,[l("div",Ql,[e[77]||(e[77]=l("div",{class:"kv-label"},"姓名",-1)),l("div",Xl,[a(r(w),{modelValue:v.id_name,"onUpdate:modelValue":e[29]||(e[29]=o=>v.id_name=o),field:U("id_name"),editable:!0},null,8,["modelValue","field"])])]),l("div",eo,[e[78]||(e[78]=l("div",{class:"kv-label"},"公民身份号码",-1)),l("div",to,[a(r(w),{modelValue:v.id_number,"onUpdate:modelValue":e[30]||(e[30]=o=>v.id_number=o),field:U("id_number"),editable:!0},null,8,["modelValue","field"])])])]))]),l("div",no,[a(r(Z),{"slot-key":"idcard_front",label:"身份证正面",multiple:!1})])])]),l("div",io,[e[80]||(e[80]=l("div",{class:"sub-title"},"身份证背面",-1)),l("div",ao,[l("div",ro,[H.value?(u(),p("div",uo,[(u(!0),p(T,null,j(et.value,o=>(u(),p("div",{key:o.key,class:"kv-item"},[l("div",co,G(le(o)),1),l("div",mo,[a(r(w),{modelValue:v[o.key],"onUpdate:modelValue":M=>v[o.key]=M,field:o,editable:!0},null,8,["modelValue","onUpdate:modelValue","field"])])]))),128))])):z("",!0)]),l("div",vo,[a(r(Z),{"slot-key":"idcard_back",label:"身份证背面",multiple:!1})])])])])]),_:1}),a(k,{shadow:"never",class:"section-card"},{header:y(()=>[l("div",_o,[e[81]||(e[81]=l("div",{class:"section-title"},"行驶证/行驶证副件",-1)),a(d,{class:"icon-btn",circle:"",size:"small",onClick:e[31]||(e[31]=o=>q.value=!q.value)},{default:y(()=>[a(c,null,{default:y(()=>[q.value?(u(),S(r(me),{key:0})):(u(),S(r(ve),{key:1}))]),_:1})]),_:1})])]),default:y(()=>[l("div",po,[l("div",fo,[e[89]||(e[89]=l("div",{class:"sub-title"},"行驶证",-1)),l("div",ko,[l("div",yo,[q.value?(u(),p("div",Lo,[(u(!0),p(T,null,j(xe.value,o=>(u(),p("div",{key:o.key,class:"kv-item"},[l("div",No,G(le(o)),1),l("div",Do,[a(r(w),{modelValue:v[o.key],"onUpdate:modelValue":M=>v[o.key]=M,field:o,editable:!0},null,8,["modelValue","onUpdate:modelValue","field"])])]))),128))])):(u(),p("div",go,[g("plate")?(u(),p("div",bo,[e[82]||(e[82]=l("div",{class:"kv-label"},"号牌号码",-1)),l("div",Vo,[a(r(w),{modelValue:v[g("plate")],"onUpdate:modelValue":e[32]||(e[32]=o=>v[g("plate")]=o),field:U(g("plate")),editable:!0},null,8,["modelValue","field"])])])):z("",!0),g("owner")?(u(),p("div",ho,[e[83]||(e[83]=l("div",{class:"kv-label"},"所有人",-1)),l("div",wo,[a(r(w),{modelValue:v[g("owner")],"onUpdate:modelValue":e[33]||(e[33]=o=>v[g("owner")]=o),field:U(g("owner")),editable:!0},null,8,["modelValue","field"])])])):z("",!0),g("use_nature")?(u(),p("div",Uo,[e[84]||(e[84]=l("div",{class:"kv-label"},"使用性质",-1)),l("div",xo,[a(r(w),{modelValue:v[g("use_nature")],"onUpdate:modelValue":e[34]||(e[34]=o=>v[g("use_nature")]=o),field:U(g("use_nature")),editable:!0},null,8,["modelValue","field"])])])):z("",!0),g("brand_model")?(u(),p("div",So,[e[85]||(e[85]=l("div",{class:"kv-label"},"品牌型号",-1)),l("div",Co,[a(r(w),{modelValue:v[g("brand_model")],"onUpdate:modelValue":e[35]||(e[35]=o=>v[g("brand_model")]=o),field:U(g("brand_model")),editable:!0},null,8,["modelValue","field"])])])):z("",!0),g("vin")?(u(),p("div",Io,[e[86]||(e[86]=l("div",{class:"kv-label"},"车辆识别代码",-1)),l("div",Fo,[a(r(w),{modelValue:v[g("vin")],"onUpdate:modelValue":e[36]||(e[36]=o=>v[g("vin")]=o),field:U(g("vin")),editable:!0},null,8,["modelValue","field"])])])):z("",!0),g("engine")?(u(),p("div",Eo,[e[87]||(e[87]=l("div",{class:"kv-label"},"发动机号码",-1)),l("div",Mo,[a(r(w),{modelValue:v[g("engine")],"onUpdate:modelValue":e[37]||(e[37]=o=>v[g("engine")]=o),field:U(g("engine")),editable:!0},null,8,["modelValue","field"])])])):z("",!0),g("register_date")?(u(),p("div",Oo,[e[88]||(e[88]=l("div",{class:"kv-label"},"注册日期",-1)),l("div",zo,[a(r(w),{modelValue:v[g("register_date")],"onUpdate:modelValue":e[38]||(e[38]=o=>v[g("register_date")]=o),field:U(g("register_date")),editable:!0},null,8,["modelValue","field"])])])):z("",!0)]))]),l("div",Ro,[a(r(Z),{"slot-key":"driving_license_main",label:"行驶证主页",multiple:!1})])])]),l("div",Bo,[e[91]||(e[91]=l("div",{class:"sub-title"},"行驶证副件",-1)),l("div",Po,[l("div",Yo,[q.value?(u(),p("div",jo,[(u(!0),p(T,null,j(Se.value,o=>(u(),p("div",{key:o.key,class:"kv-item"},[l("div",Ko,G(le(o)),1),l("div",Go,[a(r(w),{modelValue:v[o.key],"onUpdate:modelValue":M=>v[o.key]=M,field:o,editable:!0},null,8,["modelValue","onUpdate:modelValue","field"])])]))),128))])):(u(),p("div",$o,[oe.value?(u(),p("div",Ao,[e[90]||(e[90]=l("div",{class:"kv-label"},"核定载人数",-1)),l("div",To,[a(r(w),{modelValue:v[oe.value],"onUpdate:modelValue":e[39]||(e[39]=o=>v[oe.value]=o),field:U(oe.value),editable:!0},null,8,["modelValue","field"])])])):z("",!0)]))]),l("div",Ho,[a(r(Z),{"slot-key":"driving_license_sub",label:"行驶证副页",multiple:!1})])])])])]),_:1}),a(k,{shadow:"never",class:"section-card"},{header:y(()=>[l("div",qo,[e[93]||(e[93]=l("div",{class:"section-title"},"相关图片(多张)",-1)),l("div",Zo,[a(d,{size:"small",onClick:e[40]||(e[40]=o=>ce("related")),disabled:Q.value||R.value>0},{default:y(()=>[...e[92]||(e[92]=[B(" 清空图片 ",-1)])]),_:1},8,["disabled"])])])]),default:y(()=>[l("div",Jo,[l("div",Wo,[e[95]||(e[95]=l("div",{class:"slot-name"},"相关图片(多张)",-1)),l("div",Qo,[a(_,{size:"small",type:"info",effect:"plain"},{default:y(()=>[...e[94]||(e[94]=[B("可多张",-1)])]),_:1})])]),a(F,{drag:"","auto-upload":!1,multiple:!0,limit:20,"file-list":x.related,"on-change":o=>Fe("related",o),"on-remove":o=>Ee("related",o),accept:"image/*",class:"upload-box upload-multi"},{default:y(()=>[...e[96]||(e[96]=[l("div",{class:"upload-empty"},[l("div",{class:"empty-center"},[l("div",{class:"empty-title"},"拖拽图片到此处"),l("div",{class:"empty-sub"},"或点击选择文件（可多张）")])],-1)])]),_:1},8,["file-list","on-change","on-remove"]),(x.related||[]).length?(u(),p("div",Xo,[(u(!0),p(T,null,j(x.related,o=>(u(),p("div",{key:o.uid,class:"preview-item"},[o.url?(u(),S(Y,{key:0,src:o.url,"preview-src-list":ze("related"),fit:"cover",class:"preview-img"},null,8,["src","preview-src-list"])):(u(),p("div",es)),l("div",ts,[l("div",{class:"preview-name",title:o.name},G(o.name),9,ls),l("div",os,[C[o.uid]?.status==="uploading"?(u(),S(_,{key:0,size:"small",type:"warning"},{default:y(()=>[...e[97]||(e[97]=[B("上传中",-1)])]),_:1})):C[o.uid]?.status==="done"?(u(),S(_,{key:1,size:"small",type:"success"},{default:y(()=>[...e[98]||(e[98]=[B("已就绪",-1)])]),_:1})):C[o.uid]?.status==="error"?(u(),S(_,{key:2,size:"small",type:"danger"},{default:y(()=>[...e[99]||(e[99]=[B("失败",-1)])]),_:1})):(u(),S(_,{key:3,size:"small",type:"info",effect:"plain"},{default:y(()=>[...e[100]||(e[100]=[B("待上传",-1)])]),_:1}))])])]))),128))])):z("",!0),l("div",ss,[ne("related")>0?(u(),p("span",ns,"已就绪："+G(ne("related"))+" 张",1)):(u(),p("span",is,"未上传"))])])]),_:1})])])}}},hs=ht(as,[["__scopeId","data-v-bbe1888d"]]);export{hs as default};
