import{c as A,r as V,o as ln,q as on,x as g,y as d,z as ee,P as a,M as f,H as l,ay as S,O as R,ac as O,ap as $,G as v,J as C,L as s,X as te,I as rn,aI as un,u as Ke}from"./vendor-vue-fFWwKrgY.js";import{u as sn,b as dn}from"./vendor-vue-router-CVyACjsp.js";import{f as Je,E as y,d as ne}from"./vendor-element-plus-CtVxZ4Oy.js";import{h as cn,l as mn,d as fn,e as _n,b as pn,i as vn}from"./orders-DVGDUW2c.js";import{l as bn,a as hn,b as gn,c as yn,d as wn,r as kn,e as Sn,h as Ze}from"./finance-D7CYzIUW.js";import{_ as Vn,u as Nn,R as h}from"./index-DLy_C7Pe.js";const An={class:"page"},Cn={class:"page-header"},xn={class:"finance-actions"},Rn={class:"table-scroll"},Fn={key:0,class:"switch-cell"},Mn={key:1},Un={key:0,class:"switch-cell"},Bn={key:1},En={key:0},In={key:1,class:"actions"},Tn={key:2,class:"actions"},Dn={class:"pagination-wrapper"},On={__name:"OrderListBase",props:{title:{type:String,default:"订单列表"},mode:{type:String,default:"all"},source:{type:String,default:"orders"}},setup(ye){const we=ye,ke=dn(),Se=sn(),P=Nn(),qe=A(()=>{const t=Number(P?.user?.id??0);return Number.isFinite(t)?Math.trunc(t):0}),_=A(()=>String(Se?.path||"").startsWith("/finance")),He=A(()=>!_.value),Y=A(()=>String(P.roleName||"").trim().toLowerCase()),ie=A(()=>Y.value===h.SALES),ue=A(()=>{const t=Y.value;return t===h.SUPER_ADMIN||t===h.MANAGER||t===h.FINANCE||t===h.MARKET}),J=A(()=>{if(!_.value)return!1;const t=Y.value;return t===h.FINANCE||t===h.SUPER_ADMIN||t===h.MANAGER}),Ve=A(()=>{if(!_.value)return!1;const t=Y.value;return t===h.FINANCE||t===h.SUPER_ADMIN||t===h.MANAGER}),We=A(()=>{if(!_.value)return!1;const t=Y.value;return t===h.MANAGER||t===h.SUPER_ADMIN}),F=V(!1),H=V(!1),se=V([]),de=V(0),Z=V(1),ce=V(20),me=V([]),fe=V([]),E=V([]),M=V(!1),q=V(!1),L=V([]),z=V(!1),G=V(null),W=V("");function m(t){return!!t?._is_summary}function Xe({row:t}){return m(t)?"row-summary":""}function Ne(){return{owner_name:"",id_number:"",vin:"",engine_no:"",plate_no:"",vehicle_model:"",remark:"",customer_group_id:null,channel_group_id:null,salesperson_id:null,team_name:null,created_date:[]}}function Ae(){return{created_date:[],channel_group_id:null,customer_group_id:null,salesperson_id:null,market:"",owner_name:"",insurance_expire_date:"",first_register_date:[],is_paid:null,is_rebate:null,team_names:[]}}const u=V(_.value?Ae():Ne()),Ce=A({get(){const t=u.value?.team_names;return Array.isArray(t)&&t[0]||null},set(t){const e=String(t??"").trim();u.value.team_names=e?[e]:[]}});function Qe(t,e){const r=t?.dynamic_data;return r&&typeof r=="object"?r[e]:void 0}function j(t){return String(t??"").trim()}function ae(t){return j(t?.group_name)||(t?.id!=null?String(t.id):"-")}function xe(t){if(t==null||t==="")return null;const e=Number(t);return Number.isFinite(e)?e:null}function X(t){const e=xe(t);return e===null?"-":e.toFixed(2)}function et(t){const e=xe(t);return e===null?"-":String(e)}function Re(t){if(t==null||t==="")return"-";const e=String(t).trim();if(!e)return"-";if(/^\d{8}$/.test(e))return`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`;const r=e.match(/^(\d{4}-\d{2}-\d{2})/);if(r&&r[1])return r[1];if(/^\d+$/.test(e)){const o=Number(e);if(Number.isFinite(o)){const i=e.length===10?o*1e3:o,p=new Date(i);if(Number.isFinite(p.getTime())){const b=new Intl.DateTimeFormat("zh-CN",{timeZone:"Asia/Shanghai",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(p),N=b.find(B=>B.type==="year")?.value||"",w=b.find(B=>B.type==="month")?.value||"",k=b.find(B=>B.type==="day")?.value||"";if(N&&w&&k)return`${N}-${w}-${k}`}}return"-"}return"-"}function Fe(t){if(t==null||t==="")return"";const e=String(t).trim();if(!e)return"";if(/^\d{8}$/.test(e))return`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`;const r=e.match(/^(\d{4}-\d{2}-\d{2})/);if(r&&r[1])return r[1];const o=Re(e);return o==="-"?"":o}function I(t){const e=t?.order_info;return e&&typeof e=="object"?e:null}const tt=A(()=>{const t=new Map,e=Array.isArray(E.value)?E.value:[];for(const r of e){const o=Number(r?.id);!Number.isFinite(o)||o<=0||t.set(o,r)}return t});function nt(t){const e=Number(t?.salesperson_id);return!Number.isFinite(e)||e<=0?null:tt.value.get(e)||null}function at(t){const e=Array.isArray(t)?t:[],r=[...new Set(e.map(o=>String(o||"").trim()).filter(Boolean))];return r.length?r.join("、"):""}function le(t){const e=t?.data??t??{};return Array.isArray(e?.items)?e.items:[]}function lt(t){const e=t?.data??t??{},r=Array.isArray(e?.items)?e.items:[],o=[];for(const i of r){const p=String(i?.team_name??"").trim();p&&o.push(p)}return Array.from(new Set(o)).sort((i,p)=>String(i).localeCompare(String(p),"zh-CN"))}async function ot(t={}){return vn(t)}async function rt(){return _.value?hn():fn()}async function it(){return _.value?gn():_n()}async function _e(t){q.value=!0;try{if(_.value){const o=await yn();E.value=le(o);return}const e=String(t||"").trim(),r=await ot(e?{team_name:e}:{});E.value=le(r)}catch(e){console.error(e),E.value=[]}finally{q.value=!1}}const Me=A(()=>Array.isArray(E.value)?E.value:[]);function Ue(){const t=[P?.userId,P?.user_id,P?.id,P?.user?.id,P?.user?.user_id,P?.user?.uid];for(const e of t){const r=Number(e);if(Number.isFinite(r)&&r>0)return r}return null}function Be(){if(_.value||!ie.value)return;const t=Ue();t&&(u.value.salesperson_id=t),!u.value.team_name&&Array.isArray(L.value)&&L.value.length===1&&(u.value.team_name=L.value[0])}async function ut(t){if(_.value)return;const e=u.value?.salesperson_id;if(!ie.value)u.value.salesperson_id=null;else{const r=Ue();r&&(u.value.salesperson_id=r)}await _e(t),!ie.value&&e&&(Array.isArray(E.value)?E.value:[]).some(o=>Number(o?.id)===Number(e))&&(u.value.salesperson_id=e)}async function st(){M.value=!0,z.value=!0;const t=[rt(),it(),cn()],e=await Promise.allSettled(t),r=e[0];me.value=r?.status==="fulfilled"?le(r.value):[],r?.status!=="fulfilled"&&console.error(r?.reason);const o=e[1];fe.value=o?.status==="fulfilled"?le(o.value):[],o?.status!=="fulfilled"&&console.error(o?.reason);const i=e[2];L.value=i?.status==="fulfilled"?lt(i.value):[],i?.status!=="fulfilled"&&console.error(i?.reason),M.value=!1,z.value=!1,Be(),await _e(u.value?.team_name)}async function dt(){if(!_.value)return;const t=ze(),e=Wt(t);if(!(e&&e===W.value&&G.value))try{const r=await wn(t),o=r?.data??r??{};G.value=o&&typeof o=="object"?o:null,W.value=e||""}catch(r){console.error(r),G.value=null,W.value=e||""}}async function T(){F.value=!0;try{const t=_.value?await bn(ge()):await mn(ge()),e=t?.data??t??{};se.value=Array.isArray(e?.items)?e.items:[],de.value=Number(e?.total??0),_.value&&await dt()}catch(t){console.error(t),y.error(_.value?"加载财务列表失败":"加载订单列表失败")}finally{F.value=!1}}function x(){Z.value=1,G.value=null,W.value="",T()}async function Ee(){u.value=_.value?Ae():Ne(),Be(),await _e(u.value?.team_name),Z.value=1,G.value=null,W.value="",await T()}function ct(t){Z.value=t,T()}function mt(t){ce.value=t,Z.value=1,T()}function oe(t){const e=Se.fullPath;_.value?ke.push(`/finance/orders/${t}?from=${encodeURIComponent(e)}&source=finance`):ke.push(`/orders/${t}?from=${encodeURIComponent(e)}`)}function ft(t){const e=qe.value;if(!e)return!0;const r=Number(t?.salesperson_id??0);return!Number.isFinite(r)||r<=0?!0:Math.trunc(r)===e}function Ie(t){if(_.value||!t||m(t)||pe(t))return!1;const e=Y.value;return e===h.MARKET||e===h.FINANCE?!1:e===h.SALES?ft(t):e===h.SUPER_ADMIN||e===h.MANAGER}function Te(t){if(_.value||!t||m(t)||!pe(t))return!1;const e=Y.value;return e===h.SUPER_ADMIN||e===h.MANAGER}async function _t(t,e){const r=!!e,o=r?"确认标记完成":"确认退回未完成",i=r?"确认将该订单标记为【已完成】？":"确认将该订单退回【未完成】？";try{await ne.confirm(i,o,{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning",center:!0})}catch{return!1}return!0}async function De(t,e){if(!t?.id)return;const r=!!e,o=!!t?.is_finished;if(!(o===r||!await _t(t,r))){t._saving_finished=!0,t.is_finished=r;try{await pn(t.id,{is_finished:r}),y.success(r?"已标记完成":"已退回未完成"),await T()}catch(p){console.error(p),t.is_finished=o,y.error("操作失败")}finally{t._saving_finished=!1}}}async function pt(t,e){if(!(!e||m(e))){if(t==="detail"){oe(e.id);return}if(t==="markFinished"){if(!Ie(e)){y.error("无权限操作");return}await De(e,!0);return}if(t==="reopen"){if(!Te(e)){y.error("无权限操作");return}await De(e,!1)}}}async function vt(){try{await ne.alert("退回前请先将【回款】和【返点】都调整为“否”。","无法退回",{type:"warning",center:!0,confirmButtonText:"我知道了"})}catch{}}async function bt(t){if(!(!_.value||!t?.id)&&!m(t)){if(!J.value){y.error("无权限操作");return}if(ve(t)||be(t)){await vt();return}try{await ne.confirm("确认将该订单退回【未完成】？","确认退回",{confirmButtonText:"确认退回",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}try{await kn(t.id),y.success("已退回未完成"),await T()}catch(e){console.error(e),y.error("操作失败")}}}async function ht(t,e){if(!(!e||m(e))){if(t==="detail"){oe(e.id);return}t==="return"&&await bt(e)}}async function gt(t,e){if(!_.value||!t?.id||m(t)||!J.value)return;const r=ve(t),o=!!e;if(r!==o){try{await ne.confirm(`确认将该订单【回款】改为【${o?"是":"否"}】？`,"确认操作",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}t._saving_paid=!0,Oe(t,o);try{await Ze(t.id,{is_paid:o}),y.success("已更新回款状态")}catch(i){console.error(i),Oe(t,r),y.error("操作失败")}finally{t._saving_paid=!1}}}async function yt(t,e){if(!_.value||!t?.id||m(t)||!J.value)return;const r=be(t),o=!!e;if(r!==o){try{await ne.confirm(`确认将该订单【返点】改为【${o?"是":"否"}】？`,"确认操作",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}t._saving_rebate=!0,$e(t,o);try{await Ze(t.id,{is_rebate:o}),y.success("已更新返点状态")}catch(i){console.error(i),$e(t,r),y.error("操作失败")}finally{t._saving_rebate=!1}}}function wt(){const t=new Intl.DateTimeFormat("zh-CN",{timeZone:"Asia/Shanghai",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(new Date),e=t.find(i=>i.type==="year")?.value||"0000",r=t.find(i=>i.type==="month")?.value||"00",o=t.find(i=>i.type==="day")?.value||"00";return`${e}-${r}-${o}`}function kt(t){const e=String(t||"");if(!e)return"";const r=e.match(/filename\*\s*=\s*([^;]+)/i);if(r&&r[1]){const i=r[1].trim(),p=i.indexOf("''");if(p>=0){const b=i.slice(p+2).trim();try{return decodeURIComponent(b)}catch{return b}}return i.replace(/^["']|["']$/g,"")}const o=e.match(/filename\s*=\s*([^;]+)/i);return o&&o[1]?o[1].trim().replace(/^["']|["']$/g,""):""}function St(t,e){const r=URL.createObjectURL(t),o=document.createElement("a");o.href=r,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>{try{URL.revokeObjectURL(r)}catch{}},1200)}async function Vt(){if(_.value){if(!Ve.value){y.error("无权限下载");return}if(!H.value){H.value=!0;try{const t=ze(),e=await Sn(t),r=Number(e?.status||0),o=e?.headers||{},i=String(o["content-type"]||o["Content-Type"]||"").toLowerCase();if(r>=400){try{const w=await new Response(e.data).text();let k="";try{const B=JSON.parse(w);k=String(B?.detail||B?.message||w||"导出失败")}catch{k=w||"导出失败"}y.error(k)}catch{y.error("导出失败")}return}if(i.includes("application/json")){try{const w=await new Response(e.data).text();y.error(w||"导出失败")}catch{y.error("导出失败")}return}const p=o["content-disposition"]||o["Content-Disposition"]||"",b=kt(p)||`财务管理_订单_${wt()}.xls`,N=e.data instanceof Blob?e.data:new Blob([e.data],{type:i||"application/octet-stream"});St(N,b),y.success("已下载符合筛选条件数据")}catch(t){console.error(t),y.error("下载失败")}finally{H.value=!1}}}}const Nt={commercial_amount:"commercial_amount",compulsory_amount:"compulsory_amount",vehicle_tax_amount:"vehicle_tax_amount",noncar_amount:"non_vehicle_amount"},At={channel_commercial_point:"channel_commercial_point",channel_commercial_supplement_point:"channel_commercial_supplement_point",channel_compulsory_point:"channel_compulsory_point",channel_vehicle_tax_point:"channel_vehicle_tax_point",channel_noncar_point:"channel_non_vehicle_point",customer_commercial_point:"customer_commercial_point",customer_commercial_supplement_point:"customer_commercial_supplement_point",customer_compulsory_point:"customer_compulsory_point",customer_vehicle_tax_point:"customer_vehicle_tax_point",customer_noncar_point:"customer_non_vehicle_point"};function Ct(t){return t?.created_at||null}function pe(t){return!!t?.is_finished}function xt(t){return String(t?.channel_group_name||"").trim()||"-"}function Rt(t){return String(t?.customer_group_name||"").trim()||"-"}function Ft(t){const e=t?.customer_group_market;return String(e??"").trim()||"-"}function Mt(t){const e=String(t?.salesperson_name??"").trim();if(e)return e;const r=nt(t);return String(r?.real_name||r?.username||"-")}function K(t,e=[]){for(const r of e){const o=Qe(t,r),i=String(o??"").trim();if(i)return i}return""}function Ut(t){return K(t,["id_name","dl_owner","owner_name"])||"-"}function Bt(t){return K(t,["dl_plate_no","plate_no"])||"-"}function Et(t){const e=I(t)?.insurance_expire_date;return Fe(e)||"-"}function It(t){return K(t,["dl_vin","vin"])||"-"}function Tt(t){return K(t,["dl_engine_no","engine_no"])||"-"}function Dt(t){return K(t,["dl_brand_model","dl_vehicle_model","vehicle_model","brand_model"])||"-"}function Ot(t){const e=K(t,["dl_register_date","first_register_date","register_date","dl_first_register_date"]);return Fe(e)||"-"}function $t(t){return K(t,["id_number","dl_id_number"])||"-"}function Pt(t){const e=I(t)?.owner_phone;return String(e??"").trim()||"-"}function zt(t){return String(I(t)?.remark??"").trim()||"-"}function Yt(t){return String(t?.manager_name??"").trim()||"-"}function Lt(t){const e=at(t?.team_names);return e||String(t?.team_name??"").trim()||"-"}function ve(t){return!!t?.is_paid}function be(t){return!!t?.is_rebate}function Oe(t,e){!t||typeof t!="object"||(t.is_paid=!!e)}function $e(t,e){!t||typeof t!="object"||(t.is_rebate=!!e)}function Gt(t,e){const r=I(t),o=Nt[e]||e;return r?r[o]:null}function jt(t,e){const r=I(t),o=At[e]||e;return r?r[o]:null}function re(t,e){return X(Gt(t,e))}function U(t,e){return et(jt(t,e))}function Kt(t,e){const r=I(t);return r?r[e]??null:null}function Pe(t,e){return X(Kt(t,e))}function Jt(t){return X(I(t)?.channel_total??null)}function Zt(t){return X(I(t)?.customer_total??null)}function qt(t){return X(I(t)?.profit??null)}function Ht(t){if(!Array.isArray(t))return null;const e=j(t[0]),r=j(t[1]);return!e&&!r?null:{start:e||"",end:r||""}}function he(t,e,r){const o=Ht(r);if(!o)return;const i={start:j(o.start),end:j(o.end)};i.start&&!i.end&&(i.end=i.start),i.end&&!i.start&&(i.start=i.end),!(!i.start||!i.end)&&(t[`${e}_start`]=i.start,t[`${e}_end`]=i.end)}function ge(){const t={page:Z.value,page_size:ce.value},e=u.value||{};if(_.value){const r=Array.isArray(e.team_names)?e.team_names.map(p=>String(p||"").trim()).filter(Boolean):[];r.length&&(t.team_names=r),he(t,"created_date",e.created_date),e.channel_group_id&&(t.channel_group_id=e.channel_group_id),e.customer_group_id&&(t.customer_group_id=e.customer_group_id),e.salesperson_id&&(t.salesperson_id=e.salesperson_id);const o=j(e.market);o&&(t.market=o);const i=j(e.owner_name);return i&&(t.owner_name=i),e.insurance_expire_date&&(t.insurance_expire_date=e.insurance_expire_date),he(t,"first_register_date",e.first_register_date),(e.is_paid===!0||e.is_paid===!1)&&(t.is_paid=e.is_paid),(e.is_rebate===!0||e.is_rebate===!1)&&(t.is_rebate=e.is_rebate),t}return e.team_name&&(t.team_name=String(e.team_name).trim()),we.mode==="finished"&&(t.is_finished=!0),we.mode==="unfinished"&&(t.is_finished=!1),e.owner_name&&(t.owner_name=e.owner_name),e.id_number&&(t.id_number=e.id_number),e.vin&&(t.vin=e.vin),e.engine_no&&(t.engine_no=e.engine_no),e.plate_no&&(t.plate_no=e.plate_no),e.vehicle_model&&(t.vehicle_model=e.vehicle_model),e.remark&&(t.remark=e.remark),e.customer_group_id&&(t.customer_group_id=e.customer_group_id),e.channel_group_id&&(t.channel_group_id=e.channel_group_id),e.salesperson_id&&(t.salesperson_id=e.salesperson_id),he(t,"created_date",e.created_date),t}function ze(){const t={...ge()};return delete t.page,delete t.page_size,t}function Wt(t){const e=new Set,r=o=>o===null||typeof o!="object"?o:e.has(o)?null:(e.add(o),Array.isArray(o)?o.map(r):Object.keys(o).sort().reduce((i,p)=>(i[p]=r(o[p]),i),{}));try{return JSON.stringify(r(t))}catch{return""}}function Xt(t){const e=r=>{const o=Number(r);return Number.isFinite(o)?o:0};return{id:-1,_is_summary:!0,created_at:"汇总",is_finished:!0,is_paid:!1,is_rebate:!1,order_info:{commercial_amount:e(t?.commercial_amount),compulsory_amount:e(t?.compulsory_amount),vehicle_tax_amount:e(t?.vehicle_tax_amount),non_vehicle_amount:e(t?.noncar_amount),channel_reward:e(t?.channel_reward),customer_reward:e(t?.customer_reward),channel_total:e(t?.receivable),customer_total:e(t?.payable),profit:e(t?.profit)}}}const Qt=A(()=>{const t=Array.isArray(se.value)?[...se.value]:[];return _.value&&G.value&&t.push(Xt(G.value)),t});return ln(()=>_.value?null:u.value?.team_name??null,async(t,e)=>{_.value||t!==e&&await ut(t)}),on(async()=>{await st(),await T()}),(t,e)=>{const r=S("el-date-picker"),o=S("el-form-item"),i=S("el-col"),p=S("el-option"),b=S("el-select"),N=S("el-row"),w=S("el-input"),k=S("el-button"),B=S("el-form"),en=S("el-card"),c=S("el-table-column"),Ye=S("el-switch"),Le=S("el-icon"),Q=S("el-dropdown-item"),Ge=S("el-dropdown-menu"),je=S("el-dropdown"),tn=S("el-table"),nn=S("el-pagination"),an=un("loading");return d(),g("div",An,[ee("div",Cn,[ee("h2",null,f(ye.title),1)]),a(en,{shadow:"never",class:"toolbar-card","body-style":{padding:"10px 12px"}},{default:l(()=>[a(B,{model:u.value,class:"filters-form","label-width":"88px"},{default:l(()=>[_.value?(d(),g(R,{key:0},[a(N,{gutter:12},{default:l(()=>[a(i,{span:6},{default:l(()=>[a(o,{label:"日期"},{default:l(()=>[a(r,{modelValue:u.value.created_date,"onUpdate:modelValue":e[0]||(e[0]=n=>u.value.created_date=n),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"100%"},clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"渠道"},{default:l(()=>[a(b,{modelValue:u.value.channel_group_id,"onUpdate:modelValue":e[1]||(e[1]=n=>u.value.channel_group_id=n),clearable:"",filterable:"",placeholder:"选择渠道",style:{width:"100%"},loading:M.value,disabled:M.value},{default:l(()=>[(d(!0),g(R,null,O(fe.value,n=>(d(),v(p,{key:String(n.id),label:ae(n),value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"客户"},{default:l(()=>[a(b,{modelValue:u.value.customer_group_id,"onUpdate:modelValue":e[2]||(e[2]=n=>u.value.customer_group_id=n),clearable:"",filterable:"",placeholder:"选择客户",style:{width:"100%"},loading:M.value,disabled:M.value},{default:l(()=>[(d(!0),g(R,null,O(me.value,n=>(d(),v(p,{key:String(n.id),label:ae(n),value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"业务员"},{default:l(()=>[a(b,{modelValue:u.value.salesperson_id,"onUpdate:modelValue":e[3]||(e[3]=n=>u.value.salesperson_id=n),clearable:"",filterable:"",placeholder:"选择业务员",style:{width:"100%"},loading:q.value,disabled:q.value},{default:l(()=>[(d(!0),g(R,null,O(Me.value,n=>(d(),v(p,{key:String(n.id),label:n.real_name||n.username,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])]),_:1})]),_:1})]),_:1}),a(N,{gutter:12},{default:l(()=>[a(i,{span:6},{default:l(()=>[a(o,{label:"市场"},{default:l(()=>[a(w,{modelValue:u.value.market,"onUpdate:modelValue":e[4]||(e[4]=n=>u.value.market=n),clearable:"",placeholder:"市场（模糊）",onKeyup:$(x,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"团队"},{default:l(()=>[We.value?(d(),v(b,{key:0,modelValue:u.value.team_names,"onUpdate:modelValue":e[5]||(e[5]=n=>u.value.team_names=n),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",clearable:"",filterable:"",placeholder:"选择团队（可多选）",style:{width:"100%"},loading:z.value,disabled:z.value||!ue.value},{default:l(()=>[(d(!0),g(R,null,O(L.value,n=>(d(),v(p,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])):(d(),v(b,{key:1,modelValue:Ce.value,"onUpdate:modelValue":e[6]||(e[6]=n=>Ce.value=n),clearable:"",filterable:"",placeholder:"选择团队",style:{width:"100%"},loading:z.value,disabled:z.value||!ue.value},{default:l(()=>[(d(!0),g(R,null,O(L.value,n=>(d(),v(p,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"]))]),_:1})]),_:1}),a(i,{span:12})]),_:1}),a(N,{gutter:12},{default:l(()=>[a(i,{span:6},{default:l(()=>[a(o,{label:"车主"},{default:l(()=>[a(w,{modelValue:u.value.owner_name,"onUpdate:modelValue":e[7]||(e[7]=n=>u.value.owner_name=n),clearable:"",placeholder:"车主（模糊）",onKeyup:$(x,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"保险到期日"},{default:l(()=>[a(r,{modelValue:u.value.insurance_expire_date,"onUpdate:modelValue":e[8]||(e[8]=n=>u.value.insurance_expire_date=n),type:"date","value-format":"YYYY-MM-DD",placeholder:"选择日期",style:{width:"100%"},clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"初登日期"},{default:l(()=>[a(r,{modelValue:u.value.first_register_date,"onUpdate:modelValue":e[9]||(e[9]=n=>u.value.first_register_date=n),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"100%"},clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"是否回款"},{default:l(()=>[a(b,{modelValue:u.value.is_paid,"onUpdate:modelValue":e[10]||(e[10]=n=>u.value.is_paid=n),clearable:"",placeholder:"全部",style:{width:"100%"}},{default:l(()=>[a(p,{label:"是",value:!0}),a(p,{label:"否",value:!1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(N,{gutter:12},{default:l(()=>[a(i,{span:6},{default:l(()=>[a(o,{label:"是否返点"},{default:l(()=>[a(b,{modelValue:u.value.is_rebate,"onUpdate:modelValue":e[11]||(e[11]=n=>u.value.is_rebate=n),clearable:"",placeholder:"全部",style:{width:"100%"}},{default:l(()=>[a(p,{label:"是",value:!0}),a(p,{label:"否",value:!1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(i,{span:18,class:"finance-actions-col"},{default:l(()=>[ee("div",xn,[a(k,{"native-type":"button",type:"primary",loading:F.value,onClick:x},{default:l(()=>[...e[26]||(e[26]=[s("搜索",-1)])]),_:1},8,["loading"]),a(k,{"native-type":"button",loading:F.value,onClick:Ee},{default:l(()=>[...e[27]||(e[27]=[s("重置",-1)])]),_:1},8,["loading"]),a(k,{"native-type":"button",loading:F.value,onClick:T},{default:l(()=>[...e[28]||(e[28]=[s("刷新",-1)])]),_:1},8,["loading"]),Ve.value?(d(),v(k,{key:0,"native-type":"button",disabled:F.value||H.value||(Number(de.value)||0)<=0,loading:H.value,onClick:te(Vt,["stop","prevent"])},{default:l(()=>[...e[29]||(e[29]=[s(" 下载 ",-1)])]),_:1},8,["disabled","loading"])):C("",!0)])]),_:1})]),_:1})],64)):(d(),g(R,{key:1},[a(N,{gutter:12},{default:l(()=>[a(i,{span:6},{default:l(()=>[a(o,{label:"日期"},{default:l(()=>[a(r,{modelValue:u.value.created_date,"onUpdate:modelValue":e[12]||(e[12]=n=>u.value.created_date=n),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"100%"},clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"渠道"},{default:l(()=>[a(b,{modelValue:u.value.channel_group_id,"onUpdate:modelValue":e[13]||(e[13]=n=>u.value.channel_group_id=n),clearable:"",filterable:"",placeholder:"选择渠道",style:{width:"100%"},loading:M.value,disabled:M.value},{default:l(()=>[(d(!0),g(R,null,O(fe.value,n=>(d(),v(p,{key:String(n.id),label:ae(n),value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"客户"},{default:l(()=>[a(b,{modelValue:u.value.customer_group_id,"onUpdate:modelValue":e[14]||(e[14]=n=>u.value.customer_group_id=n),clearable:"",filterable:"",placeholder:"选择客户",style:{width:"100%"},loading:M.value,disabled:M.value},{default:l(()=>[(d(!0),g(R,null,O(me.value,n=>(d(),v(p,{key:String(n.id),label:ae(n),value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"业务员"},{default:l(()=>[a(b,{modelValue:u.value.salesperson_id,"onUpdate:modelValue":e[15]||(e[15]=n=>u.value.salesperson_id=n),clearable:"",filterable:"",placeholder:"选择业务员",style:{width:"100%"},loading:q.value,disabled:q.value},{default:l(()=>[(d(!0),g(R,null,O(Me.value,n=>(d(),v(p,{key:String(n.id),label:n.real_name||n.username,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])]),_:1})]),_:1})]),_:1}),a(N,{gutter:12},{default:l(()=>[a(i,{span:6},{default:l(()=>[a(o,{label:"团队"},{default:l(()=>[a(b,{modelValue:u.value.team_name,"onUpdate:modelValue":e[16]||(e[16]=n=>u.value.team_name=n),clearable:"",filterable:"",placeholder:"选择团队",style:{width:"100%"},loading:z.value,disabled:z.value||!ue.value},{default:l(()=>[(d(!0),g(R,null,O(L.value,n=>(d(),v(p,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])]),_:1})]),_:1}),a(i,{span:18})]),_:1}),a(N,{gutter:12},{default:l(()=>[a(i,{span:6},{default:l(()=>[a(o,{label:"车主"},{default:l(()=>[a(w,{modelValue:u.value.owner_name,"onUpdate:modelValue":e[17]||(e[17]=n=>u.value.owner_name=n),clearable:"",placeholder:"车主（模糊）",onKeyup:$(x,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"身份证号"},{default:l(()=>[a(w,{modelValue:u.value.id_number,"onUpdate:modelValue":e[18]||(e[18]=n=>u.value.id_number=n),clearable:"",placeholder:"身份证号（模糊）",onKeyup:$(x,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"车牌"},{default:l(()=>[a(w,{modelValue:u.value.plate_no,"onUpdate:modelValue":e[19]||(e[19]=n=>u.value.plate_no=n),clearable:"",placeholder:"车牌（模糊）",onKeyup:$(x,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"发动机号"},{default:l(()=>[a(w,{modelValue:u.value.engine_no,"onUpdate:modelValue":e[20]||(e[20]=n=>u.value.engine_no=n),clearable:"",placeholder:"发动机号（模糊）",onKeyup:$(x,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(N,{gutter:12},{default:l(()=>[a(i,{span:6},{default:l(()=>[a(o,{label:"车架号"},{default:l(()=>[a(w,{modelValue:u.value.vin,"onUpdate:modelValue":e[21]||(e[21]=n=>u.value.vin=n),clearable:"",placeholder:"车架号（模糊）",onKeyup:$(x,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"车型"},{default:l(()=>[a(w,{modelValue:u.value.vehicle_model,"onUpdate:modelValue":e[22]||(e[22]=n=>u.value.vehicle_model=n),clearable:"",placeholder:"车型（模糊）",onKeyup:$(x,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(o,{label:"订单备注"},{default:l(()=>[a(w,{modelValue:u.value.remark,"onUpdate:modelValue":e[23]||(e[23]=n=>u.value.remark=n),clearable:"",placeholder:"订单备注（模糊）",onKeyup:$(x,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{span:6,class:"toolbar-actions"},{default:l(()=>[a(k,{"native-type":"button",type:"primary",loading:F.value,onClick:x},{default:l(()=>[...e[30]||(e[30]=[s("搜索",-1)])]),_:1},8,["loading"]),a(k,{"native-type":"button",loading:F.value,onClick:Ee},{default:l(()=>[...e[31]||(e[31]=[s("重置",-1)])]),_:1},8,["loading"]),a(k,{"native-type":"button",loading:F.value,onClick:T},{default:l(()=>[...e[32]||(e[32]=[s("刷新",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})],64))]),_:1},8,["model"])]),_:1}),ee("div",Rn,[rn((d(),v(tn,{data:Qt.value,border:"",stripe:"",class:"main-table","row-class-name":Xe},{default:l(()=>[a(c,{label:"日期","min-width":"110","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"汇总":Re(Ct(n))),1)]),_:1}),He.value?(d(),v(c,{key:0,label:"完成状态","min-width":"92",align:"center","header-align":"center","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":pe(n)?"是":"否"),1)]),_:1})):C("",!0),a(c,{label:"渠道","min-width":"140","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":xt(n)),1)]),_:1}),a(c,{label:"客户","min-width":"140","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":Rt(n)),1)]),_:1}),a(c,{label:"市场","min-width":"110","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":Ft(n)),1)]),_:1}),_.value?(d(),v(c,{key:1,label:"业务员","min-width":"120","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":Mt(n)),1)]),_:1})):C("",!0),a(c,{label:"车主","min-width":"120","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":Ut(n)),1)]),_:1}),a(c,{label:"车牌","min-width":"120","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":Bt(n)),1)]),_:1}),a(c,{label:"保险到期日","min-width":"120","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":Et(n)),1)]),_:1}),a(c,{label:"车架号","min-width":"160","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":It(n)),1)]),_:1}),a(c,{label:"发动机号","min-width":"150","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":Tt(n)),1)]),_:1}),a(c,{label:"车型","min-width":"160","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":Dt(n)),1)]),_:1}),a(c,{label:"初登日期","min-width":"120","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":Ot(n)),1)]),_:1}),a(c,{label:"身份证号","min-width":"170","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":$t(n)),1)]),_:1}),a(c,{label:"电话","min-width":"130","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":Pt(n)),1)]),_:1}),a(c,{label:"商业金额","min-width":"110","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(re(n,"commercial_amount")),1)]),_:1}),a(c,{label:"交强金额","min-width":"110","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(re(n,"compulsory_amount")),1)]),_:1}),a(c,{label:"车船税金额","min-width":"120","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(re(n,"vehicle_tax_amount")),1)]),_:1}),a(c,{label:"非车金额","min-width":"110","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(re(n,"noncar_amount")),1)]),_:1}),a(c,{label:"渠道商业点位","min-width":"120","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":U(n,"channel_commercial_point")),1)]),_:1}),_.value?C("",!0):(d(),v(c,{key:2,label:"渠道商业后补点位","min-width":"140","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":U(n,"channel_commercial_supplement_point")),1)]),_:1})),a(c,{label:"渠道交强点位","min-width":"120","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":U(n,"channel_compulsory_point")),1)]),_:1}),a(c,{label:"渠道车船税点位","min-width":"130","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":U(n,"channel_vehicle_tax_point")),1)]),_:1}),a(c,{label:"渠道非车点位","min-width":"120","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":U(n,"channel_noncar_point")),1)]),_:1}),_.value?(d(),v(c,{key:3,label:"渠道奖励","min-width":"110","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(Pe(n,"channel_reward")),1)]),_:1})):C("",!0),a(c,{label:"客户商业点位","min-width":"120","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":U(n,"customer_commercial_point")),1)]),_:1}),_.value?C("",!0):(d(),v(c,{key:4,label:"客户商业后补点位","min-width":"140","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":U(n,"customer_commercial_supplement_point")),1)]),_:1})),a(c,{label:"客户交强点位","min-width":"120","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":U(n,"customer_compulsory_point")),1)]),_:1}),a(c,{label:"客户车船税点位","min-width":"130","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":U(n,"customer_vehicle_tax_point")),1)]),_:1}),a(c,{label:"客户非车点位","min-width":"120","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":U(n,"customer_noncar_point")),1)]),_:1}),_.value?(d(),v(c,{key:5,label:"客户奖励","min-width":"110","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(Pe(n,"customer_reward")),1)]),_:1})):C("",!0),a(c,{label:"应收","min-width":"110","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(Jt(n)),1)]),_:1}),a(c,{label:"应付","min-width":"110","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(Zt(n)),1)]),_:1}),a(c,{label:"利润","min-width":"110","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(qt(n)),1)]),_:1}),a(c,{label:"所属经理","min-width":"130","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":Yt(n)),1)]),_:1}),a(c,{label:"所属团队","min-width":"120","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":Lt(n)),1)]),_:1}),a(c,{label:"订单备注","min-width":"180","show-overflow-tooltip":""},{default:l(({row:n})=>[s(f(m(n)?"":zt(n)),1)]),_:1}),_.value?(d(),v(c,{key:6,label:"是否回款",width:"108",fixed:"right",align:"center","header-align":"center","class-name":"col-switch"},{default:l(({row:n})=>[m(n)?(d(),g("span",Mn)):(d(),g("div",Fn,[a(Ye,{size:"medium","inline-prompt":"","inactive-text":"否","active-text":"是","model-value":ve(n),loading:!!n?._saving_paid,disabled:!J.value,onChange:D=>gt(n,D)},null,8,["model-value","loading","disabled","onChange"])]))]),_:1})):C("",!0),_.value?(d(),v(c,{key:7,label:"是否返点",width:"108",fixed:"right",align:"center","header-align":"center","class-name":"col-switch"},{default:l(({row:n})=>[m(n)?(d(),g("span",Bn)):(d(),g("div",Un,[a(Ye,{size:"medium","inline-prompt":"","inactive-text":"否","active-text":"是","model-value":be(n),loading:!!n?._saving_rebate,disabled:!J.value,onChange:D=>yt(n,D)},null,8,["model-value","loading","disabled","onChange"])]))]),_:1})):C("",!0),a(c,{label:"操作",width:_.value?110:130,fixed:"right",align:"center","header-align":"center","class-name":"col-actions"},{default:l(({row:n})=>[m(n)?(d(),g("span",En)):_.value?(d(),g("div",In,[a(k,{"native-type":"button",size:"small",link:"",onClick:te(D=>oe(n.id),["stop"])},{default:l(()=>[...e[33]||(e[33]=[s("详情",-1)])]),_:1},8,["onClick"]),a(je,{trigger:"click",teleported:!0,placement:"bottom-end","popper-class":"order-actions-popper",onCommand:D=>ht(D,n)},{dropdown:l(()=>[a(Ge,null,{default:l(()=>[a(Q,{command:"detail"},{default:l(()=>[...e[34]||(e[34]=[s("详情",-1)])]),_:1}),J.value?(d(),v(Q,{key:0,command:"return",divided:""},{default:l(()=>[...e[35]||(e[35]=[s("退回未完成",-1)])]),_:1})):C("",!0)]),_:1})]),default:l(()=>[a(k,{"native-type":"button",size:"small",circle:"",onClick:e[24]||(e[24]=te(()=>{},["stop"]))},{default:l(()=>[a(Le,null,{default:l(()=>[a(Ke(Je))]),_:1})]),_:1})]),_:1},8,["onCommand"])])):(d(),g("div",Tn,[a(k,{"native-type":"button",size:"small",link:"",onClick:te(D=>oe(n.id),["stop"])},{default:l(()=>[...e[36]||(e[36]=[s("详情",-1)])]),_:1},8,["onClick"]),a(je,{trigger:"click",teleported:!0,placement:"bottom-end","popper-class":"order-actions-popper",onCommand:D=>pt(D,n)},{dropdown:l(()=>[a(Ge,null,{default:l(()=>[a(Q,{command:"detail"},{default:l(()=>[...e[37]||(e[37]=[s("详情",-1)])]),_:1}),Ie(n)?(d(),v(Q,{key:0,command:"markFinished",divided:""},{default:l(()=>[...e[38]||(e[38]=[s("标记完成",-1)])]),_:1})):C("",!0),Te(n)?(d(),v(Q,{key:1,command:"reopen",divided:""},{default:l(()=>[...e[39]||(e[39]=[s("退回未完成",-1)])]),_:1})):C("",!0)]),_:2},1024)]),default:l(()=>[a(k,{"native-type":"button",size:"small",circle:"",onClick:e[25]||(e[25]=te(()=>{},["stop"]))},{default:l(()=>[a(Le,null,{default:l(()=>[a(Ke(Je))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]))]),_:1},8,["width"])]),_:1},8,["data"])),[[an,F.value]])]),ee("div",Dn,[a(nn,{background:"",layout:"total, prev, pager, next, sizes",total:de.value,"current-page":Z.value,"page-size":ce.value,"page-sizes":[10,20,50,100],onCurrentChange:ct,onSizeChange:mt},null,8,["total","current-page","page-size"])])])}}},jn=Vn(On,[["__scopeId","data-v-99073257"]]);export{jn as O};
