import{h as a}from"./http-DGyH82Tn.js";const u="Asia/Shanghai",p=new Set(["related"]);function f(e){const t=Number(typeof e=="string"?e.trim():e);if(!Number.isFinite(t))throw new Error("finance api: invalid orderId");if(!Number.isInteger(t))throw new Error("finance api: orderId must be an integer");if(t<=0)throw new Error("finance api: invalid orderId");return t}function b(e){const t={};for(const[n,r]of Object.entries(e||{}))r!==void 0&&(t[n]=r);return t}function c(e){return e instanceof Date&&Number.isFinite(e.getTime())}function d(e,t=u){const n=c(e)?e:new Date(e);return c(n)?new Intl.DateTimeFormat("en-CA",{timeZone:t,year:"numeric",month:"2-digit",day:"2-digit"}).format(n):""}function g(e){if(e==null)return"";if(c(e))return d(e,u);if(typeof e=="string"){const t=e.trim();if(!t)return"";if(/^\d{8}$/.test(t))return`${t.slice(0,4)}-${t.slice(4,6)}-${t.slice(6,8)}`;const n=t.match(/^(\d{4}-\d{2}-\d{2})/);if(n)return n[1];const r=t.match(/^(\d{4})\/(\d{2})\/(\d{2})/);return r?`${r[1]}-${r[2]}-${r[3]}`:""}if(typeof e=="number"&&Number.isFinite(e)){const t=new Date(e);return c(t)?d(t,u):""}return""}function y(e){if(!Array.isArray(e)||e.length!==2)return null;const t=g(e[0]),n=g(e[1]);return!t||!n?null:[t,n]}function l(e){const t={},n=e&&typeof e=="object"?e:{};for(const[r,i]of Object.entries(n))if(i!=null){if(typeof i=="string"){const o=i.trim();if(!o)continue;t[r]=o;continue}if(typeof i=="number"){if(!Number.isFinite(i))continue;t[r]=i;continue}if(c(i)){t[r]=d(i,u);continue}if(Array.isArray(i)){const o=i.map(s=>s==null?s:typeof s=="string"?s.trim():typeof s=="number"?Number.isFinite(s)?s:null:c(s)?d(s,u):s).filter(s=>s!=null&&!(typeof s=="string"&&s===""));if(!o.length)continue;t[r]=o;continue}t[r]=i}return t}function m(e){const t=l(e);if(Object.prototype.hasOwnProperty.call(t,"created_date")){const r=Object.prototype.hasOwnProperty.call(t,"created_date_start"),i=Object.prototype.hasOwnProperty.call(t,"created_date_end"),o=!r&&!i?y(t.created_date):null;delete t.created_date,o&&(t.created_date_start=o[0],t.created_date_end=o[1])}if(Object.prototype.hasOwnProperty.call(t,"first_register_date")){const r=Object.prototype.hasOwnProperty.call(t,"first_register_date_start"),i=Object.prototype.hasOwnProperty.call(t,"first_register_date_end"),o=!r&&!i?y(t.first_register_date):null;delete t.first_register_date,o&&(t.first_register_date_start=o[0],t.first_register_date_end=o[1])}const n=[["created_date_start","created_date_end"],["first_register_date_start","first_register_date_end"]];for(const[r,i]of n){const o=Object.prototype.hasOwnProperty.call(t,r)&&String(t[r]??"").trim()!=="",s=Object.prototype.hasOwnProperty.call(t,i)&&String(t[i]??"").trim()!=="";o!==s&&(delete t[r],delete t[i])}return t}function h(e){const t=e&&typeof e=="object"?e:{},n={};return Object.prototype.hasOwnProperty.call(t,"is_paid")&&(t.is_paid===!0||t.is_paid===!1)&&(n.is_paid=t.is_paid),Object.prototype.hasOwnProperty.call(t,"is_rebate")&&(t.is_rebate===!0||t.is_rebate===!1)&&(n.is_rebate=t.is_rebate),n}function w(e){if(!Array.isArray(e))return[];const t=[];for(const n of e){if(!n||typeof n!="object")continue;const r=String(n.slot_key??"").trim(),i=String(n.storage_key??"").trim().replace(/^\/+/,""),o=String(n.md5??"").trim();if(!r||!p.has(r)||!i)continue;const s={slot_key:r,storage_key:i};if(o&&(s.md5=o),n.etag!=null&&String(n.etag).trim()&&(s.etag=String(n.etag).trim()),n.size!=null&&!Number.isNaN(Number(n.size))){const _=Number(n.size);Number.isFinite(_)&&(s.size=Math.max(0,_))}n.content_type!=null&&String(n.content_type).trim()&&(s.content_type=String(n.content_type).trim()),n.original_name!=null&&String(n.original_name).trim()&&(s.original_name=String(n.original_name).trim()),t.push(s)}return t}function O(e){if(!Array.isArray(e))return[];const t=new Set,n=[];for(const r of e){const i=String(r??"").trim();i&&p.has(i)&&(t.has(i)||(t.add(i),n.push(i)))}return n}function F(e={}){const t=m(e);return a.get("/finance/orders",{params:t})}function j(e={}){const t=m(e);return a.get("/finance/orders/summary",{params:t})}function N(e={}){const t=m(e);return a.get("/finance/orders/export",{params:t,responseType:"blob"})}function P(e){const t=f(e);return a.get(`/finance/orders/${t}`)}function z(e,t={}){const n=f(e),r=h(t);if(!Object.keys(r).length)throw new Error("finance api: status patch requires is_paid and/or is_rebate boolean");return a.patch(`/finance/orders/${n}/status`,r)}function A(e){const t=f(e);return a.post(`/finance/orders/${t}/return`)}function E(e={}){const t=l(e);return a.get("/finance/customer-groups",{params:t})}function k(e={}){const t=l(e);return a.get("/finance/channel-groups",{params:t})}function $(e={}){const t=e&&typeof e=="object"?e:{},n=t.status!==void 0&&t.status!==null?Number(t.status):1,r=Number.isFinite(n)?n:1,i=l({...t,status:r});return a.get("/finance/salespersons",{params:i})}function D({order_id:e,slot_key:t="related",file:n}){if(!n)throw new Error("finance api: upload requires file");const r=String(t||"related").trim();if(!p.has(r))throw new Error("finance api: invalid slot_key");const i=new FormData;return i.append("order_id",String(f(e))),i.append("slot_key",r),i.append("file",n),a.post("/finance/bos-upload",i)}function I(e={}){const t=e&&typeof e=="object"?e:{},n=w(t.images),r=O(t.clear_slots),i=b({order_id:t.order_id!=null?f(t.order_id):void 0,images:n,clear_slots:r.length?r:void 0});if(!i.order_id)throw new Error("finance api: finalize requires order_id");return a.post("/finance/finalize",i)}export{E as a,k as b,$ as c,j as d,N as e,I as f,P as g,z as h,F as l,A as r,D as u};
