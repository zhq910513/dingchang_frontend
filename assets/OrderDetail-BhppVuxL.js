import{u as _l,b as pl}from"./vendor-vue-router-CVyACjsp.js";import{E as N,c as Be,a as Re,d as xe}from"./vendor-element-plus-CtVxZ4Oy.js";import{V as fl}from"./VehicleCertTable-B-EeolTM.js";import{h as Pe}from"./http-DGyH82Tn.js";import{g as gl,f as kl,u as yl,a as bl,b as hl}from"./orders-DVGDUW2c.js";import{g as wl,f as Vl,u as xl}from"./finance-D7CYzIUW.js";import{_ as Sl,u as Ul}from"./index-Bmu9EZNo.js";import{u as Ol,f as zl}from"./fieldFormat-B0eaWt9f.js";import{u as El}from"./bosUpload-Bf8-Xtq-.js";import{c as z,r as C,o as Se,Z as Ue,q as Cl,x as d,z as l,I as Dl,P as s,H as v,ay as R,O as M,G as T,J as x,aI as Il,y as o,L as I,M as B,ac as Y,u as f,l as ut,ai as W,D as ct}from"./vendor-vue-fFWwKrgY.js";import"./vendor-lodash-rvV0CIkQ.js";import"./vendor-DWCz07M-.js";import"./vendor-dates-DVKSwKij.js";import"./vendor-axios-C0Zqfgkc.js";import"./vendor-pinia-CMXa-Za0.js";const Al={class:"order-detail"},Fl={class:"detail-header"},Nl={class:"header-actions"},Ml={class:"page-body"},Tl={class:"kv-grid kv-grid-2"},Bl={class:"kv-item"},Rl={class:"kv-value"},Pl={class:"plain-value"},Yl={class:"kv-item"},$l={class:"kv-value"},jl={class:"plain-value"},Ll={class:"kv-item"},Kl={class:"kv-value"},ql=["title"],Hl={class:"kv-item"},Wl={class:"kv-value"},Gl=["title"],Xl={class:"kv-item"},Zl={class:"kv-value"},Jl=["title"],Ql={class:"kv-item"},en={class:"kv-value"},tn={class:"plain-value"},ln={class:"kv-item"},nn={class:"kv-value"},an={class:"plain-value"},sn={class:"kv-item"},on={class:"kv-value"},rn={class:"plain-value"},dn={class:"kv-grid kv-grid-2"},un={class:"kv-item"},cn={class:"kv-value"},mn=["title"],vn={class:"kv-item"},_n={class:"kv-value"},pn=["title"],fn={key:0,class:"image-actions image-actions-wide"},gn={key:1,class:"image-wall image-wall-wide"},kn=["onClick"],yn={key:0,class:"thumb-empty"},bn={class:"info-block"},hn={class:"kv-grid kv-grid-2 info-grid"},wn={class:"kv-item"},Vn={class:"kv-value"},xn={class:"kv-item"},Sn={class:"kv-grid kv-grid-2 info-grid"},Un={class:"kv-item kv-item-remark"},On={class:"kv-value"},zn={class:"kv-grid kv-grid-4 info-grid info-grid-compact"},En={class:"kv-item"},Cn={class:"kv-value"},Dn={class:"kv-item"},In={class:"kv-value"},An={class:"kv-item"},Fn={class:"kv-value"},Nn={class:"kv-item"},Mn={class:"kv-value"},Tn={class:"kv-grid kv-grid-2 info-grid"},Bn={class:"kv-item"},Rn={class:"kv-value"},Pn={class:"kv-item"},Yn={class:"kv-value value-red"},$n={class:"kv-grid kv-grid-6 info-grid info-grid-compact"},jn={class:"kv-item"},Ln={class:"kv-value"},Kn={class:"kv-item"},qn={class:"kv-value"},Hn={class:"kv-item"},Wn={class:"kv-value"},Gn={class:"kv-item"},Xn={class:"kv-value"},Zn={class:"kv-item"},Jn={class:"kv-value"},Qn={class:"kv-item"},ea={class:"kv-value"},ta={class:"kv-grid kv-grid-2 info-grid"},la={class:"kv-item"},na={class:"kv-value value-red"},aa={class:"kv-grid kv-grid-6 info-grid info-grid-compact"},ia={class:"kv-item"},sa={class:"kv-value"},oa={class:"kv-item"},ra={class:"kv-value"},da={class:"kv-item"},ua={class:"kv-value"},ca={class:"kv-item"},ma={class:"kv-value"},va={class:"kv-item"},_a={class:"kv-value"},pa={class:"kv-item"},fa={class:"kv-value"},ga={class:"kv-grid kv-grid-2 info-grid"},ka={class:"kv-item"},ya={class:"kv-value value-red"},ba={class:"kv-grid kv-grid-2 info-grid"},ha={class:"kv-item"},wa={class:"kv-value value-red"},Va={class:"section-header"},xa={class:"two-col"},Sa={class:"left"},Ua={key:0,class:"kv-grid kv-grid-2"},Oa={class:"kv-item"},za={class:"kv-value"},Ea={class:"kv-item"},Ca={class:"kv-value"},Da={class:"kv-item"},Ia={class:"kv-value"},Aa={class:"kv-item"},Fa={class:"kv-value"},Na={key:1},Ma={class:"right"},Ta={key:0,class:"image-actions"},Ba={class:"image-wall"},Ra={key:0,class:"thumb-empty"},Pa={class:"section-header"},Ya={class:"stack"},$a={class:"sub-block"},ja={class:"two-col"},La={class:"left"},Ka={key:0,class:"kv-grid kv-grid-2"},qa={class:"kv-item"},Ha={class:"kv-item"},Wa={class:"kv-value"},Ga={key:1,class:"kv-grid kv-grid-2"},Xa={class:"kv-label"},Za={class:"right"},Ja={key:0,class:"image-actions"},Qa={class:"image-wall"},ei={key:0,class:"thumb-empty"},ti={class:"sub-block"},li={class:"two-col"},ni={class:"left"},ai={key:0,class:"kv-grid kv-grid-2"},ii={class:"kv-label"},si={class:"kv-value"},oi={class:"right"},ri={key:0,class:"image-actions"},di={class:"image-wall"},ui={key:0,class:"thumb-empty"},ci={class:"section-header"},mi={class:"stack"},vi={class:"sub-block"},_i={class:"two-col"},pi={class:"left"},fi={key:0,class:"kv-grid kv-grid-2"},gi={key:0,class:"kv-item"},ki={class:"kv-value"},yi={key:1,class:"kv-item"},bi={key:2,class:"kv-item"},hi={class:"kv-value"},wi={key:3,class:"kv-item"},Vi={class:"kv-value"},xi={key:4,class:"kv-item"},Si={class:"kv-value"},Ui={key:5,class:"kv-item"},Oi={class:"kv-value"},zi={key:6,class:"kv-item"},Ei={class:"kv-value"},Ci={key:1,class:"kv-grid kv-grid-2"},Di={class:"kv-label"},Ii={class:"right"},Ai={key:0,class:"image-actions"},Fi={class:"image-wall"},Ni={key:0,class:"thumb-empty"},Mi={class:"sub-block"},Ti={class:"two-col"},Bi={class:"left"},Ri={key:0,class:"kv-grid kv-grid-2"},Pi={key:0,class:"kv-item"},Yi={class:"kv-value"},$i={key:1,class:"kv-grid kv-grid-2"},ji={class:"kv-label"},Li={class:"kv-value"},Ki={class:"right"},qi={key:0,class:"image-actions"},Hi={class:"image-wall"},Wi={key:0,class:"thumb-empty"},Gi=3500,mt="order_import_upload_mode",Xi={__name:"OrderDetail",setup(Zi){const ve=pl(),ne=_l(),vt=Ul();function _t(t){const e=Number(typeof t=="string"?t.trim():t);if(!Number.isFinite(e)||!Number.isInteger(e)||e<=0)throw new Error("invalid order id");return e}let K=0;try{K=_t(ne.params.id)}catch{N.error("订单ID无效"),ve.replace("/orders/all")}const Oe=z(()=>String(ne.query?.source||"")==="finance"||String(ne.name||"")==="finance-order-detail"?!0:String(ne.path||"").startsWith("/finance/")),_e=z(()=>String(vt.roleName||"").trim().toLowerCase()),ze=z(()=>_e.value==="super_admin"||_e.value==="manager"),pt=z(()=>_e.value==="sales"),ft=z(()=>{const t=_e.value;return t==="finance"||t==="manager"||t==="super_admin"}),$=z(()=>Oe.value&&ft.value),k=C(null),G=C(!1),j=C(!1),pe=C(!1),ae=C(!1),ie=C(!1),X=C(!1),Z=C(!1);function gt(){$.value&&(Z.value=!Z.value)}function kt(){$.value&&(O.related||(ue.value=[],le.value=!1,Z.value=!1,N.success("已退出编辑")))}async function yt(){$.value&&(O.related||(Z.value=!1,N.success("已完成编辑"),await re({preserveEditDraft:!0})))}Se(()=>$.value,t=>{t||(Z.value=!1)},{immediate:!0});const se=C([]),oe=C([]),fe=C(!1),ge=C(!1),q=Ue({channel_group_id:null,customer_group_id:null}),ke=C(null),ye=C(null),Ee=C(null);function bt(t){return t?.key!=="id_name"?null:e=>{e&&(ke.value=e)}}function ht(t){t&&(ye.value=t)}function wt(t){const e=h("owner");return!e||t?.key!==e?null:i=>{i&&(ye.value=i)}}function Vt(t){return t?t.closest?.(".kv-item")||t:null}function xt(t){t&&(t.classList.remove("flash-value"),t.offsetWidth,t.classList.add("flash-value"),window.setTimeout(()=>{t.classList.remove("flash-value")},Gi))}async function St({stableMs:t=260,eps:e=1.5,timeoutMs:i=2e3}={}){const r=Date.now();let p=window.scrollY,c=0;return await new Promise(V=>{function b(){const S=window.scrollY;if(Math.abs(S-p)<=e?c+=16:c=0,p=S,c>=t)return V(!0);if(Date.now()-r>=i)return V(!1);requestAnimationFrame(b)}requestAnimationFrame(b)})}async function Ye({targetEl:t,flashEls:e=[],title:i="提示",message:r="",confirmText:p="继续",cancelText:c="取消"}={}){const V=Vt(t)||t;V?.scrollIntoView&&V.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),await St({stableMs:260,eps:1.5,timeoutMs:2200});const b=Array.from(new Set([...(e||[]).filter(Boolean)]));for(const S of b)xt(S);await new Promise(S=>window.setTimeout(S,120));try{const S=typeof r=="string"?W("div",{style:"white-space: pre-line; line-height: 1.7;"},r):r;return await xe.confirm(S,i,{confirmButtonText:p,cancelButtonText:c,type:"warning",center:!0}),!0}catch{return!1}}const a=Ue({insurance_expire_date:"",owner_phone:"",remark:"",commercial_amount:null,commercial_after_amount:null,compulsory_amount:null,vehicle_tax_amount:null,non_vehicle_amount:null,premium_total:null,channel_commercial_point:null,channel_commercial_supplement_point:null,channel_compulsory_point:null,channel_vehicle_tax_point:null,channel_non_vehicle_point:null,channel_reward:null,channel_total:null,customer_commercial_point:null,customer_commercial_supplement_point:null,customer_compulsory_point:null,customer_vehicle_tax_point:null,customer_non_vehicle_point:null,customer_reward:null,customer_total:null,profit:null});function u(t){if(t==null||t==="")return null;const e=Number(t);return Number.isFinite(e)?e:null}function y(t){const e=u(t);return e===null?0:e}function $e(t){return t==null?"":String(t).trim()}function Ce(t){if(!t)return"";const e=String(t).trim();return e?/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:/^\d{4}-\d{2}-\d{2}/.test(e)?e.slice(0,10):e:""}function je(t){const e=t&&typeof t=="object"&&t.order_info&&typeof t.order_info=="object"?t.order_info:{};a.insurance_expire_date=Ce(e.insurance_expire_date),a.owner_phone=$e(e.owner_phone),a.remark=$e(e.remark),a.commercial_amount=u(e.commercial_amount),a.commercial_after_amount=u(e.commercial_after_amount),a.compulsory_amount=u(e.compulsory_amount),a.vehicle_tax_amount=u(e.vehicle_tax_amount),a.non_vehicle_amount=u(e.non_vehicle_amount),a.premium_total=u(e.premium_total),a.channel_commercial_point=u(e.channel_commercial_point),a.channel_commercial_supplement_point=u(e.channel_commercial_supplement_point),a.channel_compulsory_point=u(e.channel_compulsory_point),a.channel_vehicle_tax_point=u(e.channel_vehicle_tax_point),a.channel_non_vehicle_point=u(e.channel_non_vehicle_point),a.channel_reward=u(e.channel_reward),a.channel_total=u(e.channel_total),a.customer_commercial_point=u(e.customer_commercial_point),a.customer_commercial_supplement_point=u(e.customer_commercial_supplement_point),a.customer_compulsory_point=u(e.customer_compulsory_point),a.customer_vehicle_tax_point=u(e.customer_vehicle_tax_point),a.customer_non_vehicle_point=u(e.customer_non_vehicle_point),a.customer_reward=u(e.customer_reward),a.customer_total=u(e.customer_total),a.profit=u(e.profit),Le()}function Ut(){const t=String(a.owner_phone||"").trim(),e=String(a.remark||"").trim();return{insurance_expire_date:a.insurance_expire_date?String(a.insurance_expire_date):"",owner_phone:t,remark:e,commercial_amount:u(a.commercial_amount),commercial_after_amount:u(a.commercial_after_amount),compulsory_amount:u(a.compulsory_amount),vehicle_tax_amount:u(a.vehicle_tax_amount),non_vehicle_amount:u(a.non_vehicle_amount),channel_commercial_point:u(a.channel_commercial_point),channel_commercial_supplement_point:u(a.channel_commercial_supplement_point),channel_compulsory_point:u(a.channel_compulsory_point),channel_vehicle_tax_point:u(a.channel_vehicle_tax_point),channel_non_vehicle_point:u(a.channel_non_vehicle_point),channel_reward:u(a.channel_reward),customer_commercial_point:u(a.customer_commercial_point),customer_commercial_supplement_point:u(a.customer_commercial_supplement_point),customer_compulsory_point:u(a.customer_compulsory_point),customer_vehicle_tax_point:u(a.customer_vehicle_tax_point),customer_non_vehicle_point:u(a.customer_non_vehicle_point),customer_reward:u(a.customer_reward)}}function Le(){const t=u(a.commercial_amount),e=u(a.commercial_after_amount),i=u(a.compulsory_amount),r=u(a.vehicle_tax_amount),p=u(a.non_vehicle_amount),c=t===null?null:Math.max(0,t),V=e===null?null:Math.max(0,e),b=i===null?null:Math.max(0,i),S=r===null?null:Math.max(0,r),D=p===null?null:Math.max(0,p);a.commercial_amount=c,a.commercial_after_amount=V,a.compulsory_amount=b,a.vehicle_tax_amount=S,a.non_vehicle_amount=D;const L=[c,V,b,S,D].some(me=>typeof me=="number"),n=y(c)+y(V)+y(b)+y(S)+y(D);a.premium_total=L?n:null;const m=u(a.channel_commercial_point),w=u(a.channel_commercial_supplement_point),P=u(a.channel_compulsory_point),lt=u(a.channel_vehicle_tax_point),nt=u(a.channel_non_vehicle_point),at=u(a.channel_reward),it=u(a.customer_commercial_point),Te=u(a.customer_commercial_supplement_point),st=u(a.customer_compulsory_point),ot=u(a.customer_vehicle_tax_point),rt=u(a.customer_non_vehicle_point),dt=u(a.customer_reward),ul=[m,w,P,lt,nt,at].some(me=>typeof me=="number"),cl=[it,Te,st,ot,rt,dt].some(me=>typeof me=="number"),ml=y(c)*(y(m)/100)+y(c)*(y(w)/100)+y(V)*(y(w)/100)+y(b)*(y(P)/100)+y(S)*(y(lt)/100)+y(D)*(y(nt)/100)+y(at),vl=y(c)*(y(it)/100)+y(c)*(y(Te)/100)+y(V)*(y(Te)/100)+y(b)*(y(st)/100)+y(S)*(y(ot)/100)+y(D)*(y(rt)/100)+y(dt);a.channel_total=L||ul?ml:null,a.customer_total=L||cl?vl:null,a.channel_total===null||a.customer_total===null?a.profit=null:a.profit=y(a.channel_total)-y(a.customer_total)}Se(()=>[a.commercial_amount,a.commercial_after_amount,a.compulsory_amount,a.vehicle_tax_amount,a.non_vehicle_amount,a.channel_commercial_point,a.channel_commercial_supplement_point,a.channel_compulsory_point,a.channel_vehicle_tax_point,a.channel_non_vehicle_point,a.channel_reward,a.customer_commercial_point,a.customer_commercial_supplement_point,a.customer_compulsory_point,a.customer_vehicle_tax_point,a.customer_non_vehicle_point,a.customer_reward],()=>Le());const Ot=z(()=>{const t=Array.isArray(se.value)?se.value:[],e=q.channel_group_id;if(e==null||e==="")return t;const i=Number(e);if(t.some(c=>Number(c?.id)===i))return t;const p=k.value?.channel_group_name||`ID:${e}`;return[{id:e,group_name:`${p}（已删除）`,_ghost:!0},...t]}),zt=z(()=>{const t=Array.isArray(oe.value)?oe.value:[],e=q.customer_group_id;if(e==null||e==="")return t;const i=Number(e);if(t.some(c=>Number(c?.id)===i))return t;const p=k.value?.customer_group_name||`ID:${e}`;return[{id:e,group_name:`${p}（已删除）`,_ghost:!0},...t]}),{allFields:Et,loadConfig:Ct}=Ol(),Ke=z(()=>{const t=new Map;for(const e of Et.value||[])t.set(e.key,e);return t});function A(t){const e=String(t||"").trim();return Ke.value.get(e)||{key:e,label:e,type:"text",options:[]}}function be(t){return t?.key==="id_number"?"公民身份号码":t?.label||t?.key||""}function qe(t){if(t==null||t==="")return t;const e=String(t);return/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:t}function Dt(t,e){if(t==null||t==="")return"-";const i=e||{type:"text",options:[]},r=i.type==="date"?qe(t):t,p=zl(r,i);return p===""?"-":p}const g=Ue({}),te=z(()=>!k.value||Oe.value?!1:k.value.is_finished===!0?ze.value:ze.value?!0:pt.value&&k.value.is_finished===!1),_=z(()=>te.value&&X.value),J=z(()=>_.value?!0:$.value&&Z.value),It=z(()=>!k.value||k.value.is_finished!==!0?!1:ze.value);function He(t){const e=String(t||"").trim();return e&&(e==="vehicle_cert"||e==="idcard_front"||e==="idcard_back"||e==="driving_license_main"||e==="driving_license_sub"||e==="related")?e:""}function De(){return{vehicle_cert:[],idcard_front:[],idcard_back:[],driving_license_main:[],driving_license_sub:[],related:[]}}function At(t){const e=De();for(const[i,r]of Object.entries(t||{})){const p=new Set,c=[];for(const V of Array.isArray(r)?r:[]){const b=String(V||"").trim();!b||p.has(b)||(p.add(b),c.push(b))}e[i]=c}return e}const E=z(()=>{const t=De();for(const e of k.value?.images||[]){const i=He(e?.slot_key),r=String(e?.image_url||"").trim();!i||!r||t[i].push(r)}return At(t)}),Ie=z(()=>{const t=De();for(const e of k.value?.images||[]){const i=He(e?.slot_key);i&&(t[i]||(t[i]=[]),t[i].push(e))}return t}),Ft=Object.freeze(["id_name","id_gender","id_ethnicity","id_birth_date","id_address","id_number"]),Nt=Object.freeze(["id_issuer","id_validity"]),Mt=z(()=>Ft.map(t=>A(t))),Tt=z(()=>Nt.map(t=>A(t))),Bt=Object.freeze(["dl_plate_no","dl_owner","dl_use_nature","dl_vehicle_model","dl_vin","dl_engine_no","dl_register_date"]),Rt=Object.freeze(["dl_approved_passenger_count"]);function H(t){if(!t)return!1;if(Ke.value.has(t))return!0;const e=g?.[t];return!(e==null||e==="")}function We(t){const e=[],i=new Set;for(const r of Array.isArray(t)?t:[]){const p=String(r?.key||"");!p||i.has(p)||(i.add(p),e.push(r))}return e}const Pt=z(()=>{const t=Bt.filter(e=>H(e)).map(e=>A(e));return We(t)}),Yt=z(()=>{const t=Rt.filter(e=>H(e)).map(e=>A(e));return We(t)}),$t=z(()=>({plate:H("dl_plate_no")?"dl_plate_no":null,owner:H("dl_owner")?"dl_owner":null,use_nature:H("dl_use_nature")?"dl_use_nature":null,brand_model:H("dl_vehicle_model")?"dl_vehicle_model":null,vin:H("dl_vin")?"dl_vin":null,engine:H("dl_engine_no")?"dl_engine_no":null,register_date:H("dl_register_date")?"dl_register_date":null}));function h(t){return $t.value?.[t]||null}const he=z(()=>H("dl_approved_passenger_count")?"dl_approved_passenger_count":null),jt=z(()=>{const t=g||{};return{...t,vehicle_model:t.dl_vehicle_model??t.vehicle_model??"",vin:t.dl_vin??t.vin??"",engine_no:t.dl_engine_no??t.engine_no??""}});function Lt(){const t=ne.query?.from;if(typeof t=="string"&&t){let e=t;try{e=decodeURIComponent(t)}catch{e=t}if(e.startsWith("/")){ve.push(e);return}}if(window.history.length>1){ve.back();return}ve.push({path:Oe.value?"/finance":"/orders/all"})}function Kt(t){const e=Array.isArray(t)?t:[],i=[...new Set(e.map(r=>String(r||"").trim()).filter(Boolean))];return i.length?i.join("、"):""}const Ge=z(()=>{const t=Kt(k.value?.team_names);return t||String(k.value?.team_name??"").trim()||""});function Xe(t){if(t==null||t==="")return"-";const e=String(t).trim();if(!e)return"-";const i=e.match(/^(\d{4}-\d{2}-\d{2})/);return i&&i[1]?i[1]:/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:"-"}function Ze(t){const e=t?.dynamic_data||{};for(const i of Object.keys(g))delete g[i];for(const[i,r]of Object.entries(e))g[i]=r??"";q.customer_group_id=t?.customer_group_id??null,q.channel_group_id=t?.channel_group_id??null,je(t)}function Je(){if(te.value){if(X.value){X.value=!1,k.value&&Ze(k.value);return}X.value=!0,(!se.value.length||!oe.value.length)&&Ae()}}async function Ae(){fe.value=!0,ge.value=!0;try{const[t,e]=await Promise.all([Pe.get("/orders/channel-groups"),Pe.get("/orders/customer-groups")]);se.value=Array.isArray(t?.data?.items)?t.data.items:[],oe.value=Array.isArray(e?.data?.items)?e.data.items:[]}catch(t){console.error(t),N.error("加载渠道/客户选项失败")}finally{fe.value=!1,ge.value=!1}}function qt(){return $.value}async function re({preserveEditDraft:t=!1}={}){if(K){G.value=!0;try{const e=qt()?await wl(K):await gl(K);k.value=e.data,t?X.value||je(k.value):(X.value=!1,Ze(k.value))}catch(e){console.error(e),N.error("加载订单详情失败")}finally{G.value=!1}}}function Ht(t){return String(t||"").replace(/\s+/g,"").replace(/-/g,"")}function Wt(t){const e=Ht(t);return e?/^(?:\+?86)?1[3-9]\d{9}$/.test(e):!0}function Gt(){return String(g?.id_name||"").trim()}function Xt(){const t=h("owner");return t?String(g?.[t]||"").trim():""}async function Zt(){if(_.value){const i=String(a.owner_phone||"").trim();if(i&&!Wt(i))return await ct(),await Ye({targetEl:Ee.value,flashEls:[Ee.value],title:"电话格式不正确",message:"车主电话默认按手机号校验，请检查后再保存。",confirmText:"我知道了",cancelText:"取消"}),!1}const t=Gt(),e=Xt();return!(t&&e&&t!==e&&(await ct(),!await Ye({targetEl:ke.value||ye.value,flashEls:[ke.value,ye.value].filter(Boolean),title:"姓名不一致",message:`检测到证件姓名不一致：
身份证姓名【${t}】
行驶证所有人【${e}】
是否仍要继续保存？`,confirmText:"继续保存",cancelText:"取消保存"})))}async function Jt(){if(!(!k.value||!_.value||!await Zt())){j.value=!0;try{const e={...k.value.dynamic_data||{},...g};await bl(K,{dynamic_data:e,customer_group_id:q.customer_group_id,channel_group_id:q.channel_group_id,order_info:Ut()}),N.success("保存成功"),await re()}catch(e){console.error(e),N.error("保存失败")}finally{j.value=!1}}}async function Qt(){try{await xe.confirm("确认将该订单【退回未完成】？","确认操作",{confirmButtonText:"确认退回",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}await el()}async function el(){if(k.value){j.value=!0;try{await hl(K,{is_finished:!1}),N.success("已退回未完成"),await re()}catch(t){console.error(t),N.error("操作失败")}finally{j.value=!1}}}const de=C("smart");function tl(){const t=localStorage.getItem(mt);(t==="smart"||t==="direct"||t==="stable")&&(de.value=t)}tl();const O=Ue({vehicle_cert:!1,idcard_front:!1,idcard_back:!1,driving_license_main:!1,driving_license_sub:!1,related:!1}),ue=C([]),le=C(!1),Fe=C("");let we=null,Ne=0;function ll(t){try{return Date.parse(t)}catch{return 0}}async function nl(){const t=Date.now();if(we&&Ne&&t+12e4<Ne)return we;const i=(await Pe.get("/orders/bos-sts"))?.data;if(!i?.accessKeyId||!i?.secretAccessKey||!i?.sessionToken)throw new Error("bos-sts response invalid");return we=i,Fe.value=i.bosHost||"",Ne=ll(i.expiration)||t+600*1e3,we}function Q(t){const e=t?.message||t?.response?.data?.detail||t?.response?.data?.message||"";return String(e||"")}function Qe(t){const e=Q(t).toLowerCase();return e.includes("failed to fetch")||e.includes("network error")||e.includes("err_")||e.includes("cors")||e.includes("代理")||e.includes("vpn")||e.includes("127.0.0.1:7890")}async function et(t){try{await xe.confirm(`上传看起来被当前网络环境拦截（常见于 VPN/代理/公司网关）。

是否切换到【稳定模式上传】继续？`,"上传失败（网络拦截）",{confirmButtonText:"切换为稳定模式",cancelButtonText:"继续直传重试",type:"warning",center:!0,distinguishCancelAndClose:!0}),de.value="stable";try{localStorage.setItem(mt,"stable")}catch{}return!0}catch{return!1}}function al(t){try{return(new URL(String(t)).pathname||"").replace(/^\/+/,"")}catch{const e=String(t||""),i=e.indexOf("://");if(i>=0){const r=e.slice(i+3),p=r.indexOf("/");if(p>=0)return r.slice(p+1).replace(/^\/+/,"")}return""}}function il(t){const e=(t?.storage_key||t?.image_file?.storage_key||"").trim().replace(/^\/+/,"");if(e)return e;const i=(t?.image_url||t?.url||"").trim();return i?al(i):""}function sl(t){const i=String(t||"").match(/([a-f0-9]{32})\.[a-z0-9]+$/i);return i?String(i[1]).toLowerCase():""}function Me(t,e){const i=il(t);if(!i)return null;const r=sl(i)||"";return{slot_key:e,storage_key:i,md5:r,size:0}}async function Ve(t,e){if($.value){const c=(await xl({order_id:K,slot_key:t,file:e}))?.data;return{slot_key:t,storage_key:c?.storage_key,md5:c?.md5||"",size:c?.size||e?.size||0,content_type:c?.content_type||e?.type||"application/octet-stream",etag:c?.etag||"",original_name:c?.original_name||e?.name||"file",url:c?.url||""}}if(de.value==="stable"){const c=(await yl({slot_key:t,file:e}))?.data;return{slot_key:t,storage_key:c?.storage_key,md5:c?.md5||"",size:c?.size||e?.size||0,content_type:c?.content_type||e?.type||"application/octet-stream",etag:c?.etag||"",original_name:c?.original_name||e?.name||"file",url:c?.url||""}}const i=await nl();if(!Fe.value)throw new Error("bosHost missing");const r=await El({bosHost:Fe.value,slotKey:t,file:e,sts:i});return{slot_key:t,storage_key:r?.storage_key,md5:r?.md5||"",size:r?.size||e?.size||0,content_type:r?.content_type||e?.type||"application/octet-stream",etag:r?.etag||"",original_name:r?.original_name||e?.name||"file",url:r?.url||""}}async function ee(t,e,{clear:i=!1}={}){const r=i?[t]:[];$.value?await Vl({order_id:K,images:e,clear_slots:r}):await kl({order_id:K,images:e,clear_slots:r}),await re({preserveEditDraft:!0}),N.success("图片已更新（如涉及证件将触发 OCR 任务）")}async function ce(t,e){if(!_.value)return;const i=e?.raw;if(i){O[t]=!0;try{const r=await Ve(t,i);if(!r?.storage_key)throw new Error("upload meta invalid");await ee(t,[r])}catch(r){if(!$.value&&de.value==="smart"&&Qe(r)&&await et())try{const c=await Ve(t,i);if(!c?.storage_key)throw new Error("upload meta invalid");await ee(t,[c]);return}catch(c){console.error(c),N.error(Q(c)||"上传失败");return}console.error(r),N.error(Q(r)||"上传失败")}finally{O[t]=!1}}}async function ol(t){if(!J.value)return;const e=t?.raw;e&&(ue.value.push(e),!O.related&&await tt())}async function tt(){if(O.related)return;const t=ue.value.splice(0);if(t.length){O.related=!0;try{const e=(Ie.value.related||[]).map(r=>Me(r,"related")).filter(Boolean),i=[];for(const r of t){const p=await Ve("related",r);if(!p?.storage_key)throw new Error("upload meta invalid");i.push(p)}i.length&&await ee("related",[...e,...i]),le.value=!1}catch(e){if(!$.value&&de.value==="smart"&&Qe(e)&&!le.value&&await et()){le.value=!0;try{const r=(Ie.value.related||[]).map(c=>Me(c,"related")).filter(Boolean),p=[];for(const c of t){const V=await Ve("related",c);if(!V?.storage_key)throw new Error("upload meta invalid");p.push(V)}p.length&&await ee("related",[...r,...p]),le.value=!1}catch(r){console.error(r),N.error(Q(r)||"上传失败")}return}console.error(e),N.error(Q(e)||"上传失败")}finally{O.related=!1,ue.value.length&&tt()}}}async function rl(t){if(!J.value)return;const e=(Ie.value.related||[]).slice();if(!(t<0||t>=e.length)){O.related=!0;try{const i=e.filter((r,p)=>p!==t).map(r=>Me(r,"related")).filter(Boolean);if(!i.length){await ee("related",[],{clear:!0});return}await ee("related",i)}catch(i){console.error(i),N.error(Q(i)||"删除失败")}finally{O.related=!1}}}async function dl(){if(J.value&&E.value.related.length){try{await xe.confirm("确认清空【备用图】所有图片？","确认清空",{confirmButtonText:"确认清空",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}ue.value=[],le.value=!1,O.related=!0;try{await ee("related",[],{clear:!0})}catch(t){console.error(t),N.error(Q(t)||"清空失败")}finally{O.related=!1}}}Cl(async()=>{K&&(await Ct("order"),await re(),te.value&&await Ae())});const F=ut({name:"FieldValue",props:{modelValue:{type:[String,Number,Date],default:""},field:{type:Object,required:!0},editable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:e}){const i=R("el-input"),r=R("el-select"),p=R("el-option"),c=R("el-date-picker"),V=b=>e("update:modelValue",b);return()=>{const b=t.field||{type:"text",options:[]},S=t.modelValue??"",D=Dt(S,b);if(!t.editable)return W("span",{class:"plain-value",title:D},D);if(b.type==="date"){const L=qe(S)??"";return W(c,{modelValue:L,"onUpdate:modelValue":V,type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}if(b.type==="select"){const L=Array.isArray(b.options)?b.options:[];return W(r,{modelValue:S,"onUpdate:modelValue":V,filterable:!0,clearable:!0,class:"fv fv-select"},()=>L.map(n=>{const m=n&&typeof n=="object"?n.label:String(n),w=n&&typeof n=="object"?n.value:n;return W(p,{key:String(w),label:m,value:w})}))}return W(i,{modelValue:S,"onUpdate:modelValue":V,clearable:!0,class:"fv fv-input"})}}}),U=ut({name:"InfoValue",props:{modelValue:{type:[String,Number,null],default:""},type:{type:String,default:"text"},editable:{type:Boolean,default:!1},min:{type:Number,default:void 0},max:{type:Number,default:void 0}},emits:["update:modelValue"],setup(t,{emit:e}){const i=R("el-input"),r=R("el-date-picker"),p=C(""),c=C(!1);function V(m){return m==null||m===""?"":String(m)}function b(){c.value||(p.value=V(t.modelValue))}Se(()=>t.modelValue,()=>b(),{immediate:!0});function S(m){let w=m;return typeof t.min=="number"&&(w=Math.max(t.min,w)),typeof t.max=="number"&&(w=Math.min(t.max,w)),w}function D(){p.value="",e("update:modelValue",null)}function L(){c.value=!1;const m=String(p.value||"").trim();if(!m){D();return}const w=Number(m);if(!Number.isFinite(w)){D();return}let P=S(w);if(t.type==="money"){P=Math.round(P*100)/100,e("update:modelValue",P),p.value=P.toFixed(2);return}e("update:modelValue",P),p.value=String(P)}function n(m){if(m==null||m==="")return"-";const w=Number(m);return t.type==="money"?Number.isFinite(w)?w.toFixed(2):"-":t.type==="point"?Number.isFinite(w)?String(w):"-":t.type==="date"?Ce(m)||"-":String(m)}return()=>{const m=t.modelValue??"";if(!t.editable){const w=n(m);return W("span",{class:"plain-value",title:w},w)}if(t.type==="date"){const w=Ce(m);return W(r,{modelValue:w,"onUpdate:modelValue":P=>e("update:modelValue",P),type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}return t.type==="money"||t.type==="point"?W(i,{modelValue:p.value,"onUpdate:modelValue":w=>{p.value=String(w??"")},clearable:!0,class:"fv fv-input",inputmode:"decimal",onFocus:()=>{c.value=!0},onBlur:()=>L(),onClear:()=>D()}):W(i,{modelValue:m,"onUpdate:modelValue":w=>e("update:modelValue",w),clearable:!0,class:"fv fv-input"})}}});return Se(()=>te.value,t=>{t&&(!se.value.length||!oe.value.length)&&Ae()}),(t,e)=>{const i=R("el-button"),r=R("el-card"),p=R("el-option"),c=R("el-select"),V=R("el-upload"),b=R("el-image"),S=R("el-icon"),D=R("el-tooltip"),L=Il("loading");return o(),d("div",Al,[l("div",Fl,[e[51]||(e[51]=l("h2",null,"订单详情",-1)),l("div",Nl,[s(i,{size:"small",onClick:Lt},{default:v(()=>[...e[43]||(e[43]=[I("返回",-1)])]),_:1}),$.value&&k.value?(o(),d(M,{key:0},[Z.value?(o(),d(M,{key:1},[s(i,{size:"small",plain:"",disabled:G.value||j.value||O.related,onClick:kt},{default:v(()=>[...e[45]||(e[45]=[I(" 退出编辑 ",-1)])]),_:1},8,["disabled"]),s(i,{size:"small",type:"primary",disabled:G.value||j.value||O.related,onClick:yt},{default:v(()=>[...e[46]||(e[46]=[I(" 完成编辑 ",-1)])]),_:1},8,["disabled"])],64)):(o(),T(i,{key:0,size:"small",type:"primary",plain:"",disabled:G.value||j.value||O.related,onClick:gt},{default:v(()=>[...e[44]||(e[44]=[I(" 编辑 ",-1)])]),_:1},8,["disabled"]))],64)):(o(),d(M,{key:1},[It.value?(o(),T(i,{key:0,size:"small",type:"warning",plain:"",loading:j.value,onClick:Qt},{default:v(()=>[...e[47]||(e[47]=[I(" 退回未完成 ",-1)])]),_:1},8,["loading"])):x("",!0),te.value&&!X.value?(o(),T(i,{key:1,size:"small",type:"primary",plain:"",disabled:G.value||j.value,onClick:Je},{default:v(()=>[...e[48]||(e[48]=[I(" 编辑 ",-1)])]),_:1},8,["disabled"])):x("",!0),te.value&&X.value?(o(),T(i,{key:2,size:"small",plain:"",disabled:G.value||j.value,onClick:Je},{default:v(()=>[...e[49]||(e[49]=[I(" 取消编辑 ",-1)])]),_:1},8,["disabled"])):x("",!0),_.value?(o(),T(i,{key:3,size:"small",type:"primary",loading:j.value,onClick:Jt},{default:v(()=>[...e[50]||(e[50]=[I("保存",-1)])]),_:1},8,["loading"])):x("",!0)],64))])]),Dl((o(),d("div",Ml,[s(r,{shadow:"never",class:"section-card meta-card"},{header:v(()=>[...e[52]||(e[52]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"基础信息")],-1)])]),default:v(()=>[l("div",Tl,[l("div",Bl,[e[53]||(e[53]=l("div",{class:"kv-label"},"订单ID",-1)),l("div",Rl,[l("span",Pl,B(k.value?.id??"-"),1)])]),l("div",Yl,[e[54]||(e[54]=l("div",{class:"kv-label"},"完成状态",-1)),l("div",$l,[l("span",jl,B(k.value?.is_finished===!0?"已完成":"未完成"),1)])]),l("div",Ll,[e[55]||(e[55]=l("div",{class:"kv-label"},"业务员",-1)),l("div",Kl,[l("span",{class:"plain-value",title:k.value?.salesperson_name||"-"},B(k.value?.salesperson_name||"-"),9,ql)])]),l("div",Hl,[e[56]||(e[56]=l("div",{class:"kv-label"},"所属经理",-1)),l("div",Wl,[l("span",{class:"plain-value",title:k.value?.manager_name||"-"},B(k.value?.manager_name||"-"),9,Gl)])]),l("div",Xl,[e[57]||(e[57]=l("div",{class:"kv-label"},"所属团队",-1)),l("div",Zl,[l("span",{class:"plain-value",title:Ge.value||"-"},B(Ge.value||"-"),9,Jl)])]),l("div",Ql,[e[58]||(e[58]=l("div",{class:"kv-label"},"回款/返点",-1)),l("div",en,[l("span",tn," 回款："+B(k.value?.is_paid===!0?"是":"否")+"，返点："+B(k.value?.is_rebate===!0?"是":"否"),1)])]),l("div",ln,[e[59]||(e[59]=l("div",{class:"kv-label"},"创建时间",-1)),l("div",nn,[l("span",an,B(Xe(k.value?.created_at)),1)])]),l("div",sn,[e[60]||(e[60]=l("div",{class:"kv-label"},"更新时间",-1)),l("div",on,[l("span",rn,B(Xe(k.value?.updated_at)),1)])])])]),_:1}),s(r,{shadow:"never",class:"section-card meta-card"},{header:v(()=>[...e[61]||(e[61]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"渠道、客户")],-1)])]),default:v(()=>[l("div",dn,[l("div",un,[e[62]||(e[62]=l("div",{class:"kv-label"},"渠道",-1)),l("div",cn,[_.value?(o(),T(c,{key:0,modelValue:q.channel_group_id,"onUpdate:modelValue":e[0]||(e[0]=n=>q.channel_group_id=n),filterable:"",clearable:"",placeholder:"请选择渠道",class:"fv fv-select",loading:fe.value,disabled:fe.value},{default:v(()=>[(o(!0),d(M,null,Y(Ot.value,n=>(o(),T(p,{key:String(n.id),label:n.group_name||String(n.id),value:n.id,disabled:!!n._ghost},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading","disabled"])):(o(),d("span",{key:1,class:"plain-value",title:k.value?.channel_group_name||"-"},B(k.value?.channel_group_name||"-"),9,mn))])]),l("div",vn,[e[63]||(e[63]=l("div",{class:"kv-label"},"客户",-1)),l("div",_n,[_.value?(o(),T(c,{key:0,modelValue:q.customer_group_id,"onUpdate:modelValue":e[1]||(e[1]=n=>q.customer_group_id=n),filterable:"",clearable:"",placeholder:"请选择客户",class:"fv fv-select",loading:ge.value,disabled:ge.value},{default:v(()=>[(o(!0),d(M,null,Y(zt.value,n=>(o(),T(p,{key:String(n.id),label:n.group_name||String(n.id),value:n.id,disabled:!!n._ghost},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading","disabled"])):(o(),d("span",{key:1,class:"plain-value",title:k.value?.customer_group_name||"-"},B(k.value?.customer_group_name||"-"),9,pn))])])])]),_:1}),s(r,{shadow:"never",class:"section-card"},{header:v(()=>[...e[64]||(e[64]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"备用图")],-1)])]),default:v(()=>[J.value?(o(),d("div",fn,[s(V,{drag:"","auto-upload":!1,multiple:!0,"show-file-list":!1,accept:"image/*",disabled:O.related,"on-change":n=>ol(n),class:"related-dragger"},{default:v(()=>[...e[65]||(e[65]=[l("div",{class:"drag-inner"},[l("div",{class:"drag-title"},"拖拽图片到这里"),l("div",{class:"drag-sub"},"或点击选择（支持多张）")],-1)])]),_:1},8,["disabled","on-change"]),s(i,{size:"small",type:"danger",plain:"",disabled:O.related||!E.value.related.length,loading:O.related,onClick:dl},{default:v(()=>[...e[66]||(e[66]=[I(" 清空 ",-1)])]),_:1},8,["disabled","loading"])])):x("",!0),J.value||E.value.related.length?(o(),d("div",gn,[(o(!0),d(M,null,Y(E.value.related,(n,m)=>(o(),d("div",{key:n+":"+m,class:"thumb-wrap"},[s(b,{src:n,"preview-src-list":E.value.related,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"]),J.value?(o(),d("button",{key:0,type:"button",class:"thumb-remove",title:"删除这张",onClick:w=>rl(m)}," × ",8,kn)):x("",!0)]))),128)),J.value&&!E.value.related.length?(o(),d("div",yn)):x("",!0)])):x("",!0)]),_:1}),s(r,{shadow:"never",class:"section-card"},{header:v(()=>[...e[67]||(e[67]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"订单信息")],-1)])]),default:v(()=>[l("div",bn,[l("div",hn,[l("div",wn,[e[68]||(e[68]=l("div",{class:"kv-label"},"保险到期日",-1)),l("div",Vn,[s(f(U),{modelValue:a.insurance_expire_date,"onUpdate:modelValue":e[2]||(e[2]=n=>a.insurance_expire_date=n),type:"date",editable:_.value},null,8,["modelValue","editable"])])]),l("div",xn,[e[69]||(e[69]=l("div",{class:"kv-label"},"车主电话",-1)),l("div",{class:"kv-value",ref_key:"ownerPhoneValueRef",ref:Ee},[s(f(U),{modelValue:a.owner_phone,"onUpdate:modelValue":e[3]||(e[3]=n=>a.owner_phone=n),type:"text",editable:_.value},null,8,["modelValue","editable"])],512)])]),l("div",Sn,[l("div",Un,[e[70]||(e[70]=l("div",{class:"kv-label"},"订单备注",-1)),l("div",On,[s(f(U),{modelValue:a.remark,"onUpdate:modelValue":e[4]||(e[4]=n=>a.remark=n),type:"text",editable:_.value},null,8,["modelValue","editable"])])])]),l("div",zn,[l("div",En,[e[71]||(e[71]=l("div",{class:"kv-label"},"商业金额",-1)),l("div",Cn,[s(f(U),{modelValue:a.commercial_amount,"onUpdate:modelValue":e[5]||(e[5]=n=>a.commercial_amount=n),type:"money",editable:_.value,min:0},null,8,["modelValue","editable"])])]),l("div",Dn,[e[72]||(e[72]=l("div",{class:"kv-label"},"商业后补",-1)),l("div",In,[s(f(U),{modelValue:a.commercial_after_amount,"onUpdate:modelValue":e[6]||(e[6]=n=>a.commercial_after_amount=n),type:"money",editable:_.value,min:0},null,8,["modelValue","editable"])])]),l("div",An,[e[73]||(e[73]=l("div",{class:"kv-label"},"交强金额",-1)),l("div",Fn,[s(f(U),{modelValue:a.compulsory_amount,"onUpdate:modelValue":e[7]||(e[7]=n=>a.compulsory_amount=n),type:"money",editable:_.value,min:0},null,8,["modelValue","editable"])])]),l("div",Nn,[e[74]||(e[74]=l("div",{class:"kv-label"},"车船税金额",-1)),l("div",Mn,[s(f(U),{modelValue:a.vehicle_tax_amount,"onUpdate:modelValue":e[8]||(e[8]=n=>a.vehicle_tax_amount=n),type:"money",editable:_.value,min:0},null,8,["modelValue","editable"])])])]),l("div",Tn,[l("div",Bn,[e[75]||(e[75]=l("div",{class:"kv-label"},"非车金额",-1)),l("div",Rn,[s(f(U),{modelValue:a.non_vehicle_amount,"onUpdate:modelValue":e[9]||(e[9]=n=>a.non_vehicle_amount=n),type:"money",editable:_.value,min:0},null,8,["modelValue","editable"])])]),l("div",Pn,[e[76]||(e[76]=l("div",{class:"kv-label"},"保费金额",-1)),l("div",Yn,[s(f(U),{modelValue:a.premium_total,"onUpdate:modelValue":e[10]||(e[10]=n=>a.premium_total=n),type:"money",editable:!1},null,8,["modelValue"])])])])]),e[92]||(e[92]=l("div",{class:"split-title"},"渠道",-1)),l("div",$n,[l("div",jn,[e[77]||(e[77]=l("div",{class:"kv-label"},"商业点位%",-1)),l("div",Ln,[s(f(U),{modelValue:a.channel_commercial_point,"onUpdate:modelValue":e[11]||(e[11]=n=>a.channel_commercial_point=n),type:"point",editable:_.value},null,8,["modelValue","editable"])])]),l("div",Kn,[e[78]||(e[78]=l("div",{class:"kv-label"},"商业后补%",-1)),l("div",qn,[s(f(U),{modelValue:a.channel_commercial_supplement_point,"onUpdate:modelValue":e[12]||(e[12]=n=>a.channel_commercial_supplement_point=n),type:"point",editable:_.value},null,8,["modelValue","editable"])])]),l("div",Hn,[e[79]||(e[79]=l("div",{class:"kv-label"},"交强点位%",-1)),l("div",Wn,[s(f(U),{modelValue:a.channel_compulsory_point,"onUpdate:modelValue":e[13]||(e[13]=n=>a.channel_compulsory_point=n),type:"point",editable:_.value},null,8,["modelValue","editable"])])]),l("div",Gn,[e[80]||(e[80]=l("div",{class:"kv-label"},"车船税点位%",-1)),l("div",Xn,[s(f(U),{modelValue:a.channel_vehicle_tax_point,"onUpdate:modelValue":e[14]||(e[14]=n=>a.channel_vehicle_tax_point=n),type:"point",editable:_.value},null,8,["modelValue","editable"])])]),l("div",Zn,[e[81]||(e[81]=l("div",{class:"kv-label"},"非车点位%",-1)),l("div",Jn,[s(f(U),{modelValue:a.channel_non_vehicle_point,"onUpdate:modelValue":e[15]||(e[15]=n=>a.channel_non_vehicle_point=n),type:"point",editable:_.value},null,8,["modelValue","editable"])])]),l("div",Qn,[e[82]||(e[82]=l("div",{class:"kv-label"},"出单奖励",-1)),l("div",ea,[s(f(U),{modelValue:a.channel_reward,"onUpdate:modelValue":e[16]||(e[16]=n=>a.channel_reward=n),type:"money",editable:_.value},null,8,["modelValue","editable"])])])]),l("div",ta,[l("div",la,[e[83]||(e[83]=l("div",{class:"kv-label"},"渠道合计",-1)),l("div",na,[s(f(U),{modelValue:a.channel_total,"onUpdate:modelValue":e[17]||(e[17]=n=>a.channel_total=n),type:"money",editable:!1},null,8,["modelValue"])])])]),e[93]||(e[93]=l("div",{class:"split-title"},"客户",-1)),l("div",aa,[l("div",ia,[e[84]||(e[84]=l("div",{class:"kv-label"},"商业点位%",-1)),l("div",sa,[s(f(U),{modelValue:a.customer_commercial_point,"onUpdate:modelValue":e[18]||(e[18]=n=>a.customer_commercial_point=n),type:"point",editable:_.value},null,8,["modelValue","editable"])])]),l("div",oa,[e[85]||(e[85]=l("div",{class:"kv-label"},"商业后补%",-1)),l("div",ra,[s(f(U),{modelValue:a.customer_commercial_supplement_point,"onUpdate:modelValue":e[19]||(e[19]=n=>a.customer_commercial_supplement_point=n),type:"point",editable:_.value},null,8,["modelValue","editable"])])]),l("div",da,[e[86]||(e[86]=l("div",{class:"kv-label"},"交强点位%",-1)),l("div",ua,[s(f(U),{modelValue:a.customer_compulsory_point,"onUpdate:modelValue":e[20]||(e[20]=n=>a.customer_compulsory_point=n),type:"point",editable:_.value},null,8,["modelValue","editable"])])]),l("div",ca,[e[87]||(e[87]=l("div",{class:"kv-label"},"车船税点位%",-1)),l("div",ma,[s(f(U),{modelValue:a.customer_vehicle_tax_point,"onUpdate:modelValue":e[21]||(e[21]=n=>a.customer_vehicle_tax_point=n),type:"point",editable:_.value},null,8,["modelValue","editable"])])]),l("div",va,[e[88]||(e[88]=l("div",{class:"kv-label"},"非车点位%",-1)),l("div",_a,[s(f(U),{modelValue:a.customer_non_vehicle_point,"onUpdate:modelValue":e[22]||(e[22]=n=>a.customer_non_vehicle_point=n),type:"point",editable:_.value},null,8,["modelValue","editable"])])]),l("div",pa,[e[89]||(e[89]=l("div",{class:"kv-label"},"出单奖励",-1)),l("div",fa,[s(f(U),{modelValue:a.customer_reward,"onUpdate:modelValue":e[23]||(e[23]=n=>a.customer_reward=n),type:"money",editable:_.value},null,8,["modelValue","editable"])])])]),l("div",ga,[l("div",ka,[e[90]||(e[90]=l("div",{class:"kv-label"},"客户合计",-1)),l("div",ya,[s(f(U),{modelValue:a.customer_total,"onUpdate:modelValue":e[24]||(e[24]=n=>a.customer_total=n),type:"money",editable:!1},null,8,["modelValue"])])])]),l("div",ba,[l("div",ha,[e[91]||(e[91]=l("div",{class:"kv-label"},"利润",-1)),l("div",wa,[s(f(U),{modelValue:a.profit,"onUpdate:modelValue":e[25]||(e[25]=n=>a.profit=n),type:"money",editable:!1},null,8,["modelValue"])])])])]),_:1}),s(r,{shadow:"never",class:"section-card"},{header:v(()=>[l("div",Va,[e[94]||(e[94]=l("div",{class:"section-title"},"车辆合格证",-1)),s(i,{class:"icon-btn",circle:"",size:"small",onClick:e[26]||(e[26]=n=>pe.value=!pe.value)},{default:v(()=>[s(S,null,{default:v(()=>[pe.value?(o(),T(f(Be),{key:0})):(o(),T(f(Re),{key:1}))]),_:1})]),_:1})])]),default:v(()=>[l("div",xa,[l("div",Sa,[pe.value?(o(),d("div",Na,[s(fl,{data:jt.value,readonly:!_.value},null,8,["data","readonly"])])):(o(),d("div",Ua,[l("div",Oa,[e[95]||(e[95]=l("div",{class:"kv-label"},"车辆型号",-1)),l("div",za,[s(f(F),{modelValue:g.dl_vehicle_model,"onUpdate:modelValue":e[27]||(e[27]=n=>g.dl_vehicle_model=n),field:A("dl_vehicle_model"),editable:_.value},null,8,["modelValue","field","editable"])])]),l("div",Ea,[e[96]||(e[96]=l("div",{class:"kv-label"},"车辆识别代号/车架号",-1)),l("div",Ca,[s(f(F),{modelValue:g.dl_vin,"onUpdate:modelValue":e[28]||(e[28]=n=>g.dl_vin=n),field:A("dl_vin"),editable:_.value},null,8,["modelValue","field","editable"])])]),l("div",Da,[e[97]||(e[97]=l("div",{class:"kv-label"},"发动机号",-1)),l("div",Ia,[s(f(F),{modelValue:g.dl_engine_no,"onUpdate:modelValue":e[29]||(e[29]=n=>g.dl_engine_no=n),field:A("dl_engine_no"),editable:_.value},null,8,["modelValue","field","editable"])])]),l("div",Aa,[e[98]||(e[98]=l("div",{class:"kv-label"},"额定载客(人 )",-1)),l("div",Fa,[s(f(F),{modelValue:g.approved_passenger_count,"onUpdate:modelValue":e[30]||(e[30]=n=>g.approved_passenger_count=n),field:A("approved_passenger_count"),editable:_.value},null,8,["modelValue","field","editable"])])])]))]),l("div",Ma,[_.value?(o(),d("div",Ta,[s(V,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>ce("vehicle_cert",n)},{default:v(()=>[s(i,{size:"small",type:"primary",plain:"",loading:O.vehicle_cert},{default:v(()=>[...e[99]||(e[99]=[I("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),s(D,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:v(()=>[l("span",null,[s(i,{size:"small",disabled:""},{default:v(()=>[...e[100]||(e[100]=[I("清空",-1)])]),_:1})])]),_:1})])):x("",!0),l("div",Ba,[(o(!0),d(M,null,Y(E.value.vehicle_cert,(n,m)=>(o(),d("div",{key:n+":"+m,class:"thumb-wrap"},[s(b,{src:n,"preview-src-list":E.value.vehicle_cert,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),E.value.vehicle_cert.length?x("",!0):(o(),d("div",Ra))])])])]),_:1}),s(r,{shadow:"never",class:"section-card"},{header:v(()=>[l("div",Pa,[e[101]||(e[101]=l("div",{class:"section-title"},"身份证正面/身份证背面",-1)),s(i,{class:"icon-btn",circle:"",size:"small",onClick:e[31]||(e[31]=n=>ae.value=!ae.value)},{default:v(()=>[s(S,null,{default:v(()=>[ae.value?(o(),T(f(Be),{key:0})):(o(),T(f(Re),{key:1}))]),_:1})]),_:1})])]),default:v(()=>[l("div",Ya,[l("div",$a,[e[106]||(e[106]=l("div",{class:"sub-title"},"身份证正面",-1)),l("div",ja,[l("div",La,[ae.value?(o(),d("div",Ga,[(o(!0),d(M,null,Y(Mt.value,n=>(o(),d("div",{key:n.key,class:"kv-item"},[l("div",Xa,B(be(n)),1),l("div",{class:"kv-value",ref_for:!0,ref:bt(n)},[s(f(F),{modelValue:g[n.key],"onUpdate:modelValue":m=>g[n.key]=m,field:n,editable:_.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])],512)]))),128))])):(o(),d("div",Ka,[l("div",qa,[e[102]||(e[102]=l("div",{class:"kv-label"},"姓名",-1)),l("div",{class:"kv-value",ref_key:"idNameValueRef",ref:ke},[s(f(F),{modelValue:g.id_name,"onUpdate:modelValue":e[32]||(e[32]=n=>g.id_name=n),field:A("id_name"),editable:_.value},null,8,["modelValue","field","editable"])],512)]),l("div",Ha,[e[103]||(e[103]=l("div",{class:"kv-label"},"公民身份号码",-1)),l("div",Wa,[s(f(F),{modelValue:g.id_number,"onUpdate:modelValue":e[33]||(e[33]=n=>g.id_number=n),field:A("id_number"),editable:_.value},null,8,["modelValue","field","editable"])])])]))]),l("div",Za,[_.value?(o(),d("div",Ja,[s(V,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>ce("idcard_front",n)},{default:v(()=>[s(i,{size:"small",type:"primary",plain:"",loading:O.idcard_front},{default:v(()=>[...e[104]||(e[104]=[I("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),s(D,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:v(()=>[l("span",null,[s(i,{size:"small",disabled:""},{default:v(()=>[...e[105]||(e[105]=[I("清空",-1)])]),_:1})])]),_:1})])):x("",!0),l("div",Qa,[(o(!0),d(M,null,Y(E.value.idcard_front,(n,m)=>(o(),d("div",{key:n+":"+m,class:"thumb-wrap"},[s(b,{src:n,"preview-src-list":E.value.idcard_front,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),E.value.idcard_front.length?x("",!0):(o(),d("div",ei))])])])]),l("div",ti,[e[109]||(e[109]=l("div",{class:"sub-title"},"身份证背面",-1)),l("div",li,[l("div",ni,[ae.value?(o(),d("div",ai,[(o(!0),d(M,null,Y(Tt.value,n=>(o(),d("div",{key:n.key,class:"kv-item"},[l("div",ii,B(be(n)),1),l("div",si,[s(f(F),{modelValue:g[n.key],"onUpdate:modelValue":m=>g[n.key]=m,field:n,editable:_.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])])]))),128))])):x("",!0)]),l("div",oi,[_.value?(o(),d("div",ri,[s(V,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>ce("idcard_back",n)},{default:v(()=>[s(i,{size:"small",type:"primary",plain:"",loading:O.idcard_back},{default:v(()=>[...e[107]||(e[107]=[I("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),s(D,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:v(()=>[l("span",null,[s(i,{size:"small",disabled:""},{default:v(()=>[...e[108]||(e[108]=[I("清空",-1)])]),_:1})])]),_:1})])):x("",!0),l("div",di,[(o(!0),d(M,null,Y(E.value.idcard_back,(n,m)=>(o(),d("div",{key:n+":"+m,class:"thumb-wrap"},[s(b,{src:n,"preview-src-list":E.value.idcard_back,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),E.value.idcard_back.length?x("",!0):(o(),d("div",ui))])])])])])]),_:1}),s(r,{shadow:"never",class:"section-card"},{header:v(()=>[l("div",ci,[e[110]||(e[110]=l("div",{class:"section-title"},"行驶证/行驶证副件",-1)),s(i,{class:"icon-btn",circle:"",size:"small",onClick:e[34]||(e[34]=n=>ie.value=!ie.value)},{default:v(()=>[s(S,null,{default:v(()=>[ie.value?(o(),T(f(Be),{key:0})):(o(),T(f(Re),{key:1}))]),_:1})]),_:1})])]),default:v(()=>[l("div",mi,[l("div",vi,[e[120]||(e[120]=l("div",{class:"sub-title"},"行驶证",-1)),l("div",_i,[l("div",pi,[ie.value?(o(),d("div",Ci,[(o(!0),d(M,null,Y(Pt.value,n=>(o(),d("div",{key:n.key,class:"kv-item"},[l("div",Di,B(be(n)),1),l("div",{class:"kv-value",ref_for:!0,ref:wt(n)},[s(f(F),{modelValue:g[n.key],"onUpdate:modelValue":m=>g[n.key]=m,field:n,editable:_.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])],512)]))),128))])):(o(),d("div",fi,[h("plate")?(o(),d("div",gi,[e[111]||(e[111]=l("div",{class:"kv-label"},"号牌号码",-1)),l("div",ki,[s(f(F),{modelValue:g[h("plate")],"onUpdate:modelValue":e[35]||(e[35]=n=>g[h("plate")]=n),field:A(h("plate")),editable:_.value},null,8,["modelValue","field","editable"])])])):x("",!0),h("owner")?(o(),d("div",yi,[e[112]||(e[112]=l("div",{class:"kv-label"},"所有人",-1)),l("div",{class:"kv-value",ref:ht},[s(f(F),{modelValue:g[h("owner")],"onUpdate:modelValue":e[36]||(e[36]=n=>g[h("owner")]=n),field:A(h("owner")),editable:_.value},null,8,["modelValue","field","editable"])])])):x("",!0),h("use_nature")?(o(),d("div",bi,[e[113]||(e[113]=l("div",{class:"kv-label"},"使用性质",-1)),l("div",hi,[s(f(F),{modelValue:g[h("use_nature")],"onUpdate:modelValue":e[37]||(e[37]=n=>g[h("use_nature")]=n),field:A(h("use_nature")),editable:_.value},null,8,["modelValue","field","editable"])])])):x("",!0),h("brand_model")?(o(),d("div",wi,[e[114]||(e[114]=l("div",{class:"kv-label"},"品牌型号",-1)),l("div",Vi,[s(f(F),{modelValue:g[h("brand_model")],"onUpdate:modelValue":e[38]||(e[38]=n=>g[h("brand_model")]=n),field:A(h("brand_model")),editable:_.value},null,8,["modelValue","field","editable"])])])):x("",!0),h("vin")?(o(),d("div",xi,[e[115]||(e[115]=l("div",{class:"kv-label"},"车辆识别代码",-1)),l("div",Si,[s(f(F),{modelValue:g[h("vin")],"onUpdate:modelValue":e[39]||(e[39]=n=>g[h("vin")]=n),field:A(h("vin")),editable:_.value},null,8,["modelValue","field","editable"])])])):x("",!0),h("engine")?(o(),d("div",Ui,[e[116]||(e[116]=l("div",{class:"kv-label"},"发动机号码",-1)),l("div",Oi,[s(f(F),{modelValue:g[h("engine")],"onUpdate:modelValue":e[40]||(e[40]=n=>g[h("engine")]=n),field:A(h("engine")),editable:_.value},null,8,["modelValue","field","editable"])])])):x("",!0),h("register_date")?(o(),d("div",zi,[e[117]||(e[117]=l("div",{class:"kv-label"},"注册日期",-1)),l("div",Ei,[s(f(F),{modelValue:g[h("register_date")],"onUpdate:modelValue":e[41]||(e[41]=n=>g[h("register_date")]=n),field:A(h("register_date")),editable:_.value},null,8,["modelValue","field","editable"])])])):x("",!0)]))]),l("div",Ii,[_.value?(o(),d("div",Ai,[s(V,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>ce("driving_license_main",n)},{default:v(()=>[s(i,{size:"small",type:"primary",plain:"",loading:O.driving_license_main},{default:v(()=>[...e[118]||(e[118]=[I("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),s(D,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:v(()=>[l("span",null,[s(i,{size:"small",disabled:""},{default:v(()=>[...e[119]||(e[119]=[I("清空",-1)])]),_:1})])]),_:1})])):x("",!0),l("div",Fi,[(o(!0),d(M,null,Y(E.value.driving_license_main,(n,m)=>(o(),d("div",{key:n+":"+m,class:"thumb-wrap"},[s(b,{src:n,"preview-src-list":E.value.driving_license_main,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),E.value.driving_license_main.length?x("",!0):(o(),d("div",Ni))])])])]),l("div",Mi,[e[124]||(e[124]=l("div",{class:"sub-title"},"行驶证副件",-1)),l("div",Ti,[l("div",Bi,[ie.value?(o(),d("div",$i,[(o(!0),d(M,null,Y(Yt.value,n=>(o(),d("div",{key:n.key,class:"kv-item"},[l("div",ji,B(be(n)),1),l("div",Li,[s(f(F),{modelValue:g[n.key],"onUpdate:modelValue":m=>g[n.key]=m,field:n,editable:_.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])])]))),128))])):(o(),d("div",Ri,[he.value?(o(),d("div",Pi,[e[121]||(e[121]=l("div",{class:"kv-label"},"核定载人数",-1)),l("div",Yi,[s(f(F),{modelValue:g[he.value],"onUpdate:modelValue":e[42]||(e[42]=n=>g[he.value]=n),field:A(he.value),editable:_.value},null,8,["modelValue","field","editable"])])])):x("",!0)]))]),l("div",Ki,[_.value?(o(),d("div",qi,[s(V,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>ce("driving_license_sub",n)},{default:v(()=>[s(i,{size:"small",type:"primary",plain:"",loading:O.driving_license_sub},{default:v(()=>[...e[122]||(e[122]=[I("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),s(D,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:v(()=>[l("span",null,[s(i,{size:"small",disabled:""},{default:v(()=>[...e[123]||(e[123]=[I("清空",-1)])]),_:1})])]),_:1})])):x("",!0),l("div",Hi,[(o(!0),d(M,null,Y(E.value.driving_license_sub,(n,m)=>(o(),d("div",{key:n+":"+m,class:"thumb-wrap"},[s(b,{src:n,"preview-src-list":E.value.driving_license_sub,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),E.value.driving_license_sub.length?x("",!0):(o(),d("div",Wi))])])])])])]),_:1})])),[[L,G.value]])])}}},vs=Sl(Xi,[["__scopeId","data-v-43cbfa71"]]);export{vs as default};
