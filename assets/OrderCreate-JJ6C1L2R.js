import{b as vt,u as _t}from"./vendor-vue-router-CVyACjsp.js";import{E as J,c as me,a as ve,b as Y,d as pt}from"./vendor-element-plus-CtVxZ4Oy.js";import{V as ft}from"./VehicleCertTable-DMJrmHc4.js";import{h as _e}from"./http-DGyH82Tn.js";import{u as De,c as kt,f as yt}from"./orders-DVGDUW2c.js";import{u as gt,f as bt}from"./fieldFormat-B0eaWt9f.js";import{u as Vt,p as ht}from"./bosUpload-Bf8-Xtq-.js";import{_ as wt}from"./index-BFJc87xd.js";import{r as O,Z as $,c as A,o as Ut,q as xt,Y as St,x as p,z as l,P as a,H as y,ay as h,G as S,J as z,y as u,L as R,O as T,ac as j,u as r,l as pe,M as K,ai as b}from"./vendor-vue-fFWwKrgY.js";import"./vendor-lodash-rvV0CIkQ.js";import"./vendor-DWCz07M-.js";import"./vendor-dates-DVKSwKij.js";import"./vendor-axios-C0Zqfgkc.js";import"./vendor-pinia-CMXa-Za0.js";const It={class:"order-detail"},Ct={class:"detail-header"},Ft={class:"header-actions"},Et={class:"upload-mode"},Mt={class:"page-body"},Ot={class:"meta-narrow"},zt={class:"kv-grid kv-grid-2"},Lt={class:"kv-item"},At={class:"kv-value"},Nt={class:"kv-item"},Dt={class:"kv-value"},Rt={class:"info-block"},Bt={class:"kv-grid kv-grid-2 info-grid"},Pt={class:"kv-item"},Yt={class:"kv-value"},$t={class:"kv-item"},Tt={class:"kv-value"},jt={class:"kv-grid kv-grid-4 info-grid info-grid-compact"},Gt={class:"kv-item"},Kt={class:"kv-value"},Ht={class:"kv-item"},qt={class:"kv-value"},Zt={class:"kv-item"},Jt={class:"kv-value"},Wt={class:"kv-item"},Qt={class:"kv-value"},Xt={class:"kv-grid kv-grid-2 info-grid"},el={class:"kv-item"},tl={class:"kv-value"},ll={class:"kv-grid kv-grid-5 info-grid info-grid-compact"},sl={class:"kv-item"},ol={class:"kv-value"},nl={class:"kv-item"},il={class:"kv-value"},al={class:"kv-item"},dl={class:"kv-value"},rl={class:"kv-item"},ul={class:"kv-value"},cl={class:"kv-item"},ml={class:"kv-value"},vl={class:"kv-grid kv-grid-2 info-grid"},_l={class:"kv-item"},pl={class:"kv-value"},fl={class:"kv-grid kv-grid-5 info-grid info-grid-compact"},kl={class:"kv-item"},yl={class:"kv-value"},gl={class:"kv-item"},bl={class:"kv-value"},Vl={class:"kv-item"},hl={class:"kv-value"},wl={class:"kv-item"},Ul={class:"kv-value"},xl={class:"kv-item"},Sl={class:"kv-value"},Il={class:"kv-grid kv-grid-2 info-grid"},Cl={class:"kv-item"},Fl={class:"kv-value"},El={class:"kv-grid kv-grid-2 info-grid"},Ml={class:"kv-item"},Ol={class:"kv-value"},zl={class:"section-header"},Ll={class:"two-col"},Al={class:"left"},Nl={key:0,class:"kv-grid kv-grid-2"},Dl={class:"kv-item"},Rl={class:"kv-value"},Bl={class:"kv-item"},Pl={class:"kv-value"},Yl={class:"kv-item"},$l={class:"kv-value"},Tl={class:"kv-item"},jl={class:"kv-value"},Gl={key:1},Kl={class:"right"},Hl={class:"section-header"},ql={class:"stack"},Zl={class:"sub-block"},Jl={class:"two-col"},Wl={class:"left"},Ql={key:0,class:"kv-grid kv-grid-2"},Xl={class:"kv-item"},es={class:"kv-value"},ts={class:"kv-item"},ls={class:"kv-value"},ss={key:1,class:"kv-grid kv-grid-2"},os={class:"kv-label"},ns={class:"kv-value"},is={class:"right"},as={class:"sub-block"},ds={class:"two-col"},rs={class:"left"},us={key:0,class:"kv-grid kv-grid-2"},cs={class:"kv-label"},ms={class:"kv-value"},vs={class:"right"},_s={class:"section-header"},ps={class:"stack"},fs={class:"sub-block"},ks={class:"two-col"},ys={class:"left"},gs={key:0,class:"kv-grid kv-grid-2"},bs={key:0,class:"kv-item"},Vs={class:"kv-value"},hs={key:1,class:"kv-item"},ws={class:"kv-value"},Us={key:2,class:"kv-item"},xs={class:"kv-value"},Ss={key:3,class:"kv-item"},Is={class:"kv-value"},Cs={key:4,class:"kv-item"},Fs={class:"kv-value"},Es={key:5,class:"kv-item"},Ms={class:"kv-value"},Os={key:6,class:"kv-item"},zs={class:"kv-value"},Ls={key:1,class:"kv-grid kv-grid-2"},As={class:"kv-label"},Ns={class:"kv-value"},Ds={class:"right"},Rs={class:"sub-block"},Bs={class:"two-col"},Ps={class:"left"},Ys={key:0,class:"kv-grid kv-grid-2"},$s={key:0,class:"kv-item"},Ts={class:"kv-value"},js={key:1,class:"kv-grid kv-grid-2"},Gs={class:"kv-label"},Ks={class:"kv-value"},Hs={class:"right"},qs={class:"section-header"},Zs={class:"section-actions"},Js={class:"slot-card"},Ws={class:"slot-head"},Qs={class:"slot-tip"},Xs={key:0,class:"preview-wall"},eo={key:1,class:"preview-img preview-empty"},to={class:"preview-meta"},lo=["title"],so={class:"preview-status"},oo={class:"slot-foot"},no={key:0},io={key:1,class:"muted"},Re="order_import_upload_mode",ao={__name:"OrderCreate",setup(ro){const W=vt(),Be=_t(),Q=O(!1),X=O(!1),H=O(!1),q=O(!1),B=O("smart");function Pe(){const t=localStorage.getItem(Re);(t==="smart"||t==="direct"||t==="stable")&&(B.value=t)}function fe(){try{localStorage.setItem(Re,B.value)}catch{}}Pe();function G(t){const e=t?.message||t?.response?.data?.detail||t?.response?.data?.message||"";return String(e||"")}function Ye(t){const e=G(t).toLowerCase();return e.includes("failed to fetch")||e.includes("network error")||e.includes("err_")||e.includes("cors")||e.includes("代理")||e.includes("vpn")||e.includes("hint=浏览器请求可能走了本机代理")||e.includes("127.0.0.1:7890")}let ke=!1;async function $e(){if(ke)return!1;ke=!0;try{return await pt.confirm(`上传被当前网络环境拦截（常见于 VPN/代理/公司网关）。

建议切换到【稳定模式上传】继续，无需任何设置。`,"上传失败（网络拦截）",{confirmButtonText:"切换为稳定模式",cancelButtonText:"继续直传重试",type:"warning",center:!0,distinguishCancelAndClose:!0}),B.value="stable",fe(),!0}catch{return!1}}function Te(){const t=Be.query?.from;if(typeof t=="string"&&t){let e=t;try{e=decodeURIComponent(t)}catch{e=t}if(e.startsWith("/")){W.push(e);return}}if(window.history.length>1){W.back();return}W.push({path:"/orders/all"})}const ye=O([]),ge=O([]),ee=O(!1),te=O(!1),C=$({channel_group_id:null,customer_group_id:null}),je=A(()=>!!C.customer_group_id&&!!C.channel_group_id&&D.value===0);function be(t,e){for(const n of e){const i=t?.[n];if(i!=null&&String(i).trim()!=="")return i}return""}function Ve(t){const e=be(t,["channel_code","customer_code","group_code","code","groupCode","group_code_str","groupCodeStr"]),n=be(t,["channel_name","customer_name","group_name","name","groupName"]),i=t?.id!==null&&t?.id!==void 0?String(t.id):"";return e&&n?`${e} - ${n}`:n?String(n):e?String(e):i||"-"}function he(t){const e=t?.data;return Array.isArray(e?.items)?e.items:Array.isArray(e)?e:Array.isArray(e?.data?.items)?e.data.items:Array.isArray(e?.data)?e.data:[]}async function Ge(){ee.value=!0,te.value=!0;try{const[t,e]=await Promise.all([_e.get("/orders/channel-groups"),_e.get("/orders/customer-groups")]);ye.value=he(t),ge.value=he(e)}catch(t){console.error(t),J.error("加载渠道/客户选项失败")}finally{ee.value=!1,te.value=!1}}const{groups:we,allFields:Ke,loadConfig:He}=gt(),qe=A(()=>{const t=new Map;for(const e of Ke.value||[])t.set(e.key,e);return t});function U(t){return qe.value.get(t)||{key:t,label:t,type:"text",options:[]}}function le(t){return t?.key==="id_number"?"公民身份号码":t?.label||t?.key||""}function Ue(t){if(t==null||t==="")return t;const e=String(t);return/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:t}function Ze(t,e){if(t==null||t==="")return"-";const n=e||{type:"text",options:[]},i=n.type==="date"?Ue(t):t,d=bt(i,n);return d===""?"-":d}const v=$({}),Je=A(()=>(we.value||[]).find(t=>t.group_key==="driving_license")),We=A(()=>(we.value||[]).find(t=>t.group_key==="driving_attach"));function xe(t){return t?(t.fields||[]).map(n=>n.field_name).filter(Boolean).map(n=>U(n)):[]}const Qe=Object.freeze(["id_name","id_gender","id_ethnicity","id_birth_date","id_address","id_number"]),Xe=Object.freeze(["id_issuer","id_validity"]),et=A(()=>Qe.map(t=>U(t))),tt=A(()=>Xe.map(t=>U(t))),Se=A(()=>xe(Je.value)),Ie=A(()=>xe(We.value));function N(t,{preferKeys:e=[],labelIncludes:n=[],keyIncludes:i=[]}={}){const d=Array.isArray(t)?t:[];for(const m of e){const k=d.find(c=>c?.key===m);if(k?.key)return k.key}for(const m of i){const k=d.find(c=>String(c?.key||"").toLowerCase().includes(String(m).toLowerCase()));if(k?.key)return k.key}for(const m of n){const k=d.find(c=>String(c?.label||"").includes(String(m)));if(k?.key)return k.key}return null}const lt=A(()=>{const t=Se.value||[];return{plate:N(t,{preferKeys:["dl_plate_no"],keyIncludes:["plate"],labelIncludes:["号牌"]}),owner:N(t,{preferKeys:["dl_owner"],keyIncludes:["owner"],labelIncludes:["所有人"]}),use_nature:N(t,{preferKeys:["dl_use_nature"],keyIncludes:["use_nature","use"],labelIncludes:["使用性质"]}),brand_model:N(t,{preferKeys:["dl_brand_model"],keyIncludes:["brand","model"],labelIncludes:["品牌型号","品牌","型号"]}),vin:N(t,{preferKeys:["dl_vin","vin"],keyIncludes:["vin"],labelIncludes:["识别","车架"]}),engine:N(t,{preferKeys:["dl_engine_no","engine_no"],keyIncludes:["engine"],labelIncludes:["发动机"]}),register_date:N(t,{preferKeys:["dl_register_date","register_date"],keyIncludes:["register","reg_date"],labelIncludes:["注册日期"]})}});function g(t){return lt.value?.[t]||null}const se=A(()=>{const t=Ie.value||[];return N(t,{preferKeys:["dl_approved_passenger_count","approved_passenger_count","dl_passenger_count"],keyIncludes:["passenger","approved"],labelIncludes:["核定载","载人数","载客"]})});function f(t){if(t==null||t==="")return 0;const e=Number(t);return Number.isFinite(e)?e:0}function st(t){return t==null?"":String(t).trim()}function ae(t){if(!t)return"";const e=String(t).trim();return e?/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:/^\d{4}-\d{2}-\d{2}/.test(e)?e.slice(0,10):e:""}const o=$({insurance_expire_date:"",owner_phone:"",commercial_amount:0,compulsory_amount:0,vehicle_tax_amount:0,non_vehicle_amount:0,premium_total:0,channel_commercial_point:0,channel_compulsory_point:0,channel_vehicle_tax_point:0,channel_non_vehicle_point:0,channel_reward:0,channel_total:0,customer_commercial_point:0,customer_compulsory_point:0,customer_vehicle_tax_point:0,customer_non_vehicle_point:0,customer_reward:0,customer_total:0,profit:0});function Ce(){const t=Math.max(0,f(o.commercial_amount)),e=Math.max(0,f(o.compulsory_amount)),n=Math.max(0,f(o.vehicle_tax_amount)),i=Math.max(0,f(o.non_vehicle_amount));o.commercial_amount=t,o.compulsory_amount=e,o.vehicle_tax_amount=n,o.non_vehicle_amount=i;const d=t+e+n+i,m=f(o.channel_commercial_point),k=f(o.channel_compulsory_point),c=f(o.channel_vehicle_tax_point),_=f(o.channel_non_vehicle_point),F=f(o.channel_reward),P=f(o.customer_commercial_point),s=f(o.customer_compulsory_point),M=f(o.customer_vehicle_tax_point),ie=f(o.customer_non_vehicle_point),mt=f(o.customer_reward),Ae=t*(m/100)+e*(k/100)+n*(c/100)+i*(_/100)+F,Ne=t*(P/100)+e*(s/100)+n*(M/100)+i*(ie/100)+mt;o.premium_total=d,o.channel_total=Ae,o.customer_total=Ne,o.profit=Ae-Ne}Ut(()=>[o.commercial_amount,o.compulsory_amount,o.vehicle_tax_amount,o.non_vehicle_amount,o.channel_commercial_point,o.channel_compulsory_point,o.channel_vehicle_tax_point,o.channel_non_vehicle_point,o.channel_reward,o.customer_commercial_point,o.customer_compulsory_point,o.customer_vehicle_tax_point,o.customer_non_vehicle_point,o.customer_reward],()=>Ce());function ot(){return{insurance_expire_date:o.insurance_expire_date?ae(o.insurance_expire_date):null,owner_phone:o.owner_phone?st(o.owner_phone):null,commercial_amount:f(o.commercial_amount),compulsory_amount:f(o.compulsory_amount),vehicle_tax_amount:f(o.vehicle_tax_amount),non_vehicle_amount:f(o.non_vehicle_amount),premium_total:f(o.premium_total),channel_commercial_point:f(o.channel_commercial_point),channel_compulsory_point:f(o.channel_compulsory_point),channel_vehicle_tax_point:f(o.channel_vehicle_tax_point),channel_non_vehicle_point:f(o.channel_non_vehicle_point),channel_reward:f(o.channel_reward),channel_total:f(o.channel_total),customer_commercial_point:f(o.customer_commercial_point),customer_compulsory_point:f(o.customer_compulsory_point),customer_vehicle_tax_point:f(o.customer_vehicle_tax_point),customer_non_vehicle_point:f(o.customer_non_vehicle_point),customer_reward:f(o.customer_reward),customer_total:f(o.customer_total),profit:f(o.profit)}}const de=[{key:"vehicle_cert",label:"合格证",multiple:!1},{key:"idcard_front",label:"身份证正面",multiple:!1},{key:"idcard_back",label:"身份证背面",multiple:!1},{key:"driving_license_main",label:"行驶证主页",multiple:!1},{key:"driving_license_sub",label:"行驶证副页",multiple:!1},{key:"related",label:"相关图片(多张)",multiple:!0}],x=$(de.reduce((t,e)=>(t[e.key]=[],t),{})),L=$({}),I=$({}),D=O(0),E=$({}),re=O("");let oe=null,ue=0;function nt(t){try{return Date.parse(t)}catch{return 0}}async function it(){const t=Date.now();if(oe&&ue&&t+12e4<ue)return oe;const n=(await _e.get("/orders/bos-sts"))?.data;if(!n?.accessKeyId||!n?.secretAccessKey||!n?.sessionToken)throw new Error("bos-sts response invalid");return oe=n,re.value=n.bosHost||"",ue=nt(n.expiration)||t+600*1e3,oe}function at(t){return!!de.find(n=>n.key===t)?.multiple}function dt(t){const e=x[t]||[];return e.length?e[0]:null}function Fe(t){const e=t?.raw;if(e&&!t.url){const n=URL.createObjectURL(e);t.url=n,E[t.uid]=n}}function rt(t,e){if(!t||!e)return;const n=t.uid,i=n?E[n]:t.url;if(i){try{URL.revokeObjectURL(i)}catch{}n&&delete E[n]}const d=URL.createObjectURL(e);t.raw=e,t.url=d,n&&(E[n]=d)}function ce(t){const e=x[t]||[];for(const n of e){const i=n?.uid;if(!i)continue;L[i]&&delete L[i],I[i]&&delete I[i];const d=E[i];if(d){try{URL.revokeObjectURL(d)}catch{}delete E[i]}}x[t]=[]}function Ee(t,e){if(!at(t)){ce(t),Fe(e),x[t]=[e],ze(t,e).catch(i=>{console.error(i),Y.error({title:"上传失败",message:G(i)||"unknown error",duration:5e3})});return}const n=Array.isArray(x[t])?[...x[t]]:[];n.find(i=>i.uid===e.uid)||n.push(e),x[t]=n,Fe(e),ze(t,e).catch(i=>{console.error(i),Y.error({title:"上传失败",message:G(i)||"unknown error",duration:5e3})})}function Me(t,e){const n=x[t]||[];x[t]=n.filter(m=>m.uid!==e.uid);const i=e?.uid;i&&L[i]&&delete L[i],i&&I[i]&&delete I[i];const d=E[i];if(d){try{URL.revokeObjectURL(d)}catch{}delete E[i]}}async function Oe(t,e,n){let i=n;try{const d=await ht({file:n,slotKey:t});d?.file&&(i=d.file,rt(e,i),d?.note&&Y({title:"已预处理",message:d.note,type:"success",duration:1600}))}catch{i=n}return i}async function ze(t,e){const n=e?.raw;if(n&&!L[e.uid]){D.value+=1,I[e.uid]={status:"uploading"};try{if(B.value==="stable"){const m=await Oe(t,e,n),c=(await De({slot_key:t,file:m}))?.data;L[e.uid]={slot_key:t,md5:c?.md5,storage_key:c?.storage_key,etag:c?.etag||"",size:c?.size||m.size||0,content_type:c?.content_type||m.type||"application/octet-stream",original_name:c?.original_name||m.name||"file",preview_url:c?.preview_url||""},I[e.uid]={status:"done"},Y.success({title:"上传完成",message:`${e.name} 已就绪`,duration:2e3});return}const i=await it();if(!re.value)throw new Error("bosHost missing");const d=await Vt({bosHost:re.value,slotKey:t,file:n,sts:i});d?.preprocess_note&&Y({title:"已预处理",message:d.preprocess_note,type:"success",duration:1600}),L[e.uid]={slot_key:t,...d,size:d?.size||n.size||0,content_type:d?.content_type||n.type||"application/octet-stream",original_name:d?.original_name||n.name||"file"},I[e.uid]={status:"done"},Y.success({title:"上传完成",message:`${e.name} 已就绪`,duration:2e3})}catch(i){if(B.value==="smart"&&Ye(i)&&await $e())try{const m=e?.raw||n,k=await Oe(t,e,m),_=(await De({slot_key:t,file:k}))?.data;L[e.uid]={slot_key:t,md5:_?.md5,storage_key:_?.storage_key,etag:_?.etag||"",size:_?.size||k.size||0,content_type:_?.content_type||k.type||"application/octet-stream",original_name:_?.original_name||k.name||"file",preview_url:_?.preview_url||""},I[e.uid]={status:"done"},Y.success({title:"上传完成（稳定模式）",message:`${e.name} 已就绪`,duration:2200});return}catch(m){throw I[e.uid]={status:"error",msg:G(m)||"upload failed"},m}throw I[e.uid]={status:"error",msg:G(i)||"upload failed"},i}finally{D.value-=1}}}function ne(t){const e=x[t]||[];let n=0;for(const i of e)L[i.uid]&&(n+=1);return n}function Le(t){return(x[t]||[]).map(n=>n.url).filter(Boolean)}function ut(){const t=[];for(const e of de){const n=x[e.key]||[];for(const i of n){const d=L[i.uid];d&&t.push(d)}}return t}async function ct(){if(!C.customer_group_id||!C.channel_group_id){J.warning("客户和渠道为必选项，请先选择后再保存");return}if(D.value>0){J.warning("还有文件在上传中，请稍后再保存");return}Q.value=!0;try{const t={...v},e=ot(),n=await kt({module:"order",dynamic_data:t,order_info:e,customer_group_id:C.customer_group_id??void 0,channel_group_id:C.channel_group_id??void 0}),d=(n?.data?.data??n?.data??n)?.order_id;if(!d)throw new Error("draft missing order_id");const m=ut();await yt({order_id:d,images:m,dynamic_data:t,order_info:e,customer_group_id:C.customer_group_id??void 0,channel_group_id:C.channel_group_id??void 0}),J.success("创建成功"),W.push({path:`/orders/${d}`})}catch(t){console.error(t),J.error(G(t)||"保存失败")}finally{Q.value=!1}}xt(async()=>{await He("order"),await Ge(),Ce()}),St(()=>{for(const t of Object.keys(E)){try{URL.revokeObjectURL(E[t])}catch{}delete E[t]}});const w=pe({name:"FieldValue",props:{modelValue:{type:[String,Number,Date],default:""},field:{type:Object,required:!0},editable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:e}){const n=h("el-input"),i=h("el-select"),d=h("el-option"),m=h("el-date-picker"),k=c=>e("update:modelValue",c);return()=>{const c=t.field||{type:"text",options:[]},_=t.modelValue??"",F=Ze(_,c);if(!t.editable)return b("span",{class:"plain-value",title:F},F);if(c.type==="date"){const P=Ue(_)??"";return b(m,{modelValue:P,"onUpdate:modelValue":k,type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}if(c.type==="select"){const P=Array.isArray(c.options)?c.options:[];return b(i,{modelValue:_,"onUpdate:modelValue":k,filterable:!0,clearable:!0,class:"fv fv-select"},()=>P.map(s=>{const M=s&&typeof s=="object"?s.label:String(s),ie=s&&typeof s=="object"?s.value:s;return b(d,{key:String(ie),label:M,value:ie})}))}return b(n,{modelValue:_,"onUpdate:modelValue":k,clearable:!0,class:"fv fv-input"})}}}),V=pe({name:"InfoValue",props:{modelValue:{type:[String,Number],default:""},type:{type:String,default:"text"},editable:{type:Boolean,default:!1},min:{type:Number,default:void 0},max:{type:Number,default:void 0}},emits:["update:modelValue"],setup(t,{emit:e}){const n=h("el-input"),i=h("el-date-picker"),d=h("el-input-number"),m=c=>e("update:modelValue",c);function k(c){if(c==null||c==="")return"-";const _=Number(c);return t.type==="money"?Number.isFinite(_)?_.toFixed(2):"-":t.type==="point"?Number.isFinite(_)?String(_):"-":t.type==="date"?ae(c)||"-":String(c)}return()=>{const c=t.modelValue??"";if(!t.editable){const _=k(c);return b("span",{class:"plain-value",title:_},_)}if(t.type==="date"){const _=ae(c);return b(i,{modelValue:_,"onUpdate:modelValue":m,type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}if(t.type==="money"||t.type==="point"){const _=c===""||c===null||c===void 0?void 0:Number(c);return b(d,{modelValue:Number.isFinite(_)?_:void 0,"onUpdate:modelValue":m,controls:!1,precision:t.type==="money"?2:void 0,step:t.type==="money"?1:.1,min:typeof t.min=="number"?t.min:void 0,max:typeof t.max=="number"?t.max:void 0,class:"fv fv-number"})}return b(n,{modelValue:c,"onUpdate:modelValue":m,clearable:!0,class:"fv fv-input"})}}}),Z=pe({name:"SlotUploadCard",props:{slotKey:{type:String,required:!0},label:{type:String,default:""},multiple:{type:Boolean,default:!1}},setup(t){const e=h("el-upload"),n=h("el-image"),i=h("el-button"),d=h("el-tag");return()=>{const m=t.slotKey,k=t.label||m,c=x[m]||[],_=dt(m);return b("div",{class:"slot-card"},[b("div",{class:"slot-head"},[b("div",{class:"slot-name"},k),b("div",{class:"slot-tip"},[b(d,{size:"small",type:"info",effect:"plain"},()=>"单张")])]),b(e,{drag:!0,autoUpload:!1,multiple:!1,showFileList:!1,fileList:c,accept:"image/*",class:"upload-box upload-one",onChange:F=>Ee(m,F),onRemove:F=>Me(m,F)},{default:()=>_?b("div",{class:"one-wrap"},[b(n,{src:_?.url,previewSrcList:Le(m),fit:"contain",class:"one-img"}),b("div",{class:"one-mask"},[b("div",{class:"one-mask-text"},"拖拽或点击替换"),b(i,{size:"small",type:"danger",plain:!0,class:"one-remove",onClick:F=>{F?.stopPropagation?.(),ce(m)}},()=>"移除")])]):b("div",{class:"upload-empty"},[b("div",{class:"empty-center"},[b("div",{class:"empty-title"},"拖拽图片到此处"),b("div",{class:"empty-sub"},"或点击选择文件")])])}),b("div",{class:"slot-foot"},[ne(m)>0?b("span",null,`已就绪：${ne(m)} 张`):b("span",{class:"muted"},"未上传")])])}}});return(t,e)=>{const n=h("el-option"),i=h("el-select"),d=h("el-button"),m=h("el-alert"),k=h("el-card"),c=h("el-icon"),_=h("el-tag"),F=h("el-upload"),P=h("el-image");return u(),p("div",It,[l("div",Ct,[e[44]||(e[44]=l("h2",null,"手动创建订单",-1)),l("div",Ft,[l("div",Et,[e[41]||(e[41]=l("span",{class:"upload-mode-label"},"上传模式",-1)),a(i,{modelValue:B.value,"onUpdate:modelValue":e[0]||(e[0]=s=>B.value=s),size:"small",style:{width:"150px"},onChange:fe},{default:y(()=>[a(n,{label:"智能（推荐）",value:"smart"}),a(n,{label:"直传（更快）",value:"direct"}),a(n,{label:"稳定（兼容VPN）",value:"stable"})]),_:1},8,["modelValue"])]),a(d,{size:"small",onClick:Te},{default:y(()=>[...e[42]||(e[42]=[R("返回",-1)])]),_:1}),a(d,{size:"small",type:"primary",loading:Q.value,disabled:D.value>0||!je.value,onClick:ct},{default:y(()=>[...e[43]||(e[43]=[R(" 保存 ",-1)])]),_:1},8,["loading","disabled"])])]),l("div",Mt,[D.value>0?(u(),S(m,{key:0,class:"upload-alert",type:"warning",closable:!1,"show-icon":"",title:"正在上传",description:`正在上传 ${D.value} 个文件…（全部上传完成后才能保存）`},null,8,["description"])):z("",!0),a(k,{shadow:"never",class:"section-card"},{header:y(()=>[...e[45]||(e[45]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"渠道、客户")],-1)])]),default:y(()=>[l("div",Ot,[l("div",zt,[l("div",Lt,[e[46]||(e[46]=l("div",{class:"kv-label"},"渠道",-1)),l("div",At,[a(i,{modelValue:C.channel_group_id,"onUpdate:modelValue":e[1]||(e[1]=s=>C.channel_group_id=s),filterable:"",clearable:"",placeholder:"请选择渠道（必选）",class:"fv fv-select",loading:ee.value,disabled:ee.value},{default:y(()=>[(u(!0),p(T,null,j(ye.value,s=>(u(),S(n,{key:String(s.id),label:Ve(s),value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])])]),l("div",Nt,[e[47]||(e[47]=l("div",{class:"kv-label"},"客户",-1)),l("div",Dt,[a(i,{modelValue:C.customer_group_id,"onUpdate:modelValue":e[2]||(e[2]=s=>C.customer_group_id=s),filterable:"",clearable:"",placeholder:"请选择客户（必选）",class:"fv fv-select",loading:te.value,disabled:te.value},{default:y(()=>[(u(!0),p(T,null,j(ge.value,s=>(u(),S(n,{key:String(s.id),label:Ve(s),value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])])])])])]),_:1}),a(k,{shadow:"never",class:"section-card"},{header:y(()=>[...e[48]||(e[48]=[l("div",{class:"section-header"},[l("div",{class:"section-title"},"订单信息")],-1)])]),default:y(()=>[l("div",Rt,[l("div",Bt,[l("div",Pt,[e[49]||(e[49]=l("div",{class:"kv-label"},"保险到期日",-1)),l("div",Yt,[a(r(V),{modelValue:o.insurance_expire_date,"onUpdate:modelValue":e[3]||(e[3]=s=>o.insurance_expire_date=s),type:"date",editable:!0},null,8,["modelValue"])])]),l("div",$t,[e[50]||(e[50]=l("div",{class:"kv-label"},"车主电话",-1)),l("div",Tt,[a(r(V),{modelValue:o.owner_phone,"onUpdate:modelValue":e[4]||(e[4]=s=>o.owner_phone=s),type:"text",editable:!0},null,8,["modelValue"])])])]),l("div",jt,[l("div",Gt,[e[51]||(e[51]=l("div",{class:"kv-label"},"商业金额",-1)),l("div",Kt,[a(r(V),{modelValue:o.commercial_amount,"onUpdate:modelValue":e[5]||(e[5]=s=>o.commercial_amount=s),type:"money",editable:!0,min:0},null,8,["modelValue"])])]),l("div",Ht,[e[52]||(e[52]=l("div",{class:"kv-label"},"交强金额",-1)),l("div",qt,[a(r(V),{modelValue:o.compulsory_amount,"onUpdate:modelValue":e[6]||(e[6]=s=>o.compulsory_amount=s),type:"money",editable:!0,min:0},null,8,["modelValue"])])]),l("div",Zt,[e[53]||(e[53]=l("div",{class:"kv-label"},"车船税金额",-1)),l("div",Jt,[a(r(V),{modelValue:o.vehicle_tax_amount,"onUpdate:modelValue":e[7]||(e[7]=s=>o.vehicle_tax_amount=s),type:"money",editable:!0,min:0},null,8,["modelValue"])])]),l("div",Wt,[e[54]||(e[54]=l("div",{class:"kv-label"},"非车金额",-1)),l("div",Qt,[a(r(V),{modelValue:o.non_vehicle_amount,"onUpdate:modelValue":e[8]||(e[8]=s=>o.non_vehicle_amount=s),type:"money",editable:!0,min:0},null,8,["modelValue"])])])]),l("div",Xt,[l("div",el,[e[55]||(e[55]=l("div",{class:"kv-label"},"保费金额",-1)),l("div",tl,[a(r(V),{modelValue:o.premium_total,"onUpdate:modelValue":e[9]||(e[9]=s=>o.premium_total=s),type:"money",editable:!1},null,8,["modelValue"])])])])]),e[69]||(e[69]=l("div",{class:"split-title"},"渠道",-1)),l("div",ll,[l("div",sl,[e[56]||(e[56]=l("div",{class:"kv-label"},"商业点位%",-1)),l("div",ol,[a(r(V),{modelValue:o.channel_commercial_point,"onUpdate:modelValue":e[10]||(e[10]=s=>o.channel_commercial_point=s),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",nl,[e[57]||(e[57]=l("div",{class:"kv-label"},"交强点位%",-1)),l("div",il,[a(r(V),{modelValue:o.channel_compulsory_point,"onUpdate:modelValue":e[11]||(e[11]=s=>o.channel_compulsory_point=s),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",al,[e[58]||(e[58]=l("div",{class:"kv-label"},"车船税点位%",-1)),l("div",dl,[a(r(V),{modelValue:o.channel_vehicle_tax_point,"onUpdate:modelValue":e[12]||(e[12]=s=>o.channel_vehicle_tax_point=s),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",rl,[e[59]||(e[59]=l("div",{class:"kv-label"},"非车点位%",-1)),l("div",ul,[a(r(V),{modelValue:o.channel_non_vehicle_point,"onUpdate:modelValue":e[13]||(e[13]=s=>o.channel_non_vehicle_point=s),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",cl,[e[60]||(e[60]=l("div",{class:"kv-label"},"出单奖励",-1)),l("div",ml,[a(r(V),{modelValue:o.channel_reward,"onUpdate:modelValue":e[14]||(e[14]=s=>o.channel_reward=s),type:"money",editable:!0},null,8,["modelValue"])])])]),l("div",vl,[l("div",_l,[e[61]||(e[61]=l("div",{class:"kv-label"},"渠道合计",-1)),l("div",pl,[a(r(V),{modelValue:o.channel_total,"onUpdate:modelValue":e[15]||(e[15]=s=>o.channel_total=s),type:"money",editable:!1},null,8,["modelValue"])])])]),e[70]||(e[70]=l("div",{class:"split-title"},"客户",-1)),l("div",fl,[l("div",kl,[e[62]||(e[62]=l("div",{class:"kv-label"},"商业点位%",-1)),l("div",yl,[a(r(V),{modelValue:o.customer_commercial_point,"onUpdate:modelValue":e[16]||(e[16]=s=>o.customer_commercial_point=s),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",gl,[e[63]||(e[63]=l("div",{class:"kv-label"},"交强点位%",-1)),l("div",bl,[a(r(V),{modelValue:o.customer_compulsory_point,"onUpdate:modelValue":e[17]||(e[17]=s=>o.customer_compulsory_point=s),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",Vl,[e[64]||(e[64]=l("div",{class:"kv-label"},"车船税点位%",-1)),l("div",hl,[a(r(V),{modelValue:o.customer_vehicle_tax_point,"onUpdate:modelValue":e[18]||(e[18]=s=>o.customer_vehicle_tax_point=s),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",wl,[e[65]||(e[65]=l("div",{class:"kv-label"},"非车点位%",-1)),l("div",Ul,[a(r(V),{modelValue:o.customer_non_vehicle_point,"onUpdate:modelValue":e[19]||(e[19]=s=>o.customer_non_vehicle_point=s),type:"point",editable:!0},null,8,["modelValue"])])]),l("div",xl,[e[66]||(e[66]=l("div",{class:"kv-label"},"出单奖励",-1)),l("div",Sl,[a(r(V),{modelValue:o.customer_reward,"onUpdate:modelValue":e[20]||(e[20]=s=>o.customer_reward=s),type:"money",editable:!0},null,8,["modelValue"])])])]),l("div",Il,[l("div",Cl,[e[67]||(e[67]=l("div",{class:"kv-label"},"客户合计",-1)),l("div",Fl,[a(r(V),{modelValue:o.customer_total,"onUpdate:modelValue":e[21]||(e[21]=s=>o.customer_total=s),type:"money",editable:!1},null,8,["modelValue"])])])]),l("div",El,[l("div",Ml,[e[68]||(e[68]=l("div",{class:"kv-label"},"利润",-1)),l("div",Ol,[a(r(V),{modelValue:o.profit,"onUpdate:modelValue":e[22]||(e[22]=s=>o.profit=s),type:"money",editable:!1},null,8,["modelValue"])])])])]),_:1}),a(k,{shadow:"never",class:"section-card"},{header:y(()=>[l("div",zl,[e[71]||(e[71]=l("div",{class:"section-title"},"车辆合格证",-1)),a(d,{class:"icon-btn",circle:"",size:"small",onClick:e[23]||(e[23]=s=>X.value=!X.value)},{default:y(()=>[a(c,null,{default:y(()=>[X.value?(u(),S(r(me),{key:0})):(u(),S(r(ve),{key:1}))]),_:1})]),_:1})])]),default:y(()=>[l("div",Ll,[l("div",Al,[X.value?(u(),p("div",Gl,[a(ft,{data:v,readonly:!1},null,8,["data"])])):(u(),p("div",Nl,[l("div",Dl,[e[72]||(e[72]=l("div",{class:"kv-label"},"车辆型号",-1)),l("div",Rl,[a(r(w),{modelValue:v.vehicle_model,"onUpdate:modelValue":e[24]||(e[24]=s=>v.vehicle_model=s),field:U("vehicle_model"),editable:!0},null,8,["modelValue","field"])])]),l("div",Bl,[e[73]||(e[73]=l("div",{class:"kv-label"},"车辆识别代号/车架号",-1)),l("div",Pl,[a(r(w),{modelValue:v.vin,"onUpdate:modelValue":e[25]||(e[25]=s=>v.vin=s),field:U("vin"),editable:!0},null,8,["modelValue","field"])])]),l("div",Yl,[e[74]||(e[74]=l("div",{class:"kv-label"},"发动机号",-1)),l("div",$l,[a(r(w),{modelValue:v.engine_no,"onUpdate:modelValue":e[26]||(e[26]=s=>v.engine_no=s),field:U("engine_no"),editable:!0},null,8,["modelValue","field"])])]),l("div",Tl,[e[75]||(e[75]=l("div",{class:"kv-label"},"额定载客(人)",-1)),l("div",jl,[a(r(w),{modelValue:v.approved_passenger_count,"onUpdate:modelValue":e[27]||(e[27]=s=>v.approved_passenger_count=s),field:U("approved_passenger_count"),editable:!0},null,8,["modelValue","field"])])])]))]),l("div",Kl,[a(r(Z),{"slot-key":"vehicle_cert",label:"合格证",multiple:!1})])])]),_:1}),a(k,{shadow:"never",class:"section-card"},{header:y(()=>[l("div",Hl,[e[76]||(e[76]=l("div",{class:"section-title"},"身份证正面/身份证背面",-1)),a(d,{class:"icon-btn",circle:"",size:"small",onClick:e[28]||(e[28]=s=>H.value=!H.value)},{default:y(()=>[a(c,null,{default:y(()=>[H.value?(u(),S(r(me),{key:0})):(u(),S(r(ve),{key:1}))]),_:1})]),_:1})])]),default:y(()=>[l("div",ql,[l("div",Zl,[e[79]||(e[79]=l("div",{class:"sub-title"},"身份证正面",-1)),l("div",Jl,[l("div",Wl,[H.value?(u(),p("div",ss,[(u(!0),p(T,null,j(et.value,s=>(u(),p("div",{key:s.key,class:"kv-item"},[l("div",os,K(le(s)),1),l("div",ns,[a(r(w),{modelValue:v[s.key],"onUpdate:modelValue":M=>v[s.key]=M,field:s,editable:!0},null,8,["modelValue","onUpdate:modelValue","field"])])]))),128))])):(u(),p("div",Ql,[l("div",Xl,[e[77]||(e[77]=l("div",{class:"kv-label"},"姓名",-1)),l("div",es,[a(r(w),{modelValue:v.id_name,"onUpdate:modelValue":e[29]||(e[29]=s=>v.id_name=s),field:U("id_name"),editable:!0},null,8,["modelValue","field"])])]),l("div",ts,[e[78]||(e[78]=l("div",{class:"kv-label"},"公民身份号码",-1)),l("div",ls,[a(r(w),{modelValue:v.id_number,"onUpdate:modelValue":e[30]||(e[30]=s=>v.id_number=s),field:U("id_number"),editable:!0},null,8,["modelValue","field"])])])]))]),l("div",is,[a(r(Z),{"slot-key":"idcard_front",label:"身份证正面",multiple:!1})])])]),l("div",as,[e[80]||(e[80]=l("div",{class:"sub-title"},"身份证背面",-1)),l("div",ds,[l("div",rs,[H.value?(u(),p("div",us,[(u(!0),p(T,null,j(tt.value,s=>(u(),p("div",{key:s.key,class:"kv-item"},[l("div",cs,K(le(s)),1),l("div",ms,[a(r(w),{modelValue:v[s.key],"onUpdate:modelValue":M=>v[s.key]=M,field:s,editable:!0},null,8,["modelValue","onUpdate:modelValue","field"])])]))),128))])):z("",!0)]),l("div",vs,[a(r(Z),{"slot-key":"idcard_back",label:"身份证背面",multiple:!1})])])])])]),_:1}),a(k,{shadow:"never",class:"section-card"},{header:y(()=>[l("div",_s,[e[81]||(e[81]=l("div",{class:"section-title"},"行驶证/行驶证副件",-1)),a(d,{class:"icon-btn",circle:"",size:"small",onClick:e[31]||(e[31]=s=>q.value=!q.value)},{default:y(()=>[a(c,null,{default:y(()=>[q.value?(u(),S(r(me),{key:0})):(u(),S(r(ve),{key:1}))]),_:1})]),_:1})])]),default:y(()=>[l("div",ps,[l("div",fs,[e[89]||(e[89]=l("div",{class:"sub-title"},"行驶证",-1)),l("div",ks,[l("div",ys,[q.value?(u(),p("div",Ls,[(u(!0),p(T,null,j(Se.value,s=>(u(),p("div",{key:s.key,class:"kv-item"},[l("div",As,K(le(s)),1),l("div",Ns,[a(r(w),{modelValue:v[s.key],"onUpdate:modelValue":M=>v[s.key]=M,field:s,editable:!0},null,8,["modelValue","onUpdate:modelValue","field"])])]))),128))])):(u(),p("div",gs,[g("plate")?(u(),p("div",bs,[e[82]||(e[82]=l("div",{class:"kv-label"},"号牌号码",-1)),l("div",Vs,[a(r(w),{modelValue:v[g("plate")],"onUpdate:modelValue":e[32]||(e[32]=s=>v[g("plate")]=s),field:U(g("plate")),editable:!0},null,8,["modelValue","field"])])])):z("",!0),g("owner")?(u(),p("div",hs,[e[83]||(e[83]=l("div",{class:"kv-label"},"所有人",-1)),l("div",ws,[a(r(w),{modelValue:v[g("owner")],"onUpdate:modelValue":e[33]||(e[33]=s=>v[g("owner")]=s),field:U(g("owner")),editable:!0},null,8,["modelValue","field"])])])):z("",!0),g("use_nature")?(u(),p("div",Us,[e[84]||(e[84]=l("div",{class:"kv-label"},"使用性质",-1)),l("div",xs,[a(r(w),{modelValue:v[g("use_nature")],"onUpdate:modelValue":e[34]||(e[34]=s=>v[g("use_nature")]=s),field:U(g("use_nature")),editable:!0},null,8,["modelValue","field"])])])):z("",!0),g("brand_model")?(u(),p("div",Ss,[e[85]||(e[85]=l("div",{class:"kv-label"},"品牌型号",-1)),l("div",Is,[a(r(w),{modelValue:v[g("brand_model")],"onUpdate:modelValue":e[35]||(e[35]=s=>v[g("brand_model")]=s),field:U(g("brand_model")),editable:!0},null,8,["modelValue","field"])])])):z("",!0),g("vin")?(u(),p("div",Cs,[e[86]||(e[86]=l("div",{class:"kv-label"},"车辆识别代码",-1)),l("div",Fs,[a(r(w),{modelValue:v[g("vin")],"onUpdate:modelValue":e[36]||(e[36]=s=>v[g("vin")]=s),field:U(g("vin")),editable:!0},null,8,["modelValue","field"])])])):z("",!0),g("engine")?(u(),p("div",Es,[e[87]||(e[87]=l("div",{class:"kv-label"},"发动机号码",-1)),l("div",Ms,[a(r(w),{modelValue:v[g("engine")],"onUpdate:modelValue":e[37]||(e[37]=s=>v[g("engine")]=s),field:U(g("engine")),editable:!0},null,8,["modelValue","field"])])])):z("",!0),g("register_date")?(u(),p("div",Os,[e[88]||(e[88]=l("div",{class:"kv-label"},"注册日期",-1)),l("div",zs,[a(r(w),{modelValue:v[g("register_date")],"onUpdate:modelValue":e[38]||(e[38]=s=>v[g("register_date")]=s),field:U(g("register_date")),editable:!0},null,8,["modelValue","field"])])])):z("",!0)]))]),l("div",Ds,[a(r(Z),{"slot-key":"driving_license_main",label:"行驶证主页",multiple:!1})])])]),l("div",Rs,[e[91]||(e[91]=l("div",{class:"sub-title"},"行驶证副件",-1)),l("div",Bs,[l("div",Ps,[q.value?(u(),p("div",js,[(u(!0),p(T,null,j(Ie.value,s=>(u(),p("div",{key:s.key,class:"kv-item"},[l("div",Gs,K(le(s)),1),l("div",Ks,[a(r(w),{modelValue:v[s.key],"onUpdate:modelValue":M=>v[s.key]=M,field:s,editable:!0},null,8,["modelValue","onUpdate:modelValue","field"])])]))),128))])):(u(),p("div",Ys,[se.value?(u(),p("div",$s,[e[90]||(e[90]=l("div",{class:"kv-label"},"核定载人数",-1)),l("div",Ts,[a(r(w),{modelValue:v[se.value],"onUpdate:modelValue":e[39]||(e[39]=s=>v[se.value]=s),field:U(se.value),editable:!0},null,8,["modelValue","field"])])])):z("",!0)]))]),l("div",Hs,[a(r(Z),{"slot-key":"driving_license_sub",label:"行驶证副页",multiple:!1})])])])])]),_:1}),a(k,{shadow:"never",class:"section-card"},{header:y(()=>[l("div",qs,[e[93]||(e[93]=l("div",{class:"section-title"},"相关图片(多张)",-1)),l("div",Zs,[a(d,{size:"small",onClick:e[40]||(e[40]=s=>ce("related")),disabled:Q.value||D.value>0},{default:y(()=>[...e[92]||(e[92]=[R(" 清空图片 ",-1)])]),_:1},8,["disabled"])])])]),default:y(()=>[l("div",Js,[l("div",Ws,[e[95]||(e[95]=l("div",{class:"slot-name"},"相关图片(多张)",-1)),l("div",Qs,[a(_,{size:"small",type:"info",effect:"plain"},{default:y(()=>[...e[94]||(e[94]=[R("可多张",-1)])]),_:1})])]),a(F,{drag:"","auto-upload":!1,multiple:!0,limit:20,"file-list":x.related,"on-change":s=>Ee("related",s),"on-remove":s=>Me("related",s),accept:"image/*",class:"upload-box upload-multi"},{default:y(()=>[...e[96]||(e[96]=[l("div",{class:"upload-empty"},[l("div",{class:"empty-center"},[l("div",{class:"empty-title"},"拖拽图片到此处"),l("div",{class:"empty-sub"},"或点击选择文件（可多张）")])],-1)])]),_:1},8,["file-list","on-change","on-remove"]),(x.related||[]).length?(u(),p("div",Xs,[(u(!0),p(T,null,j(x.related,s=>(u(),p("div",{key:s.uid,class:"preview-item"},[s.url?(u(),S(P,{key:0,src:s.url,"preview-src-list":Le("related"),fit:"cover",class:"preview-img"},null,8,["src","preview-src-list"])):(u(),p("div",eo)),l("div",to,[l("div",{class:"preview-name",title:s.name},K(s.name),9,lo),l("div",so,[I[s.uid]?.status==="uploading"?(u(),S(_,{key:0,size:"small",type:"warning"},{default:y(()=>[...e[97]||(e[97]=[R("上传中",-1)])]),_:1})):I[s.uid]?.status==="done"?(u(),S(_,{key:1,size:"small",type:"success"},{default:y(()=>[...e[98]||(e[98]=[R("已就绪",-1)])]),_:1})):I[s.uid]?.status==="error"?(u(),S(_,{key:2,size:"small",type:"danger"},{default:y(()=>[...e[99]||(e[99]=[R("失败",-1)])]),_:1})):(u(),S(_,{key:3,size:"small",type:"info",effect:"plain"},{default:y(()=>[...e[100]||(e[100]=[R("待上传",-1)])]),_:1}))])])]))),128))])):z("",!0),l("div",oo,[ne("related")>0?(u(),p("span",no,"已就绪："+K(ne("related"))+" 张",1)):(u(),p("span",io,"未上传"))])])]),_:1})])])}}},Uo=wt(ao,[["__scopeId","data-v-d4006ef6"]]);export{Uo as default};
