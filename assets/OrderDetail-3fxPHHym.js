import{u as dt,b as ct}from"./vendor-vue-router-CVyACjsp.js";import{E as M,c as Be,a as Re,d as xe}from"./vendor-element-plus-CtVxZ4Oy.js";import{V as mt,u as vt}from"./bosUpload-DW8LXuH0.js";import{h as Te}from"./http-BzQs6Ld7.js";import{g as _t,f as pt,u as sl,a as ft,b as yt}from"./orders-_KolJW8S.js";import{g as gt}from"./finance-DcJBNqM-.js";import{_ as kt,u as bt}from"./index-CoFTVCI-.js";import{u as ht,f as wt}from"./fieldFormat-BFocv5jO.js";import{c as I,r as C,o as Se,Z as Ue,q as Vt,x as d,z as t,I as xt,P as o,H as _,ay as T,O as B,G as R,J as V,aI as St,y as s,L as A,ac as Y,M as te,u as p,l as rl,ai as j,D as ul}from"./vendor-vue-fFWwKrgY.js";import"./vendor-lodash-rvV0CIkQ.js";import"./vendor-DWCz07M-.js";import"./vendor-dates-DVKSwKij.js";import"./vendor-axios-C0Zqfgkc.js";import"./vendor-pinia-CMXa-Za0.js";const Ut={class:"order-detail"},It={class:"detail-header"},Ot={class:"header-actions"},zt={class:"page-body"},Ct={class:"kv-grid kv-grid-2"},Et={class:"kv-item"},At={class:"kv-value"},Dt=["title"],Ft={class:"kv-item"},Nt={class:"kv-value"},Mt=["title"],Bt={key:0,class:"image-actions image-actions-wide"},Rt={key:1,class:"image-wall image-wall-wide"},Tt=["onClick"],Pt={key:0,class:"thumb-empty"},Yt={class:"info-block"},$t={class:"kv-grid kv-grid-2 info-grid"},Lt={class:"kv-item"},Kt={class:"kv-value"},jt={class:"kv-item"},qt={class:"kv-grid kv-grid-4 info-grid info-grid-compact"},Ht={class:"kv-item"},Gt={class:"kv-value"},Wt={class:"kv-item"},Zt={class:"kv-value"},Jt={class:"kv-item"},Qt={class:"kv-value"},Xt={class:"kv-item"},en={class:"kv-value"},ln={class:"kv-grid kv-grid-2 info-grid"},tn={class:"kv-item"},nn={class:"kv-value value-red"},an={class:"kv-item"},on={class:"kv-value"},sn={class:"kv-grid kv-grid-6 info-grid info-grid-compact"},rn={class:"kv-item"},un={class:"kv-value"},dn={class:"kv-item"},cn={class:"kv-value"},mn={class:"kv-item"},vn={class:"kv-value"},_n={class:"kv-item"},pn={class:"kv-value"},fn={class:"kv-item"},yn={class:"kv-value"},gn={class:"kv-item"},kn={class:"kv-value"},bn={class:"kv-grid kv-grid-2 info-grid"},hn={class:"kv-item"},wn={class:"kv-value value-red"},Vn={class:"kv-grid kv-grid-6 info-grid info-grid-compact"},xn={class:"kv-item"},Sn={class:"kv-value"},Un={class:"kv-item"},In={class:"kv-value"},On={class:"kv-item"},zn={class:"kv-value"},Cn={class:"kv-item"},En={class:"kv-value"},An={class:"kv-item"},Dn={class:"kv-value"},Fn={class:"kv-item"},Nn={class:"kv-value"},Mn={class:"kv-grid kv-grid-2 info-grid"},Bn={class:"kv-item"},Rn={class:"kv-value value-red"},Tn={class:"kv-grid kv-grid-2 info-grid"},Pn={class:"kv-item"},Yn={class:"kv-value value-red"},$n={class:"section-header"},Ln={class:"two-col"},Kn={class:"left"},jn={key:0,class:"kv-grid kv-grid-2"},qn={class:"kv-item"},Hn={class:"kv-value"},Gn={class:"kv-item"},Wn={class:"kv-value"},Zn={class:"kv-item"},Jn={class:"kv-value"},Qn={class:"kv-item"},Xn={class:"kv-value"},ea={key:1},la={class:"right"},ta={key:0,class:"image-actions"},na={class:"image-wall"},aa={key:0,class:"thumb-empty"},ia={class:"section-header"},oa={class:"stack"},sa={class:"sub-block"},ra={class:"two-col"},ua={class:"left"},da={key:0,class:"kv-grid kv-grid-2"},ca={class:"kv-item"},ma={class:"kv-item"},va={class:"kv-value"},_a={key:1,class:"kv-grid kv-grid-2"},pa={class:"kv-label"},fa={class:"right"},ya={key:0,class:"image-actions"},ga={class:"image-wall"},ka={key:0,class:"thumb-empty"},ba={class:"sub-block"},ha={class:"two-col"},wa={class:"left"},Va={key:0,class:"kv-grid kv-grid-2"},xa={class:"kv-label"},Sa={class:"kv-value"},Ua={class:"right"},Ia={key:0,class:"image-actions"},Oa={class:"image-wall"},za={key:0,class:"thumb-empty"},Ca={class:"section-header"},Ea={class:"stack"},Aa={class:"sub-block"},Da={class:"two-col"},Fa={class:"left"},Na={key:0,class:"kv-grid kv-grid-2"},Ma={key:0,class:"kv-item"},Ba={class:"kv-value"},Ra={key:1,class:"kv-item"},Ta={key:2,class:"kv-item"},Pa={class:"kv-value"},Ya={key:3,class:"kv-item"},$a={class:"kv-value"},La={key:4,class:"kv-item"},Ka={class:"kv-value"},ja={key:5,class:"kv-item"},qa={class:"kv-value"},Ha={key:6,class:"kv-item"},Ga={class:"kv-value"},Wa={key:1,class:"kv-grid kv-grid-2"},Za={class:"kv-label"},Ja={class:"right"},Qa={key:0,class:"image-actions"},Xa={class:"image-wall"},ei={key:0,class:"thumb-empty"},li={class:"sub-block"},ti={class:"two-col"},ni={class:"left"},ai={key:0,class:"kv-grid kv-grid-2"},ii={key:0,class:"kv-item"},oi={class:"kv-value"},si={key:1,class:"kv-grid kv-grid-2"},ri={class:"kv-label"},ui={class:"kv-value"},di={class:"right"},ci={key:0,class:"image-actions"},mi={class:"image-wall"},vi={key:0,class:"thumb-empty"},_i=3500,dl="order_import_upload_mode",pi={__name:"OrderDetail",setup(fi){const Ie=ct(),ne=dt(),cl=bt(),ae=Number(ne.params.id),Oe=I(()=>String(ne.query?.source||"")==="finance"||String(ne.name||"")==="finance-order-detail"?!0:String(ne.path||"").startsWith("/finance/")),_e=I(()=>String(cl.roleName||"").trim().toLowerCase()),ze=I(()=>_e.value==="super_admin"||_e.value==="manager"),ml=I(()=>_e.value==="sales"),vl=I(()=>{const l=_e.value;return l==="finance"||l==="manager"||l==="super_admin"}),q=I(()=>Oe.value&&vl.value),O=C(null),H=C(!1),$=C(!1),pe=C(!1),ie=C(!1),oe=C(!1),G=C(!1),Z=C(!1);function _l(){q.value&&(Z.value=!Z.value)}function pl(){q.value&&(x.related||(ce.value=[],le.value=!1,Z.value=!1,M.success("已退出编辑")))}async function fl(){q.value&&(x.related||(Z.value=!1,M.success("已保存"),await ue({preserveEditDraft:!0})))}Se(()=>q.value,l=>{l||(Z.value=!1)},{immediate:!0});const se=C([]),re=C([]),fe=C(!1),ye=C(!1),L=Ue({channel_group_id:null,customer_group_id:null}),ge=C(null),ke=C(null),Ce=C(null);function yl(l){return l?.key!=="id_name"?null:e=>{e&&(ge.value=e)}}function gl(l){l&&(ke.value=l)}function kl(l){const e=b("owner");return!e||l?.key!==e?null:i=>{i&&(ke.value=i)}}function bl(l){return l?l.closest?.(".kv-item")||l:null}function hl(l){l&&(l.classList.remove("flash-value"),l.offsetWidth,l.classList.add("flash-value"),window.setTimeout(()=>{l.classList.remove("flash-value")},_i))}async function wl({stableMs:l=260,eps:e=1.5,timeoutMs:i=2e3}={}){const u=Date.now();let c=window.scrollY,r=0;return await new Promise(g=>{function k(){const U=window.scrollY;if(Math.abs(U-c)<=e?r+=16:r=0,c=U,r>=l)return g(!0);if(Date.now()-u>=i)return g(!1);requestAnimationFrame(k)}requestAnimationFrame(k)})}async function Pe({targetEl:l,flashEls:e=[],title:i="提示",message:u="",confirmText:c="继续",cancelText:r="取消"}={}){const g=bl(l)||l;g?.scrollIntoView&&g.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),await wl({stableMs:260,eps:1.5,timeoutMs:2200});const k=Array.from(new Set([...(e||[]).filter(Boolean)]));for(const U of k)hl(U);await new Promise(U=>window.setTimeout(U,120));try{const U=typeof u=="string"?j("div",{style:"white-space: pre-line; line-height: 1.7;"},u):u;return await xe.confirm(U,i,{confirmButtonText:c,cancelButtonText:r,type:"warning",center:!0}),!0}catch{return!1}}const a=Ue({insurance_expire_date:"",owner_phone:"",remark:"",commercial_amount:null,compulsory_amount:null,vehicle_tax_amount:null,non_vehicle_amount:null,premium_total:null,channel_commercial_point:null,channel_commercial_supplement_point:null,channel_compulsory_point:null,channel_vehicle_tax_point:null,channel_non_vehicle_point:null,channel_reward:null,channel_total:null,customer_commercial_point:null,customer_commercial_supplement_point:null,customer_compulsory_point:null,customer_vehicle_tax_point:null,customer_non_vehicle_point:null,customer_reward:null,customer_total:null,profit:null});function y(l){if(l==null||l==="")return null;const e=Number(l);return Number.isFinite(e)?e:null}function E(l){const e=y(l);return e===0?null:e}function w(l){const e=y(l);return e===null?0:e}function Ye(l){return l==null?"":String(l).trim()}function Ee(l){if(!l)return"";const e=String(l).trim();return e?/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:/^\d{4}-\d{2}-\d{2}/.test(e)?e.slice(0,10):e:""}function $e(l){const e=l&&typeof l=="object"&&l.order_info&&typeof l.order_info=="object"?l.order_info:{};a.insurance_expire_date=Ee(e.insurance_expire_date),a.owner_phone=Ye(e.owner_phone),a.remark=Ye(e.remark),a.commercial_amount=E(e.commercial_amount),a.compulsory_amount=E(e.compulsory_amount),a.vehicle_tax_amount=E(e.vehicle_tax_amount),a.non_vehicle_amount=E(e.non_vehicle_amount),a.premium_total=E(e.premium_total),a.channel_commercial_point=E(e.channel_commercial_point),a.channel_commercial_supplement_point=E(e.channel_commercial_supplement_point),a.channel_compulsory_point=E(e.channel_compulsory_point),a.channel_vehicle_tax_point=E(e.channel_vehicle_tax_point),a.channel_non_vehicle_point=E(e.channel_non_vehicle_point),a.channel_reward=E(e.channel_reward),a.channel_total=E(e.channel_total),a.customer_commercial_point=E(e.customer_commercial_point),a.customer_commercial_supplement_point=E(e.customer_commercial_supplement_point),a.customer_compulsory_point=E(e.customer_compulsory_point),a.customer_vehicle_tax_point=E(e.customer_vehicle_tax_point),a.customer_non_vehicle_point=E(e.customer_non_vehicle_point),a.customer_reward=E(e.customer_reward),a.customer_total=E(e.customer_total),a.profit=E(e.profit),Le()}function Vl(){const l=String(a.owner_phone||"").trim();return{insurance_expire_date:a.insurance_expire_date?String(a.insurance_expire_date):"",owner_phone:l,remark:String(a.remark||"").trim(),commercial_amount:y(a.commercial_amount),compulsory_amount:y(a.compulsory_amount),vehicle_tax_amount:y(a.vehicle_tax_amount),non_vehicle_amount:y(a.non_vehicle_amount),premium_total:y(a.premium_total),channel_commercial_point:y(a.channel_commercial_point),channel_commercial_supplement_point:y(a.channel_commercial_supplement_point),channel_compulsory_point:y(a.channel_compulsory_point),channel_vehicle_tax_point:y(a.channel_vehicle_tax_point),channel_non_vehicle_point:y(a.channel_non_vehicle_point),channel_reward:y(a.channel_reward),channel_total:y(a.channel_total),customer_commercial_point:y(a.customer_commercial_point),customer_commercial_supplement_point:y(a.customer_commercial_supplement_point),customer_compulsory_point:y(a.customer_compulsory_point),customer_vehicle_tax_point:y(a.customer_vehicle_tax_point),customer_non_vehicle_point:y(a.customer_non_vehicle_point),customer_reward:y(a.customer_reward),customer_total:y(a.customer_total),profit:y(a.profit)}}function Le(){const l=y(a.commercial_amount),e=y(a.compulsory_amount),i=y(a.vehicle_tax_amount),u=y(a.non_vehicle_amount),c=l===null?null:Math.max(0,l),r=e===null?null:Math.max(0,e),g=i===null?null:Math.max(0,i),k=u===null?null:Math.max(0,u);a.commercial_amount=c,a.compulsory_amount=r,a.vehicle_tax_amount=g,a.non_vehicle_amount=k;const U=[c,r,g,k].some(ve=>typeof ve=="number"),N=w(c)+w(r)+w(g)+w(k);a.premium_total=U?N:null;const K=y(a.channel_commercial_point),n=y(a.channel_commercial_supplement_point),m=y(a.channel_compulsory_point),h=y(a.channel_vehicle_tax_point),P=y(a.channel_non_vehicle_point),el=y(a.channel_reward),ll=y(a.customer_commercial_point),tl=y(a.customer_commercial_supplement_point),nl=y(a.customer_compulsory_point),al=y(a.customer_vehicle_tax_point),il=y(a.customer_non_vehicle_point),ol=y(a.customer_reward),ot=[K,n,m,h,P,el].some(ve=>typeof ve=="number"),st=[ll,tl,nl,al,il,ol].some(ve=>typeof ve=="number"),rt=w(c)*(w(K)/100)+w(c)*(w(n)/100)+w(r)*(w(m)/100)+w(g)*(w(h)/100)+w(k)*(w(P)/100)+w(el),ut=w(c)*(w(ll)/100)+w(c)*(w(tl)/100)+w(r)*(w(nl)/100)+w(g)*(w(al)/100)+w(k)*(w(il)/100)+w(ol);a.channel_total=U||ot?rt:null,a.customer_total=U||st?ut:null,a.channel_total===null||a.customer_total===null?a.profit=null:a.profit=w(a.channel_total)-w(a.customer_total)}Se(()=>[a.commercial_amount,a.compulsory_amount,a.vehicle_tax_amount,a.non_vehicle_amount,a.channel_commercial_point,a.channel_commercial_supplement_point,a.channel_compulsory_point,a.channel_vehicle_tax_point,a.channel_non_vehicle_point,a.channel_reward,a.customer_commercial_point,a.customer_commercial_supplement_point,a.customer_compulsory_point,a.customer_vehicle_tax_point,a.customer_non_vehicle_point,a.customer_reward],()=>Le());const xl=I(()=>{const l=Array.isArray(se.value)?se.value:[],e=L.channel_group_id;if(e==null||e==="")return l;const i=Number(e);if(l.some(r=>Number(r?.id)===i))return l;const c=O.value?.channel_group_name||`ID:${e}`;return[{id:e,group_name:`${c}（已删除）`,_ghost:!0},...l]}),Sl=I(()=>{const l=Array.isArray(re.value)?re.value:[],e=L.customer_group_id;if(e==null||e==="")return l;const i=Number(e);if(l.some(r=>Number(r?.id)===i))return l;const c=O.value?.customer_group_name||`ID:${e}`;return[{id:e,group_name:`${c}（已删除）`,_ghost:!0},...l]}),{groups:Ke,allFields:Ul,loadConfig:Il}=ht(),Ol=I(()=>{const l=new Map;for(const e of Ul.value||[])l.set(e.key,e);return l});function D(l){return Ol.value.get(l)||{key:l,label:l,type:"text",options:[]}}function be(l){return l?.key==="id_number"?"公民身份号码":l?.label||l?.key||""}function je(l){if(l==null||l==="")return l;const e=String(l);return/^\d{8}$/.test(e)?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:l}function zl(l,e){if(l==null||l==="")return"-";const i=e||{type:"text",options:[]},u=i.type==="date"?je(l):l,c=wt(u,i);return c===""?"-":c}const f=Ue({}),ee=I(()=>!O.value||Oe.value?!1:O.value.is_finished===!0?ze.value:ze.value?!0:ml.value&&O.value.is_finished===!1),v=I(()=>ee.value&&G.value),J=I(()=>v.value?!0:q.value&&Z.value),Cl=I(()=>!O.value||O.value.is_finished!==!0?!1:ze.value),z=I(()=>{const l={vehicle_cert:[],idcard_front:[],idcard_back:[],driving_license_main:[],driving_license_sub:[],related:[]};for(const e of O.value?.images||[]){if(!e?.slot_key)continue;const i=(e?.image_url||e?.url||"").trim();i&&(l[e.slot_key]||(l[e.slot_key]=[]),l[e.slot_key].push(i))}return l}),Ae=I(()=>{const l={vehicle_cert:[],idcard_front:[],idcard_back:[],driving_license_main:[],driving_license_sub:[],related:[]};for(const e of O.value?.images||[])e?.slot_key&&(l[e.slot_key]||(l[e.slot_key]=[]),l[e.slot_key].push(e));return l}),El=Object.freeze(["id_name","id_gender","id_ethnicity","id_birth_date","id_address","id_number"]),Al=Object.freeze(["id_issuer","id_validity"]),Dl=I(()=>El.map(l=>D(l))),Fl=I(()=>Al.map(l=>D(l))),Nl=I(()=>(Ke.value||[]).find(l=>l.group_key==="driving_license")),Ml=I(()=>(Ke.value||[]).find(l=>l.group_key==="driving_attach"));function qe(l){return l?(l.fields||[]).map(i=>i.field_name).filter(Boolean).map(i=>D(i)):[]}const Bl=Object.freeze(["dl_plate_no","dl_owner","dl_use_nature","dl_brand_model","dl_vin","dl_engine_no","dl_register_date"]);function Rl(l){const e=[],i=new Set;for(const u of Array.isArray(l)?l:[]){const c=String(u?.key||"");c&&(i.has(c)||(i.add(c),e.push(u)))}return e}function Tl(l,e){const i=Array.isArray(l)?l:[],u=new Set(i.map(r=>String(r?.key||"")).filter(Boolean)),c=(Array.isArray(e)?e:[]).filter(r=>r&&!u.has(String(r))).map(r=>D(r));return Rl([...i,...c])}const He=I(()=>Tl(qe(Nl.value),Bl)),Ge=I(()=>qe(Ml.value));function W(l,{preferKeys:e=[],labelIncludes:i=[],keyIncludes:u=[]}={}){const c=Array.isArray(l)?l:[];for(const r of e){const g=c.find(k=>k?.key===r);if(g?.key)return g.key}for(const r of u){const g=c.find(k=>String(k?.key||"").toLowerCase().includes(String(r).toLowerCase()));if(g?.key)return g.key}for(const r of i){const g=c.find(k=>String(k?.label||"").includes(String(r)));if(g?.key)return g.key}return null}const Pl=I(()=>{const l=He.value||[];return{plate:W(l,{preferKeys:["dl_plate_no"],keyIncludes:["plate"],labelIncludes:["号牌"]}),owner:W(l,{preferKeys:["dl_owner"],keyIncludes:["owner"],labelIncludes:["所有人"]}),use_nature:W(l,{preferKeys:["dl_use_nature"],keyIncludes:["use_nature","use"],labelIncludes:["使用性质"]}),brand_model:W(l,{preferKeys:["dl_brand_model"],keyIncludes:["brand","model"],labelIncludes:["品牌型号","品牌","型号"]}),vin:W(l,{preferKeys:["dl_vin","vin"],keyIncludes:["vin"],labelIncludes:["识别","车架"]}),engine:W(l,{preferKeys:["dl_engine_no","engine_no","dl_engine","engine"],keyIncludes:["engine"],labelIncludes:["发动机"]}),register_date:W(l,{preferKeys:["dl_register_date","register_date","dl_reg_date","dl_register_dt"],keyIncludes:["register","reg_date","reg"],labelIncludes:["注册日期"]})}});function b(l){return Pl.value?.[l]||null}const he=I(()=>{const l=Ge.value||[];return W(l,{preferKeys:["dl_approved_passenger_count","approved_passenger_count","dl_passenger_count"],keyIncludes:["passenger","approved"],labelIncludes:["核定载","载人数","载客"]})});function Yl(){const l=ne.query?.from;if(typeof l=="string"&&l){let e=l;try{e=decodeURIComponent(l)}catch{e=l}if(e.startsWith("/")){Ie.push(e);return}}if(window.history.length>1){Ie.back();return}Ie.push({path:Oe.value?"/finance":"/orders/all"})}function We(l){const e=l?.dynamic_data||{};for(const i of Object.keys(f))delete f[i];for(const[i,u]of Object.entries(e))f[i]=u??"";L.customer_group_id=l?.customer_group_id??null,L.channel_group_id=l?.channel_group_id??null,$e(l)}function Ze(){if(ee.value){if(G.value){G.value=!1,O.value&&We(O.value);return}G.value=!0,(!se.value.length||!re.value.length)&&De()}}async function De(){fe.value=!0,ye.value=!0;try{const[l,e]=await Promise.all([Te.get("/orders/channel-groups"),Te.get("/orders/customer-groups")]);se.value=Array.isArray(l?.data?.items)?l.data.items:[],re.value=Array.isArray(e?.data?.items)?e.data.items:[]}catch(l){console.error(l),M.error("加载渠道/客户选项失败")}finally{fe.value=!1,ye.value=!1}}function $l(){return q.value}async function ue({preserveEditDraft:l=!1}={}){H.value=!0;try{const e=$l()?await gt(ae):await _t(ae);O.value=e.data,l?G.value||$e(O.value):(G.value=!1,We(O.value))}catch(e){console.error(e),M.error("加载订单详情失败")}finally{H.value=!1}}function Ll(l){return String(l||"").replace(/\s+/g,"").replace(/-/g,"")}function Kl(l){const e=Ll(l);return e?/^(?:\+?86)?1[3-9]\d{9}$/.test(e):!0}function jl(){return String(f?.id_name||"").trim()}function ql(){const l=b("owner");return l?String(f?.[l]||"").trim():""}async function Hl(){if(v.value){const i=String(a.owner_phone||"").trim();if(i&&!Kl(i))return await ul(),await Pe({targetEl:Ce.value,flashEls:[Ce.value],title:"电话格式不正确",message:"车主电话默认按手机号校验，请检查后再保存。",confirmText:"我知道了",cancelText:"取消"}),!1}const l=jl(),e=ql();return!(l&&e&&l!==e&&(await ul(),!await Pe({targetEl:ge.value||ke.value,flashEls:[ge.value,ke.value].filter(Boolean),title:"姓名不一致",message:`检测到证件姓名不一致：
身份证姓名【${l}】
行驶证所有人【${e}】
是否仍要继续保存？`,confirmText:"继续保存",cancelText:"取消保存"})))}async function Gl(){if(!(!O.value||!v.value||!await Hl())){$.value=!0;try{const e={...O.value.dynamic_data||{},...f};await ft(ae,{dynamic_data:e,customer_group_id:L.customer_group_id,channel_group_id:L.channel_group_id,order_info:Vl()}),M.success("保存成功"),await ue()}catch(e){console.error(e),M.error("保存失败")}finally{$.value=!1}}}async function Wl(){try{await xe.confirm("确认将该订单【退回未完成】？","确认操作",{confirmButtonText:"确认退回",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}await Zl()}async function Zl(){if(O.value){$.value=!0;try{await yt(ae,{is_finished:!1}),M.success("已退回未完成"),await ue()}catch(l){console.error(l),M.error("操作失败")}finally{$.value=!1}}}const de=C("smart");function Jl(){const l=localStorage.getItem(dl);(l==="smart"||l==="direct"||l==="stable")&&(de.value=l)}Jl();const x=Ue({vehicle_cert:!1,idcard_front:!1,idcard_back:!1,driving_license_main:!1,driving_license_sub:!1,related:!1}),ce=C([]),le=C(!1),Fe=C("");let we=null,Ne=0;function Ql(l){try{return Date.parse(l)}catch{return 0}}async function Xl(){const l=Date.now();if(we&&Ne&&l+12e4<Ne)return we;const i=(await Te.get("/orders/bos-sts"))?.data;if(!i?.accessKeyId||!i?.secretAccessKey||!i?.sessionToken)throw new Error("bos-sts response invalid");return we=i,Fe.value=i.bosHost||"",Ne=Ql(i.expiration)||l+600*1e3,we}function Q(l){const e=l?.message||l?.response?.data?.detail||l?.response?.data?.message||"";return String(e||"")}function Je(l){const e=Q(l).toLowerCase();return e.includes("failed to fetch")||e.includes("network error")||e.includes("err_")||e.includes("cors")||e.includes("代理")||e.includes("vpn")||e.includes("127.0.0.1:7890")}async function Qe(l){try{await xe.confirm(`上传看起来被当前网络环境拦截（常见于 VPN/代理/公司网关）。

是否切换到【稳定模式上传】继续？`,"上传失败（网络拦截）",{confirmButtonText:"切换为稳定模式",cancelButtonText:"继续直传重试",type:"warning",center:!0,distinguishCancelAndClose:!0}),de.value="stable";try{localStorage.setItem(dl,"stable")}catch{}return!0}catch{return!1}}function et(l){try{return(new URL(String(l)).pathname||"").replace(/^\/+/,"")}catch{const e=String(l||""),i=e.indexOf("://");if(i>=0){const u=e.slice(i+3),c=u.indexOf("/");if(c>=0)return u.slice(c+1).replace(/^\/+/,"")}return""}}function lt(l){const e=(l?.storage_key||l?.image_file?.storage_key||"").trim().replace(/^\/+/,"");if(e)return e;const i=(l?.image_url||l?.url||"").trim();return i?et(i):""}function tt(l){const i=String(l||"").match(/([a-f0-9]{32})\.[a-z0-9]+$/i);return i?String(i[1]).toLowerCase():""}function Me(l,e){const i=lt(l);if(!i)return null;const u=tt(i)||"";return{slot_key:e,storage_key:i,md5:u,size:0}}async function Ve(l,e){if(q.value){const r=(await sl({slot_key:l,file:e}))?.data;return{slot_key:l,storage_key:r?.storage_key,md5:r?.md5||"",size:r?.size||e?.size||0,content_type:r?.content_type||e?.type||"application/octet-stream",etag:r?.etag||"",original_name:r?.original_name||e?.name||"file",url:r?.url||""}}if(de.value==="stable"){const r=(await sl({slot_key:l,file:e}))?.data;return{slot_key:l,storage_key:r?.storage_key,md5:r?.md5||"",size:r?.size||e?.size||0,content_type:r?.content_type||e?.type||"application/octet-stream",etag:r?.etag||"",original_name:r?.original_name||e?.name||"file",url:r?.url||""}}const i=await Xl();if(!Fe.value)throw new Error("bosHost missing");const u=await vt({bosHost:Fe.value,slotKey:l,file:e,sts:i});return{slot_key:l,storage_key:u?.storage_key,md5:u?.md5||"",size:u?.size||e?.size||0,content_type:u?.content_type||e?.type||"application/octet-stream",etag:u?.etag||"",original_name:u?.original_name||e?.name||"file",url:u?.url||""}}async function X(l,e,{clear:i=!1}={}){await pt({order_id:ae,images:e,clear_slots:i?[l]:[]}),await ue({preserveEditDraft:!0}),M.success("图片已更新（如涉及证件将触发 OCR 任务）")}async function me(l,e){if(!v.value)return;const i=e?.raw;if(i){x[l]=!0;try{const u=await Ve(l,i);if(!u?.storage_key)throw new Error("upload meta invalid");await X(l,[u])}catch(u){if(de.value==="smart"&&Je(u)&&await Qe())try{const r=await Ve(l,i);if(!r?.storage_key)throw new Error("upload meta invalid");await X(l,[r]);return}catch(r){console.error(r),M.error(Q(r)||"上传失败");return}console.error(u),M.error(Q(u)||"上传失败")}finally{x[l]=!1}}}async function nt(l){if(!J.value)return;const e=l?.raw;e&&(ce.value.push(e),!x.related&&await Xe())}async function Xe(){if(x.related)return;const l=ce.value.splice(0);if(l.length){x.related=!0;try{const e=(Ae.value.related||[]).map(u=>Me(u,"related")).filter(Boolean),i=[];for(const u of l){const c=await Ve("related",u);if(!c?.storage_key)throw new Error("upload meta invalid");i.push(c)}i.length&&await X("related",[...e,...i]),le.value=!1}catch(e){if(!q.value&&de.value==="smart"&&Je(e)&&!le.value&&await Qe()){le.value=!0;try{const u=(Ae.value.related||[]).map(r=>Me(r,"related")).filter(Boolean),c=[];for(const r of l){const g=await Ve("related",r);if(!g?.storage_key)throw new Error("upload meta invalid");c.push(g)}c.length&&await X("related",[...u,...c]),le.value=!1}catch(u){console.error(u),M.error(Q(u)||"上传失败")}return}console.error(e),M.error(Q(e)||"上传失败")}finally{x.related=!1,ce.value.length&&Xe()}}}async function at(l){if(!J.value)return;const e=(Ae.value.related||[]).slice();if(!(l<0||l>=e.length)){x.related=!0;try{const i=e.filter((u,c)=>c!==l).map(u=>Me(u,"related")).filter(Boolean);if(!i.length){await X("related",[],{clear:!0});return}await X("related",i)}catch(i){console.error(i),M.error(Q(i)||"删除失败")}finally{x.related=!1}}}async function it(){if(J.value&&z.value.related.length){try{await xe.confirm("确认清空【备用图】所有图片？","确认清空",{confirmButtonText:"确认清空",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}ce.value=[],le.value=!1,x.related=!0;try{await X("related",[],{clear:!0})}catch(l){console.error(l),M.error(Q(l)||"清空失败")}finally{x.related=!1}}}Vt(async()=>{await Il("order"),ee.value&&await De(),await ue()});const F=rl({name:"FieldValue",props:{modelValue:{type:[String,Number,Date],default:""},field:{type:Object,required:!0},editable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:e}){const i=T("el-input"),u=T("el-select"),c=T("el-option"),r=T("el-date-picker"),g=k=>e("update:modelValue",k);return()=>{const k=l.field||{type:"text",options:[]},U=l.modelValue??"",N=zl(U,k);if(!l.editable)return j("span",{class:"plain-value",title:N},N);if(k.type==="date"){const K=je(U)??"";return j(r,{modelValue:K,"onUpdate:modelValue":g,type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}if(k.type==="select"){const K=Array.isArray(k.options)?k.options:[];return j(u,{modelValue:U,"onUpdate:modelValue":g,filterable:!0,clearable:!0,class:"fv fv-select"},()=>K.map(n=>{const m=n&&typeof n=="object"?n.label:String(n),h=n&&typeof n=="object"?n.value:n;return j(c,{key:String(h),label:m,value:h})}))}return j(i,{modelValue:U,"onUpdate:modelValue":g,clearable:!0,class:"fv fv-input"})}}}),S=rl({name:"InfoValue",props:{modelValue:{type:[String,Number,null],default:""},type:{type:String,default:"text"},editable:{type:Boolean,default:!1},min:{type:Number,default:void 0},max:{type:Number,default:void 0}},emits:["update:modelValue"],setup(l,{emit:e}){const i=T("el-input"),u=T("el-date-picker"),c=C(""),r=C(!1);function g(m){return m==null||m===""||(l.type==="money"||l.type==="point")&&Number(m)===0?"":String(m)}function k(){r.value||(c.value=g(l.modelValue))}Se(()=>l.modelValue,()=>k(),{immediate:!0});function U(m){let h=m;return typeof l.min=="number"&&(h=Math.max(l.min,h)),typeof l.max=="number"&&(h=Math.min(l.max,h)),h}function N(){c.value="",e("update:modelValue",null)}function K(){r.value=!1;const m=String(c.value||"").trim();if(!m){N();return}const h=Number(m);if(!Number.isFinite(h)){N();return}let P=U(h);if(l.type==="money"){P=Math.round(P*100)/100,e("update:modelValue",P),c.value=P.toFixed(2);return}e("update:modelValue",P),c.value=String(P)}function n(m){if(m==null||m==="")return"-";const h=Number(m);return l.type==="money"?Number.isFinite(h)?h.toFixed(2):"-":l.type==="point"?Number.isFinite(h)?String(h):"-":l.type==="date"?Ee(m)||"-":String(m)}return()=>{const m=l.modelValue??"";if(!l.editable){const h=n(m);return j("span",{class:"plain-value",title:h},h)}if(l.type==="date"){const h=Ee(m);return j(u,{modelValue:h,"onUpdate:modelValue":P=>e("update:modelValue",P),type:"date",clearable:!0,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",class:"fv fv-date"})}return l.type==="money"||l.type==="point"?j(i,{modelValue:c.value,"onUpdate:modelValue":h=>{c.value=String(h??"")},clearable:!0,class:"fv fv-input",inputmode:"decimal",onFocus:()=>{r.value=!0},onBlur:()=>K(),onClear:()=>N()}):j(i,{modelValue:m,"onUpdate:modelValue":h=>e("update:modelValue",h),clearable:!0,class:"fv fv-input"})}}});return Se(()=>ee.value,l=>{l&&(!se.value.length||!re.value.length)&&De()}),(l,e)=>{const i=T("el-button"),u=T("el-option"),c=T("el-select"),r=T("el-card"),g=T("el-upload"),k=T("el-image"),U=T("el-icon"),N=T("el-tooltip"),K=St("loading");return s(),d("div",Ut,[t("div",It,[e[50]||(e[50]=t("h2",null,"订单详情",-1)),t("div",Ot,[o(i,{size:"small",onClick:Yl},{default:_(()=>[...e[42]||(e[42]=[A("返回",-1)])]),_:1}),q.value&&O.value?(s(),d(B,{key:0},[Z.value?(s(),d(B,{key:1},[o(i,{size:"small",plain:"",disabled:H.value||$.value||x.related,onClick:pl},{default:_(()=>[...e[44]||(e[44]=[A(" 取消编辑 ",-1)])]),_:1},8,["disabled"]),o(i,{size:"small",type:"primary",disabled:H.value||$.value||x.related,onClick:fl},{default:_(()=>[...e[45]||(e[45]=[A(" 保存 ",-1)])]),_:1},8,["disabled"])],64)):(s(),R(i,{key:0,size:"small",type:"primary",plain:"",disabled:H.value||$.value||x.related,onClick:_l},{default:_(()=>[...e[43]||(e[43]=[A(" 编辑 ",-1)])]),_:1},8,["disabled"]))],64)):(s(),d(B,{key:1},[Cl.value?(s(),R(i,{key:0,size:"small",type:"warning",plain:"",loading:$.value,onClick:Wl},{default:_(()=>[...e[46]||(e[46]=[A(" 退回未完成 ",-1)])]),_:1},8,["loading"])):V("",!0),ee.value&&!G.value?(s(),R(i,{key:1,size:"small",type:"primary",plain:"",disabled:H.value||$.value,onClick:Ze},{default:_(()=>[...e[47]||(e[47]=[A(" 编辑 ",-1)])]),_:1},8,["disabled"])):V("",!0),ee.value&&G.value?(s(),R(i,{key:2,size:"small",plain:"",disabled:H.value||$.value,onClick:Ze},{default:_(()=>[...e[48]||(e[48]=[A(" 取消编辑 ",-1)])]),_:1},8,["disabled"])):V("",!0),v.value?(s(),R(i,{key:3,size:"small",type:"primary",loading:$.value,onClick:Gl},{default:_(()=>[...e[49]||(e[49]=[A("保存",-1)])]),_:1},8,["loading"])):V("",!0)],64))])]),xt((s(),d("div",zt,[o(r,{shadow:"never",class:"section-card meta-card"},{header:_(()=>[...e[51]||(e[51]=[t("div",{class:"section-header"},[t("div",{class:"section-title"},"渠道、客户")],-1)])]),default:_(()=>[t("div",Ct,[t("div",Et,[e[52]||(e[52]=t("div",{class:"kv-label"},"渠道",-1)),t("div",At,[v.value?(s(),R(c,{key:0,modelValue:L.channel_group_id,"onUpdate:modelValue":e[0]||(e[0]=n=>L.channel_group_id=n),filterable:"",clearable:"",placeholder:"请选择渠道",class:"fv fv-select",loading:fe.value,disabled:fe.value},{default:_(()=>[(s(!0),d(B,null,Y(xl.value,n=>(s(),R(u,{key:String(n.id),label:n.group_name||String(n.id),value:n.id,disabled:!!n._ghost},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading","disabled"])):(s(),d("span",{key:1,class:"plain-value",title:O.value?.channel_group_name||"-"},te(O.value?.channel_group_name||"-"),9,Dt))])]),t("div",Ft,[e[53]||(e[53]=t("div",{class:"kv-label"},"客户",-1)),t("div",Nt,[v.value?(s(),R(c,{key:0,modelValue:L.customer_group_id,"onUpdate:modelValue":e[1]||(e[1]=n=>L.customer_group_id=n),filterable:"",clearable:"",placeholder:"请选择客户",class:"fv fv-select",loading:ye.value,disabled:ye.value},{default:_(()=>[(s(!0),d(B,null,Y(Sl.value,n=>(s(),R(u,{key:String(n.id),label:n.group_name||String(n.id),value:n.id,disabled:!!n._ghost},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading","disabled"])):(s(),d("span",{key:1,class:"plain-value",title:O.value?.customer_group_name||"-"},te(O.value?.customer_group_name||"-"),9,Mt))])])])]),_:1}),o(r,{shadow:"never",class:"section-card"},{header:_(()=>[...e[54]||(e[54]=[t("div",{class:"section-header"},[t("div",{class:"section-title"},"备用图")],-1)])]),default:_(()=>[J.value?(s(),d("div",Bt,[o(g,{drag:"","auto-upload":!1,multiple:!0,"show-file-list":!1,accept:"image/*",disabled:x.related,"on-change":n=>nt(n),class:"related-dragger"},{default:_(()=>[...e[55]||(e[55]=[t("div",{class:"drag-inner"},[t("div",{class:"drag-title"},"拖拽图片到这里"),t("div",{class:"drag-sub"},"或点击选择（支持多张）")],-1)])]),_:1},8,["disabled","on-change"]),o(i,{size:"small",type:"danger",plain:"",disabled:x.related||!z.value.related.length,loading:x.related,onClick:it},{default:_(()=>[...e[56]||(e[56]=[A(" 清空 ",-1)])]),_:1},8,["disabled","loading"])])):V("",!0),J.value||z.value.related.length?(s(),d("div",Rt,[(s(!0),d(B,null,Y(z.value.related,(n,m)=>(s(),d("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.related,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"]),J.value?(s(),d("button",{key:0,type:"button",class:"thumb-remove",title:"删除这张",onClick:h=>at(m)}," × ",8,Tt)):V("",!0)]))),128)),J.value&&!z.value.related.length?(s(),d("div",Pt)):V("",!0)])):V("",!0)]),_:1}),o(r,{shadow:"never",class:"section-card"},{header:_(()=>[...e[57]||(e[57]=[t("div",{class:"section-header"},[t("div",{class:"section-title"},"订单信息")],-1)])]),default:_(()=>[t("div",Yt,[t("div",$t,[t("div",Lt,[e[58]||(e[58]=t("div",{class:"kv-label"},"保险到期日",-1)),t("div",Kt,[o(p(S),{modelValue:a.insurance_expire_date,"onUpdate:modelValue":e[2]||(e[2]=n=>a.insurance_expire_date=n),type:"date",editable:v.value},null,8,["modelValue","editable"])])]),t("div",jt,[e[59]||(e[59]=t("div",{class:"kv-label"},"车主电话",-1)),t("div",{class:"kv-value",ref_key:"ownerPhoneValueRef",ref:Ce},[o(p(S),{modelValue:a.owner_phone,"onUpdate:modelValue":e[3]||(e[3]=n=>a.owner_phone=n),type:"text",editable:v.value},null,8,["modelValue","editable"])],512)])]),t("div",qt,[t("div",Ht,[e[60]||(e[60]=t("div",{class:"kv-label"},"商业金额",-1)),t("div",Gt,[o(p(S),{modelValue:a.commercial_amount,"onUpdate:modelValue":e[4]||(e[4]=n=>a.commercial_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])]),t("div",Wt,[e[61]||(e[61]=t("div",{class:"kv-label"},"交强金额",-1)),t("div",Zt,[o(p(S),{modelValue:a.compulsory_amount,"onUpdate:modelValue":e[5]||(e[5]=n=>a.compulsory_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])]),t("div",Jt,[e[62]||(e[62]=t("div",{class:"kv-label"},"车船税金额",-1)),t("div",Qt,[o(p(S),{modelValue:a.vehicle_tax_amount,"onUpdate:modelValue":e[6]||(e[6]=n=>a.vehicle_tax_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])]),t("div",Xt,[e[63]||(e[63]=t("div",{class:"kv-label"},"非车金额",-1)),t("div",en,[o(p(S),{modelValue:a.non_vehicle_amount,"onUpdate:modelValue":e[7]||(e[7]=n=>a.non_vehicle_amount=n),type:"money",editable:v.value,min:0},null,8,["modelValue","editable"])])])]),t("div",ln,[t("div",tn,[e[64]||(e[64]=t("div",{class:"kv-label"},"保费金额",-1)),t("div",nn,[o(p(S),{modelValue:a.premium_total,"onUpdate:modelValue":e[8]||(e[8]=n=>a.premium_total=n),type:"money",editable:!1},null,8,["modelValue"])])]),t("div",an,[e[65]||(e[65]=t("div",{class:"kv-label"},"订单备注",-1)),t("div",on,[o(p(S),{modelValue:a.remark,"onUpdate:modelValue":e[9]||(e[9]=n=>a.remark=n),type:"text",editable:v.value},null,8,["modelValue","editable"])])])])]),e[81]||(e[81]=t("div",{class:"split-title"},"渠道",-1)),t("div",sn,[t("div",rn,[e[66]||(e[66]=t("div",{class:"kv-label"},"商业点位%",-1)),t("div",un,[o(p(S),{modelValue:a.channel_commercial_point,"onUpdate:modelValue":e[10]||(e[10]=n=>a.channel_commercial_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),t("div",dn,[e[67]||(e[67]=t("div",{class:"kv-label"},"商业后补%",-1)),t("div",cn,[o(p(S),{modelValue:a.channel_commercial_supplement_point,"onUpdate:modelValue":e[11]||(e[11]=n=>a.channel_commercial_supplement_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),t("div",mn,[e[68]||(e[68]=t("div",{class:"kv-label"},"交强点位%",-1)),t("div",vn,[o(p(S),{modelValue:a.channel_compulsory_point,"onUpdate:modelValue":e[12]||(e[12]=n=>a.channel_compulsory_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),t("div",_n,[e[69]||(e[69]=t("div",{class:"kv-label"},"车船税点位%",-1)),t("div",pn,[o(p(S),{modelValue:a.channel_vehicle_tax_point,"onUpdate:modelValue":e[13]||(e[13]=n=>a.channel_vehicle_tax_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),t("div",fn,[e[70]||(e[70]=t("div",{class:"kv-label"},"非车点位%",-1)),t("div",yn,[o(p(S),{modelValue:a.channel_non_vehicle_point,"onUpdate:modelValue":e[14]||(e[14]=n=>a.channel_non_vehicle_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),t("div",gn,[e[71]||(e[71]=t("div",{class:"kv-label"},"出单奖励",-1)),t("div",kn,[o(p(S),{modelValue:a.channel_reward,"onUpdate:modelValue":e[15]||(e[15]=n=>a.channel_reward=n),type:"money",editable:v.value},null,8,["modelValue","editable"])])])]),t("div",bn,[t("div",hn,[e[72]||(e[72]=t("div",{class:"kv-label"},"渠道合计",-1)),t("div",wn,[o(p(S),{modelValue:a.channel_total,"onUpdate:modelValue":e[16]||(e[16]=n=>a.channel_total=n),type:"money",editable:!1},null,8,["modelValue"])])])]),e[82]||(e[82]=t("div",{class:"split-title"},"客户",-1)),t("div",Vn,[t("div",xn,[e[73]||(e[73]=t("div",{class:"kv-label"},"商业点位%",-1)),t("div",Sn,[o(p(S),{modelValue:a.customer_commercial_point,"onUpdate:modelValue":e[17]||(e[17]=n=>a.customer_commercial_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),t("div",Un,[e[74]||(e[74]=t("div",{class:"kv-label"},"商业后补%",-1)),t("div",In,[o(p(S),{modelValue:a.customer_commercial_supplement_point,"onUpdate:modelValue":e[18]||(e[18]=n=>a.customer_commercial_supplement_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),t("div",On,[e[75]||(e[75]=t("div",{class:"kv-label"},"交强点位%",-1)),t("div",zn,[o(p(S),{modelValue:a.customer_compulsory_point,"onUpdate:modelValue":e[19]||(e[19]=n=>a.customer_compulsory_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),t("div",Cn,[e[76]||(e[76]=t("div",{class:"kv-label"},"车船税点位%",-1)),t("div",En,[o(p(S),{modelValue:a.customer_vehicle_tax_point,"onUpdate:modelValue":e[20]||(e[20]=n=>a.customer_vehicle_tax_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),t("div",An,[e[77]||(e[77]=t("div",{class:"kv-label"},"非车点位%",-1)),t("div",Dn,[o(p(S),{modelValue:a.customer_non_vehicle_point,"onUpdate:modelValue":e[21]||(e[21]=n=>a.customer_non_vehicle_point=n),type:"point",editable:v.value},null,8,["modelValue","editable"])])]),t("div",Fn,[e[78]||(e[78]=t("div",{class:"kv-label"},"出单奖励",-1)),t("div",Nn,[o(p(S),{modelValue:a.customer_reward,"onUpdate:modelValue":e[22]||(e[22]=n=>a.customer_reward=n),type:"money",editable:v.value},null,8,["modelValue","editable"])])])]),t("div",Mn,[t("div",Bn,[e[79]||(e[79]=t("div",{class:"kv-label"},"客户合计",-1)),t("div",Rn,[o(p(S),{modelValue:a.customer_total,"onUpdate:modelValue":e[23]||(e[23]=n=>a.customer_total=n),type:"money",editable:!1},null,8,["modelValue"])])])]),t("div",Tn,[t("div",Pn,[e[80]||(e[80]=t("div",{class:"kv-label"},"利润",-1)),t("div",Yn,[o(p(S),{modelValue:a.profit,"onUpdate:modelValue":e[24]||(e[24]=n=>a.profit=n),type:"money",editable:!1},null,8,["modelValue"])])])])]),_:1}),o(r,{shadow:"never",class:"section-card"},{header:_(()=>[t("div",$n,[e[83]||(e[83]=t("div",{class:"section-title"},"车辆合格证",-1)),o(i,{class:"icon-btn",circle:"",size:"small",onClick:e[25]||(e[25]=n=>pe.value=!pe.value)},{default:_(()=>[o(U,null,{default:_(()=>[pe.value?(s(),R(p(Be),{key:0})):(s(),R(p(Re),{key:1}))]),_:1})]),_:1})])]),default:_(()=>[t("div",Ln,[t("div",Kn,[pe.value?(s(),d("div",ea,[o(mt,{data:f,readonly:!v.value},null,8,["data","readonly"])])):(s(),d("div",jn,[t("div",qn,[e[84]||(e[84]=t("div",{class:"kv-label"},"车辆型号",-1)),t("div",Hn,[o(p(F),{modelValue:f.vehicle_model,"onUpdate:modelValue":e[26]||(e[26]=n=>f.vehicle_model=n),field:D("vehicle_model"),editable:v.value},null,8,["modelValue","field","editable"])])]),t("div",Gn,[e[85]||(e[85]=t("div",{class:"kv-label"},"车辆识别代号/车架号",-1)),t("div",Wn,[o(p(F),{modelValue:f.vin,"onUpdate:modelValue":e[27]||(e[27]=n=>f.vin=n),field:D("vin"),editable:v.value},null,8,["modelValue","field","editable"])])]),t("div",Zn,[e[86]||(e[86]=t("div",{class:"kv-label"},"发动机号",-1)),t("div",Jn,[o(p(F),{modelValue:f.engine_no,"onUpdate:modelValue":e[28]||(e[28]=n=>f.engine_no=n),field:D("engine_no"),editable:v.value},null,8,["modelValue","field","editable"])])]),t("div",Qn,[e[87]||(e[87]=t("div",{class:"kv-label"},"额定载客(人 )",-1)),t("div",Xn,[o(p(F),{modelValue:f.approved_passenger_count,"onUpdate:modelValue":e[29]||(e[29]=n=>f.approved_passenger_count=n),field:D("approved_passenger_count"),editable:v.value},null,8,["modelValue","field","editable"])])])]))]),t("div",la,[v.value?(s(),d("div",ta,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("vehicle_cert",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.vehicle_cert},{default:_(()=>[...e[88]||(e[88]=[A("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[t("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[89]||(e[89]=[A("清空",-1)])]),_:1})])]),_:1})])):V("",!0),t("div",na,[(s(!0),d(B,null,Y(z.value.vehicle_cert,(n,m)=>(s(),d("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.vehicle_cert,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.vehicle_cert.length?V("",!0):(s(),d("div",aa))])])])]),_:1}),o(r,{shadow:"never",class:"section-card"},{header:_(()=>[t("div",ia,[e[90]||(e[90]=t("div",{class:"section-title"},"身份证正面/身份证背面",-1)),o(i,{class:"icon-btn",circle:"",size:"small",onClick:e[30]||(e[30]=n=>ie.value=!ie.value)},{default:_(()=>[o(U,null,{default:_(()=>[ie.value?(s(),R(p(Be),{key:0})):(s(),R(p(Re),{key:1}))]),_:1})]),_:1})])]),default:_(()=>[t("div",oa,[t("div",sa,[e[95]||(e[95]=t("div",{class:"sub-title"},"身份证正面",-1)),t("div",ra,[t("div",ua,[ie.value?(s(),d("div",_a,[(s(!0),d(B,null,Y(Dl.value,n=>(s(),d("div",{key:n.key,class:"kv-item"},[t("div",pa,te(be(n)),1),t("div",{class:"kv-value",ref_for:!0,ref:yl(n)},[o(p(F),{modelValue:f[n.key],"onUpdate:modelValue":m=>f[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])],512)]))),128))])):(s(),d("div",da,[t("div",ca,[e[91]||(e[91]=t("div",{class:"kv-label"},"姓名",-1)),t("div",{class:"kv-value",ref_key:"idNameValueRef",ref:ge},[o(p(F),{modelValue:f.id_name,"onUpdate:modelValue":e[31]||(e[31]=n=>f.id_name=n),field:D("id_name"),editable:v.value},null,8,["modelValue","field","editable"])],512)]),t("div",ma,[e[92]||(e[92]=t("div",{class:"kv-label"},"公民身份号码",-1)),t("div",va,[o(p(F),{modelValue:f.id_number,"onUpdate:modelValue":e[32]||(e[32]=n=>f.id_number=n),field:D("id_number"),editable:v.value},null,8,["modelValue","field","editable"])])])]))]),t("div",fa,[v.value?(s(),d("div",ya,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("idcard_front",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.idcard_front},{default:_(()=>[...e[93]||(e[93]=[A("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[t("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[94]||(e[94]=[A("清空",-1)])]),_:1})])]),_:1})])):V("",!0),t("div",ga,[(s(!0),d(B,null,Y(z.value.idcard_front,(n,m)=>(s(),d("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.idcard_front,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.idcard_front.length?V("",!0):(s(),d("div",ka))])])])]),t("div",ba,[e[98]||(e[98]=t("div",{class:"sub-title"},"身份证背面",-1)),t("div",ha,[t("div",wa,[ie.value?(s(),d("div",Va,[(s(!0),d(B,null,Y(Fl.value,n=>(s(),d("div",{key:n.key,class:"kv-item"},[t("div",xa,te(be(n)),1),t("div",Sa,[o(p(F),{modelValue:f[n.key],"onUpdate:modelValue":m=>f[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])])]))),128))])):V("",!0)]),t("div",Ua,[v.value?(s(),d("div",Ia,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("idcard_back",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.idcard_back},{default:_(()=>[...e[96]||(e[96]=[A("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[t("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[97]||(e[97]=[A("清空",-1)])]),_:1})])]),_:1})])):V("",!0),t("div",Oa,[(s(!0),d(B,null,Y(z.value.idcard_back,(n,m)=>(s(),d("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.idcard_back,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.idcard_back.length?V("",!0):(s(),d("div",za))])])])])])]),_:1}),o(r,{shadow:"never",class:"section-card"},{header:_(()=>[t("div",Ca,[e[99]||(e[99]=t("div",{class:"section-title"},"行驶证/行驶证副件",-1)),o(i,{class:"icon-btn",circle:"",size:"small",onClick:e[33]||(e[33]=n=>oe.value=!oe.value)},{default:_(()=>[o(U,null,{default:_(()=>[oe.value?(s(),R(p(Be),{key:0})):(s(),R(p(Re),{key:1}))]),_:1})]),_:1})])]),default:_(()=>[t("div",Ea,[t("div",Aa,[e[109]||(e[109]=t("div",{class:"sub-title"},"行驶证",-1)),t("div",Da,[t("div",Fa,[oe.value?(s(),d("div",Wa,[(s(!0),d(B,null,Y(He.value,n=>(s(),d("div",{key:n.key,class:"kv-item"},[t("div",Za,te(be(n)),1),t("div",{class:"kv-value",ref_for:!0,ref:kl(n)},[o(p(F),{modelValue:f[n.key],"onUpdate:modelValue":m=>f[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])],512)]))),128))])):(s(),d("div",Na,[b("plate")?(s(),d("div",Ma,[e[100]||(e[100]=t("div",{class:"kv-label"},"号牌号码",-1)),t("div",Ba,[o(p(F),{modelValue:f[b("plate")],"onUpdate:modelValue":e[34]||(e[34]=n=>f[b("plate")]=n),field:D(b("plate")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("owner")?(s(),d("div",Ra,[e[101]||(e[101]=t("div",{class:"kv-label"},"所有人",-1)),t("div",{class:"kv-value",ref:gl},[o(p(F),{modelValue:f[b("owner")],"onUpdate:modelValue":e[35]||(e[35]=n=>f[b("owner")]=n),field:D(b("owner")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("use_nature")?(s(),d("div",Ta,[e[102]||(e[102]=t("div",{class:"kv-label"},"使用性质",-1)),t("div",Pa,[o(p(F),{modelValue:f[b("use_nature")],"onUpdate:modelValue":e[36]||(e[36]=n=>f[b("use_nature")]=n),field:D(b("use_nature")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("brand_model")?(s(),d("div",Ya,[e[103]||(e[103]=t("div",{class:"kv-label"},"品牌型号",-1)),t("div",$a,[o(p(F),{modelValue:f[b("brand_model")],"onUpdate:modelValue":e[37]||(e[37]=n=>f[b("brand_model")]=n),field:D(b("brand_model")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("vin")?(s(),d("div",La,[e[104]||(e[104]=t("div",{class:"kv-label"},"车辆识别代码",-1)),t("div",Ka,[o(p(F),{modelValue:f[b("vin")],"onUpdate:modelValue":e[38]||(e[38]=n=>f[b("vin")]=n),field:D(b("vin")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("engine")?(s(),d("div",ja,[e[105]||(e[105]=t("div",{class:"kv-label"},"发动机号码",-1)),t("div",qa,[o(p(F),{modelValue:f[b("engine")],"onUpdate:modelValue":e[39]||(e[39]=n=>f[b("engine")]=n),field:D(b("engine")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0),b("register_date")?(s(),d("div",Ha,[e[106]||(e[106]=t("div",{class:"kv-label"},"注册日期",-1)),t("div",Ga,[o(p(F),{modelValue:f[b("register_date")],"onUpdate:modelValue":e[40]||(e[40]=n=>f[b("register_date")]=n),field:D(b("register_date")),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0)]))]),t("div",Ja,[v.value?(s(),d("div",Qa,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("driving_license_main",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.driving_license_main},{default:_(()=>[...e[107]||(e[107]=[A("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[t("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[108]||(e[108]=[A("清空",-1)])]),_:1})])]),_:1})])):V("",!0),t("div",Xa,[(s(!0),d(B,null,Y(z.value.driving_license_main,(n,m)=>(s(),d("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.driving_license_main,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.driving_license_main.length?V("",!0):(s(),d("div",ei))])])])]),t("div",li,[e[113]||(e[113]=t("div",{class:"sub-title"},"行驶证副件",-1)),t("div",ti,[t("div",ni,[oe.value?(s(),d("div",si,[(s(!0),d(B,null,Y(Ge.value,n=>(s(),d("div",{key:n.key,class:"kv-item"},[t("div",ri,te(be(n)),1),t("div",ui,[o(p(F),{modelValue:f[n.key],"onUpdate:modelValue":m=>f[n.key]=m,field:n,editable:v.value},null,8,["modelValue","onUpdate:modelValue","field","editable"])])]))),128))])):(s(),d("div",ai,[he.value?(s(),d("div",ii,[e[110]||(e[110]=t("div",{class:"kv-label"},"核定载人数",-1)),t("div",oi,[o(p(F),{modelValue:f[he.value],"onUpdate:modelValue":e[41]||(e[41]=n=>f[he.value]=n),field:D(he.value),editable:v.value},null,8,["modelValue","field","editable"])])])):V("",!0)]))]),t("div",di,[v.value?(s(),d("div",ci,[o(g,{"auto-upload":!1,multiple:!1,"show-file-list":!1,accept:"image/*","on-change":n=>me("driving_license_sub",n)},{default:_(()=>[o(i,{size:"small",type:"primary",plain:"",loading:x.driving_license_sub},{default:_(()=>[...e[111]||(e[111]=[A("替换图片",-1)])]),_:1},8,["loading"])]),_:1},8,["on-change"]),o(N,{content:"当前后端 finalize 协议不支持把单图槽清空为 0 张",placement:"top"},{default:_(()=>[t("span",null,[o(i,{size:"small",disabled:""},{default:_(()=>[...e[112]||(e[112]=[A("清空",-1)])]),_:1})])]),_:1})])):V("",!0),t("div",mi,[(s(!0),d(B,null,Y(z.value.driving_license_sub,(n,m)=>(s(),d("div",{key:n+":"+m,class:"thumb-wrap"},[o(k,{src:n,"preview-src-list":z.value.driving_license_sub,"initial-index":m,fit:"cover",class:"thumb"},null,8,["src","preview-src-list","initial-index"])]))),128)),z.value.driving_license_sub.length?V("",!0):(s(),d("div",vi))])])])])])]),_:1})])),[[K,H.value]])])}}},Ei=kt(pi,[["__scopeId","data-v-9908bcd3"]]);export{Ei as default};
