import{a}from"./vendor-axios-C0Zqfgkc.js";function f(t){const n=new URLSearchParams,o=(e,r)=>{if(r!=null){if(Array.isArray(r)){for(const i of r)i!=null&&n.append(e,String(i));return}n.append(e,String(r))}};if(t&&typeof t=="object")for(const[e,r]of Object.entries(t))o(e,r);return n.toString()}const c=a.create({baseURL:"/api",timeout:3e4,paramsSerializer:{serialize:t=>f(t)}});function l(){return sessionStorage.getItem("sessionToken")||""}function d(t,n){if(!t)return!1;if(typeof t.get=="function"){const e=t.get(n);return e!=null&&String(e).trim()!==""}const o=String(n).toLowerCase();for(const e of Object.keys(t))if(String(e).toLowerCase()===o){const r=t[e];return r!=null&&String(r).trim()!==""}return!1}function p(t,n,o){return t||(t={}),typeof t.set=="function"?(t.set(n,o),t):(t[n]=o,t)}c.interceptors.request.use(t=>{const n=l();return t.headers=t.headers??{},n&&!d(t.headers,"X-Session-Token")&&(t.headers=p(t.headers,"X-Session-Token",n)),t},t=>Promise.reject(t));let s=!1;function u(){const t=window.location.pathname||"/",n=window.location.search||"",o=window.location.hash||"";return`${t}${n}${o}`}function h(){const t=u();if(t.startsWith("/login"))return;const n=`/login?redirect=${encodeURIComponent(t)}`;window.location.replace(n)}async function w(){if(!s){s=!0;try{if(!u().startsWith("/login"))try{window.alert("登录已过期，请重新登录。")}catch{}try{sessionStorage.removeItem("sessionToken")}catch{}h()}catch(t){console.error(t)}finally{window.setTimeout(()=>{s=!1},800)}}}c.interceptors.response.use(t=>t,t=>{const n=t?.response?.status;return(n===401||n===419)&&w(),Promise.reject(t)});export{c as h};
