import{a as u}from"./vendor-axios-C0Zqfgkc.js";const i=u.create({baseURL:"/api",timeout:3e4});function a(){return sessionStorage.getItem("sessionToken")||""}function l(t,e){if(!t)return!1;if(typeof t.get=="function"){const o=t.get(e);return o!=null&&String(o).trim()!==""}const n=String(e).toLowerCase();for(const o of Object.keys(t))if(String(o).toLowerCase()===n){const r=t[o];return r!=null&&String(r).trim()!==""}return!1}function f(t,e,n){return t||(t={}),typeof t.set=="function"?(t.set(e,n),t):(t[e]=n,t)}i.interceptors.request.use(t=>{const e=a();return t.headers=t.headers??{},e&&!l(t.headers,"X-Session-Token")&&(t.headers=f(t.headers,"X-Session-Token",e)),t},t=>Promise.reject(t));let s=!1;function c(){const t=window.location.pathname||"/",e=window.location.search||"",n=window.location.hash||"";return`${t}${e}${n}`}function h(){const t=c();if(t.startsWith("/login"))return;const e=`/login?redirect=${encodeURIComponent(t)}`;window.location.replace(e)}async function p(){if(!s){s=!0;try{if(!c().startsWith("/login"))try{window.alert("登录已过期，请重新登录。")}catch{}try{sessionStorage.removeItem("sessionToken")}catch{}h()}catch(t){console.error(t)}finally{window.setTimeout(()=>{s=!1},800)}}}i.interceptors.response.use(t=>t,t=>{const e=t?.response?.status;return(e===401||e===419)&&p(),Promise.reject(t)});export{i as h};
