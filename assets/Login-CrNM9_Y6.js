import{Z as k,r as A,q as V,x as C,z as o,P as r,H as n,ay as u,y as O,L as w,ap as B,u as v}from"./vendor-vue-CZOMRj4y.js";import{u as I,b as W}from"./vendor-vue-router-o2a2TmKO.js";import{l as M}from"./auth-BqM3s_5E.js";import{_ as T,u as F}from"./index-ql1pe5O8.js";import{u as K,l as P,E as f}from"./vendor-element-plus-nv6hIq5t.js";import"./http-DGyH82Tn.js";import"./vendor-axios-C0Zqfgkc.js";import"./vendor-pinia--LqfdQ-h.js";import"./vendor-lodash-rvV0CIkQ.js";import"./vendor-DWCz07M-.js";import"./vendor-dates-DVKSwKij.js";const U="/logo.png",q={class:"login-page"},z={class:"login-shell"},H={class:"card-inner"},D={class:"brand"},Z={__name:"Login",setup(j){const _=W(),E=I(),c=F(),l=k({username:"",password:""}),m=A(!1);function y(t){return t===ROLE.MARKET?"/channels":t===ROLE.FINANCE?"/finance":"/orders/all"}function L(t,e){const s=String(e||"");return!(!s.startsWith("/")||t===ROLE.FINANCE&&s.startsWith("/orders")||t===ROLE.SALES&&s.startsWith("/finance")||(t===ROLE.SALES||t===ROLE.FINANCE)&&s.startsWith("/users"))}function h(t){return/[\u4e00-\u9fa5]/.test(String(t||""))}function R(t){const e=t?.response?.status,s=t?.response?.data?.detail,i=t?.message;if(s&&typeof s=="string"&&h(s))return s;const a=String(i||"");return/timeout/i.test(a)||/ECONNABORTED/i.test(String(t?.code||""))?"请求超时，请检查网络后重试":/Network Error/i.test(a)?"网络异常，请检查网络连接":e===401?"登录失败：账号或密码不正确":e===403?"登录失败：当前账号无权限":e>=500?"服务器异常，请稍后重试":e?"登录失败，请稍后重试":"登录失败，请检查网络后重试"}async function g(t){const e=E.query.redirect,s=typeof e=="string"&&e.startsWith("/")?e:"";s&&L(t,s)?await _.replace(s):await _.replace(y(t))}V(async()=>{document.body.classList.remove("app-shell-lock"),c.isLoggedIn&&await g(c.roleName)});async function b(){if(m.value)return;const t=String(l.username||"").trim(),e=String(l.password||"");if(!t||!e){f.warning("请输入用户名和密码");return}m.value=!0;try{const s=await M({username:t,password:e}),i=s?.data?.session_token||"",a=s?.data?.user||null,d=a?.role_name||"";if(!i){f.error("登录失败：登录信息异常，请联系管理员");return}if(!d){f.error("登录失败：账号权限信息异常，请联系管理员");return}c.setToken(i),c.setRoleName(d),c.setUser(a),f.success("登录成功"),await g(d)}catch(s){console.error(s),f.error(R(s))}finally{m.value=!1}}return(t,e)=>{const s=u("el-tag"),i=u("el-icon"),a=u("el-input"),d=u("el-form-item"),S=u("el-button"),x=u("el-form"),N=u("el-card");return O(),C("div",q,[e[6]||(e[6]=o("div",{class:"bg-blobs","aria-hidden":"true"},[o("span",{class:"blob b1"})],-1)),o("div",z,[r(N,{class:"login-card",shadow:"never"},{default:n(()=>[o("div",H,[o("div",D,[e[3]||(e[3]=o("div",{class:"brand-left"},[o("div",{class:"logo-wrap"},[o("img",{src:U,alt:"Logo",class:"logo"})]),o("div",{class:"brand-text"},[o("div",{class:"brand-title"},"订单管理系统"),o("div",{class:"brand-subtitle"},"欢迎回来，请登录继续")])],-1)),r(s,{size:"small",type:"info",class:"brand-tag"},{default:n(()=>[...e[2]||(e[2]=[w("v1",-1)])]),_:1})]),r(x,{class:"login-form",model:l,"label-width":"72px",onKeyup:B(b,["enter"])},{default:n(()=>[r(d,{label:"用户名",class:"form-item"},{default:n(()=>[r(a,{modelValue:l.username,"onUpdate:modelValue":e[0]||(e[0]=p=>l.username=p),autocomplete:"username",placeholder:"请输入用户名",clearable:""},{prefix:n(()=>[r(i,null,{default:n(()=>[r(v(K))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(d,{label:"密码",class:"form-item"},{default:n(()=>[r(a,{modelValue:l.password,"onUpdate:modelValue":e[1]||(e[1]=p=>l.password=p),type:"password","show-password":"",autocomplete:"current-password",placeholder:"请输入密码",clearable:""},{prefix:n(()=>[r(i,null,{default:n(()=>[r(v(P))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(S,{class:"login-btn",type:"primary",loading:m.value,onClick:b},{default:n(()=>[...e[4]||(e[4]=[w(" 登录 ",-1)])]),_:1},8,["loading"]),e[5]||(e[5]=o("div",{class:"footer-note"},"登录即表示你同意系统的使用规范与审计记录。",-1))]),_:1},8,["model"])])]),_:1})])])}}},ne=T(Z,[["__scopeId","data-v-39284592"]]);export{ne as default};
