import{h as a}from"./http-DGyH82Tn.js";const u="Asia/Shanghai",O=new Set(["vehicle_cert","idcard_front","idcard_back","driving_license_main","driving_license_sub","related"]);function _(t){const e=Number(typeof t=="string"?t.trim():t);if(!Number.isFinite(e))throw new Error("orders api: invalid id");if(!Number.isInteger(e))throw new Error("orders api: id must be an integer");if(e<=0)throw new Error("orders api: invalid id");return e}function c(t){const e={};for(const[r,n]of Object.entries(t||{}))n!==void 0&&(e[r]=n);return e}function p(t){return Object.prototype.toString.call(t)==="[object Object]"}function d(t){return t instanceof Date&&Number.isFinite(t.getTime())}function l(t,e=u){const r=d(t)?t:new Date(t);return d(r)?new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit"}).format(r):""}function h(t){if(t==null)return"";if(d(t))return l(t,u);if(typeof t=="string"){const e=t.trim();if(!e)return"";if(/^\d{8}$/.test(e))return`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`;const r=e.match(/^(\d{4}-\d{2}-\d{2})/);if(r)return r[1];const n=e.match(/^(\d{4})\/(\d{2})\/(\d{2})/);return n?`${n[1]}-${n[2]}-${n[3]}`:""}if(typeof t=="number"&&Number.isFinite(t)){const e=new Date(t);return d(e)?l(e,u):""}return""}function b(t){if(!Array.isArray(t)||t.length!==2)return null;const e=h(t[0]),r=h(t[1]);return!e||!r?null:[e,r]}function j(t){const e={},r=t&&typeof t=="object"?t:{};for(const[n,i]of Object.entries(r))if(i!=null){if(typeof i=="string"){const s=i.trim();if(!s)continue;e[n]=s;continue}if(typeof i=="number"){if(!Number.isFinite(i))continue;e[n]=i;continue}if(d(i)){e[n]=l(i,u);continue}if(Array.isArray(i)){const s=i.map(o=>o==null?o:typeof o=="string"?o.trim():typeof o=="number"?Number.isFinite(o)?o:null:d(o)?l(o,u):o).filter(o=>o!=null&&!(typeof o=="string"&&o===""));if(!s.length)continue;e[n]=s;continue}e[n]=i}return e}function N(t){const e=j(t);if(Object.prototype.hasOwnProperty.call(e,"created_date")){const n=Object.prototype.hasOwnProperty.call(e,"created_date_start"),i=Object.prototype.hasOwnProperty.call(e,"created_date_end"),s=!n&&!i?b(e.created_date):null;delete e.created_date,s&&(e.created_date_start=s[0],e.created_date_end=s[1])}if(Object.prototype.hasOwnProperty.call(e,"first_register_date")){const n=Object.prototype.hasOwnProperty.call(e,"first_register_date_start"),i=Object.prototype.hasOwnProperty.call(e,"first_register_date_end"),s=!n&&!i?b(e.first_register_date):null;delete e.first_register_date,s&&(e.first_register_date_start=s[0],e.first_register_date_end=s[1])}const r=[["created_date_start","created_date_end"],["first_register_date_start","first_register_date_end"]];for(const[n,i]of r){const s=Object.prototype.hasOwnProperty.call(e,n)&&String(e[n]??"").trim()!=="",o=Object.prototype.hasOwnProperty.call(e,i)&&String(e[i]??"").trim()!=="";s!==o&&(delete e[n],delete e[i])}return e}function g(t){return p(t)?t:{}}function m(t){if(t!==void 0)return p(t)?t:void 0}function P(t={}){const e=N(t);return a.get("/orders",{params:e})}function k(t){const e=_(t);return a.get(`/orders/${e}`)}function z(t={}){const e=g(t),r=c({module:e.module||"order",dynamic_data:p(e.dynamic_data)?e.dynamic_data:{},customer_group_id:e.customer_group_id??void 0,channel_group_id:e.channel_group_id??void 0,salesperson_id:e.salesperson_id??void 0,order_info:m(e.order_info)});return a.post("/orders/draft",r)}function w(t){if(!Array.isArray(t))return[];const e=[];for(const r of t){if(!r||typeof r!="object")continue;const n=r.slot_key!=null?String(r.slot_key).trim():"",i=r.storage_key!=null?String(r.storage_key).trim().replace(/^\/+/,""):"",s=r.md5!=null?String(r.md5).trim():"";if(!n||!O.has(n)||!i)continue;const o={slot_key:n,storage_key:i};if(s&&(o.md5=s),r.etag!=null&&String(r.etag).trim()&&(o.etag=String(r.etag).trim()),r.size!=null&&!Number.isNaN(Number(r.size))){const y=Number(r.size);Number.isFinite(y)&&(o.size=Math.max(0,y))}r.content_type!=null&&String(r.content_type).trim()&&(o.content_type=String(r.content_type).trim()),r.original_name!=null&&String(r.original_name).trim()&&(o.original_name=String(r.original_name).trim());const f=r.url!=null&&String(r.url).trim()?String(r.url).trim():r.preview_url!=null&&String(r.preview_url).trim()?String(r.preview_url).trim():"";f&&(o.url=f),e.push(o)}return e}function S(t){if(!Array.isArray(t))return[];const e=new Set(["related"]),r=new Set,n=[];for(const i of t){const s=String(i??"").trim();s&&e.has(s)&&(r.has(s)||(r.add(s),n.push(s)))}return n}function E(t={}){const e=g(t),r=S(e.clear_slots),n=w(e.images),i=c({order_id:e.order_id!=null?_(e.order_id):void 0,images:n,clear_slots:r.length?r:void 0,dynamic_data:m(e.dynamic_data),customer_group_id:e.customer_group_id??void 0,channel_group_id:e.channel_group_id??void 0,salesperson_id:e.salesperson_id??void 0,order_info:m(e.order_info)});return a.post("/orders/finalize",i)}function F({slot_key:t,file:e}={}){const r=String(t??"").trim();if(!r)throw new Error("orders api: slot_key is required");if(!O.has(r))throw new Error("orders api: invalid slot_key");if(!e)throw new Error("orders api: file is required");const n=new FormData;return n.append("slot_key",r),n.append("file",e),a.post("/orders/bos-upload",n)}function $({order_id:t,images:e=[],clear_slots:r=[],trigger_ocr:n=!0}={}){const i=_(t),s=w(e),o=S(r),f=c({images:s,clear_slots:o.length?o:void 0,trigger_ocr:!!n});return a.post(`/orders/${i}/images/bind`,f)}function D(t,e={}){const r=_(t),n=g(e),i=c({is_finished:n.is_finished!==void 0?n.is_finished:void 0});return a.patch(`/orders/${r}/status`,i)}function I(){return a.get("/orders/customer-groups")}function T(){return a.get("/orders/channel-groups")}function C(){return a.get("/orders/teams")}function L(t={}){const e=t&&typeof t=="object"?t:{},r=typeof e.team_name=="string"?e.team_name.trim():"",n=e.status!==void 0&&e.status!==null?Number(e.status):1,i=Number.isFinite(n)?n:1,s=c({status:i,team_name:r||void 0});return a.get("/orders/salespersons",{params:s})}export{D as a,I as b,z as c,T as d,C as e,E as f,k as g,L as h,$ as i,P as l,F as u};
